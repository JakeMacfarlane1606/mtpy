

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MTpy.core.OCCAMTools &mdash; MTpy 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MTpy.core.OCCAMTools</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Aug 23 11:54:38 2011</span>

<span class="sd">@author: a1185872</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="c">#import shutil</span>
<span class="c">#import subprocess</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">matplotlib.colorbar</span> <span class="kn">as</span> <span class="nn">mcb</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
<span class="c">#from matplotlib.colorbar import * </span>

<span class="n">occamdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;1&#39;</span><span class="p">:</span><span class="s">&#39;resxy&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">:</span><span class="s">&#39;phasexy&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">:</span><span class="s">&#39;realtip&#39;</span><span class="p">,</span><span class="s">&#39;4&#39;</span><span class="p">:</span><span class="s">&#39;imagtip&#39;</span><span class="p">,</span><span class="s">&#39;5&#39;</span><span class="p">:</span><span class="s">&#39;resyx&#39;</span><span class="p">,</span>
           <span class="s">&#39;6&#39;</span><span class="p">:</span><span class="s">&#39;phaseyx&#39;</span><span class="p">}</span>

<div class="viewcode-block" id="make1DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.make1DdataFile">[docs]</a><span class="k">def</span> <span class="nf">make1DdataFile</span><span class="p">(</span><span class="n">station</span><span class="p">,</span><span class="n">edipath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">polarization</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span>
                   <span class="n">reserr</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="n">phaseerr</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.6e</span><span class="s">&#39;</span><span class="p">,</span><span class="n">ss</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make1Ddatafile will write a data file for Occam1D</span>

<span class="sd">    Input:</span>
<span class="sd">        station = the station name and path if edipath=None</span>
<span class="sd">        edipath = path to the edi files to be written into a data file,</span>
<span class="sd">                  useful for multile data files</span>
<span class="sd">        savepath = path to save the file</span>
<span class="sd">        thetar = rotation angle to rotate Z</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    #===============================================================================</span>
<span class="sd">    # Input parameters</span>
<span class="sd">    #===============================================================================</span>
<span class="sd">    </span>
<span class="sd">    edipath=r&quot;C:\Peacock\My Dropbox\Paralana\EDIFilesBaseSurvey\SS&quot; #path to edi&#39;s</span>
<span class="sd">    station=&#39;pb01&#39;  #station to create data file for                   </span>
<span class="sd">    savepath=r&quot;C:\Peacock\PHD\OCCAM\1DInversion\Base&quot;  #path to save the data file</span>
<span class="sd">    polarization=&#39;both&#39;  #choose component either xy or yx or both</span>
<span class="sd">    reserr=&#39;data&#39;   #either data or set as a percentage</span>
<span class="sd">    phaseerr=&#39;data&#39; #either data or set as percentage -&gt; 10 for 10 percent error</span>
<span class="sd">    ss=&#39;   &#39;</span>
<span class="sd">    fmt=&#39;%.6e&#39;</span>
<span class="sd">    #===============================================================================</span>
<span class="sd">    # open up edi file and write data file</span>
<span class="sd">    #===============================================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="kn">import</span> <span class="nn">MTpy.core.Z</span>


    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">station</span><span class="p">)</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">edipath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;Need to input a path for the file.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#find the edifile</span>
            <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">edifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edifile</span><span class="o">=</span><span class="n">station</span>
            
    <span class="c">#raise an error if can&#39;t find the edifile        </span>
    <span class="k">if</span> <span class="n">edifile</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;No edifile exists, check path and station name&#39;</span><span class="p">)</span>

    <span class="c">#read in edifile    </span>
    <span class="n">impz</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>    
    
    <span class="c">#make sure the savepath exists, if not create it</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">savepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">savepath</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">savepath</span><span class="p">))</span>
    
    <span class="c">#load the edifile and get resistivity and phase</span>
    
    <span class="n">rp</span><span class="o">=</span><span class="n">impz</span><span class="o">.</span><span class="n">getResPhase</span><span class="p">(</span><span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
    <span class="n">freq</span><span class="o">=</span><span class="n">impz</span><span class="o">.</span><span class="n">frequency</span>
    <span class="n">nf</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">returnfn</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">polarization</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;xy&#39;</span><span class="p">,</span><span class="s">&#39;yx&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">dfilesave</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">impz</span><span class="o">.</span><span class="n">station</span><span class="o">+</span><span class="n">pol</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;.dat&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dfilesave</span><span class="o">=</span><span class="n">savepath</span>
            <span class="n">datafid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dfilesave</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>

            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Format:  EMData_1.1 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!Polarization:&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

            <span class="c">#needs a transmitter to work so put in a dummy one</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Transmitters: 1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;0 0 0 0 0 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            
            <span class="c">#write frequencies</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Frequencies:&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>       
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freq</span><span class="p">:</span>
                <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            
            <span class="c">#needs a receiver to work so put in a dummy one</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Receivers: 1 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;0 0 0 0 0 0 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            
            <span class="c">#write data</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Data:&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nf</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Type&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Freq#&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Tx#&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Rx#&#39;</span><span class="o">+</span>
                          <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Data&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Std_Error&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                          
            <span class="c">#put the yx phase component in the first quadrant as prescribed</span>
            <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                    <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span>
                    <span class="c">#check if there are any negative phases</span>
                    <span class="n">negphase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negphase</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">negphase</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span>\
                                                        <span class="p">[</span><span class="n">negphase</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="mi">360</span>
                    
            <span class="c">#write the resistivity and phase components</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
                <span class="c">#write resistivity components</span>
                <span class="k">if</span> <span class="n">reserr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resyxerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">reserr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">reserr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                
                <span class="c">#write phase components</span>
                <span class="k">if</span> <span class="n">phaseerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">phaseerr</span><span class="o">/</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                      <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                      <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">phaseerr</span><span class="o">/</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&#39;Wrote Data File: &#39;</span><span class="p">,</span><span class="n">dfilesave</span>
            <span class="n">returnfn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfilesave</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">returnfn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">returnfn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">polarization</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
            <span class="n">pol</span><span class="o">=</span><span class="s">&#39;xy&#39;</span>
        <span class="k">elif</span> <span class="n">polarization</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
            <span class="n">pol</span><span class="o">=</span><span class="s">&#39;yx&#39;</span>
        
        <span class="k">if</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">dfilesave</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">impz</span><span class="o">.</span><span class="n">station</span><span class="o">+</span><span class="n">pol</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;.dat&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfilesave</span><span class="o">=</span><span class="n">savepath</span>
        <span class="c">#open file to write to</span>
        <span class="n">datafid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dfilesave</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Format:  EMData_1.1 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!Polarization:&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c">#needs a transmitter to work so put in a dummy one</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Transmitters: 1</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;0 0 0 0 0 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write frequencies</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Frequencies:&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>       
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freq</span><span class="p">:</span>
            <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#needs a receiver to work so put in a dummy one</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Receivers: 1 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;0 0 0 0 0 0 </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write header line</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;# Data:&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nf</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Type&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Freq#&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Tx#&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Rx#&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                      <span class="s">&#39;Data&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;Std_Error&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                      
        <span class="c">#put the yx phase component in the first quadrant as prescribed</span>
        <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span>
                <span class="c">#check if there are any negative phases</span>
                <span class="n">negphase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negphase</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">negphase</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span>\
                                                    <span class="p">[</span><span class="n">negphase</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="mi">360</span>
                
        <span class="c">#write the resistivity and phase components</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="c">#write resistivity components</span>
            <span class="k">if</span> <span class="n">reserr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resyxerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">reserr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;RhoZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">reserr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            
            <span class="c">#write phase components</span>
            <span class="k">if</span> <span class="n">phaseerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;xy&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">phaseerr</span><span class="o">/</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s">&#39;yx&#39;</span><span class="p">:</span>
                    <span class="n">datafid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;PhsZ&#39;</span><span class="o">+</span><span class="n">pol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span>
                                  <span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ss</span><span class="o">+</span>
                                  <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">phaseerr</span><span class="o">/</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datafid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;Wrote Data File: &#39;</span><span class="p">,</span><span class="n">dfilesave</span>
        <span class="k">return</span> <span class="n">dfilesave</span>
</div>
<div class="viewcode-block" id="make1DModelFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.make1DModelFile">[docs]</a><span class="k">def</span> <span class="nf">make1DModelFile</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">nlayers</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">bottomlayer</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">basestep</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">z1layer</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">airlayerheight</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes a 1D model file</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        savepath =path to save file to, if just path saved as savepath\model.mod</span>
<span class="sd">        nlayers = number of layers</span>
<span class="sd">        bottomlayer = depth of bottom layer in meters</span>
<span class="sd">        basestep = numerical base of logarithmic depth step 10 or 2 or 1 for </span>
<span class="sd">                    linear</span>
<span class="sd">        z1layer = depth of first layer in meters</span>
<span class="sd">        airlayerheight = height of air layers in meters</span>
<span class="sd">    Output:</span>
<span class="sd">        modelfilename = full path to model file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c">#===========================================================================</span>
    <span class="c"># Make model file</span>
    <span class="c">#===========================================================================</span>
    <span class="c">#make sure the savepath exists, if not create it</span>
    
    <span class="n">ss</span><span class="o">=</span><span class="s">&#39;   &#39;</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">modfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;model.txt&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">modfn</span><span class="o">=</span><span class="n">savepath</span>
    
    <span class="c">#---------need to refine this-------------------- </span>
    <span class="c">#make an array of layer depths on a scale specified by base</span>
<span class="c">#    layers=np.zeros(nlayers+1)</span>
<span class="c">#    layers[0]=z1layer</span>
    
    <span class="n">layers</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">z1layer</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">bottomlayer</span><span class="p">),</span><span class="n">num</span><span class="o">=</span><span class="n">nlayers</span><span class="p">)</span>   
<span class="c">#    if basestep==10:</span>
<span class="c">#    #    l=np.log10(np.logspace(0,np.log10(bottomlayer),num=nlayers))</span>
<span class="c">#        l=np.linspace(1,np.log10(bottomlayer)+1,num=nlayers+1)</span>
<span class="c">#    </span>
<span class="c">#    elif basestep==2:</span>
<span class="c">#    #    l=np.log2(np.logspace(0,np.log2(bottomlayer),num=nlayers)</span>
<span class="c">#        l=np.linspace(1,np.log2(bottomlayer)+1,num=nlayers+1)</span>
<span class="c">#    elif basestep==1:</span>
<span class="c">#        l=np.linspace(1,np.log10(bottomlayer)+1,num=nlayers+1)</span>
<span class="c">#    else:</span>
<span class="c">#        raise ValueError(&#39;Base &#39;+str(basestep)+&#39; not supported&#39;)</span>
<span class="c">#    </span>
<span class="c">#    for ll in range(1,nlayers+1):</span>
<span class="c">#        layers[ll]=layers[0:ll].sum()+z1layer*np.floor(l[ll])</span>
        
    
    
    
<span class="c">#% Create seabed layers:</span>
<span class="c">#    switch lower(zScale)</span>
<span class="c">#        case &#39;uniform&#39;</span>
<span class="c">#            z = linspace(oceanDepth,maxDepth, nSeaBedLay);</span>
<span class="c">#        case {&#39;log&#39;,&#39;logarithmic&#39;}</span>
<span class="c">#            z = logspace(log10(oceanDepth),log10(maxDepth), nSeaBedLay);</span>
<span class="c">#    end</span>
<span class="c">#    r = z*0 - 1; % make vector of -1&#39;s</span>
<span class="c">#    </span>
<span class="c">#</span>
<span class="c">#    Model(:,1) = [zsea; z(:)];</span>
<span class="c">#    Model(:,2) = [rsea; r(:)];</span>
<span class="c">#    </span>
<span class="c">#    Model(:,3) = 1;</span>
<span class="c">#    Model(1:length(zsea)+1,3) = 0;  % +1 is for top of first seabed layer. </span>
<span class="c">#    Model(:,4) = 0; % pref penalty</span>
<span class="c">#    Model(:,5) = 0; % pref penalty</span>
<span class="c">#</span>
<span class="c">#% Write Model File:</span>
<span class="c">#</span>
<span class="c">#% Open file:</span>
<span class="c">#    fid = fopen(filename,&#39;w&#39;);</span>
<span class="c">#    if fid &lt;= 0 </span>
<span class="c">#        fprintf(&#39;Error creating model file: %s\n&#39;,filename); </span>
<span class="c">#        status = -1;</span>
<span class="c">#        return</span>
<span class="c">#    end</span>
<span class="c">#</span>
<span class="c">#% Format:</span>
<span class="c">#  fprintf(fid,&#39;Format:     Resistivity1DMod_1.0\n&#39;);</span>
<span class="c">#  </span>
<span class="c">#% Num Layers:</span>
<span class="c"># nlay = length(Model(:,1));</span>
<span class="c"># fprintf(fid,&#39;#Layers:    %i\n&#39;,nlay);</span>
<span class="c">#    </span>
<span class="c">#% Comments with column labels:</span>
<span class="c">#    fprintf(fid,&#39;! top_depth 	resistivity  penalty	preference   pref_penalty\n&#39;);</span>
<span class="c">#</span>
<span class="c">#% Write out the array:</span>
<span class="c">#  fprintf(fid,&#39;%12g %12g %12g %12g %12g\n&#39;,Model&#39;); </span>
<span class="c">#</span>
<span class="c">#% Close the file:</span>
<span class="c">#   fclose(fid);    </span>
    
    <span class="c">#make the model file</span>
    <span class="n">modfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">modfn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Format: Resistivity1DMod_1.0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#LAYERS:    &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nlayers</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!Set free values to -1 or ? </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!penalize between 1 and 0,&#39;</span><span class="o">+</span>
                 <span class="s">&#39;0 allowing jump between layers and 1 smooth. </span><span class="se">\n</span><span class="s">&#39;</span> <span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!preference is the assumed resistivity on linear scale. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!pref_penalty needs to be put if preference is not 0 [0,1]. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;! top_depth&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;resistivity&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;penalty&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;preference&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                 <span class="s">&#39;pref_penalty </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;-10000&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1d12&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;!air layer </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;-1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;!first ground layer </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
        <span class="n">modfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;-1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="n">modfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;Wrote Model file: &#39;</span><span class="p">,</span><span class="n">modfn</span>
    
    <span class="k">return</span> <span class="n">modfn</span>
</div>
<div class="viewcode-block" id="make1DInputFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.make1DInputFile">[docs]</a><span class="k">def</span> <span class="nf">make1DInputFile</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">modelfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">datafile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">roughtype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">targetrms</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">rhostart</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s">&#39;1dInv&#39;</span><span class="p">,</span>
                    <span class="n">lagrange</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span><span class="n">roughness</span><span class="o">=</span><span class="mf">1.0E7</span><span class="p">,</span><span class="n">debuglevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">iteration</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">misfit</span><span class="o">=</span><span class="mf">100.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a 1D input file for occam</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        savepath = full path to save input file to, if just path then saved as</span>
<span class="sd">                   savepath/input.input</span>
<span class="sd">        modelfile = full path to model file, if None then assumed to be in </span>
<span class="sd">                    savepath/model.mod</span>
<span class="sd">        datafile = full path to data file, if None then assumed to be in </span>
<span class="sd">                    savepath/data.data</span>
<span class="sd">        roughtype = roughness type</span>
<span class="sd">        maxiter = maximum number of iterations</span>
<span class="sd">        targetrms = target rms value</span>
<span class="sd">        rhostart = starting resistivity value on linear scale</span>
<span class="sd">        paramcount = </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="n">ss</span><span class="o">=</span><span class="s">&#39;   &#39;</span>
    
    <span class="c">#make input data file name</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">inputfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;input.txt&#39;</span><span class="p">)</span>
        <span class="n">ipath</span><span class="o">=</span><span class="n">savepath</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inputfn</span><span class="o">=</span><span class="n">savepath</span>
        <span class="n">ipath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">modelfile</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">modelfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ipath</span><span class="p">,</span><span class="s">&#39;model.txt&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">datafile</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">datafile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ipath</span><span class="p">,</span><span class="s">&#39;Data.txt&#39;</span><span class="p">)</span>
    
    <span class="n">mdict</span><span class="o">=</span><span class="n">read1DModelFile</span><span class="p">(</span><span class="n">modelfile</span><span class="p">)</span>
    <span class="n">paramcount</span><span class="o">=</span><span class="n">mdict</span><span class="p">[</span><span class="s">&#39;nparam&#39;</span><span class="p">]</span>        
    
    <span class="n">infid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">inputfn</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Format:             OCCAMITER_FLEX      ! Flexible format </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Description:        &#39;</span><span class="o">+</span><span class="n">description</span><span class="o">+</span><span class="s">&#39;     !For your own notes. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Model File:         &#39;</span><span class="o">+</span><span class="n">modelfile</span><span class="o">+</span><span class="s">&#39;       </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Data File:          &#39;</span><span class="o">+</span><span class="n">datafile</span><span class="o">+</span><span class="s">&#39;        </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>                                                                     
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Date/Time:          &#39;</span><span class="o">+</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>         
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Max Iter:           &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">maxiter</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Target Misfit:      &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">targetrms</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Roughness Type:     &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">roughtype</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!Model Bounds:      min,max             ! Optional, places bounds&#39;</span><span class="o">+</span>
                <span class="s">&#39; on log10(rho) values. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;!Model Value Steps: stepsize            ! Optional, forces model&#39;</span><span class="o">+</span>
                <span class="s">&#39; into discrete steps of stepsize. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Debug Level:        &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">debuglevel</span><span class="p">)</span><span class="o">+</span>
                <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">19</span><span class="o">+</span><span class="s">&#39;! Console output. &#39;</span><span class="o">+</span>
                <span class="s">&#39;0: minimal, 1: default, 2: detailed </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Iteration:          &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span><span class="o">+</span>
                <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">19</span><span class="o">+</span><span class="s">&#39;! Iteration number,&#39;</span><span class="o">+</span>
                <span class="s">&#39; use 0 for starting from scratch. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Lagrange Value:     &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lagrange</span><span class="p">)</span><span class="o">+</span>
                <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">17</span><span class="o">+</span><span class="s">&#39;! log10(largrance &#39;</span><span class="o">+</span>
                <span class="s">&#39;multiplier), starting value.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Roughness Value:    &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">roughness</span><span class="p">)</span><span class="o">+</span>
                <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="s">&#39;! Roughness of last&#39;</span><span class="o">+</span>
                <span class="s">&#39; model, ignored on startup. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Misfit Value:       &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">misfit</span><span class="p">)</span><span class="o">+</span>
                <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">15</span><span class="o">+</span><span class="s">&#39;! Misfit of model listed&#39;</span><span class="o">+</span>
                <span class="s">&#39;below. Ignored on startup.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Misfit Reached:     0	                ! 0: not reached,&#39;</span><span class="o">+</span>
                <span class="s">&#39; 1: reached.  Useful when restarting.</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Param Count:        &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">paramcount</span><span class="p">)</span><span class="o">+</span>
                <span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">17</span><span class="o">+</span><span class="s">&#39;! Number of free&#39;</span> <span class="o">+</span>
                <span class="s">&#39; inversion parameters. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">paramcount</span><span class="p">):</span>
        <span class="n">infid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rhostart</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="n">infid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;Wrote Input File: &#39;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">inputfn</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="read1DModelFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read1DModelFile">[docs]</a><span class="k">def</span> <span class="nf">read1DModelFile</span><span class="p">(</span><span class="n">modelfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    will read in model file</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        modelfile = full path to model file</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        mdict = dictionary of values with keys:</span>
<span class="sd">            depth = depth of model in meters</span>
<span class="sd">            res = value of resisitivity</span>
<span class="sd">            pen = penalty</span>
<span class="sd">            pre = preference</span>
<span class="sd">            prefpen = preference penalty</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">modelfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">mlines</span><span class="o">=</span><span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">mfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">mdict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;nparam&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">,</span><span class="s">&#39;res&#39;</span><span class="p">,</span><span class="s">&#39;pen&#39;</span><span class="p">,</span><span class="s">&#39;pref&#39;</span><span class="p">,</span><span class="s">&#39;prefpen&#39;</span><span class="p">]:</span>
        <span class="n">mdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">mm</span><span class="p">,</span><span class="n">mline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">mline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">mlst</span><span class="o">=</span><span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">mdict</span><span class="p">[</span><span class="n">mlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mlst</span><span class="o">=</span><span class="n">mlst</span><span class="o">=</span><span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;?&#39;</span><span class="p">:</span>
                <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;1d12&#39;</span><span class="p">:</span>
                <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0E12</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;pen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;pref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;prefpen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">mlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;-1&#39;</span> <span class="ow">or</span> <span class="n">mlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;?&#39;</span><span class="p">:</span>
                <span class="n">mdict</span><span class="p">[</span><span class="s">&#39;nparam&#39;</span><span class="p">]</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">,</span><span class="s">&#39;res&#39;</span><span class="p">,</span><span class="s">&#39;pen&#39;</span><span class="p">,</span><span class="s">&#39;pref&#39;</span><span class="p">,</span><span class="s">&#39;prefpen&#39;</span><span class="p">]:</span>
            <span class="n">mdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mdict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                
    <span class="k">return</span> <span class="n">mdict</span>
    </div>
<div class="viewcode-block" id="read1DInputFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read1DInputFile">[docs]</a><span class="k">def</span> <span class="nf">read1DInputFile</span><span class="p">(</span><span class="n">inputfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    reads in a 1D input file</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">infid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">inputfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ilines</span><span class="o">=</span><span class="n">infid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">infid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">indict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">indict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">iline</span> <span class="ow">in</span> <span class="n">ilines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">iline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ikey</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ivalue</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">indict</span><span class="p">[</span><span class="n">ikey</span><span class="p">]</span><span class="o">=</span><span class="n">ivalue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">indict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">indict</span>
</div>
<div class="viewcode-block" id="read1DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read1DdataFile">[docs]</a><span class="k">def</span> <span class="nf">read1DdataFile</span><span class="p">(</span><span class="n">datafile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    reads a 1D data file</span>
<span class="sd">    </span>
<span class="sd">    Iputs:</span>
<span class="sd">        datafile = full path to data file</span>
<span class="sd">    &quot;&quot;&quot;</span>            
    
    <span class="n">dfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="n">dlines</span><span class="o">=</span><span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">dfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c">#get format of input data</span>
    <span class="n">fmt</span><span class="o">=</span><span class="n">dlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    
    <span class="n">finddict</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">fkey</span><span class="o">=</span><span class="n">dline</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fvalue</span><span class="o">=</span><span class="n">ii</span>
            <span class="n">finddict</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span><span class="o">=</span><span class="n">fvalue</span>
    <span class="n">nfreq</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Frequencies&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    
    <span class="c">#frequency list</span>
    <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Frequencies&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                                                        <span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Receivers&#39;</span><span class="p">]]])</span>
            
    <span class="c">#data dictionary </span>
    <span class="n">rpdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;freq&#39;</span><span class="p">:</span><span class="n">freq</span><span class="p">,</span>
            <span class="s">&#39;resxy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)),</span>
            <span class="s">&#39;resyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)),</span>
            <span class="s">&#39;phasexy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)),</span>
            <span class="s">&#39;phaseyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">))</span>
            <span class="p">}</span>
            
    <span class="k">for</span> <span class="n">dline</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlst</span><span class="o">=</span><span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlst</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">jj</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">dvalue</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">derr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;RhoZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;103&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;PhsZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;104&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;RhoZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;105&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;PhsZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;106&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
    
    <span class="k">return</span> <span class="n">rpdict</span>
</div>
<div class="viewcode-block" id="read1DIterFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read1DIterFile">[docs]</a><span class="k">def</span> <span class="nf">read1DIterFile</span><span class="p">(</span><span class="n">iterfile</span><span class="p">,</span><span class="n">modelfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read an iteration file</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        iterfile = full path to iteration file</span>
<span class="sd">        modelfile = full path to model file</span>
<span class="sd">    </span>
<span class="sd">    Output:</span>
<span class="sd">        idict = dictionary with keys:</span>
<span class="sd">            depth = depth of model in m</span>
<span class="sd">            modelres = resistivity of model, any fixed parameters will be put in</span>
<span class="sd">                        correct place.</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">mdict</span><span class="o">=</span><span class="n">read1DModelFile</span><span class="p">(</span><span class="n">modelfile</span><span class="p">)</span>
    
    <span class="n">freeparams</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mdict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">ifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">iterfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ilines</span><span class="o">=</span><span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">idict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">model</span><span class="o">=</span><span class="p">[]</span>    
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">iline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ilines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">iline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">ikey</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ivalue</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">20</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">idict</span><span class="p">[</span><span class="n">ikey</span><span class="p">]</span><span class="o">=</span><span class="n">ivalue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ilst</span><span class="o">=</span><span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">ilst</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            
    <span class="n">model</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">idict</span><span class="p">[</span><span class="s">&#39;modelres&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mdict</span><span class="p">[</span><span class="s">&#39;res&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idict</span><span class="p">[</span><span class="s">&#39;modelres&#39;</span><span class="p">][</span><span class="n">freeparams</span><span class="p">]</span><span class="o">=</span><span class="n">model</span>
    <span class="n">idict</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mdict</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">idict</span>
    
</div>
<div class="viewcode-block" id="read1DRespFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read1DRespFile">[docs]</a><span class="k">def</span> <span class="nf">read1DRespFile</span><span class="p">(</span><span class="n">respfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read response file</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        repsfile = full path to response file</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        rpdict = dictionary with keys:</span>
<span class="sd">            freq = frequency array</span>
<span class="sd">            resxy,resyx,phasexy,phaseyx = array for corresponding component with</span>
<span class="sd">                index as:</span>
<span class="sd">                    0 = input data</span>
<span class="sd">                    1 = input error</span>
<span class="sd">                    2 = model data</span>
<span class="sd">                    3 = model error</span>
<span class="sd">    &quot;&quot;&quot;</span>
           
    
    <span class="n">dfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">respfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="n">dlines</span><span class="o">=</span><span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">dfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">finddict</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">fkey</span><span class="o">=</span><span class="n">dline</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fvalue</span><span class="o">=</span><span class="n">ii</span>
            <span class="n">finddict</span><span class="p">[</span><span class="n">fkey</span><span class="p">]</span><span class="o">=</span><span class="n">fvalue</span>
    <span class="n">nfreq</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Frequencies&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    
    <span class="c">#frequency list</span>
    <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Frequencies&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                                                        <span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Receivers&#39;</span><span class="p">]]])</span>
            
    <span class="c">#data dictionary </span>
    <span class="n">rpdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;freq&#39;</span><span class="p">:</span><span class="n">freq</span><span class="p">,</span>
            <span class="s">&#39;resxy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)),</span>
            <span class="s">&#39;resyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)),</span>
            <span class="s">&#39;phasexy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)),</span>
            <span class="s">&#39;phaseyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">))</span>
            <span class="p">}</span>
            
    <span class="k">for</span> <span class="n">dline</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="n">finddict</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlst</span><span class="o">=</span><span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlst</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">jj</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">dvalue</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">derr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">rvalue</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">rerr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;RhoZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;103&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rerr</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;PhsZxy&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;104&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rerr</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;RhoZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;105&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rerr</span>
                <span class="k">if</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;PhsZyx&#39;</span> <span class="ow">or</span> <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;106&#39;</span><span class="p">:</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">dvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">derr</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rvalue</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">rerr</span>
    
    <span class="k">return</span> <span class="n">rpdict</span>
    </div>
<div class="viewcode-block" id="plot1D"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plot1D">[docs]</a><span class="k">def</span> <span class="nf">plot1D</span><span class="p">(</span><span class="n">respfile</span><span class="p">,</span><span class="n">iterfile</span><span class="p">,</span><span class="n">modelfile</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
    
    <span class="c">#color for data</span>
    <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c">#color for occam model</span>
    <span class="n">ctem</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ctmm</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c">#color for Wingling model</span>
    <span class="n">ctewl</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ctmwl</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="c">#read in data</span>
    <span class="n">rpdict</span><span class="o">=</span><span class="n">read1DRespFile</span><span class="p">(</span><span class="n">respfile</span><span class="p">)</span>
    <span class="n">mdict</span><span class="o">=</span><span class="n">read1DIterFile</span><span class="p">(</span><span class="n">iterfile</span><span class="p">,</span><span class="n">modelfile</span><span class="p">)</span>

    <span class="n">period</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;freq&#39;</span><span class="p">]</span>
    
    <span class="c">#make a grid of subplots</span>
    <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">75</span><span class="p">)</span>
    
    <span class="c">#make a figure</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    
    <span class="c">#plot resistivity</span>
    <span class="n">axr</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,:</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxy</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">r1</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
        <span class="n">titlestr</span><span class="o">=</span><span class="s">&#39;$Z_{xy}$&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryx</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">r1</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
        <span class="n">titlestr</span><span class="o">=</span><span class="s">&#39;$Z_{yx}$&#39;</span>
                      
    <span class="n">rxym</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ryxm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxym</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">r2</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxym</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">rxym</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryxm</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">r2</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryxm</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">ryxm</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                      
    <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">],[</span><span class="s">&#39;Data&#39;</span><span class="p">,</span><span class="s">&#39;Model&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper left&#39;</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
               <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
               <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">)</span>
    
    <span class="c">#plot Phase</span>
    <span class="n">axp</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">4</span><span class="p">:,:</span><span class="mi">4</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axr</span><span class="p">)</span>
    <span class="n">pxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxy</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">p1</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyx</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">p1</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
                      
    <span class="n">pxym</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pyxm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxym</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">p2</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxym</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">pxym</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyxm</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">p2</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyxm</span><span class="p">],</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">pyxm</span><span class="p">],</span>
                      <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
                      
    <span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">axr</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
    <span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">titlestr</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
    
    <span class="c">#plot 1D inversion</span>
    <span class="n">axm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">modelresp</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">mdict</span><span class="p">[</span><span class="s">&#39;modelres&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">depthp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mdict</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mdict</span><span class="p">[</span><span class="s">&#39;depth&#39;</span><span class="p">]))])[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">axm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">modelresp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">depthp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps-&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="p">(</span><span class="n">depthp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">depthp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axm</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">depthp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ymax</span><span class="o">=</span><span class="n">depthp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c">#    axm.set_xlim(xmax=10**3)</span>
    <span class="n">axm</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (m)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axm</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Resistivity ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
<span class="c">#    axm.yaxis.set_minor_locator(MultipleLocator(200))</span>
<span class="c">#    axm.yaxis.set_major_locator(MultipleLocator(1000))</span>
    <span class="n">axm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
</div>
<div class="viewcode-block" id="make2DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.make2DdataFile">[docs]</a><span class="k">def</span> <span class="nf">make2DdataFile</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">mmode</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">stationlst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">resxyerr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">resyxerr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">phasexyerr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">phaseyxerr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                   <span class="n">ss</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%2.6f</span><span class="s">&#39;</span><span class="p">,</span><span class="n">freqstep</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">plotyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="n">lineori</span><span class="o">=</span><span class="s">&#39;ew&#39;</span><span class="p">,</span>
                   <span class="n">tippererr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ftol</span><span class="o">=.</span><span class="mo">05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    make2DdataFile will make a data file for occam2D.  </span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        edipath = path to edifiles</span>
<span class="sd">        mmode = modes to invert for.  Can be: </span>
<span class="sd">                &#39;both&#39; -&gt; will model both TE and TM modes</span>
<span class="sd">                &#39;TM&#39;   -&gt; will model just TM mode</span>
<span class="sd">                &#39;TE&#39;   -&gt; will model just TE mode</span>
<span class="sd">        savepath = path to save the data file to, this can include the name of</span>
<span class="sd">                   the data file, if not the file will be named:</span>
<span class="sd">                       savepath\Data.dat or edipath\Data.dat if savepath=None</span>
<span class="sd">        stationlst = list of stations to put in the data file, doesn&#39;t need to</span>
<span class="sd">                     be in order, the relative distance will be calculated</span>
<span class="sd">                     internally.  If stationlst=None, it will be assumed all the</span>
<span class="sd">                     files in edipath will be input into the data file</span>
<span class="sd">        title = title input into the data file</span>
<span class="sd">        thetar = rotation angle (deg) of the edifiles if you want to align the</span>
<span class="sd">                 components with the profile.  Angle is on the unit circle with </span>
<span class="sd">                 an orientation that north is 0 degree, east -90.</span>
<span class="sd">        resxyerr = percent error in the res_xy component (TE), </span>
<span class="sd">                  can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                  used.  </span>
<span class="sd">        resyxerr = percent error in the res_yx component (TM), </span>
<span class="sd">                  can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                  used.  </span>
<span class="sd">        phasexyerr = percent error in the phase_xy component (TE), </span>
<span class="sd">                  can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                  used.  </span>
<span class="sd">        phaseyxerr = percent error in the phase_yx component (TM), </span>
<span class="sd">                  can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                  used.  </span>
<span class="sd">        ss = is the spacing parameter for the data file</span>
<span class="sd">        fmt = format of the numbers for the data file, see string formats for </span>
<span class="sd">              a full description</span>
<span class="sd">        freqstep = take frequencies at this step, so if you want to take every</span>
<span class="sd">                   third frequency enter 3.  </span>
<span class="sd">                   Can input as a list of specific frequencies.  Note that the</span>
<span class="sd">                   frequencies must match the frequencies in the EDI files,</span>
<span class="sd">                   otherwise they will not be input.  </span>
<span class="sd">        plotyn = y or n to plot the stations on the profile line.</span>
<span class="sd">        lineori = predominant line orientation with respect to geographic north</span>
<span class="sd">                 ew for east-west line-&gt; will orientate so first station is </span>
<span class="sd">                                         farthest to the west</span>
<span class="sd">                 ns for north-south line-&gt; will orientate so first station is </span>
<span class="sd">                                         farthest to the south</span>
<span class="sd">        tippererr = error for tipper in percent.  If this value is entered than</span>
<span class="sd">                    the tipper will be included in the inversion, if the value</span>
<span class="sd">                    is None than the tipper will not be included.</span>
<span class="sd">              </span>
<span class="sd">    Output:</span>
<span class="sd">        datfilename = full path of data file</span>
<span class="sd">                 </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">MTpy.core.MTtools</span> <span class="kn">as</span> <span class="nn">mt</span>
    <span class="kn">import</span> <span class="nn">MTpy.utils.LatLongUTMconversion</span> <span class="kn">as</span> <span class="nn">utm2ll</span>
    
    
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
        <span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
    <span class="c">#create rotation matrix</span>
    <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetar</span><span class="p">)],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetar</span><span class="p">)]])</span>
    
    <span class="c">#-----------------------Station Locations-----------------------------------    </span>
    <span class="c">#create a list to put all the station dictionaries into</span>
    <span class="n">surveylst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">eastlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">northlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">pstationlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">freqlst</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">stationlst</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">stationlst</span><span class="o">=</span><span class="p">[</span><span class="n">edifile</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> 
            <span class="k">for</span> <span class="n">edifile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">edifile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.edi&#39;</span><span class="p">)]</span>
    
    <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">):</span>
        <span class="c">#search for filenames in the given directory and match to station name</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;*.edi&#39;</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;Found station edifile: &#39;</span><span class="p">,</span> <span class="n">filename</span>
                <span class="n">surveydict</span><span class="o">=</span><span class="p">{}</span> <span class="c">#create a dictionary for the station data and info</span>
                <span class="n">edifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span> <span class="c">#create filename path</span>
                <span class="n">z1</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
<span class="c">#                edidict=mt.readedi(edifile) #read in edifile as a dictionary</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">frequency</span>                
<span class="c">#                freq=edidict[&#39;frequency&#39;]</span>
                <span class="c">#check to see if the frequency is in descending order</span>
                <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">z</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                    <span class="n">zvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">zvar</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                    <span class="n">tip</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tipper</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                    <span class="n">tipvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tippervar</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                    
<span class="c">#                    z=edidict[&#39;z&#39;][::-1,:,:]</span>
<span class="c">#                    zvar=edidict[&#39;zvar&#39;][::-1,:,:]</span>
<span class="c">#                    tip=edidict[&#39;tipper&#39;][::-1,:,:]</span>
<span class="c">#                    tipvar=edidict[&#39;tippervar&#39;][::-1,:,:]</span>
                    <span class="k">print</span> <span class="s">&#39;Flipped to descending frequency for station &#39;</span><span class="o">+</span><span class="n">station</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">z</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">z</span>
                    <span class="n">zvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">zvar</span>
                    <span class="n">tip</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tipper</span>
                    <span class="n">tipvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tippervar</span>
<span class="c">#                    z=edidict[&#39;z&#39;]</span>
<span class="c">#                    zvar=edidict[&#39;zvar&#39;]</span>
<span class="c">#                    tip=edidict[&#39;tipper&#39;]</span>
<span class="c">#                    tipvar=edidict[&#39;tippervar&#39;]</span>
                <span class="c">#rotate matrices if angle is greater than 0</span>
                <span class="k">if</span> <span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
                        <span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                        <span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                                             <span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                        
<span class="c">#                zone,east,north=utm2ll.LLtoUTM(23,edidict[&#39;lat&#39;],edidict[&#39;lon&#39;])</span>
                <span class="n">zone</span><span class="p">,</span><span class="n">east</span><span class="p">,</span><span class="n">north</span><span class="o">=</span><span class="n">utm2ll</span><span class="o">.</span><span class="n">LLtoUTM</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
                <span class="c">#put things into a dictionary to sort out order of stations</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">station</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">east</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">north</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;zone&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">zone</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">z</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">zvar</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;freq&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">freq</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tip</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tipvar</span>
<span class="c">#                surveydict[&#39;lat&#39;]=edidict[&#39;lat&#39;]</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">lat</span>
<span class="c">#                surveydict[&#39;lon&#39;]=edidict[&#39;lon&#39;]</span>
                <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;lon&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">lon</span>
                <span class="n">freqlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
                <span class="n">eastlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">east</span><span class="p">)</span>
                <span class="n">northlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">north</span><span class="p">)</span>
                <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>
                <span class="n">surveylst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surveydict</span><span class="p">)</span>
                
    <span class="c">#project stations onto a best fitting line</span>
    <span class="c">#plot a bestfitting line</span>
    <span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">eastlst</span><span class="p">,</span><span class="n">northlst</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&#39;Profile Line Angle is: {0:.4g} (E=0,N=90)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    
    <span class="c">#plot stations on profile line</span>
    <span class="k">if</span> <span class="n">plotyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Projected Stations&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eastlst</span><span class="p">,</span><span class="n">sp</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">eastlst</span><span class="p">),</span><span class="s">&#39;-b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">surveylst</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;zone&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;zone&#39;</span><span class="p">]:</span>
            <span class="k">print</span> <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">]</span>
        <span class="n">d</span><span class="o">=</span><span class="p">(</span><span class="n">northlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">sp</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">eastlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">x0</span><span class="o">=</span><span class="n">eastlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">y0</span><span class="o">=</span><span class="n">northlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">x0</span>
        <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">y0</span>
        <span class="k">if</span> <span class="n">plotyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="o">+.</span><span class="mo">0005</span><span class="p">,</span><span class="n">pstationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                 <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                                                        <span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        
        <span class="c">#need to figure out a way to account for zone changes</span>
        
        <span class="k">if</span> <span class="n">lineori</span><span class="o">==</span><span class="s">&#39;ew&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]:</span>
                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]:</span>
                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">elif</span> <span class="n">lineori</span><span class="o">==</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]:</span>
                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]:</span>
                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="c">#sort by ascending order of distance from first station</span>
    <span class="n">surveylst</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">surveylst</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s">&#39;offset&#39;</span><span class="p">))</span>
    
    <span class="c">#number of stations read    </span>
    <span class="n">nstat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">surveylst</span><span class="p">)</span>    
    
    <span class="c">#--------------------------Match Frequencies--------------------------------</span>
    <span class="c">#a dictionary is created with the frequency as the key and the value is the</span>
    <span class="c">#frequency number in the list. Each edi file is iterated over extracting</span>
    <span class="c">#only the matched frequencies.  This makes it necessary to have the same</span>
    <span class="c">#frequency content in each edifile.    </span>
    
    <span class="c">#make a list to iterate over frequencies</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">freqstep</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">freqstep</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">freqstep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="c">#find the median frequency list</span>
            <span class="n">maxflen</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freqlst</span><span class="p">])</span>
            <span class="n">farray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nstat</span><span class="p">,</span><span class="n">maxflen</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstat</span><span class="p">):</span>
                <span class="n">farray</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">])]</span><span class="o">=</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        
            <span class="n">mfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">farray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">mfreq</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">freqstep</span><span class="p">)</span>
            <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mfreq</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">ii</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqstep</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">mfreq</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqstep</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#find the median frequency list</span>
        <span class="n">maxflen</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freqlst</span><span class="p">])</span>
        <span class="n">farray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nstat</span><span class="p">,</span><span class="n">maxflen</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstat</span><span class="p">):</span>
            <span class="n">farray</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">])]</span><span class="o">=</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        
        <span class="n">mfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">farray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
        <span class="c">#make a dictionary of values        </span>
        <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> 
                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">mfreq</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">maxflen</span><span class="p">,</span><span class="n">freqstep</span><span class="p">)],</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">ff</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span>

    <span class="c">#print the frequencies to look for to make sure its what the user wants</span>
    <span class="c">#make a list of keys that is sorted in descending order</span>
    <span class="n">klst</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">fdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="n">klst</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">klst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dd</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">klst</span><span class="p">]</span>    
    
    <span class="k">print</span> <span class="s">&#39;Frequencies to look for are: (# freq(Hz) Period(s)) &#39;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">klst</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">fdict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">key</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    
    <span class="c">#make lists of parameters to write to file    </span>
    <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">offsetlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">stationlstsort</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstat</span><span class="p">):</span>
        <span class="n">z</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">]</span>
        <span class="n">zvar</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;freq&#39;</span><span class="p">]</span>
        <span class="n">offsetlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">])</span>  
        <span class="n">stationlstsort</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">])</span>
        <span class="n">tip</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span>
        <span class="n">tipvar</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span>
        <span class="c">#loop over frequencies to pick out the ones desired</span>
        <span class="n">dflst</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">klst</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
            <span class="c">#jj is the index of edi file frequency list, this index corresponds</span>
            <span class="c">#to the impedance tensor component index</span>
            <span class="c">#ff is the frequency from the edi file frequency list</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c">#nn is the frequency number out of extracted frequency list</span>
                <span class="n">nn</span><span class="o">=</span><span class="n">fdict</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">]</span>
                            <span class="c">#calculate resistivity </span>
                <span class="n">wt</span><span class="o">=.</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
                <span class="n">resxy</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">resyx</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        
                <span class="c">#calculate the phase putting the yx in the 1st quadrant        </span>
                <span class="n">phasexy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">phaseyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span>\
                        <span class="mi">180</span>
                <span class="c">#put phases in correct quadrant if should be negative</span>
                <span class="k">if</span> <span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">:</span>
                    <span class="n">phaseyx</span><span class="o">=</span><span class="n">phaseyx</span><span class="o">-</span><span class="mi">360</span>
                    <span class="k">print</span> <span class="s">&#39;Found Negative Phase&#39;</span><span class="p">,</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">],</span><span class="n">ff</span>    
                
                <span class="c">#calculate errors</span>
                <span class="c">#res_xy (TE)</span>
                <span class="k">if</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                    <span class="n">dresxyerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resxy</span>
                    <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresxyerr</span><span class="o">/</span><span class="n">resxy</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                
                <span class="c">#Res_yx(TM)</span>
                <span class="k">if</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                    <span class="n">dresyxerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resyx</span>
                    <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresyxerr</span><span class="o">/</span><span class="n">resyx</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                
                <span class="c">#phase_xy(TE)</span>
                <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                    <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span>\
                                <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dphasexyerr</span><span class="o">=</span><span class="p">(</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                    
                <span class="c">#phase_yx (TM)</span>
                <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                    <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span>\
                                <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dphaseyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                
                <span class="c">#calculate log10 of resistivity as prescribed by OCCAM</span>
                <span class="n">lresyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resyx</span><span class="p">)</span>
                <span class="n">lresxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resxy</span><span class="p">)</span>
                
                <span class="c">#if include the tipper</span>
                <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c">#calculate the projection angle for real and imaginary</span>
                        <span class="n">tipphir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span>
                        <span class="n">tipphii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span>
                        
                        <span class="c">#project the tipper onto the profile line</span>
                        <span class="n">projtipr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphir</span><span class="p">)</span>
                        <span class="n">projtipi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphii</span><span class="p">)</span>
                                  
                        <span class="c">#error of tipper is a decimal percentage</span>
                        <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                        
                        <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                        
                    
                <span class="c">#make a list of lines to write to the data file</span>
                <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;mmode&#39;</span> <span class="o">+</span><span class="n">mmode</span><span class="o">+</span><span class="s">&#39; not defined&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c">#search around the frequency given by ftol</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">ff</span><span class="o">&gt;</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ftol</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ff</span><span class="o">&lt;</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ftol</span><span class="p">):</span>
                            <span class="n">nn</span><span class="o">=</span><span class="n">fdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>                           
                            <span class="n">wt</span><span class="o">=.</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
                            <span class="n">resxy</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                            <span class="n">resyx</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                    
                            <span class="c">#calculate the phase putting the yx in the 1st quadrant        </span>
                            <span class="n">phasexy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span>\
                                    <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                            <span class="n">phaseyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span>\
                                    <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="mi">180</span>
                            <span class="c">#put phases in correct quadrant if should be negative</span>
                            <span class="k">if</span> <span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">:</span>
                                <span class="n">phaseyx</span><span class="o">=</span><span class="n">phaseyx</span><span class="o">-</span><span class="mi">360</span>
                                <span class="k">print</span> <span class="s">&#39;Found Negative Phase&#39;</span><span class="p">,</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">],</span><span class="n">ff</span>    
                            
                            <span class="c">#calculate errors</span>
                            <span class="c">#res_xy (TE)</span>
                            <span class="k">if</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                <span class="n">dresxyerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resxy</span>
                                <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresxyerr</span><span class="o">/</span><span class="n">resxy</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                            
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                            
                            <span class="c">#Res_yx(TM)</span>
                            <span class="k">if</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                <span class="n">dresyxerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resyx</span>
                                <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresyxerr</span><span class="o">/</span><span class="n">resyx</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                            
                            <span class="c">#phase_xy(TE)</span>
                            <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span>\
                                            <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">dphasexyerr</span><span class="o">=</span><span class="p">(</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                                
                            <span class="c">#phase_yx (TM)</span>
                            <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span>\
                                            <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">dphaseyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                            
                            <span class="c">#calculate log10 of resistivity as prescribed by OCCAM</span>
                            <span class="n">lresyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resyx</span><span class="p">)</span>
                            <span class="n">lresxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resxy</span><span class="p">)</span>
                            
                            <span class="c">#if include the tipper</span>
                            <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                                    <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="c">#calculate the projection angle for real and imaginary</span>
                                    <span class="n">tipphir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span>
                                    <span class="n">tipphii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span>
                                    
                                    <span class="c">#project the tipper onto the profile line</span>
                                    <span class="n">projtipr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                              <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphir</span><span class="p">)</span>
                                    <span class="n">projtipi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                              <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphii</span><span class="p">)</span>
                                              
                                    <span class="c">#error of tipper is a decimal percentage</span>
                                    <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                                    
                                    <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                                    
                                
                            <span class="c">#make a list of lines to write to the data file</span>
                            <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;mmode&#39;</span> <span class="o">+</span><span class="n">mmode</span><span class="o">+</span><span class="s">&#39; not defined&#39;</span><span class="p">)</span>    
                        
                            <span class="k">break</span>                         
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
        <span class="c">#                           print &#39;Did not find frequency {0} for station {1}&#39;.format(ff,surveylst[kk][&#39;station&#39;])</span>
                            <span class="c">#calculate resistivity </span>
                               
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
    
    <span class="c">#===========================================================================</span>
    <span class="c">#                             write dat file</span>
    <span class="c">#===========================================================================</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">datfilename</span><span class="o">=</span><span class="n">savepath</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
            <span class="n">datfilename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;Data.dat&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">datfilename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="s">&#39;Data.dat&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">title</span><span class="o">=</span><span class="s">&#39;Occam Inversion&#39;</span>
        
    <span class="n">datfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">datfilename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FORMAT:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">11</span><span class="o">+</span><span class="s">&#39;OCCAM2MTDATA_1.0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TITLE:            </span><span class="si">%1.4f</span><span class="s">-- </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">title</span><span class="p">))</span>
    
    <span class="c">#write station sites</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nstat</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stationlstsort</span><span class="p">:</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write offsets</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OFFSETS (M):&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">offsetlst</span><span class="p">:</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">offset</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write frequencies</span>
    <span class="c">#writefreq=[freq[ff] for ff in range(0,len(freq),freqstep)]</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FREQUENCIES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fdict</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">klst</span><span class="p">:</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">fkey</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write data block</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA BLOCKS:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reslst</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;FREQ&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;TYPE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;DATUM&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;ERROR&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">datline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reslst</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">datline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Found #IND on line &#39;</span><span class="p">,</span><span class="n">ll</span>
            <span class="n">ndline</span><span class="o">=</span><span class="n">datline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">,</span><span class="s">&#39;00&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Replaced with 00&#39;</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ndline</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datline</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">print</span> <span class="s">&#39;Wrote Occam2D data file to: &#39;</span><span class="p">,</span><span class="n">datfilename</span>
    
    <span class="k">return</span> <span class="n">datfilename</span>
    </div>
<div class="viewcode-block" id="makeModel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.makeModel">[docs]</a><span class="k">def</span> <span class="nf">makeModel</span><span class="p">(</span><span class="n">datafilename</span><span class="p">,</span><span class="n">niter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">targetrms</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">nlayers</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">nlperdec</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
              <span class="n">z1layer</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">bwidth</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">trigger</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span><span class="n">cwd</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="n">rhostart</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
              <span class="n">makemodelexe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modelname</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">use_existing_startup</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">existing_startup_file</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makeModel will make an the input files for occam using Steve Constable&#39;s</span>
<span class="sd">    MakeModel2DMT.f code.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        datafn = full path to data file</span>
<span class="sd">        niter = maximum number of iterations</span>
<span class="sd">        targetrms = target root mean square error</span>
<span class="sd">        nlayers = total number of layers in mesh</span>
<span class="sd">        nlperdec = number of layers per decade</span>
<span class="sd">        z1layer = thickness of the first layer in meters</span>
<span class="sd">        bwidth = maximum block width for regularization grid in meters</span>
<span class="sd">        trigger = triger point to amalgamate blocks</span>
<span class="sd">        cwd     = working directory, files are saved here</span>
<span class="sd">        rhostart = starting resistivity for homogeneous half space in ohm-m</span>
<span class="sd">        use_existing_startup: set True, if an old iteration step output is provided as startup</span>
<span class="sd">        existing_startup_file: absolute path for old itereation output to be used as startup</span>

<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        meshfn = mesh file for finite element grid saved ats MESH</span>
<span class="sd">        inmodelfn = input model, starting model with rhostart as starting value</span>
<span class="sd">                    saved as INMODEL</span>
<span class="sd">        startupfn = start up filepath, saved as startup</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#get the base name of data file    </span>
    
    <span class="n">olddir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">curdir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">cwd</span><span class="p">)</span>

    <span class="n">dfnb</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">datafilename</span><span class="p">)</span>


    <span class="c">#deprecated....not necessary, if path is given in excplicit form</span>
    <span class="c">#put data file into the same directory as MakeModel2DMT</span>
    
    <span class="c">#write input file for MakeModel2DMT</span>
    <span class="n">mmfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s">&#39;inputMakeModel.txt&#39;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dfnb</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">niter</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>    
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">targetrms</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>    
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nlayers</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nlperdec</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z1layer</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bwidth</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">trigger</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mmfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#WRite parameters to local dict for passing to functions:</span>
    <span class="n">parameter_dict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;datafile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datafilename</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_max_iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">niter</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;targetrms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targetrms</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_layers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nlayers</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_layersperdecade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nlperdec</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;firstlayer_thickness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z1layer</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;max_blockwidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bwidth</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;trigger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trigger</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;cwd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cwd</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;rho_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhostart</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;modelname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelname</span>

    <span class="c">#shutil.copy(os.path.join(occampath,&#39;inputMakeModel.txt&#39;),</span>
                <span class="c">#os.path.join(os.path.dirname(datafilename),</span>
                             <span class="c">#&#39;inputMakeModel.txt&#39;))</span>
    
    
    <span class="c">#---call MakeModel2DMT---</span>
    <span class="c">#subprocess.os.system(&quot;%s &lt; inputMakeModel.txt&quot;%(makemodelexe))</span>

    
    <span class="c">#change back to original working directory    </span>
    <span class="c">#os.chdir(cdir)</span>
    
    
    <span class="n">meshfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s">&#39;MESH&#39;</span><span class="p">)</span>
    <span class="n">inmodelfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s">&#39;INMODEL&#39;</span><span class="p">)</span>
    <span class="n">startupfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span><span class="s">&#39;startup&#39;</span><span class="p">)</span>
    
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;meshfn&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">meshfn</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;inmodelfn&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">inmodelfn</span>
        

    <span class="k">if</span> <span class="n">use_existing_startup</span><span class="p">:</span>
        <span class="n">startupfn</span> <span class="o">=</span>  <span class="n">existing_startup_file</span>

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;startupfn&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">startupfn</span>
    
    <span class="c">#write OCCAM input files directly - no external function needed:</span>
    <span class="n">filelist</span><span class="o">=</span> <span class="n">makestartfiles</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">)</span>

    <span class="c">#deprecated....not necessary</span>
    <span class="c">#copy ouput files to savepath</span>
    
    <span class="c">#rewrite mesh so it contains the right number of columns and rows</span>
    <span class="c">#rewriteMesh(meshfn)</span>
    
    <span class="c">#write startup file to have the starting desired starting rho value</span>
    <span class="n">ifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">startupfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ilines</span><span class="o">=</span><span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">rhostart</span><span class="o">!=</span><span class="mi">100</span><span class="p">:</span>
        <span class="c">#make startup model a homogeneous half space of rhostart</span>
        <span class="n">rhostart</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rhostart</span><span class="p">)</span>
        <span class="n">ifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">startupfn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ilines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;2.000000&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;2.000000&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">rhostart</span><span class="p">)</span>
            <span class="n">ifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">print</span> <span class="s">&#39;Be sure to check the INMODEL file for clumped numbers near the bottom.&#39;</span>
    <span class="k">print</span> <span class="s">&#39;Also, check the MESH and startup files to make sure they are correct.&#39;</span>

    <span class="c">#go back to old path:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">olddir</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">filelist</span>

</div>
<div class="viewcode-block" id="rewriteMesh"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.rewriteMesh">[docs]</a><span class="k">def</span> <span class="nf">rewriteMesh</span><span class="p">(</span><span class="n">meshfn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    checkMesh will check to see if the number of lines are correct and the </span>
<span class="sd">    length of the line is correct</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c">#check the mesh</span>
    <span class="n">mfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">meshfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">mlines</span><span class="o">=</span><span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">mfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c">#get parameters for number of lines and number of unknowns per line    </span>
    <span class="n">pstr</span><span class="o">=</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">nhn</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">pstr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nvn</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pstr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span>
    
    <span class="k">print</span> <span class="s">&#39;Number of horizontal nodes: &#39;</span><span class="p">,</span><span class="n">nhn</span>
    <span class="k">print</span> <span class="s">&#39;Number of vertical nodes: &#39;</span><span class="p">,</span><span class="n">nvn</span>
    <span class="c">#find the first line</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">mline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">qspot</span><span class="o">=</span><span class="n">ii</span>
            <span class="k">break</span>

    <span class="c">#rewrite the file to have the proper amount of stuff</span>
    <span class="n">mfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">meshfn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">mlines</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">qspot</span><span class="p">]:</span>
        <span class="n">mfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">qspot</span><span class="p">,</span><span class="n">qspot</span><span class="o">+</span><span class="n">nvn</span><span class="p">):</span>
        <span class="n">mfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="o">*</span><span class="p">(</span><span class="n">nhn</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">mfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 
</div>
<div class="viewcode-block" id="read2Dmesh"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read2Dmesh">[docs]</a><span class="k">def</span> <span class="nf">read2Dmesh</span><span class="p">(</span><span class="n">meshfn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read a 2D meshfn</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        meshfn = full path to mesh file</span>

<span class="sd">    Output:</span>
<span class="sd">        hnodes = array of horizontal nodes (column locations (m))</span>
<span class="sd">        vnodes = array of vertical nodes (row locations(m))</span>
<span class="sd">        mdata = free parameters</span>
<span class="sd">        </span>
<span class="sd">    Things to do:</span>
<span class="sd">        incorporate fixed values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">mfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">meshfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="n">mlines</span><span class="o">=</span><span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
    <span class="n">nh</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">nv</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
    
    <span class="n">hnodes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
    <span class="n">vnodes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span>
    <span class="n">mdata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nh</span><span class="p">,</span><span class="n">nv</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>    
    
    <span class="c">#get horizontal nodes</span>
    <span class="n">jj</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">ii</span><span class="o">&lt;</span><span class="n">nh</span><span class="p">:</span>
        <span class="n">hline</span><span class="o">=</span><span class="n">mlines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">hline</span><span class="p">:</span>
            <span class="n">hnodes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>
            <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="c">#get vertical nodes</span>
    <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">ii</span><span class="o">&lt;</span><span class="n">nv</span><span class="p">:</span>
        <span class="n">vline</span><span class="o">=</span><span class="n">mlines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">vline</span><span class="p">:</span>
            <span class="n">vnodes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>
            <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>    
    
    <span class="c">#get free parameters        </span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">mm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">kk</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>        
            <span class="n">mline</span><span class="o">=</span><span class="n">mm</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;EXCEPTION&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nh</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mdata</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="n">mline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="k">return</span> <span class="n">hnodes</span><span class="p">,</span><span class="n">vnodes</span><span class="p">,</span><span class="n">mdata</span>
    </div>
<div class="viewcode-block" id="read2DInmodel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read2DInmodel">[docs]</a><span class="k">def</span> <span class="nf">read2DInmodel</span><span class="p">(</span><span class="n">inmodelfn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read an INMODEL file for occam 2D</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        inmodelfn = full path to INMODEL file</span>
<span class="sd">    </span>
<span class="sd">    Output:</span>
<span class="sd">        rows = list of combined data blocks where first number of each list</span>
<span class="sd">                represents the number of combined mesh layers for this </span>
<span class="sd">                regularization block.  The second number is the number of </span>
<span class="sd">                columns in the regularization block layer</span>
<span class="sd">        cols = list of combined mesh columns for the regularization layer.</span>
<span class="sd">               The sum of this list must be equal to the number of mesh</span>
<span class="sd">               columns.</span>
<span class="sd">        headerdict = dictionary of all the header information including the</span>
<span class="sd">                     binding offset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">ifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">inmodelfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="n">headerdict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">rows</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">cols</span><span class="o">=</span><span class="p">[]</span>    
    <span class="n">ncols</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="n">ilines</span><span class="o">=</span><span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">iline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ilines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">iline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">iline</span><span class="o">=</span><span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">headerdict</span><span class="p">[</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c">#append the last line</span>
            <span class="k">if</span> <span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;EXCEPTIONS&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iline</span><span class="o">=</span><span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">iline</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">iline</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span>
                <span class="n">ncols</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="o">+</span><span class="n">iline</span>
    
    <span class="k">return</span> <span class="n">rows</span><span class="p">,</span><span class="n">cols</span><span class="p">,</span><span class="n">headerdict</span>
                
    </div>
<div class="viewcode-block" id="read2DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read2DdataFile">[docs]</a><span class="k">def</span> <span class="nf">read2DdataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read2DdataFile will read in data from a 2D occam data file.  Only supports</span>
<span class="sd">    the first 6 data types of occam2D</span>
<span class="sd">    </span>
<span class="sd">    Input: </span>
<span class="sd">        datafn = full path to data file</span>
<span class="sd">    </span>
<span class="sd">    Output:</span>
<span class="sd">        rplst = list of dictionaries for each station with keywords:</span>
<span class="sd">            &#39;station&#39; = station name</span>
<span class="sd">            &#39;offset&#39; = relative offset,</span>
<span class="sd">            &#39;resxy&#39; = TE resistivity and error as row 0 and 1 ressectively,</span>
<span class="sd">            &#39;resyx&#39;= TM resistivity and error as row 0 and 1 respectively,</span>
<span class="sd">            &#39;phasexy&#39;= TE phase and error as row 0 and 1 respectively,</span>
<span class="sd">            &#39;phaseyx&#39;= Tm phase and error as row 0 and 1 respectively,</span>
<span class="sd">            &#39;realtip&#39;= Real Tipper and error as row 0 and 1 respectively,</span>
<span class="sd">            &#39;imagtip&#39;= Imaginary Tipper and error as row 0 and 1 respectively</span>
<span class="sd">            </span>
<span class="sd">            Note: that the resistivity will be in log10 space.  Also, there are</span>
<span class="sd">            2 extra rows in the data arrays, this is to put the response from</span>
<span class="sd">            the inversion. </span>
<span class="sd">        </span>
<span class="sd">        stationlst = list of stations in order from one side of the profile</span>
<span class="sd">                     to the other.</span>
<span class="sd">        freq = list of frequencies used in the inversion</span>
<span class="sd">        title = title, could be useful for plotting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">dfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="n">dlines</span><span class="o">=</span><span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c">#get format of input data</span>
    <span class="n">fmt</span><span class="o">=</span><span class="n">dlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    
    <span class="c">#get title</span>
    <span class="n">titlestr</span><span class="o">=</span><span class="n">dlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">titlestr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">tstr</span><span class="o">=</span><span class="n">titlestr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">theta</span><span class="o">=</span><span class="n">tstr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">title</span><span class="o">=</span><span class="n">tstr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">title</span><span class="o">=</span><span class="n">titlestr</span>
        <span class="n">theta</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">print</span> <span class="s">&#39;Need to figure out angle of profile line&#39;</span>
    <span class="c">#get number of sits</span>
    <span class="n">nsites</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    
    <span class="c">#get station names</span>
    <span class="n">stationlst</span><span class="o">=</span><span class="p">[</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nsites</span><span class="o">+</span><span class="mi">3</span><span class="p">)]</span>
    
    <span class="c">#get offsets in meters</span>
    <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="n">nsites</span><span class="p">,</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="p">)]</span>
    
    <span class="c">#get number of frequencies</span>
    <span class="n">nfreq</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c">#get frequencies</span>
    <span class="n">freq</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="p">,</span>
                                                      <span class="mi">5</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="o">+</span><span class="n">nfreq</span><span class="p">)]</span>
                                                      

    <span class="c">#-----------get data-------------------</span>
    <span class="c">#set zero array size the first row will be the data and second the error</span>
    <span class="n">asize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)</span>
    <span class="c">#make a list of dictionaries for each station.</span>
    <span class="n">rplst</span><span class="o">=</span><span class="p">[{</span><span class="s">&#39;station&#39;</span><span class="p">:</span><span class="n">station</span><span class="p">,</span><span class="s">&#39;offset&#39;</span><span class="p">:</span><span class="n">offsets</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
            <span class="s">&#39;resxy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
            <span class="s">&#39;resyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
            <span class="s">&#39;phasexy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
            <span class="s">&#39;phaseyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
            <span class="s">&#39;realtip&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
            <span class="s">&#39;imagtip&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
            <span class="p">}</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="o">+</span><span class="n">nfreq</span><span class="p">:]:</span>
        <span class="n">ls</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c">#station index</span>
        <span class="n">ss</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
        <span class="c">#component key</span>
        <span class="n">comp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
        <span class="c">#frequency index        </span>
        <span class="n">ff</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
        <span class="c">#print ls,ss,comp,ff</span>
        <span class="c">#put into array</span>
        <span class="c">#input data</span>
        <span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">0</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> 
        <span class="c">#error       </span>
        <span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">1</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">rplst</span><span class="p">,</span><span class="n">stationlst</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span><span class="n">title</span><span class="p">,</span><span class="n">theta</span>
    </div>
<div class="viewcode-block" id="rewrite2DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.rewrite2DdataFile">[docs]</a><span class="k">def</span> <span class="nf">rewrite2DdataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">edipath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">resxyerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span>
                      <span class="n">resyxerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span><span class="n">phasexyerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span><span class="n">phaseyxerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span>
                      <span class="n">tippererr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">mmode</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">flst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">removestation</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rewrite2DDataFile will rewrite an existing data file so you can redefine </span>
<span class="sd">    some of the parameters, such as rotation angle, or errors for the different</span>
<span class="sd">    components or only invert for one mode or add one or add tipper or remove</span>
<span class="sd">    tipper.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        datafn = full path to data file to rewrite</span>
<span class="sd">        </span>
<span class="sd">        rotz = rotation angle with positive clockwise</span>
<span class="sd">        </span>
<span class="sd">        resxyerr = error for TE mode resistivity (percent) or &#39;data&#39; for data </span>
<span class="sd">                    or prev to take errors from data file.</span>
<span class="sd">        </span>
<span class="sd">        resyxerr = error for TM mode resistivity (percent) or &#39;data&#39; for data</span>
<span class="sd">                    or prev to take errors from data file.</span>
<span class="sd">                    </span>
<span class="sd">        phasexyerr = error for TE mode phase (percent) or &#39;data&#39; for data</span>
<span class="sd">                    or prev to take errors from data file.</span>
<span class="sd">                    </span>
<span class="sd">        phaseyxerr = error for TM mode phase (percent) or &#39;data&#39; for data</span>
<span class="sd">                    or prev to take errors from data file.</span>
<span class="sd">                    </span>
<span class="sd">        tippererr = error for tipper (percent) input only if you want to invert</span>
<span class="sd">                    for the tipper or &#39;data&#39; for data errors</span>
<span class="sd">                    or prev to take errors from data file.</span>
<span class="sd">                    </span>
<span class="sd">        mmodes = &#39;both&#39; for both TE and TM</span>
<span class="sd">                 &#39;TE&#39; for TE</span>
<span class="sd">                 &#39;TM&#39; for TM</span>
<span class="sd">                 </span>
<span class="sd">        flst = frequency list in Hz to rewrite, needs to be similar to the </span>
<span class="sd">                datafile, cannot add frequencies</span>
<span class="sd">                </span>
<span class="sd">        removestation = list of stations to remove if desired</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ss</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="s">&#39; &#39;</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%2.6f</span><span class="s">&#39;</span>
    
    <span class="c">#load the data for the data file    </span>
    <span class="n">rplst</span><span class="p">,</span><span class="n">stationlst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="n">read2DdataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">)</span>
    
    <span class="c">#make a dictionary of rplst for easier extraction of data</span>
    <span class="n">rpdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">station</span><span class="p">,</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">)])</span>

    <span class="c">#remove stations from rplst and stationlst if desired</span>
    <span class="k">if</span> <span class="n">removestation</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="c">#if removestation is not a list make it one</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">removestation</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">removestation</span><span class="o">=</span><span class="p">[</span><span class="n">removestation</span><span class="p">]</span>
        
<span class="c">#        #remove station dictionary from rplst</span>
<span class="c">#        for rstation in removestation:</span>
<span class="c">#            for hh,hdict in enumerate(rplst):</span>
<span class="c">#                if hdict[&#39;station&#39;]==rstation:</span>
<span class="c">#                    rplst.remove(rplst[hh])</span>
        
        <span class="c">#remove station from station list           </span>
        <span class="k">for</span> <span class="n">rstation</span> <span class="ow">in</span> <span class="n">removestation</span><span class="p">:</span>        
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stationlst</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rstation</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Did not find &#39;</span><span class="o">+</span><span class="n">rstation</span>
    
    <span class="c">#if flst is not the same as freq make freq=flst</span>
    <span class="k">if</span> <span class="n">flst</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">flst</span>
    
    
    <span class="c">#if the rotation angle is not 0 than need to read the original data in</span>
    <span class="k">if</span> <span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">edipath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;Need to input the edipath to original edifiles to&#39;</span><span class="o">+</span>
                           <span class="s">&#39; get rotations correct&#39;</span><span class="p">)</span>
        
        <span class="c">#get list of edifiles already in data file</span>
        <span class="n">edilst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">edi</span><span class="p">)</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stationlst</span> 
                <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">edi</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">stat</span><span class="p">)]</span><span class="o">==</span><span class="n">stat</span><span class="p">]</span>
        <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">edifn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilst</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">imp1</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">edifn</span><span class="p">)</span>
            <span class="n">rp</span><span class="o">=</span><span class="n">imp1</span><span class="o">.</span><span class="n">getResPhase</span><span class="p">(</span><span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
            <span class="n">imptip</span><span class="o">=</span><span class="n">imp1</span><span class="o">.</span><span class="n">getTipper</span><span class="p">()</span>
            <span class="n">tip</span><span class="o">=</span><span class="n">imptip</span><span class="o">.</span><span class="n">tipper</span>
            <span class="n">station</span><span class="o">=</span><span class="n">stationlst</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;{0:.6g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fr</span><span class="p">),</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">fr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imp1</span><span class="o">.</span><span class="n">frequency</span><span class="p">)])</span>
            <span class="c">#loop over frequencies to pick out the ones desired</span>
            <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="c">#jj is the index of edi file frequency list, this index corresponds</span>
                <span class="c">#to the impedance tensor component index</span>
                <span class="c">#ff is the frequency from the edi file frequency list</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c">#nn is the frequency number out of extracted frequency list</span>
                    <span class="n">nn</span><span class="o">=</span><span class="n">fdict</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">]</span>
                    
                    <span class="c">#calculate resistivity</span>
                    <span class="n">resxy</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                    <span class="n">resyx</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
            
                    <span class="c">#calculate the phase putting the yx in the 1st quadrant</span>
                    <span class="n">phasexy</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                    <span class="n">phaseyx</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">+</span><span class="mi">180</span>
                    <span class="c">#put phases in correct quadrant if should be negative</span>
                    <span class="k">if</span> <span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">:</span>
                        <span class="n">phaseyx</span><span class="o">=</span><span class="n">phaseyx</span><span class="o">-</span><span class="mi">360</span>
                        <span class="k">print</span> <span class="s">&#39;Found Negative Phase at&#39;</span><span class="p">,</span><span class="n">imp1</span><span class="o">.</span><span class="n">station</span><span class="p">,</span><span class="n">ff</span>    
                    
                    <span class="c">#calculate errors</span>
                    <span class="c">#res_xy (TE)</span>
                    <span class="k">if</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">/</span><span class="n">resxy</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="c">#take errors from data file</span>
                    <span class="k">elif</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    
                    <span class="c">#Res_yx(TM)</span>
                    <span class="k">if</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c">#take errors from data file</span>
                    <span class="k">elif</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">lresyxerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    
                    <span class="c">#phase_xy(TE)</span>
                    <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                        <span class="c">#take errors from data file</span>
                    <span class="k">elif</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dphasexyerr</span><span class="o">=</span><span class="p">(</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                        
                    <span class="c">#phase_yx (TM)</span>
                    <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dphaseyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                    
                    <span class="c">#calculate log10 of resistivity as prescribed by OCCAM</span>
                    <span class="n">lresyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resyx</span><span class="p">)</span>
                    <span class="n">lresxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resxy</span><span class="p">)</span>
                    
                    <span class="c">#if include the tipper</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">tip</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c">#calculate the projection angle for real and imaginary</span>
                            <span class="n">tipphir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span>\
                                    <span class="n">theta</span>
                            <span class="n">tipphii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">-</span>\
                                    <span class="n">theta</span>
                            
                            <span class="c">#project the tipper onto the profile line</span>
                            <span class="n">projtipr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                      <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphir</span><span class="p">)</span>
                            <span class="n">projtipi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                      <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphii</span><span class="p">)</span>
                                      
                            <span class="c">#error of tipper is a decimal percentage</span>
                            <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                            
                            <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                        
                    
                    <span class="c">#make a list of lines to write to the data file</span>
                    <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                            <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                            <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                            <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                            <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                            <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                            <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;mmode&#39;</span> <span class="o">+</span><span class="n">mmode</span><span class="o">+</span><span class="s">&#39; not defined&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
    
    <span class="c">#If no rotation is desired but error bars are than...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">srp</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">]</span>
            <span class="n">nr</span><span class="o">=</span><span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c">#calculate errors and rewrite</span>
            <span class="c">#res_xy (TE)</span>
            <span class="k">if</span> <span class="n">resxyerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">lresxyerr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
            
            <span class="c">#Res_yx(TM)</span>
            <span class="k">if</span> <span class="n">resyxerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">lresyxerr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
            
            <span class="c">#phase_xy(TE)</span>
            <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">dphasexyerr</span><span class="o">=</span><span class="p">(</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">dphasexyerr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
                
            <span class="c">#phase_yx (TM)</span>
            <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">dphaseyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">dphaseyxerr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="c">#error of tipper is a decimal percentage</span>
                <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">projtiperr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
                <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">projtiperr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="c">#make a list of lines to write to the data file</span>
                <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c">#===========================================================================</span>
    <span class="c">#                             write dat file</span>
    <span class="c">#===========================================================================</span>
    
    <span class="c">#make the file name of the data file</span>
    <span class="k">if</span> <span class="n">datafn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;RW&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">dfn</span><span class="o">=</span><span class="n">datanf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dfn</span><span class="o">=</span><span class="n">datafn</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;RW.dat&#39;</span>
        
    <span class="n">nstat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stationlst</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">title</span><span class="o">=</span><span class="s">&#39;Occam Inversion&#39;</span>
        
    <span class="n">datfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FORMAT:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">11</span><span class="o">+</span><span class="s">&#39;OCCAM2MTDATA_1.0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TITLE:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write station sites</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nstat</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stationlst</span><span class="p">:</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write offsets</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OFFSETS (M):&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stationlst</span><span class="p">:</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write frequencies</span>
    <span class="c">#writefreq=[freq[ff] for ff in range(0,len(freq),freqstep)]</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FREQUENCIES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freq</span><span class="p">:</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">ff</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write data block</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA BLOCKS:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reslst</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;FREQ&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;TYPE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;DATUM&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;ERROR&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">datline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reslst</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">datline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Found #IND on line &#39;</span><span class="p">,</span><span class="n">ll</span>
            <span class="n">ndline</span><span class="o">=</span><span class="n">datline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">,</span><span class="s">&#39;00&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Replaced with 00&#39;</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ndline</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datline</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">print</span> <span class="s">&#39;Wrote Occam2D data file to: &#39;</span><span class="p">,</span><span class="n">dfn</span>
    
    <span class="k">return</span> <span class="n">dfn</span>
                             </div>
<div class="viewcode-block" id="read2DRespFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read2DRespFile">[docs]</a><span class="k">def</span> <span class="nf">read2DRespFile</span><span class="p">(</span><span class="n">respfn</span><span class="p">,</span><span class="n">datafn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read2DRespFile will read in a response file and combine the data with info </span>
<span class="sd">    from the data file.</span>

<span class="sd">    Input:</span>
<span class="sd">        respfn = full path to the response file</span>
<span class="sd">        datafn = full path to data file</span>

<span class="sd">    Outputs:</span>
<span class="sd">        for each data array, the rows are ordered as:</span>
<span class="sd">            0 -&gt; input data</span>
<span class="sd">            1 -&gt; input error</span>
<span class="sd">            2 -&gt; model output</span>
<span class="sd">            3 -&gt; relative error (data-model)/(input error)</span>
<span class="sd">            </span>
<span class="sd">        rplst = list of dictionaries for each station with keywords:</span>
<span class="sd">            &#39;station&#39; = station name</span>
<span class="sd">            &#39;offset&#39; = relative offset,</span>
<span class="sd">            &#39;resxy&#39; = TE resistivity </span>
<span class="sd">            &#39;resyx&#39;= TM resistivity </span>
<span class="sd">            &#39;phasexy&#39;= TE phase </span>
<span class="sd">            &#39;phaseyx&#39;= TM phase a</span>
<span class="sd">            &#39;realtip&#39;= Real Tipper </span>
<span class="sd">            &#39;imagtip&#39;= Imaginary Tipper </span>
<span class="sd">            </span>
<span class="sd">            Note: that the resistivity will be in log10 space.  Also, there are</span>
<span class="sd">            2 extra rows in the data arrays, this is to put the response from</span>
<span class="sd">            the inversion. </span>
<span class="sd">        </span>
<span class="sd">        stationlst = list of stations in order from one side of the profile</span>
<span class="sd">                     to the other.</span>
<span class="sd">        freq = list of frequencies used in the inversion</span>
<span class="sd">        title = title, could be useful for plotting.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">rplst</span><span class="p">,</span><span class="n">stationlst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="n">read2DdataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">)</span>
    
    <span class="n">rfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">respfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="n">rlines</span><span class="o">=</span><span class="n">rfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">rlines</span><span class="p">:</span>
        <span class="n">ls</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c">#station index</span>
        <span class="n">ss</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
        <span class="c">#component key</span>
        <span class="n">comp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
        <span class="c">#frequency index        </span>
        <span class="n">ff</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
        <span class="c">#put into array</span>
        <span class="c">#model response</span>
        <span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">2</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> 
        <span class="c">#relative error        </span>
        <span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">3</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> 
        
    <span class="k">return</span> <span class="n">rplst</span><span class="p">,</span><span class="n">stationlst</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span><span class="n">title</span>
</div>
<div class="viewcode-block" id="read2DIterFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read2DIterFile">[docs]</a><span class="k">def</span> <span class="nf">read2DIterFile</span><span class="p">(</span><span class="n">iterfn</span><span class="p">,</span><span class="n">iterpath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read2DIterFile will read an iteration file and combine that info from the </span>
<span class="sd">    datafn and return a dictionary of variables.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        iterfn = full path to iteration file if iterpath=None.  If </span>
<span class="sd">                       iterpath is input then iterfn is just the name</span>
<span class="sd">                       of the file without the full path.</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        idict = dictionary of parameters, keys are verbatim from the file, </span>
<span class="sd">                except for the key &#39;model&#39; which is the contains the model</span>
<span class="sd">                numbers in a 1D array.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#get full paths if not already input</span>
    <span class="k">if</span> <span class="n">iterpath</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">iterfn</span><span class="p">)</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">ifn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iterpath</span><span class="p">,</span><span class="n">iterfn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ifn</span><span class="o">=</span><span class="n">iterfn</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;File: &#39;</span><span class="o">+</span><span class="n">ifn</span><span class="o">+</span><span class="s">&#39; does not exist, check name and path&#39;</span><span class="p">)</span>
        
<span class="c">#    if iterpath!=None and os.path.dirname(datafn)==&#39;&#39;:</span>
<span class="c">#        dfn=os.path.join(iterpath,datafn)</span>
<span class="c">#    else:</span>
<span class="c">#        dfn=datafn</span>
<span class="c">#    if os.path.exists(dfn)==False:</span>
<span class="c">#        raise IOError(&#39;File: &#39;+dfn+&#39; does not exist, check name and path&#39;)</span>
    
    <span class="c">#open file</span>
    <span class="n">ifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">ifn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ilines</span><span class="o">=</span><span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c">#create dictionary to put things</span>
    <span class="n">idict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
    <span class="c">#put header info into dictionary with similar keys</span>
    <span class="k">while</span> <span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Param&#39;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">iline</span><span class="o">=</span><span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">idict</span><span class="p">[</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="c">#get number of parameters</span>
    <span class="n">iline</span><span class="o">=</span><span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">nparam</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">idict</span><span class="p">[</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">nparam</span>
    <span class="n">idict</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nparam</span><span class="p">)</span>
    <span class="n">kk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">jj</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">jj</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">ilines</span><span class="p">)</span><span class="o">-</span><span class="n">kk</span><span class="p">:</span>
        <span class="n">iline</span><span class="o">=</span><span class="n">ilines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">idict</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">][</span><span class="n">jj</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="n">ll</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>
            
    <span class="k">return</span> <span class="n">idict</span>

</div>
<div class="viewcode-block" id="compareIter"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.compareIter">[docs]</a><span class="k">def</span> <span class="nf">compareIter</span><span class="p">(</span><span class="n">iterfn1</span><span class="p">,</span><span class="n">iterfn2</span><span class="p">,</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    compareIter will take the difference between two iteration and make a </span>
<span class="sd">    difference iter file</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        iterfn1 = full path to iteration file 1</span>
<span class="sd">        iterfn2 = full path to iteration file 2</span>
<span class="sd">        savepath = path to save the difference iteration file, can be full or</span>
<span class="sd">                  just a directory</span>
<span class="sd">                  </span>
<span class="sd">    Outputs:</span>
<span class="sd">        diterfn = file name of iteration difference either:</span>
<span class="sd">            savepath/iterdiff##and##.iter</span>
<span class="sd">            or os.path.dirname(iterfn1,iterdiff##and##.iter)</span>
<span class="sd">            or savepath</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#get number of iteration</span>
    <span class="n">inum1</span><span class="o">=</span><span class="n">iterfn1</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>    
    <span class="n">inum2</span><span class="o">=</span><span class="n">iterfn2</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>    
    
    <span class="c">#make file name to save difference to</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">svdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">iterfn1</span><span class="p">)</span>
        <span class="n">diterfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">svdir</span><span class="p">,</span>
                              <span class="s">&#39;iterdiff{0}and{1}.iter&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inum1</span><span class="p">,</span><span class="n">inum2</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">diterfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span>
                              <span class="s">&#39;iterdiff{0}and{1}.iter&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inum1</span><span class="p">,</span><span class="n">inum2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diterfn</span><span class="o">=</span><span class="n">savepath</span>
    
    <span class="c">#read the iter files</span>
    <span class="n">idict1</span><span class="o">=</span><span class="n">read2DIterFile</span><span class="p">(</span><span class="n">iterfn1</span><span class="p">)</span>
    <span class="n">idict2</span><span class="o">=</span><span class="n">read2DIterFile</span><span class="p">(</span><span class="n">iterfn2</span><span class="p">)</span>
    
    <span class="c">#calculate difference this way it will plot as red going conductive and</span>
    <span class="c">#blues being a resistive change</span>
    <span class="n">mdiff</span><span class="o">=-</span><span class="n">idict1</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">idict2</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">]</span>
    <span class="n">nd</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">mdiff</span><span class="p">)</span>
    
    <span class="n">ifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">iterfn1</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ilines</span><span class="o">=</span><span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    
    
    <span class="c">#write iterfile</span>
    <span class="n">dfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">diterfn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Param&#39;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">dfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="n">dfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Param Count:        {0}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nd</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nd</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;   {0:+.6f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mdiff</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="n">kk</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">kk</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">dfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">dfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            
    <span class="n">dfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">diterfn</span>
        </div>
<div class="viewcode-block" id="plot2DResponses"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plot2DResponses">[docs]</a><span class="k">def</span> <span class="nf">plot2DResponses</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">respfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">wlfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">maxcol</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">plottype</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">phaselimits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">95</span><span class="p">),</span><span class="n">colormode</span><span class="o">=</span><span class="s">&#39;color&#39;</span><span class="p">,</span><span class="n">reslimits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plotResponse will plot the responses modeled from winglink against the </span>
<span class="sd">    observed data.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        respfn = full path to response file</span>
<span class="sd">        datafn = full path to data file</span>
<span class="sd">        wlfn = full path to a winglink data file used for a similar</span>
<span class="sd">                          inversion.  This will be plotted on the response</span>
<span class="sd">                          plots for comparison of fits.</span>
<span class="sd">        maxcol = maximum number of columns for the plot</span>
<span class="sd">        plottype = &#39;all&#39; to plot all on the same plot</span>
<span class="sd">                   &#39;1&#39; to plot each respones in a different figure</span>
<span class="sd">                   station to plot a single station or enter as a list of </span>
<span class="sd">                   stations to plot a few stations [station1,station2].  Does</span>
<span class="sd">                   not have to be verbatim but should have similar unique </span>
<span class="sd">                   characters input pb01 for pb01cs in outputfile</span>
<span class="sd">    Outputs:</span>
<span class="sd">        used for interactive masking of points</span>
<span class="sd">        axlst = list of axes plotted</span>
<span class="sd">        errlst = list of errors that were plotted</span>
<span class="sd">        linelst = list of lines plotted</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">MTpy.core.WinglinkTools</span> <span class="kn">as</span> <span class="nn">wlt</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
    
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dpi</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dpi&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span>
    <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>
        <span class="c">#color for data</span>
        <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mted</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
        <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
        
        <span class="c">#color for occam model</span>
        <span class="n">ctem</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ctmm</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">mtem</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
        <span class="n">mtmm</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
        
        <span class="c">#color for Wingling model</span>
        <span class="n">ctewl</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">ctmwl</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mtewl</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
        <span class="n">mtmwl</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
        
    <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
        <span class="c">#color for data</span>
        <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mted</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
        <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;v&#39;</span>
        
        <span class="c">#color for occam model</span>
        <span class="n">ctem</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ctmm</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">mtem</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
        <span class="n">mtmm</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
        
        <span class="c">#color for Wingling model</span>
        <span class="n">ctewl</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ctmwl</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>    
        <span class="n">mtewl</span><span class="o">=</span><span class="s">&#39;|&#39;</span>
        <span class="n">mtmwl</span><span class="o">=</span><span class="s">&#39;_&#39;</span>
        
    <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="c">#read in the data    </span>
        <span class="n">rplst</span><span class="p">,</span><span class="n">stationlst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">read2DRespFile</span><span class="p">(</span><span class="n">respfn</span><span class="p">,</span><span class="n">datafn</span><span class="p">)</span>
        <span class="c">#make a legend list for plotting</span>
        <span class="n">legendlst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;$Obs_{xy}$&#39;</span><span class="p">,</span><span class="s">&#39;$Obs_{yx}$&#39;</span><span class="p">,</span><span class="s">&#39;$Mod_{xy}$&#39;</span><span class="p">,</span><span class="s">&#39;$Mod_{yx}$&#39;</span><span class="p">]</span>
        <span class="n">plotresp</span><span class="o">=</span><span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rplst</span><span class="p">,</span><span class="n">stationlst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="n">read2DdataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">)</span>
        <span class="c">#make a legend list for plotting</span>
        <span class="n">legendlst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;$Obs_{xy}$&#39;</span><span class="p">,</span><span class="s">&#39;$Obs_{yx}$&#39;</span><span class="p">]</span>
        <span class="n">plotresp</span><span class="o">=</span><span class="bp">False</span>
    
    <span class="c">#boolean for adding winglink output to the plots 0 for no, 1 for yes</span>
    <span class="n">addwl</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">hspace</span><span class="o">=.</span><span class="mi">15</span>
    <span class="c">#read in winglink data file</span>
    <span class="k">if</span> <span class="n">wlfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">addwl</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">hspace</span><span class="o">=.</span><span class="mi">25</span>
        <span class="n">wld</span><span class="p">,</span><span class="n">wlrplst</span><span class="p">,</span><span class="n">wlplst</span><span class="p">,</span><span class="n">wlslst</span><span class="p">,</span><span class="n">wltlst</span><span class="o">=</span><span class="n">wlt</span><span class="o">.</span><span class="n">readOutputFile</span><span class="p">(</span><span class="n">wlfn</span><span class="p">)</span>
        <span class="n">legendlst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;$Obs_{xy}$&#39;</span><span class="p">,</span><span class="s">&#39;$Obs_{yx}$&#39;</span><span class="p">,</span><span class="s">&#39;Occ_$Mod_{xy}$&#39;</span><span class="p">,</span><span class="s">&#39;Occ_$Mod_{yx}$&#39;</span><span class="p">,</span>
                   <span class="s">&#39;Wl_$Mod_{xy}$&#39;</span><span class="p">,</span><span class="s">&#39;Wl_$Mod_{yx}$&#39;</span><span class="p">]</span>
        <span class="n">sdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">ostation</span><span class="p">,</span><span class="n">wlstation</span><span class="p">)</span> <span class="k">for</span> <span class="n">wlstation</span> <span class="ow">in</span> <span class="n">wlslst</span> 
                    <span class="k">for</span> <span class="n">ostation</span> <span class="ow">in</span> <span class="n">stationlst</span> <span class="k">if</span> <span class="n">wlstation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">ostation</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">period</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">freq</span>
    <span class="n">nf</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
    
    <span class="n">nstations</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stationlst</span><span class="p">)</span>
    
    <span class="c">#plot all responses onto one plot</span>
    <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="s">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">maxcol</span><span class="o">=</span><span class="mi">8</span>         
        <span class="n">nrows</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nstations</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">maxcol</span><span class="p">)))</span>
        
        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="mi">14</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">right</span><span class="o">=.</span><span class="mi">98</span><span class="p">)</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="n">g1</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="n">maxcol</span><span class="p">,</span><span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                                    <span class="n">hspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">)</span>
            <span class="n">count</span><span class="o">=</span><span class="n">rr</span><span class="o">*</span><span class="p">(</span><span class="n">maxcol</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxcol</span><span class="p">):</span>
                <span class="n">rlst</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ii</span><span class="o">=</span><span class="n">count</span><span class="o">+</span><span class="n">cc</span>
                    <span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">rmslst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                       <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                        <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                        <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">rms</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">rmslst</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslst</span><span class="p">))</span>
                <span class="c">#plot resistivity</span>
                <span class="n">axr</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">g1</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="n">cc</span><span class="p">])</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">axr</span><span class="p">)</span>
                <span class="c">#cut out missing data points first</span>
                <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">r1</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                              <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
                <span class="n">r2</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                              <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">mrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">mryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">r3</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                    <span class="n">r4</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                
                    <span class="n">rlst</span><span class="o">=</span><span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">,</span><span class="n">r3</span><span class="p">,</span><span class="n">r4</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rlst</span><span class="o">=</span><span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">]</span>
                <span class="c">#plot phase</span>
                <span class="n">axp</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Subplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">g1</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="n">cc</span><span class="p">])</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">axp</span><span class="p">)</span>
                <span class="c">#cut out missing data points first</span>
                <span class="n">pxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">pyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                             <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                             <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">mpxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">mpyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                
                <span class="c">#add in winglink responses</span>
                <span class="k">if</span> <span class="n">addwl</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">wlrms</span><span class="o">=</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;rms&#39;</span><span class="p">]</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>\
                                    <span class="s">&#39;rms_occ, rms_wl= </span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rms</span><span class="p">,</span><span class="n">wlrms</span><span class="p">),</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="n">r5</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;period&#39;</span><span class="p">],</span>
                                   <span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;modresxy&#39;</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                   <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                        <span class="n">r6</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;period&#39;</span><span class="p">],</span>
                                   <span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;modresyx&#39;</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                   <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                        <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;period&#39;</span><span class="p">],</span>
                                     <span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;modphasexy&#39;</span><span class="p">],</span>
                                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                     <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                        <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;period&#39;</span><span class="p">],</span>
                                     <span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]]][</span><span class="s">&#39;modphaseyx&#39;</span><span class="p">],</span>
                                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">ms</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                     <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r6</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;Station not present&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;; rms= </span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">rms</span><span class="p">,</span>
                                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                
                <span class="c">#make plot nice with labels</span>
                <span class="k">if</span> <span class="n">cc</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">rr</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlst</span><span class="p">,</span><span class="n">legendlst</span><span class="p">,</span>
                                <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper center&#39;</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                <span class="n">borderaxespad</span><span class="o">=.</span><span class="mi">35</span><span class="p">,</span>
                                <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rlst</span><span class="p">))</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">cc</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
                    
                <span class="n">axp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">phaselimits</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reslimits</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">reslimits</span><span class="p">)</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="n">cc</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">15</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        
                <span class="k">if</span> <span class="n">cc</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">rr</span><span class="o">==</span><span class="n">nrows</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                                   
    <span class="c">#---------------plot each respones in a different figure------------------</span>
    <span class="k">elif</span> <span class="n">plottype</span><span class="o">==</span><span class="s">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">)</span>
         
        

        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">):</span>
            
            <span class="n">rlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">llst</span><span class="o">=</span><span class="p">[]</span>
            
            <span class="n">rmslst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                       <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                        <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                        <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">rms</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">rmslst</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslst</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            
            <span class="c">#plot resistivity</span>
            <span class="n">axr</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,:])</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c">#check to see if there is a xy component</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">rte</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                   <span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                   <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">rxy</span><span class="p">]</span><span class="o">*</span>\
                                   <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                   <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Obs_{xy}$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            
            <span class="c">#check to see if there is a yx component</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">rtm</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                   <span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                   <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ryx</span><span class="p">]</span><span class="o">*</span>\
                                   <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                   <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Obs_{yx}$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>                                
            
            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">mrxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">mryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c">#check for the xy of model component</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mrxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">r3</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                    <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">*</span>\
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                    <span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Mod_{xy}$&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c">#check for the yx model component  of resisitivity</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mryx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">r4</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                    <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">*</span>\
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                    <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r4</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Mod_{yx}$&#39;</span><span class="p">)</span>
                                
            <span class="c">#plot phase</span>
            <span class="n">axp</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axr</span><span class="p">)</span>
            
            <span class="c">#cut out missing data points first</span>
            <span class="n">pxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">pte</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                   <span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                   <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                    <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">ptm</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                   <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                   <span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                   <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                    <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            
            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">mpxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">mpyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpyx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
<span class="c">#                axp.semilogx(period[mpxy],rplst[ii][&#39;phasexy&#39;][2][mpxy],</span>
<span class="c">#                             ls=&#39;--&#39;,marker=&#39;+&#39;,ms=2*ms,color=ctem,mfc=ctem)</span>
<span class="c">#                axp.semilogx(period[mpyx],rplst[ii][&#39;phaseyx&#39;][2][mpyx],</span>
<span class="c">#                             ls=&#39;--&#39;,marker=&#39;+&#39;,ms=2*ms,color=ctmm,mfc=ctmm)</span>
                         
            <span class="c">#add in winglink responses</span>
            <span class="k">if</span> <span class="n">addwl</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">wlrms</span><span class="o">=</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">station</span><span class="p">]][</span><span class="s">&#39;rms&#39;</span><span class="p">]</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>\
                                <span class="s">&#39;rms_occ, rms_wl= </span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rms</span><span class="p">,</span><span class="n">wlrms</span><span class="p">),</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">wlstation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wlslst</span><span class="p">):</span>
<span class="c">#                        print station,wlstation</span>
                        <span class="k">if</span> <span class="n">wlstation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">station</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">print</span> <span class="n">station</span><span class="p">,</span><span class="n">wlstation</span>
                            <span class="n">wlrpdict</span><span class="o">=</span><span class="n">wlrplst</span><span class="p">[</span><span class="n">ww</span><span class="p">]</span>
                    
                    <span class="n">zrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">zryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    
                     <span class="c">#plot winglink resistivity</span>
                    <span class="n">r5</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                    <span class="n">r6</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                    
                    <span class="c">#plot winglink phase</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                 <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                 <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                    
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r6</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$WLMod_{xy}$&#39;</span><span class="p">)</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$WLMod_{yx}$&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Station not present&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;; rms= </span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">rms</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            
                            
            <span class="n">axr</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
<span class="c">#            axr.set_xticklabels([&#39;&#39; for ii in range(10)])</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">phaselimits</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reslimits</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">reslimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">reslimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axr</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            
            <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlst</span><span class="p">,</span><span class="n">llst</span><span class="p">,</span>
                       <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                       <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                       <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">07</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">07</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
            
    <span class="c">#---Plot single or subset of stations-------------------------------------</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pstationlst</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plottype</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">plottype</span><span class="o">=</span><span class="p">[</span><span class="n">plottype</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">station</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pstation</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
<span class="c">#                    print &#39;plotting &#39;,station</span>
                    <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">addwl</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">pwlstationlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">wlstation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wlslst</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">wlstation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pstation</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
<span class="c">#                        print &#39;plotting &#39;,wlstation</span>
                        <span class="n">pwlstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span>  

        <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">top</span><span class="o">=.</span><span class="mi">93</span><span class="p">,</span><span class="n">bottom</span><span class="o">=.</span><span class="mo">07</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pstationlst</span><span class="p">):</span>
            <span class="n">rlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">pstation</span><span class="o">=</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">rmslst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                       <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                        <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                        <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">rms</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">rmslst</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslst</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="c">#plot resistivity</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">axr</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,:])</span>
            <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rte</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">rxy</span><span class="p">]</span><span class="o">*</span>\
                        <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                    <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">rtm</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ryx</span><span class="p">]</span><span class="o">*</span>\
                        <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                    <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c">#            r1=axr.loglog(period[rxy],10**rplst[ii][&#39;resxy&#39;][0][rxy],</span>
<span class="c">#                          ls=&#39;:&#39;,marker=&#39;s&#39;,ms=ms,color=cted,mfc=cted)</span>
<span class="c">#            r2=axr.loglog(period[ryx],10**rplst[ii][&#39;resyx&#39;][0][ryx],</span>
<span class="c">#                          ls=&#39;:&#39;,marker=&#39;o&#39;,ms=ms,color=ctmd,mfc=ctmd)</span>
            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">mrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">mryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">r3</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">],</span>
                                <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">*</span>\
                                <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                <span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                <span class="n">r4</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">],</span>
                                <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">*</span>\
                                <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
<span class="c">#                r3=axr.loglog(period[mrxy],10**rplst[ii][&#39;resxy&#39;][2][mrxy],</span>
<span class="c">#                              ls=&#39;--&#39;,marker=&#39;+&#39;, ms=2*ms,color=ctem,mfc=ctem)</span>
<span class="c">#                r4=axr.loglog(period[mryx],10**rplst[ii][&#39;resyx&#39;][2][mryx],</span>
<span class="c">#                              ls=&#39;--&#39;,marker=&#39;+&#39;,ms=2*ms,color=ctmm,mfc=ctmm)</span>
            
                <span class="n">rlst</span><span class="o">=</span><span class="p">[</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">r3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">r4</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rlst</span><span class="o">=</span><span class="p">[</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                
            <span class="c">#plot phase</span>
            <span class="n">axp</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axr</span><span class="p">)</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">pxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pte</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                       <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                       <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ptm</span><span class="o">=</span><span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#            axp.semilogx(period[pxy],rplst[ii][&#39;phasexy&#39;][0][pxy],</span>
<span class="c">#                         ls=&#39;:&#39;,marker=&#39;s&#39;,ms=ms,color=cted,mfc=cted)</span>
<span class="c">#            axp.semilogx(period[pyx],rplst[ii][&#39;phaseyx&#39;][0][pyx],</span>
<span class="c">#                         ls=&#39;:&#39;,marker=&#39;o&#39;,ms=ms,color=ctmd,mfc=ctmd)</span>
            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">mpxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">mpyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                
                <span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                            <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                <span class="n">axp</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                            <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
<span class="c">#                axp.semilogx(period[mpxy],rplst[ii][&#39;phasexy&#39;][2][mpxy],</span>
<span class="c">#                             ls=&#39;--&#39;,marker=&#39;+&#39;,ms=2*ms,color=ctem,mfc=ctem)</span>
<span class="c">#                axp.semilogx(period[mpyx],rplst[ii][&#39;phaseyx&#39;][2][mpyx],</span>
<span class="c">#                             ls=&#39;--&#39;,marker=&#39;+&#39;,ms=2*ms,color=ctmm,mfc=ctmm)</span>
                         
            <span class="c">#add in winglink responses</span>
            <span class="k">if</span> <span class="n">addwl</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">wlrms</span><span class="o">=</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">station</span><span class="p">]][</span><span class="s">&#39;rms&#39;</span><span class="p">]</span>
                    <span class="k">print</span> <span class="s">&#39;plotting WL station: &#39;</span><span class="p">,</span> <span class="n">sdict</span><span class="p">[</span><span class="n">pstation</span><span class="p">]</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pstation</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>\
                                <span class="s">&#39;rms_occ, rms_wl= </span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rms</span><span class="p">,</span><span class="n">wlrms</span><span class="p">),</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="n">wlrpdict</span><span class="o">=</span><span class="n">wlrplst</span><span class="p">[</span><span class="n">pwlstationlst</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span>
                    <span class="n">zrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="n">zryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                    
                    <span class="c">#plot winglink Resistivity</span>
                    <span class="n">r5</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                    <span class="n">r6</span><span class="o">=</span><span class="n">axr</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                  <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                    <span class="c">#plot winglink phase</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                 <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                 <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r6</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Station not present&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pstation</span><span class="o">+</span><span class="s">&#39;; rms= </span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">rms</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">pstation</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                       
            
            <span class="n">axr</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span> 
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axr</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>                 
            <span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
<span class="c">#            axr.set_xticklabels([&#39;&#39; for ii in range(10)])</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">phaselimits</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reslimits</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">reslimits</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            
            <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                           <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlst</span><span class="p">,</span><span class="n">legendlst</span><span class="p">,</span>
                       <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                       <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                       <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">})</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
            
<span class="c">#    return axlst,linelst,errlst</span>
    </div>
<div class="viewcode-block" id="plotTipper"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plotTipper">[docs]</a><span class="k">def</span> <span class="nf">plotTipper</span><span class="p">(</span><span class="n">datafile</span><span class="p">,):</span>
    <span class="k">pass</span>
    </div>
<div class="viewcode-block" id="plotAllResponses"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plotAllResponses">[docs]</a><span class="k">def</span> <span class="nf">plotAllResponses</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot all the responses of occam inversion from data file.  This assumes</span>
<span class="sd">    the response curves are in the same folder as the datafile.</span>

<span class="sd">    Input:</span>
<span class="sd">        datafile = full path to occam data file</span>
<span class="sd">        </span>
<span class="sd">    Output:</span>
<span class="sd">        Plot</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
    
    <span class="n">rpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
    
    <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">20</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">08</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">92</span>


    <span class="n">rlst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rpath</span><span class="p">,</span><span class="n">rfile</span><span class="p">)</span> <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">rpath</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">rfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.resp&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">nresp</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rlst</span><span class="p">)</span>
    
    <span class="n">colorlst</span><span class="o">=</span><span class="p">[(</span><span class="n">cc</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">nresp</span><span class="p">)]</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">axrte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axrtm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">axpte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axptm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">rmstelst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">rmstmlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">rmstestr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">rmstmstr</span><span class="o">=</span><span class="p">[]</span>
    <span class="c">#read responses</span>
    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">rfile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rlst</span><span class="p">):</span>
        <span class="n">rplst</span><span class="p">,</span><span class="n">stationlst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">read2DRespFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rpath</span><span class="p">,</span><span class="n">rfile</span><span class="p">),</span>
                                                 <span class="n">datafile</span><span class="p">)</span>
        <span class="n">ii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stationlst</span><span class="p">)</span><span class="o">==</span><span class="n">station</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">period</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">freq</span>
        
        <span class="n">rmslstte</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">rmslsttm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                            <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">rmste</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">rmslstte</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslstte</span><span class="p">))</span>
        <span class="n">rmstm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">rmslsttm</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslsttm</span><span class="p">))</span>
        <span class="n">rmstelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> rms=</span><span class="si">%.3f</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">rmste</span><span class="p">))</span>
        <span class="n">rmstmlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> rms=</span><span class="si">%.3f</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">rmstm</span><span class="p">))</span>
        <span class="n">rmstestr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmste</span><span class="p">)</span>
        <span class="n">rmstmstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmstm</span><span class="p">)</span>
        <span class="c">#plot resistivity</span>
        
        
        <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">r1</span><span class="p">,</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                          <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">r2</span><span class="p">,</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                          <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">rlstte</span><span class="o">=</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span>
            <span class="n">rlsttm</span><span class="o">=</span><span class="p">[</span><span class="n">r2</span><span class="p">]</span>
    
        <span class="n">mrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">mryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">r3</span><span class="p">,</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">],</span>
                        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="n">r4</span><span class="p">,</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">],</span>
                        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
    
        <span class="n">rlstte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span>
        <span class="n">rlsttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r4</span><span class="p">)</span>
                            
        <span class="c">#plot phase</span>
        <span class="c">#cut out missing data points first</span>
        <span class="n">pxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">pyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        
        <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>            
            <span class="n">axpte</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                         <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">axptm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                         <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
                         
        <span class="n">mpxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">mpyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">axpte</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="n">axptm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
    
<span class="c">#    teh,tel=axrte.get_legend_handles_labels()                 </span>
<span class="c">#    axrte.legend(rlstte,rmstelst,loc=2,markerscale=2,borderaxespad=.05,</span>
<span class="c">#               labelspacing=.08,</span>
<span class="c">#               handletextpad=.15,borderpad=.05)</span>
    
<span class="c">#    tmh,tml=axrtm.get_legend_handles_labels() </span>
<span class="c">#    axrtm.legend(rlsttm,rmstmlst,loc=2,markerscale=2,borderaxespad=.05,</span>
<span class="c">#               labelspacing=.08,</span>
<span class="c">#               handletextpad=.15,borderpad=.05)</span>
                   
    <span class="n">axrte</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">axrtm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
    
    
    <span class="n">axrtm</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
    <span class="n">axrte</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
    <span class="c">#axpte.set_ylim(-10,120)</span>
    
    <span class="n">rmstestr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rmstestr</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">rmstmstr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rmstmstr</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;TE rms={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstestr</span><span class="p">),</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axrtm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;TM rms={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstmstr</span><span class="p">),</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    
    <span class="n">axpte</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">axpte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">axpte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">axrte</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axpte</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axpte</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>

    <span class="n">axrte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">axpte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="n">axrtm</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
<span class="c">#    axptm.set_ylim(-10,120)</span>
    <span class="n">axptm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">axptm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">axptm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="n">axrtm</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axptm</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">axptm</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>

    <span class="n">axrtm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">axptm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">station</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    </div>
<div class="viewcode-block" id="plot2DModel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plot2DModel">[docs]</a><span class="k">def</span> <span class="nf">plot2DModel</span><span class="p">(</span><span class="n">iterfile</span><span class="p">,</span><span class="n">meshfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">inmodelfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">datafile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">xpad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">ypad</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span><span class="n">mpad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">spad</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="n">stationid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">fdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;rotation&#39;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;normal&#39;</span><span class="p">},</span>
                <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">ylimits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xminorticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">yminorticks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">climits</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet_r&#39;</span><span class="p">,</span><span class="n">fs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">femesh</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span>
                <span class="n">regmesh</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="n">meshnum</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span>
                <span class="n">blocknum</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span><span class="n">blkfdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">plotdimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">grid</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span><span class="n">yscale</span><span class="o">=</span><span class="s">&#39;km&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plotModel will plot the model output by occam in the iteration file.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        iterfile = full path to the iteration file that you want to plot</span>
<span class="sd">        </span>
<span class="sd">        meshfile = full path to mesh file (the forward modeling mesh).  If </span>
<span class="sd">                    none it will look for a file with mesh in the name.</span>
<span class="sd">        </span>
<span class="sd">        inmodelfile = full path to the INMODEL file (regularization mesh).</span>
<span class="sd">                      If none it will look for a file with inmodel in the name.</span>
<span class="sd">        </span>
<span class="sd">        datafile = full path to data file.  If none is input it will use the</span>
<span class="sd">                    data file found in the iteration file.</span>
<span class="sd">        </span>
<span class="sd">        xpad = padding in the horizontal direction of model</span>
<span class="sd">        </span>
<span class="sd">        ypad = padding the in the vertical direction of the top of the model</span>
<span class="sd">               to fit the station names and markers</span>
<span class="sd">               </span>
<span class="sd">        mpad = marker pad to fit right at the surface, haven&#39;t found a better</span>
<span class="sd">               way of doing this automatically yet</span>
<span class="sd">               </span>
<span class="sd">        spad = padding of station names away from the top of the model, this</span>
<span class="sd">                is kind of awkward at the moment especially if you zoom into </span>
<span class="sd">                the model, it usually looks retarded and doesn&#39;t fit</span>
<span class="sd">                </span>
<span class="sd">        ms = marker size in ambiguous points</span>
<span class="sd">        </span>
<span class="sd">        stationid = index of station names to plot -&gt; ex. pb01sdr would be </span>
<span class="sd">                    stationid=(0,4) to plot pb01</span>
<span class="sd">                    </span>
<span class="sd">        fdict = font dictionary for the station names, can have keys:</span>
<span class="sd">                &#39;size&#39; = font size</span>
<span class="sd">                &#39;rotation&#39; = angle of rotation (deg) of font</span>
<span class="sd">                &#39;weight&#39; = weight of font </span>
<span class="sd">                &#39;color&#39; = color of font</span>
<span class="sd">                &#39;style&#39; = style of font ex. &#39;italics&#39;</span>
<span class="sd">                </span>
<span class="sd">        plotdimensions = x-y dimensions of the figure (10,10) in inches</span>
<span class="sd">                </span>
<span class="sd">        dpi = dot per inch of figure, should be 300 for publications</span>
<span class="sd">        </span>
<span class="sd">        ylimits = limits of depth scale (km). ex, ylimits=(0,30)</span>
<span class="sd">        </span>
<span class="sd">        xminorticks = location of minor tick marks for the horizontal axis</span>
<span class="sd">        </span>
<span class="sd">        yminorticks = location of minor tick marks for vertical axis</span>
<span class="sd">        </span>
<span class="sd">        climits = limits of log10(resistivity). ex. climits=(0,4)</span>
<span class="sd">        </span>
<span class="sd">        cmap = color map to plot the model image</span>
<span class="sd">        </span>
<span class="sd">        fs = font size of axis labels</span>
<span class="sd">        </span>
<span class="sd">        femesh = &#39;on&#39; to plot finite element forward modeling mesh (black)</span>
<span class="sd">        </span>
<span class="sd">        regmesh = &#39;on&#39; to plot regularization mesh (blue)</span>
<span class="sd">        </span>
<span class="sd">        aspect = aspect ratio of the figure, depends on your line length and</span>
<span class="sd">                the depth you want to investigate</span>
<span class="sd">        </span>
<span class="sd">        title = &#39;on&#39; to put the RMS and Roughness as the title, or input a </span>
<span class="sd">                string that will be added to the RMS and roughness, or put </span>
<span class="sd">                None to not put a title on the plot and print out RMS and </span>
<span class="sd">                roughness</span>
<span class="sd">        </span>
<span class="sd">        meshnum = &#39;on&#39; to plot FE mesh block numbers</span>
<span class="sd">        </span>
<span class="sd">        fignum = figure number to plot to</span>
<span class="sd">        </span>
<span class="sd">        blocknum = &#39;on&#39; to plot numbers on the regularization blocks</span>
<span class="sd">        </span>
<span class="sd">        blkfdict = font dictionary for the numbering of regularization blocks</span>
<span class="sd">        </span>
<span class="sd">        grid = major for major ticks grid</span>
<span class="sd">               minor for a grid of the minor ticks</span>
<span class="sd">               both for a grid with major and minor ticks</span>
<span class="sd">        </span>
<span class="sd">        yscale = &#39;km&#39; for depth in km or &#39;m&#39; for depth in meters</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    
    <span class="c">#get directory path of inversion folder</span>
    <span class="n">invpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">iterfile</span><span class="p">)</span>    
    
    <span class="c">#read in iteration file</span>
    <span class="n">idict</span><span class="o">=</span><span class="n">read2DIterFile</span><span class="p">(</span><span class="n">iterfile</span><span class="p">)</span>    
    
    <span class="c">#get meshfile if none is provides assuming the mesh file is named with</span>
    <span class="c">#mesh</span>
    <span class="k">if</span> <span class="n">meshfile</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">meshfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="s">&#39;MESH&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">meshfile</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">invpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;mesh&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">meshfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">meshfile</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Could not find a mesh file, input manually&#39;</span><span class="p">)</span>
    
    <span class="c">#get inmodelfile if none is provides assuming the mesh file is named with</span>
    <span class="c">#inmodel</span>
    <span class="k">if</span> <span class="n">inmodelfile</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">inmodelfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="s">&#39;INMODEL&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">inmodelfile</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">invpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;inmodel&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">inmodelfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">inmodelfile</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Could not find a model file, input manually&#39;</span><span class="p">)</span>
                
    <span class="c">#get datafile if none is provides assuming the mesh file is named with</span>
    <span class="c">#.dat</span>
    <span class="k">if</span> <span class="n">datafile</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">datafile</span><span class="o">=</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Data File&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">datafile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">datafile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">datafile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">invpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.dat&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">datafile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Could not find a data file, input manually&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;km&#39;</span><span class="p">:</span>
        <span class="n">dfactor</span><span class="o">=</span><span class="mf">1000.</span>
        <span class="n">pfactor</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="k">elif</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;m&#39;</span><span class="p">:</span>
        <span class="n">dfactor</span><span class="o">=</span><span class="mf">1.</span>
        <span class="n">pfactor</span><span class="o">=</span><span class="mf">1000.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dfactor</span><span class="o">=</span><span class="mf">1000.</span>
        <span class="n">pfactor</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="c">#read in data file</span>
    <span class="k">print</span> <span class="s">&#39;Reading data from: &#39;</span><span class="p">,</span><span class="n">datafile</span>
    <span class="n">rplst</span><span class="p">,</span><span class="n">slst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">datatitle</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="n">read2DdataFile</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
    
    <span class="c">#read in MESH file</span>
    <span class="k">print</span> <span class="s">&#39;Reading mesh from: &#39;</span><span class="p">,</span><span class="n">meshfile</span>
    <span class="n">hnode</span><span class="p">,</span><span class="n">vnode</span><span class="p">,</span><span class="n">freeparam</span><span class="o">=</span><span class="n">read2Dmesh</span><span class="p">(</span><span class="n">meshfile</span><span class="p">)</span>
    
    <span class="c">#read in INMODEL</span>
    <span class="k">print</span> <span class="s">&#39;Reading model from: &#39;</span><span class="p">,</span><span class="n">inmodelfile</span>
    <span class="n">cr</span><span class="p">,</span><span class="n">cc</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">read2DInmodel</span><span class="p">(</span><span class="n">inmodelfile</span><span class="p">)</span>
    <span class="n">bndgoff</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;BINDING OFFSET&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">dfactor</span>
    
    <span class="c">#make a meshgrid </span>
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">hnode</span><span class="p">,</span><span class="n">vnode</span><span class="p">)</span>
    
    <span class="n">cr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
    
    <span class="n">nc</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
    
    <span class="n">resmodel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">vnode</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">hnode</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
        <span class="c">#get the number of layers to combine</span>
        <span class="c">#this index will be the first index in the vertical direction</span>
        <span class="n">ny1</span><span class="o">=</span><span class="n">cr</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c">#the second index  in the vertical direction</span>
        <span class="n">ny2</span><span class="o">=</span><span class="n">ny1</span><span class="o">+</span><span class="n">cr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#make the list of amalgamated columns an array for ease</span>
        <span class="n">lc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="c">#loop over the number of amalgamated blocks</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
            <span class="c">#get first in index in the horizontal direction</span>
            <span class="n">nx1</span><span class="o">=</span><span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="c">#get second index in horizontal direction</span>
            <span class="n">nx2</span><span class="o">=</span><span class="n">nx1</span><span class="o">+</span><span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
            <span class="c">#put the apporpriate resistivity value into all the amalgamated model</span>
            <span class="c">#blocks of the regularization grid into the forward model grid</span>
            <span class="n">resmodel</span><span class="p">[</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">]</span><span class="o">=</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span>
            <span class="n">mm</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="c">#make some arrays for plotting the model</span>
    
    <span class="n">plotx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hnode</span><span class="p">[:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hnode</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span><span class="o">/</span><span class="n">dfactor</span>
    <span class="n">ploty</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vnode</span><span class="p">[:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vnode</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span><span class="o">/</span><span class="n">dfactor</span>
    
    <span class="c">#center the grid onto the station coordinates</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">bndgoff</span><span class="o">-</span><span class="n">plotx</span><span class="p">[</span><span class="n">cc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">plotx</span><span class="o">=</span><span class="n">plotx</span><span class="o">+</span><span class="n">x0</span>
    
    <span class="c">#flip the arrays around for plotting purposes</span>
    <span class="c">#plotx=plotx[::-1] and make the first layer start at zero</span>
    <span class="n">ploty</span><span class="o">=</span><span class="n">ploty</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ploty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c">#make a mesh grid to plot in the model coordinates</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">plotx</span><span class="p">,</span><span class="n">ploty</span><span class="p">)</span>
    
    <span class="c">#flip the resmodel upside down so that the top is the stations</span>
    <span class="n">resmodel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resmodel</span><span class="p">)</span>
    
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="o">/</span><span class="mf">40.</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">08</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">99</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">92</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">01</span>
    <span class="c">#plot the model</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">plotdimensions</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">resmodel</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c">#ax.set_ylim(ploty[0],ploty[-1]-2.0)</span>
    
    <span class="n">cbx</span><span class="o">=</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">01</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">vmax</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s">&#39;10$^{0}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> 
                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    
    <span class="n">offsetlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">rpdict</span> <span class="ow">in</span> <span class="n">rplst</span><span class="p">:</span>
        <span class="c">#plot the station marker</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="o">-</span><span class="n">mpad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                   <span class="n">s</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>
        <span class="c">#put station id onto station marker</span>
        <span class="c">#if there is a station id index</span>
        <span class="k">if</span> <span class="n">stationid</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="o">-</span><span class="n">spad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">,</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">][</span><span class="n">stationid</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">stationid</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>
        <span class="c">#otherwise put on the full station name found form data file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="o">-</span><span class="n">spad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">,</span>
                    <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">],</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>
        <span class="n">offsetlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">)</span>
    
    <span class="c">#set the initial limits of the plot to be square about the profile line  </span>
    <span class="k">if</span> <span class="n">ylimits</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>  
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">))</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="o">-</span><span class="n">ypad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pfactor</span><span class="p">,(</span><span class="n">ylimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ypad</span><span class="p">)</span><span class="o">*</span><span class="n">pfactor</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">xpad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">),</span>
                 <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">xpad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">)))</span>
    <span class="c">#set the axis properties</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">xminorticks</span><span class="o">*</span><span class="n">pfactor</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">yminorticks</span><span class="o">*</span><span class="n">pfactor</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;km&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Horizontal Distance (km)&#39;</span><span class="p">,</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (km)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="k">elif</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;m&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Horizontal Distance (m)&#39;</span><span class="p">,</span>
                      <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (m)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    
    <span class="c">#put a grid on if one is desired    </span>
    <span class="k">if</span> <span class="n">grid</span><span class="o">==</span><span class="s">&#39;major&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;major&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">grid</span><span class="o">==</span><span class="s">&#39;minor&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;minor&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">grid</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="c">#set title as rms and roughness</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">titlestr</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">iterfile</span><span class="p">)),</span>
                                  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">iterfile</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titlestr</span><span class="o">+</span><span class="s">&#39;: RMS {0:.2f}, Roughness={1:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                     <span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">]),</span>
                     <span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">])),</span>
                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="s">&#39;; RMS {0:.2f}, Roughness={1:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                     <span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">]),</span>
                     <span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">])),</span>
                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;RMS {0:.2f}, Roughness={1:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                     <span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">]),</span>
                     <span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">]))</span> 
    
    <span class="c">#plot forward model mesh    </span>
    <span class="k">if</span> <span class="n">femesh</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">plotx</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span><span class="n">xx</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">ploty</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">ploty</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">plotx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">plotx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">yy</span><span class="p">,</span><span class="n">yy</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="c">#plot the regularization mesh</span>
    <span class="k">if</span> <span class="n">regmesh</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
        <span class="n">linelst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
            <span class="c">#get the number of layers to combine</span>
            <span class="c">#this index will be the first index in the vertical direction</span>
            <span class="n">ny1</span><span class="o">=</span><span class="n">cr</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="c">#the second index  in the vertical direction</span>
            <span class="n">ny2</span><span class="o">=</span><span class="n">ny1</span><span class="o">+</span><span class="n">cr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#make the list of amalgamated columns an array for ease</span>
            <span class="n">lc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">yline</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">plotx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">plotx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">],</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">linelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yline</span><span class="p">)</span>
            <span class="c">#loop over the number of amalgamated blocks</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                <span class="c">#get first in index in the horizontal direction</span>
                <span class="n">nx1</span><span class="o">=</span><span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="c">#get second index in horizontal direction</span>
                <span class="n">nx2</span><span class="o">=</span><span class="n">nx1</span><span class="o">+</span><span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ny1</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ny1</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">xline</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">],</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">]],[</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">],</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny2</span><span class="p">]],</span>
                                  <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">linelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xline</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                
    <span class="c">##plot the mesh block numbers</span>
    <span class="k">if</span> <span class="n">meshnum</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
        <span class="n">kk</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="n">ploty</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">plotx</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
                <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                
    <span class="c">##plot regularization block numbers</span>
    <span class="k">if</span> <span class="n">blocknum</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
        <span class="n">kk</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
            <span class="c">#get the number of layers to combine</span>
            <span class="c">#this index will be the first index in the vertical direction</span>
            <span class="n">ny1</span><span class="o">=</span><span class="n">cr</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="c">#the second index  in the vertical direction</span>
            <span class="n">ny2</span><span class="o">=</span><span class="n">ny1</span><span class="o">+</span><span class="n">cr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#make the list of amalgamated columns an array for ease</span>
            <span class="n">lc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="c">#loop over the number of amalgamated blocks</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                <span class="c">#get first in index in the horizontal direction</span>
                <span class="n">nx1</span><span class="o">=</span><span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="c">#get second index in horizontal direction</span>
                <span class="n">nx2</span><span class="o">=</span><span class="n">nx1</span><span class="o">+</span><span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ny1</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ny1</span><span class="o">=</span><span class="mi">1</span>
                    <span class="c">#get center points of the blocks</span>
                    <span class="n">yy</span><span class="o">=</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span><span class="o">-</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                    <span class="n">xx</span><span class="o">=</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span><span class="o">-</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                    <span class="c">#put the number</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span><span class="n">fontdict</span><span class="o">=</span><span class="n">blkfdict</span><span class="p">,</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
      </div>
<div class="viewcode-block" id="plotPseudoSection"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plotPseudoSection">[docs]</a><span class="k">def</span> <span class="nf">plotPseudoSection</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">respfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rcmap</span><span class="o">=</span><span class="s">&#39;jet_r&#39;</span><span class="p">,</span><span class="n">pcmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">,</span>
                      <span class="n">rlim</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)),</span><span class="n">plim</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">)),</span><span class="n">ml</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                      <span class="n">stationid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots a pseudo section of the data</span>
<span class="sd">    </span>
<span class="sd">    datafn = full path to data file</span>
<span class="sd">    respfn = full path to response file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">rplst</span><span class="p">,</span><span class="n">slst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">read2DRespFile</span><span class="p">(</span><span class="n">respfn</span><span class="p">,</span><span class="n">datafn</span><span class="p">)</span>
        <span class="n">nr</span><span class="o">=</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rplst</span><span class="p">,</span><span class="n">slst</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">thetal</span><span class="o">=</span><span class="n">read2DdataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">)</span>
        <span class="n">nr</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">ns</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">slst</span><span class="p">)</span>
    <span class="n">nf</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">ylimits</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">freq</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="mf">1.</span><span class="o">/</span><span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="c">#    print ylimits</span>
    
    <span class="c">#make a grid for pcolormesh so you can have a log scale</span>
    <span class="c">#get things into arrays for plotting</span>
    <span class="n">offsetlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    <span class="n">resxyarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>    
    <span class="n">resyxarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>    
    <span class="n">phasexyarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>    
    <span class="n">phaseyxarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">rpdict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rplst</span><span class="p">):</span>
        <span class="n">offsetlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span>     
        <span class="n">resxyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phasexyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phaseyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">resxyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">resyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">phasexyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">phaseyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            
            
    <span class="c">#make a meshgrid for plotting</span>
    <span class="c">#flip frequency so bottom corner is long period</span>
    <span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c">#make list for station labels</span>
    <span class="n">slabel</span><span class="o">=</span><span class="p">[</span><span class="n">slst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">stationid</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">stationid</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ml</span><span class="p">)]</span>
    <span class="n">labellst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;$r_{TE-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$r_{TE-Model}$&#39;</span><span class="p">,</span>
              <span class="s">&#39;$r_{TM-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$r_{TM-Model}$&#39;</span><span class="p">,</span>
              <span class="s">&#39;$\phi_{TE-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$\phi_{TE-Model}$&#39;</span><span class="p">,</span>
              <span class="s">&#39;$\phi_{TM-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$\phi_{TM-Model}$&#39;</span><span class="p">]</span>
    <span class="n">xloc</span><span class="o">=</span><span class="n">offsetlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">offsetlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">5</span>
    <span class="n">yloc</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">7</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">09</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">96</span>        
        
        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">gs1</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=.</span><span class="mi">48</span><span class="p">,</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mo">005</span><span class="p">)</span>
        <span class="n">gs2</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.52</span><span class="p">,</span><span class="n">right</span><span class="o">=.</span><span class="mi">98</span><span class="p">,</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mo">005</span><span class="p">)</span>
        
<span class="c">#        ax1r=fig.add_subplot(2,4,1)</span>
        <span class="n">ax1r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax1r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resxyarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
<span class="c">#        ax2r=fig.add_subplot(2,4,2)</span>
        <span class="n">ax2r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax2r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resxyarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                       
<span class="c">#        ax3r=fig.add_subplot(2,4,3)</span>
        <span class="n">ax3r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax3r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resyxarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
<span class="c">#        ax4r=fig.add_subplot(2,4,4)</span>
        <span class="n">ax4r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax4r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resyxarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="c">#        ax1p=fig.add_subplot(2,4,5)</span>
        <span class="n">ax1p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax1p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phasexyarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
<span class="c">#        ax2p=fig.add_subplot(2,4,6)</span>
        <span class="n">ax2p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax2p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phasexyarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                       
<span class="c">#        ax3p=fig.add_subplot(2,4,7)</span>
        <span class="n">ax3p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax3p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phaseyxarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
<span class="c">#        ax4p=fig.add_subplot(2,4,8)</span>
        <span class="n">ax4p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax4p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phaseyxarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                       <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">axlst</span><span class="o">=</span><span class="p">[</span><span class="n">ax1r</span><span class="p">,</span><span class="n">ax2r</span><span class="p">,</span><span class="n">ax3r</span><span class="p">,</span><span class="n">ax4r</span><span class="p">,</span><span class="n">ax1p</span><span class="p">,</span><span class="n">ax2p</span><span class="p">,</span><span class="n">ax3p</span><span class="p">,</span><span class="n">ax4p</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">xx</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axlst</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
<span class="c">#            ax.xaxis.set_major_locator(MultipleLocator(ml))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ml</span><span class="p">)])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">,</span><span class="n">minor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">offsetlst</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">offsetlst</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="mf">2.0</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">cbx</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">015</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                                        <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
<span class="c">#                        cb.set_label(&#39;Resistivity ($\Omega \cdot$m)&#39;,</span>
<span class="c">#                                     fontdict={&#39;size&#39;:9})</span>
                    <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                        <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                                        <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
                        <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                                        <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
<span class="c">#                        cb.set_label(&#39;Phase (deg)&#39;,fontdict={&#39;size&#39;:9})</span>
                    <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
                        <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                                        <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xloc</span><span class="p">,</span><span class="n">yloc</span><span class="p">,</span><span class="n">labellst</span><span class="p">[</span><span class="n">xx</span><span class="p">],</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;facecolor&#39;</span><span class="p">:</span><span class="s">&#39;white&#39;</span><span class="p">},</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">xx</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">xx</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Station&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            
                
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="plotDepthModel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plotDepthModel">[docs]</a><span class="k">def</span> <span class="nf">plotDepthModel</span><span class="p">(</span><span class="n">iterfn</span><span class="p">,</span><span class="n">meshfn</span><span class="p">,</span><span class="n">slst</span><span class="p">,</span><span class="n">lm</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                   <span class="n">stations</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">yscale</span><span class="o">=</span><span class="s">&#39;log&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    will plot a depth section as a line for the block numbers given by slst and</span>
<span class="sd">    the layer multiplier lm</span>
<span class="sd">    &quot;&quot;&quot;</span>
                       
    <span class="n">idict</span><span class="o">=</span><span class="n">read2DIterFile</span><span class="p">(</span><span class="n">iterfn</span><span class="p">)</span>
    <span class="n">harr</span><span class="p">,</span><span class="n">varr</span><span class="p">,</span><span class="n">marr</span><span class="o">=</span><span class="n">read2Dmesh</span><span class="p">(</span><span class="n">meshfn</span><span class="p">)</span>
    
    <span class="n">v</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">varr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">varr</span><span class="p">))])</span>
<span class="c">#    print varr</span>
    
    <span class="n">nv</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">v</span><span class="o">&lt;</span><span class="n">depth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">rholst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">slst</span><span class="p">:</span>
        <span class="n">ilst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span><span class="o">*</span><span class="n">lm</span><span class="o">+</span><span class="p">(</span><span class="n">ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rho</span><span class="o">=</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">][</span><span class="n">ilst</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">p1</span><span class="p">,</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rho</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">v</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ilst</span><span class="p">):],</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps-&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">p1</span><span class="p">,</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rho</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">v</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ilst</span><span class="p">):],</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps-&#39;</span><span class="p">)</span>
        <span class="n">rholst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="n">varr</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">stations</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rholst</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rholst</span><span class="p">)),</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rholst</span><span class="p">,</span><span class="n">stations</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (m)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
        
        </div>
<div class="viewcode-block" id="plotL2Curve"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.plotL2Curve">[docs]</a><span class="k">def</span> <span class="nf">plotL2Curve</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">fnstem</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PlotL2Curve will plot the RMS vs iteration number for the given inversion </span>
<span class="sd">    folder and roughness vs iteration number</span>
<span class="sd">    </span>
<span class="sd">    Inputs: </span>
<span class="sd">        invpath = full path to the inversion folder where .iter files are</span>
<span class="sd">        fnstem = filename stem to look for in case multiple inversions were</span>
<span class="sd">                run in the same folder.  If none then searches for anything</span>
<span class="sd">                ending in .iter</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        rmsiter = array(3x#iterations) of rms, iteration and roughness</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    
    <span class="k">if</span> <span class="n">fnstem</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">iterlst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">itfile</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">itfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">invpath</span><span class="p">)</span> <span class="k">if</span> <span class="n">itfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.iter&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iterlst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">itfile</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">itfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">invpath</span><span class="p">)</span> <span class="k">if</span> <span class="n">itfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.iter&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span>
                <span class="n">itfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">fnstem</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
                
    <span class="n">nr</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">iterlst</span><span class="p">)</span>
    
    <span class="n">rmsarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nr</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">itfile</span> <span class="ow">in</span> <span class="n">iterlst</span><span class="p">:</span>
        <span class="n">idict</span><span class="o">=</span><span class="n">read2DIterFile</span><span class="p">(</span><span class="n">itfile</span><span class="p">)</span>
        <span class="n">ii</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Iteration&#39;</span><span class="p">])</span>
        <span class="n">rmsarr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">])</span>
        <span class="n">rmsarr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">])</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="o">/</span><span class="mf">40.</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">08</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">90</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">90</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">01</span>
    
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="c">#make a subplot for RMS vs Iteration</span>
    <span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c">#plot the rms vs iteration</span>
    <span class="n">l1</span><span class="p">,</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;-k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="c">#plot the median of the RMS</span>
    <span class="n">m1</span><span class="p">,</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">nr</span><span class="p">),</span>
                 <span class="s">&#39;--r&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">75</span><span class="p">)</span>
    
    <span class="c">#plot the mean of the RMS</span>
    <span class="n">m2</span><span class="p">,</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">nr</span><span class="p">),</span>
                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;orange&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">75</span><span class="p">)</span>

    <span class="c">#make subplot for RMS vs Roughness Plot</span>
    <span class="n">ax2</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
    
    <span class="c">#plot the rms vs roughness </span>
    <span class="n">l2</span><span class="p">,</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;--b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                 <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">rms</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">rms</span><span class="p">,</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span>
                 <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                 <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">,</span><span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;blue&#39;</span><span class="p">})</span>
    
    <span class="c">#make a legend</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">],[</span><span class="s">&#39;RMS&#39;</span><span class="p">,</span><span class="s">&#39;Roughness&#39;</span><span class="p">,</span>
               <span class="s">&#39;Median_RMS={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">])),</span>
                <span class="s">&#39;Mean_RMS={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]))],</span>
                <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper center&#39;</span><span class="p">,</span><span class="n">columnspacing</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
                <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>
                
    <span class="c">#set the axis properties for RMS vs iteration</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;RMS&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>                                   
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Iteration&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Roughness&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">,</span>
                                         <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;blue&#39;</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
        <span class="n">t2</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
<span class="c">#    #plot the median of the RMS</span>
<span class="c">#    m1,=ax2.plot(np.arange(0,nr,1),np.repeat(np.median(rmsarr[1:,0]),nr),</span>
<span class="c">#                 &#39;--r&#39;,lw=.75)</span>
<span class="c">#    </span>
<span class="c">#    #plot the mean of the RMS</span>
<span class="c">#    m2,=ax2.plot(np.arange(0,nr,1),np.repeat(np.mean(rmsarr[1:,0]),nr),</span>
<span class="c">#                 ls=&#39;--&#39;,color=&#39;orange&#39;,lw=.75)</span>
    <span class="c">#set the axis properties for RMS vs iteration</span>
<span class="c">#    ax2.yaxis.set_minor_locator(MultipleLocator(.1))</span>
<span class="c">#    ax2.xaxis.set_minor_locator(MultipleLocator(1))</span>
<span class="c">#    ax2.set_ylabel(&#39;RMS&#39;,fontdict={&#39;size&#39;:8,&#39;weight&#39;:&#39;bold&#39;})                                   </span>
<span class="c">#    ax2.set_xlabel(&#39;Roughness&#39;,fontdict={&#39;size&#39;:8,&#39;weight&#39;:&#39;bold&#39;})</span>
<span class="c">#    ax2.grid(alpha=.25,which=&#39;both&#39;)</span>
                
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="getdatetime"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.getdatetime">[docs]</a><span class="k">def</span> <span class="nf">getdatetime</span><span class="p">():</span>


    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">())</span>



</div>
<div class="viewcode-block" id="makestartfiles"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.makestartfiles">[docs]</a><span class="k">def</span> <span class="nf">makestartfiles</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">):</span>

    <span class="n">read_datafile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">)</span>

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_sideblockelements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_bottomlayerelements&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;itform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;not specified&#39;</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;N/A&#39;</span>

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getdatetime</span><span class="p">()</span>
    

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;iruf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;idebug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;nit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;pmu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;rlast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0E+07</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;tobt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;ifftol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">blocks_elements_setup</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">)</span>
    
    <span class="n">get_model_setup</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">)</span>
    
    <span class="n">writemeshfile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">)</span>
    <span class="n">writemodelfile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">)</span>
    <span class="n">writestartupfile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">)</span>

    <span class="n">MeshF</span> <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;meshfn&#39;</span><span class="p">]</span>
    <span class="n">ModF</span>  <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;inmodelfn&#39;</span><span class="p">]</span>
    <span class="n">SF</span>    <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;startupfn&#39;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">MeshF</span><span class="p">,</span><span class="n">ModF</span><span class="p">,</span><span class="n">SF</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="writemeshfile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.writemeshfile">[docs]</a><span class="k">def</span> <span class="nf">writemeshfile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">):</span>

    <span class="n">mesh_positions_vert</span> <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;mesh_positions_vert&#39;</span><span class="p">]</span>
    <span class="n">mesh_positions_hor</span>  <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;mesh_positions_hor&#39;</span><span class="p">]</span>
    <span class="n">n_nodes_hor</span>         <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_nodes_hor&#39;</span><span class="p">]</span>
    <span class="n">n_nodes_vert</span>        <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_nodes_vert&#39;</span><span class="p">]</span>
    
    <span class="n">fh_mesh</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;meshfn&#39;</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">mesh_outstring</span> <span class="o">=</span><span class="s">&#39;&#39;</span>

    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;MESH FILE FROM MTpy</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">mesh_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>

    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_nodes_hor</span><span class="p">,</span><span class="n">n_nodes_vert</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mesh_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>

    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes_hor</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">temptext</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%.1f</span><span class="s"> &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">mesh_positions_hor</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">temptext</span> <span class="o">+=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">mesh_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>

    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_nodes_vert</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">temptext</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%.1f</span><span class="s"> &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">mesh_positions_vert</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">temptext</span> <span class="o">+=</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">mesh_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>

    <span class="n">mesh_outstring</span> <span class="o">+=</span><span class="s">&quot;</span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">n_nodes_vert</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">tempstring</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="n">tempstring</span> <span class="o">+=</span> <span class="p">(</span><span class="n">n_nodes_hor</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="s">&quot;?&quot;</span>
        <span class="n">tempstring</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">mesh_outstring</span> <span class="o">+=</span> <span class="n">tempstring</span>
    

    <span class="n">fh_mesh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mesh_outstring</span><span class="p">)</span>
    <span class="n">fh_mesh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="writemodelfile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.writemodelfile">[docs]</a><span class="k">def</span> <span class="nf">writemodelfile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">):</span>
    <span class="s">&quot;needed : filename,binding_offset,startcolumn, n_layers,layer_thickness,block_width&quot;</span>

    <span class="n">modelblockstrings</span> <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;modelblockstrings&#39;</span><span class="p">]</span>
    <span class="n">nfev</span>              <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;nfev&#39;</span><span class="p">]</span>
    <span class="n">lo_colnumbers</span>     <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;lo_colnumbers&#39;</span><span class="p">]</span>
    <span class="n">boffset</span>           <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;binding_offset&#39;</span><span class="p">])</span>
    <span class="n">n_layers</span>          <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_layers&#39;</span><span class="p">]))</span>

    
    <span class="n">fh_model</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;inmodelfn&#39;</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">=</span><span class="s">&#39;&#39;</span>

    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Format:           </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;OCCAM2MTMOD_1.0&quot;</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Model Name:       </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;modelname&#39;</span><span class="p">])</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Description:      </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;Random Text&quot;</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Mesh File:        </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;meshfn&#39;</span><span class="p">]))</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Mesh Type:        </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;PW2D&quot;</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Statics File:     </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;none&quot;</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Prejudice File:   </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;none&quot;</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Binding Offset:   </span><span class="si">%.1f</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">boffset</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Num Layers:       </span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n_layers</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_layers</span><span class="p">):</span>
        <span class="n">n_meshlayers</span>  <span class="o">=</span> <span class="n">nfev</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">n_meshcolumns</span> <span class="o">=</span> <span class="n">lo_colnumbers</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">temptext</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n_meshlayers</span><span class="p">,</span> <span class="n">n_meshcolumns</span><span class="p">)</span>
        <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>

        <span class="n">temptext</span> <span class="o">=</span> <span class="n">modelblockstrings</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
        <span class="c">#model_outstring += &quot;\n&quot;</span>
        

    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Number Exceptions:</span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">model_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    

    <span class="n">fh_model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">model_outstring</span><span class="p">)</span>
    <span class="n">fh_model</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="writestartupfile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.writestartupfile">[docs]</a><span class="k">def</span> <span class="nf">writestartupfile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">):</span>


    <span class="n">fh_startup</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;startupfn&#39;</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">startup_outstring</span> <span class="o">=</span><span class="s">&#39;&#39;</span>

    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Format:           </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;itform&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Description:      </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;description&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Model File:       </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;inmodelfn&#39;</span><span class="p">]))</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Data File:        </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;datafile&#39;</span><span class="p">]))</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Date/Time:        </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;datetime&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Max Iter:         </span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_max_iterations&#39;</span><span class="p">])))</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Req Tol:          </span><span class="si">%.1g</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;targetrms&#39;</span><span class="p">]))</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;IRUF:             </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;iruf&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Debug Level:      </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;idebug&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Iteration:        </span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_max_iterations&#39;</span><span class="p">])))</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;PMU:              </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;pmu&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Rlast:            </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;rlast&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;Tlast:            </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;tobt&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;IffTol:           </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;ifftol&#39;</span><span class="p">])</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;No. Parms:        </span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_parameters&#39;</span><span class="p">])))</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
    <span class="n">temptext</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_parameters&#39;</span><span class="p">]))):</span>
        <span class="n">temptext</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%.1g</span><span class="s">  &quot;</span><span class="o">%</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">temptext</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">startup_outstring</span> <span class="o">+=</span> <span class="n">temptext</span>
     

    <span class="n">fh_startup</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">startup_outstring</span><span class="p">)</span>
    <span class="n">fh_startup</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="read_datafile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.read_datafile">[docs]</a><span class="k">def</span> <span class="nf">read_datafile</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">):</span>


    <span class="n">df</span> <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;datafile&#39;</span><span class="p">]</span>
    <span class="n">F</span>  <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">datafile_content</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#RELYING ON A CONSTANT FORMAT, ACCESSING THE PARTS BY COUNTING OF LINES!!!:</span>
    
    <span class="n">n_sites</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datafile_content</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">sitenames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sites</span><span class="p">):</span>
        <span class="n">sitenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datafile_content</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">sitelocations</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sites</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span><span class="o">+</span><span class="n">n_sites</span><span class="o">+</span><span class="n">i</span>
        <span class="n">sitelocations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">datafile_content</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

    <span class="n">n_freqs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datafile_content</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n_sites</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">freqs</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_freqs</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">n_sites</span><span class="o">+</span><span class="mi">5</span><span class="o">+</span><span class="n">i</span>
        <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">datafile_content</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>


    <span class="n">n_data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datafile_content</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n_sites</span><span class="o">+</span><span class="mi">5</span><span class="o">+</span><span class="n">n_freqs</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
    

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;lo_site_names&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">sitenames</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;lo_site_locations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitelocations</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_sites&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">n_sites</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_datapoints&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">n_data</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_freqs&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">n_freqs</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;lo_freqs&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="n">freqs</span>
    
    
</div>
<div class="viewcode-block" id="get_model_setup"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.get_model_setup">[docs]</a><span class="k">def</span> <span class="nf">get_model_setup</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">):</span>

    <span class="n">ncol0</span>      <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;ncol0&#39;</span><span class="p">]))</span>
    <span class="n">n_layer</span>    <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_layers&#39;</span><span class="p">]))</span>
    <span class="n">nfe</span>        <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;nfe&#39;</span><span class="p">]</span>
    <span class="n">thickness</span>  <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;thickness&#39;</span><span class="p">]</span>
    <span class="n">width</span>      <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span>
    <span class="n">trigger</span>    <span class="o">=</span>  <span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;trigger&#39;</span><span class="p">])</span>
    <span class="n">dlz</span> <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;dlz&#39;</span><span class="p">]</span>

    <span class="n">modelblockstrings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lo_colnumbers</span>     <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ncol</span>     <span class="o">=</span> <span class="n">ncol0</span>
    <span class="n">np</span>       <span class="o">=</span> <span class="mi">0</span>

    
    <span class="k">for</span> <span class="n">layer_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_layer</span><span class="p">):</span>
        <span class="n">block_idx</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c">#print layer_idx,len(thickness),len(width),ncol,len(dlz)</span>
    
        <span class="k">while</span> <span class="n">block_idx</span><span class="o">+</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">ncol</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span>

            <span class="c">#PROBLEM : &#39;thickness&#39; has only &quot;n_layer&#39;-1 entries!!</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dlz</span><span class="p">[</span><span class="n">layer_idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">trigger</span><span class="o">*</span><span class="p">(</span><span class="n">width</span><span class="p">[</span><span class="n">block_idx</span><span class="p">]</span><span class="o">+</span><span class="n">width</span><span class="p">[</span><span class="n">block_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">block_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">width</span><span class="p">[</span><span class="n">block_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">width</span><span class="p">[</span><span class="n">block_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nfe</span><span class="p">[</span><span class="n">block_idx</span><span class="p">]</span>   <span class="o">+=</span> <span class="n">nfe</span><span class="p">[</span><span class="n">block_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">ncol</span><span class="p">):</span>
                    <span class="n">width</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                    <span class="n">nfe</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="n">nfe</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>

                <span class="n">ncol</span> <span class="o">-=</span><span class="mi">1</span>

        <span class="n">lo_colnumbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncol</span><span class="p">)</span>

        <span class="n">tempstring</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="n">tempstring</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s"> &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">nfe</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">tempstring</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">modelblockstrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tempstring</span><span class="p">)</span>

        <span class="n">np</span> <span class="o">=</span> <span class="n">np</span> <span class="o">+</span> <span class="n">ncol</span>

        <span class="c">#completely unnecessary!!! :</span>
        <span class="k">if</span> <span class="n">layer_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mcol</span> <span class="o">=</span> <span class="n">ncol</span>
        

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;modelblockstrings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelblockstrings</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;lo_colnumbers&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">lo_colnumbers</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_parameters&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">np</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_cols_max&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">mcol</span>
    
</div>
<div class="viewcode-block" id="blocks_elements_setup"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.blocks_elements_setup">[docs]</a><span class="k">def</span> <span class="nf">blocks_elements_setup</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">):</span>
    

    <span class="n">lo_sites</span> <span class="o">=</span> <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;lo_site_locations&#39;</span><span class="p">]</span>
    <span class="n">n_sites</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lo_sites</span><span class="p">)</span>
    <span class="n">maxwidth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;max_blockwidth&#39;</span><span class="p">])</span>

    <span class="n">nbot</span>     <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_bottomlayerelements&#39;</span><span class="p">]))</span>
    <span class="n">nside</span>    <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_sideblockelements&#39;</span><span class="p">]))</span>

    <span class="c"># j: index for finite elements</span>
    <span class="c"># k: index for regularisation bricks</span>
    <span class="c"># Python style: start with 0 instead of 1</span>

    <span class="n">sitlok</span>      <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sides</span>       <span class="o">=</span> <span class="p">[]</span>
    <span class="n">width</span>       <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dly</span>         <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nfe</span>         <span class="o">=</span> <span class="p">[]</span>
    <span class="n">thickness</span>   <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nfev</span>        <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dlz</span>         <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bot</span>         <span class="o">=</span> <span class="p">[]</span>

    
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sitlok</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lo_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_sites</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        
        <span class="n">spacing</span>           <span class="o">=</span> <span class="n">lo_sites</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">lo_sites</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n_localextrasites</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">spacing</span><span class="o">/</span><span class="n">maxwidth</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">idx2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_localextrasites</span><span class="p">):</span>
            <span class="n">sitlok</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lo_sites</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">idx2</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n_localextrasites</span><span class="p">)</span><span class="o">*</span><span class="n">spacing</span> <span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c"># nrk: number of total dummy stations</span>
    <span class="n">nrk</span> <span class="o">=</span> <span class="n">j</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s"> dummy stations defined&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">nrk</span><span class="p">)</span>

    
    <span class="n">spacing1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sitlok</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">sitlok</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">sides</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">spacing1</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nside</span><span class="p">):</span>
        <span class="n">curr_side</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">sides</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">curr_side</span> <span class="o">&gt;</span> <span class="mf">1000000.</span><span class="p">:</span>
            <span class="n">curr_side</span> <span class="o">=</span> <span class="mf">1000000.</span>
        <span class="n">sides</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_side</span><span class="p">)</span>
        
    <span class="c">#-------------------------------------------</span>

    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">firstblockwidth</span> <span class="o">=</span> <span class="mf">0.</span>
    
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nside</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">firstblockwidth</span> <span class="o">+=</span> <span class="n">sides</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sides</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="n">width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstblockwidth</span><span class="p">)</span>
    <span class="n">nfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>
    
    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing1</span><span class="p">)</span>
    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing1</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">nfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">spacing1</span><span class="p">)</span>

    <span class="n">block_offset</span> <span class="o">=</span> <span class="n">width</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing1</span><span class="p">)</span>
    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing1</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">nfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">spacing1</span><span class="p">)</span>
    
    <span class="n">block_offset</span> <span class="o">+=</span> <span class="n">spacing1</span>

    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c">#------------------------</span>
    
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nrk</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">spacing2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sitlok</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">sitlok</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing1</span><span class="p">)</span>
        <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing2</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="n">nfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing1</span><span class="o">+</span><span class="n">spacing2</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">spacing1</span> <span class="o">=</span> <span class="n">spacing2</span>

    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing2</span><span class="p">)</span>
    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing2</span><span class="p">)</span>

    <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">nfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">spacing2</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing2</span><span class="p">)</span>
    <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spacing2</span><span class="p">)</span>
    
    <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="n">nfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">spacing2</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">width</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">sides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">spacing2</span>

    <span class="c">#------------------------------</span>
    
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nside</span><span class="p">):</span>
        <span class="n">curr_side</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">sides</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">curr_side</span> <span class="o">&gt;</span> <span class="mf">1000000.</span><span class="p">:</span>
            <span class="n">curr_side</span> <span class="o">=</span> <span class="mf">1000000.</span>
        <span class="n">sides</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">curr_side</span>


    <span class="n">lastblockwidth</span><span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nside</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">lastblockwidth</span> <span class="o">+=</span> <span class="n">sides</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">dly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sides</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="n">width</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lastblockwidth</span>

    <span class="c">#---------------------------------</span>

    <span class="n">k</span><span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>

    <span class="n">nodey</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">ncol0</span> <span class="o">=</span> <span class="n">k</span>

    <span class="n">block_offset</span> <span class="o">=</span> <span class="n">sitlok</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">block_offset</span>

    <span class="c">#----------------------------------</span>

    <span class="n">layers_per_decade</span>     <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_layersperdecade&#39;</span><span class="p">])</span>
    <span class="n">first_layer_thickness</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;firstlayer_thickness&#39;</span><span class="p">])</span>

    <span class="n">t</span>          <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">layers_per_decade</span><span class="p">)</span>
    <span class="n">t1</span>         <span class="o">=</span> <span class="n">first_layer_thickness</span>
    <span class="n">thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
    
    <span class="n">d1</span> <span class="o">=</span> <span class="n">t1</span>
    
    <span class="n">n_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_layers&#39;</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_layers</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span><span class="o">*</span><span class="n">t</span>
        <span class="n">curr_thickness</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">-</span> <span class="n">d1</span>
        <span class="k">if</span> <span class="n">curr_thickness</span> <span class="o">&lt;</span> <span class="n">t1</span><span class="p">:</span>
            <span class="n">curr_thickness</span> <span class="o">=</span> <span class="n">t1</span>
        <span class="n">thickness</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_thickness</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">+=</span> <span class="n">curr_thickness</span>
    
    
    <span class="n">bot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">thickness</span><span class="p">[</span><span class="n">n_layers</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nbot</span><span class="p">):</span>
        <span class="n">bot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bot</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>

    <span class="c">#--------------------------------------------------</span>

    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">dlz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thickness</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">dlz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thickness</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">nfev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">k</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="n">dlz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thickness</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">dlz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thickness</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">nfev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">k</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">n_layers</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">nfev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">dlz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thickness</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbot</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">dlz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bot</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="n">nfev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nbot</span><span class="p">)</span>

    <span class="n">nodez</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>
    

    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;ncol0&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="n">ncol0</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;nfe&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">nfe</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;nfev&#39;</span><span class="p">]</span>              <span class="o">=</span> <span class="n">nfev</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;thickness&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">thickness</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span>             <span class="o">=</span> <span class="n">width</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;binding_offset&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">block_offset</span>
    <span class="c">#parameter_dict[&#39;y_nodes&#39;]           = nodey </span>
    <span class="c">#parameter_dict[&#39;z_nodes&#39;]           = nodez</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;dlz&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">dlz</span>
    <span class="c">#parameter_dict[&#39;dly&#39;]               = dly</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;mesh_positions_vert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dlz</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;mesh_positions_hor&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">dly</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_nodes_hor&#39;</span><span class="p">]</span>         <span class="o">=</span> <span class="n">nodey</span>
    <span class="n">parameter_dict</span><span class="p">[</span><span class="s">&#39;n_nodes_vert&#39;</span><span class="p">]</span>        <span class="o">=</span> <span class="n">nodez</span>
    
    </div>
<div class="viewcode-block" id="OccamPointPicker"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.OccamPointPicker">[docs]</a><span class="k">class</span> <span class="nc">OccamPointPicker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class will help the user interactively pick points to mask and add </span>
<span class="sd">    error bars. </span>
<span class="sd">    </span>
<span class="sd">    To mask just a single point right click over the point and a gray point </span>
<span class="sd">    will appear indicating it has been masked</span>
<span class="sd">    </span>
<span class="sd">    To mask both the apparent resistivity and phase left click over the point.</span>
<span class="sd">    Gray points will appear over both the apparent resistivity and phase.  </span>
<span class="sd">    Sometimes the points don&#39;t exactly matchup, haven&#39;t quite worked that bug</span>
<span class="sd">    out yet, but not to worry it picks out the correct points</span>
<span class="sd">    </span>
<span class="sd">    To add error bars to a point click the middle or scroll bar button.  This</span>
<span class="sd">    only adds error bars to the point and does not reduce them so start out</span>
<span class="sd">    with reasonable errorbars.  You can change the increment that the error</span>
<span class="sd">    bars are increased with reserrinc and phaseerrinc.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        axlst = list of the resistivity and phase axis that have been plotted</span>
<span class="sd">                as [axrte,axrtm,axpte,axptm]</span>
<span class="sd">        </span>
<span class="sd">        linelst = list of lines used to plot the responses, not the error bars</span>
<span class="sd">        </span>
<span class="sd">        errlst = list of the errorcaps and errorbar lines as </span>
<span class="sd">                   [[cap1,cap2,bar],...]</span>
<span class="sd">                 </span>
<span class="sd">        reserrinc = percent increment to increase the errorbars</span>
<span class="sd">        </span>
<span class="sd">        phaseerrinc = percent increment to increase the errorbars</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
<div class="viewcode-block" id="OccamPointPicker.__init__"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.OccamPointPicker.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axlst</span><span class="p">,</span><span class="n">linelst</span><span class="p">,</span><span class="n">errlst</span><span class="p">,</span><span class="n">reserrinc</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">phaseerrinc</span><span class="o">=.</span><span class="mo">02</span><span class="p">,</span>
                 <span class="n">marker</span><span class="o">=</span><span class="s">&#39;h&#39;</span><span class="p">):</span>
        <span class="c">#give the class some attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axlst</span><span class="o">=</span><span class="n">axlst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linelst</span><span class="o">=</span><span class="n">linelst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="o">=</span><span class="n">errlst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fndict</span><span class="o">=</span><span class="p">{}</span>
        <span class="c">#see if just one figure is plotted or multiple figures are plotted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">=</span><span class="n">axlst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">=</span><span class="n">linelst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cidlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axlst</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        
            <span class="c">#get data from lines and make a dictionary of frequency points for easy</span>
            <span class="c">#indexing</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">linelst</span><span class="p">[</span><span class="n">nn</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;{0:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span><span class="p">,</span><span class="n">kk</span> <span class="ow">in</span> 
                                        <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">0</span><span class="p">])]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fndict</span><span class="p">[</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">)]</span><span class="o">=</span><span class="n">nn</span>
                
                <span class="c">#set some events</span>
                <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">cid1</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;pick_event&#39;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">cid2</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;axes_enter_event&#39;</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">inAxes</span><span class="p">)</span>
                    <span class="n">cid3</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;key_press_event&#39;</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">on_close</span><span class="p">)</span>
                    <span class="n">cid4</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;figure_enter_event&#39;</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">inFigure</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cidlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">cid1</span><span class="p">,</span><span class="n">cid2</span><span class="p">,</span><span class="n">cid3</span><span class="p">,</span><span class="n">cid4</span><span class="p">])</span>
        
            <span class="c">#read in the error in a useful way so that it can be translated to </span>
            <span class="c">#the data file.  Make the error into an array</span>
            <span class="k">for</span> <span class="n">ee</span><span class="p">,</span><span class="n">err</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">errlst</span><span class="p">[</span><span class="n">nn</span><span class="p">]):</span>
                <span class="n">errpath</span><span class="o">=</span><span class="n">err</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()</span>
                <span class="n">errarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="n">nn</span><span class="p">][</span><span class="n">ee</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">ff</span><span class="p">,</span><span class="n">epath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">errpath</span><span class="p">):</span>
                    <span class="n">errv</span><span class="o">=</span><span class="n">epath</span><span class="o">.</span><span class="n">vertices</span>
                    <span class="n">errarr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">errv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nn</span><span class="p">][</span><span class="n">ee</span><span class="p">][</span><span class="n">ff</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errarr</span><span class="p">)</span>
        
        <span class="c">#set the error bar increment values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserrinc</span><span class="o">=</span><span class="n">reserrinc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phaseerrinc</span><span class="o">=</span><span class="n">phaseerrinc</span>
        <span class="c">#set the marker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">=</span><span class="n">marker</span>
        <span class="c">#set the figure number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span>
        <span class="c">#make a list of occam lines to write later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occamlines</span><span class="o">=</span><span class="p">[]</span>
    
        
        
    </div>
<div class="viewcode-block" id="OccamPointPicker.__call__"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.OccamPointPicker.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the function is called the mouse events will be recorder for </span>
<span class="sd">        picking points to mask or change error bars.</span>
<span class="sd">        </span>
<span class="sd">        Left mouse button will mask both resistivity and phase point</span>
<span class="sd">        </span>
<span class="sd">        Right mouse button will mask just the point selected</span>
<span class="sd">        </span>
<span class="sd">        middle mouse button will increase the error bars</span>
<span class="sd">        </span>
<span class="sd">        q will close the figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">=</span><span class="n">event</span>
        <span class="c">#make a new point that is an PickEvent type</span>
        <span class="n">npoint</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">artist</span>
        <span class="c">#if the right button is clicked mask the point</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">button</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="c">#get the point that was clicked on</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="n">xd</span><span class="o">=</span><span class="n">npoint</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">yd</span><span class="o">=</span><span class="n">npoint</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            
            <span class="c">#set the x index from the frequency dictionary</span>
            <span class="n">ll</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="s">&#39;{0:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xd</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            
            <span class="c">#change the data to be a zero</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            
            <span class="c">#reset the point to be a gray x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span><span class="n">yd</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                         <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        
        <span class="c">#if the left button is clicked change both resistivity and phase points</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">button</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="c">#get the point that was clicked on</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="n">xd</span><span class="o">=</span><span class="n">npoint</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">yd</span><span class="o">=</span><span class="n">npoint</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            
            <span class="c">#set the x index from the frequency dictionary</span>
            <span class="n">ll</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="s">&#39;{0:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xd</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            
            <span class="c">#set the data point to zero</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            
            <span class="c">#reset the point to be a gray x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span><span class="n">yd</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                         <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            
            <span class="c">#check to make sure there is a corresponding res/phase point</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c">#get the corresponding y-value </span>
                <span class="n">yd2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">kk</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>
                
                <span class="c">#set that data point to 0 as well</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">kk</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                
                <span class="c">#make that data point a gray x</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xd</span><span class="p">,</span><span class="n">yd2</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">,</span>
                                        <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Axis does not contain res/phase point&#39;</span>
                
        <span class="c">#if click the scroll button or middle button change increase the </span>
        <span class="c">#errorbars by the given amount</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">button</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">ind</span>
            <span class="n">xd</span><span class="o">=</span><span class="n">npoint</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">yd</span><span class="o">=</span><span class="n">npoint</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">()[</span><span class="n">ii</span><span class="p">]</span>
            
            <span class="c">#get x index</span>
            <span class="n">ll</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="s">&#39;{0:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xd</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            
            <span class="c">#make error bar array</span>
            <span class="n">eb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span>
            
            <span class="c">#make ecap array</span>
            <span class="n">ecapl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>
            <span class="n">ecapu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>
            
            <span class="c">#change apparent resistivity error</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">nebu</span><span class="o">=</span><span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">reserrinc</span><span class="o">*</span><span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nebl</span><span class="o">=</span><span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">reserrinc</span><span class="o">*</span><span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ecapl</span><span class="o">=</span><span class="n">ecapl</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">reserrinc</span><span class="o">*</span><span class="n">ecapl</span>
                <span class="n">ecapu</span><span class="o">=</span><span class="n">ecapu</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">reserrinc</span><span class="o">*</span><span class="n">ecapu</span>
                
            <span class="c">#change phase error</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">nebu</span><span class="o">=</span><span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phaseerrinc</span>
                <span class="n">nebl</span><span class="o">=</span><span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phaseerrinc</span>
                <span class="n">ecapl</span><span class="o">=</span><span class="n">ecapl</span><span class="o">-</span><span class="n">ecapl</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phaseerrinc</span>
                <span class="n">ecapu</span><span class="o">=</span><span class="n">ecapu</span><span class="o">+</span><span class="n">ecapu</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phaseerrinc</span>
                
            <span class="c">#put the new error into the error array    </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">nebu</span><span class="o">-</span>\
                                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="n">ll</span><span class="p">])</span>
            
            <span class="c">#set the new error bar values</span>
            <span class="n">eb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">nebu</span>
            <span class="n">eb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">nebl</span>
            
            <span class="c">#reset the error bars and caps</span>
            <span class="n">ncapl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">ncapu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
            <span class="n">ncapl</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">ecapl</span>
            <span class="n">ncapu</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">ecapu</span>
            
            <span class="c">#set the values </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">ncapl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">ncapu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span><span class="o">=</span><span class="n">eb</span>
            
        <span class="c">#redraw the canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="c">#get the axis number that the mouse is in and change to that axis</span></div>
<div class="viewcode-block" id="OccamPointPicker.inAxes"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.OccamPointPicker.inAxes">[docs]</a>    <span class="k">def</span> <span class="nf">inAxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event2</span><span class="o">=</span><span class="n">event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">inaxes</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">axj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axlst</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">axl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axj</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">==</span><span class="n">axl</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">=</span><span class="n">ll</span>
                
        <span class="c">#set complimentary resistivity and phase plots together</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kk</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kk</span><span class="o">=</span><span class="mi">3</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jj</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kk</span><span class="o">=</span><span class="mi">1</span>
        
    <span class="c">#get the figure number that the mouse is in</span></div>
<div class="viewcode-block" id="OccamPointPicker.inFigure"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.OccamPointPicker.inFigure">[docs]</a>    <span class="k">def</span> <span class="nf">inFigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event3</span><span class="o">=</span><span class="n">event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fndict</span><span class="p">[</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">number</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linelst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c">#type the q key to quit the figure and disconnect event handling            </span></div>
<div class="viewcode-block" id="OccamPointPicker.on_close"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.OccamPointPicker.on_close">[docs]</a>    <span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event3</span><span class="o">=</span><span class="n">event</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event3</span><span class="o">.</span><span class="n">key</span><span class="o">==</span><span class="s">&#39;q&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cidlst</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fignum</span><span class="p">]:</span>
               <span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;closed&#39;</span>     
            </div></div>
<div class="viewcode-block" id="Occam2DData"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData">[docs]</a><span class="k">class</span> <span class="nc">Occam2DData</span><span class="p">:</span>
<div class="viewcode-block" id="Occam2DData.__init__"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">datafn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">=</span><span class="n">datafn</span>
        </div>
<div class="viewcode-block" id="Occam2DData.make2DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.make2DdataFile">[docs]</a>    <span class="k">def</span> <span class="nf">make2DdataFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edipath</span><span class="p">,</span><span class="n">mmode</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">stationlst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">resxyerr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">resyxerr</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                       <span class="n">phasexyerr</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">phaseyxerr</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">ss</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%2.6f</span><span class="s">&#39;</span><span class="p">,</span>
                       <span class="n">freqstep</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">plotyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="n">lineori</span><span class="o">=</span><span class="s">&#39;ew&#39;</span><span class="p">,</span><span class="n">tippererr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                       <span class="n">ftol</span><span class="o">=.</span><span class="mo">05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make2DdataFile will make a data file for occam2D.  </span>
<span class="sd">        </span>
<span class="sd">        Input:</span>
<span class="sd">            edipath = path to edifiles</span>
<span class="sd">            mmode = modes to invert for.  Can be: </span>
<span class="sd">                    &#39;both&#39; -&gt; will model both TE and TM modes</span>
<span class="sd">                    &#39;TM&#39;   -&gt; will model just TM mode</span>
<span class="sd">                    &#39;TE&#39;   -&gt; will model just TE mode</span>
<span class="sd">            savepath = path to save the data file to, this can include the name of</span>
<span class="sd">                       the data file, if not the file will be named:</span>
<span class="sd">                           savepath\Data.dat or edipath\Data.dat if savepath=None</span>
<span class="sd">            stationlst = list of stations to put in the data file, doesn&#39;t need to</span>
<span class="sd">                         be in order, the relative distance will be calculated</span>
<span class="sd">                         internally.  If stationlst=None, it will be assumed all the</span>
<span class="sd">                         files in edipath will be input into the data file</span>
<span class="sd">            title = title input into the data file</span>
<span class="sd">            thetar = rotation angle (deg) of the edifiles if you want to align the</span>
<span class="sd">                     components with the profile.  Angle is on the unit circle with </span>
<span class="sd">                     an orientation that north is 0 degree, east -90.</span>
<span class="sd">            resxyerr = percent error in the res_xy component (TE), </span>
<span class="sd">                      can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                      used.  </span>
<span class="sd">            resyxerr = percent error in the res_yx component (TM), </span>
<span class="sd">                      can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                      used.  </span>
<span class="sd">            phasexyerr = percent error in the phase_xy component (TE), </span>
<span class="sd">                      can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                      used.  </span>
<span class="sd">            phaseyxerr = percent error in the phase_yx component (TM), </span>
<span class="sd">                      can be entered as &#39;data&#39; where the errors from the data are</span>
<span class="sd">                      used.  </span>
<span class="sd">            ss = is the spacing parameter for the data file</span>
<span class="sd">            fmt = format of the numbers for the data file, see string formats for </span>
<span class="sd">                  a full description</span>
<span class="sd">            freqstep = take frequencies at this step, so if you want to take every</span>
<span class="sd">                       third frequency enter 3.  </span>
<span class="sd">                       Can input as a list of specific frequencies.  Note that the</span>
<span class="sd">                       frequencies must match the frequencies in the EDI files,</span>
<span class="sd">                       otherwise they will not be input.  </span>
<span class="sd">            plotyn = y or n to plot the stations on the profile line.</span>
<span class="sd">            lineori = predominant line orientation with respect to geographic north</span>
<span class="sd">                     ew for east-west line-&gt; will orientate so first station is </span>
<span class="sd">                                             farthest to the west</span>
<span class="sd">                     ns for north-south line-&gt; will orientate so first station is </span>
<span class="sd">                                             farthest to the south</span>
<span class="sd">            tippererr = error for tipper in percent.  If this value is entered than</span>
<span class="sd">                        the tipper will be included in the inversion, if the value</span>
<span class="sd">                        is None than the tipper will not be included.</span>
<span class="sd">                  </span>
<span class="sd">        Output:</span>
<span class="sd">            datfilename = full path of data file</span>
<span class="sd">                     </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="c">#create rotation matrix</span>
        <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetar</span><span class="p">)],</span>
                             <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetar</span><span class="p">)]])</span>
        
        <span class="c">#-----------------------Station Locations-----------------------------------    </span>
        <span class="c">#create a list to put all the station dictionaries into</span>
        <span class="n">surveylst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">eastlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">northlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">pstationlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">freqlst</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">stationlst</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">stationlst</span><span class="o">=</span><span class="p">[</span><span class="n">edifile</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">edifile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">edifile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.edi&#39;</span><span class="p">)]</span>
        
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">):</span>
            <span class="c">#search for filenames in the given directory and match to station name</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;*.edi&#39;</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&#39;Found station edifile: &#39;</span><span class="p">,</span> <span class="n">filename</span>
                    <span class="n">surveydict</span><span class="o">=</span><span class="p">{}</span> <span class="c">#create a dictionary for the station data and info</span>
                    <span class="n">edifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span> <span class="c">#create filename path</span>
                    <span class="n">z1</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
                    <span class="n">freq</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">frequency</span>                
                    <span class="c">#check to see if the frequency is in descending order</span>
                    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">z</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                        <span class="n">zvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">zvar</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                        <span class="n">tip</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tipper</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                        <span class="n">tipvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tippervar</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                        
                        <span class="k">print</span> <span class="s">&#39;Flipped to descending frequency for station &#39;</span><span class="o">+</span><span class="n">station</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">z</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">z</span>
                        <span class="n">zvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">zvar</span>
                        <span class="n">tip</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tipper</span>
                        <span class="n">tipvar</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">tippervar</span>
                    <span class="c">#rotate matrices if angle is greater than 0</span>
                    <span class="k">if</span> <span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
                            <span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                            <span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                                                 <span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                            
                    <span class="c">#get eastings and northings so everything is in meters</span>
                    <span class="n">zone</span><span class="p">,</span><span class="n">east</span><span class="p">,</span><span class="n">north</span><span class="o">=</span><span class="n">utm2ll</span><span class="o">.</span><span class="n">LLtoUTM</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
                    <span class="c">#put things into a dictionary to sort out order of stations</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">station</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">east</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">north</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;zone&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">zone</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">z</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">zvar</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;freq&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">freq</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tip</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tipvar</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">lat</span>
                    <span class="n">surveydict</span><span class="p">[</span><span class="s">&#39;lon&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">lon</span>
                    <span class="n">freqlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
                    <span class="n">eastlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">east</span><span class="p">)</span>
                    <span class="n">northlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">north</span><span class="p">)</span>
                    <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>
                    <span class="n">surveylst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surveydict</span><span class="p">)</span>
        
        <span class="c">#-----------------------------------------------------------------            </span>
        <span class="c">#project stations onto a best fitting line taking into account the </span>
        <span class="c">#strike direction to get relative MT distance correct</span>
        <span class="c">#-----------------------------------------------------------------</span>
        
        <span class="c">#get bestfitting line</span>
        <span class="n">p</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">eastlst</span><span class="p">,</span><span class="n">northlst</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c">#the angle of the line is now the angle of the best fitting line added</span>
        <span class="c">#to the geoelectric strike direction, which gives the relative distance</span>
        <span class="c">#along the strike direction.</span>
        <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">print</span> <span class="s">&#39;Profile Line Angle is: {0:.4g} (E=0,N=90)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        
        <span class="c">#plot stations on profile line</span>
        <span class="k">if</span> <span class="n">plotyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">lfig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="n">lax</span><span class="o">=</span><span class="n">lfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">lax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eastlst</span><span class="p">,</span><span class="n">sp</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">eastlst</span><span class="p">),</span><span class="s">&#39;-b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">lax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Projected Stations&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">surveylst</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;zone&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;zone&#39;</span><span class="p">]:</span>
                <span class="k">print</span> <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">]</span>
            <span class="n">d</span><span class="o">=</span><span class="p">(</span><span class="n">northlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">sp</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">eastlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">eastlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y0</span><span class="o">=</span><span class="n">northlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">x0</span>
            <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">y0</span>
            
            
            <span class="c">#need to figure out a way to account for zone changes</span>
            
            <span class="k">if</span> <span class="n">lineori</span><span class="o">==</span><span class="s">&#39;ew&#39;</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]:</span>
                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                    <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]:</span>
                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                    <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">elif</span> <span class="n">lineori</span><span class="o">==</span><span class="s">&#39;ns&#39;</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]:</span>
                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                    <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]:</span>
                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;east&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                    <span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">]</span><span class="o">-</span>
                                                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;north&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">surveylst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                    
            <span class="k">if</span> <span class="n">plotyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
<span class="c">#                ds=surveylst[ii][&#39;offset&#39;]*np.sin(thetar)*(1-np.tan(thetar)**2)</span>
<span class="c">#                lax.plot(x0+ds*np.cos(thetar),y0+ds*np.sin(thetar),&#39;v&#39;,</span>
<span class="c">#                         color=&#39;k&#39;,ms=8,mew=3)</span>
                <span class="n">lax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">lax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="o">+.</span><span class="mo">0005</span><span class="p">,</span><span class="n">pstationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                                                            <span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        
        <span class="c">#sort by ascending order of distance from first station</span>
        <span class="n">surveylst</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">surveylst</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s">&#39;offset&#39;</span><span class="p">))</span>
        
        <span class="c">#number of stations read    </span>
        <span class="n">nstat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">surveylst</span><span class="p">)</span>    
        
        <span class="c">#--------------------------Match Frequencies---------------------------</span>
        <span class="c">#a dictionary is created with the frequency as the key and the value is</span>
        <span class="c">#the frequency number in the list. Each edi file is iterated over </span>
        <span class="c">#extracting only the matched frequencies.  This makes it necessary to </span>
        <span class="c">#have the same frequency content in each edifile.  If the frequencies</span>
        <span class="c">#do not match then you can specify a tolerance to look around for </span>
        <span class="c">#each frequency.</span>
        
        <span class="c">#make a list to iterate over frequencies</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">freqstep</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">freqstep</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">freqstep</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="c">#find the median frequency list</span>
                <span class="n">maxflen</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freqlst</span><span class="p">])</span>
                <span class="n">farray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nstat</span><span class="p">,</span><span class="n">maxflen</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstat</span><span class="p">):</span>
                    <span class="n">farray</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">])]</span><span class="o">=</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            
                <span class="n">mfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">farray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">mfreq</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">freqstep</span><span class="p">)</span>
                <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">mfreq</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">ii</span><span class="p">)</span> 
                                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqstep</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">mfreq</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqstep</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#find the median frequency list</span>
            <span class="n">maxflen</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">freqlst</span><span class="p">])</span>
            <span class="n">farray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nstat</span><span class="p">,</span><span class="n">maxflen</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstat</span><span class="p">):</span>
                <span class="n">farray</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">])]</span><span class="o">=</span><span class="n">freqlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            
            <span class="n">mfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">farray</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
            <span class="c">#make a dictionary of values        </span>
            <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">,</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> 
                        <span class="nb">enumerate</span><span class="p">(</span><span class="n">mfreq</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">maxflen</span><span class="p">,</span><span class="n">freqstep</span><span class="p">)],</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">ff</span><span class="o">!=</span><span class="mi">0</span><span class="p">])</span>
    
        <span class="c">#print the frequencies to look for to make sure its what the user wants</span>
        <span class="c">#make a list of keys that is sorted in descending order</span>
        <span class="n">klst</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">fdict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">klst</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">klst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dd</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">klst</span><span class="p">]</span>    
        
        <span class="k">print</span> <span class="s">&#39;Frequencies to look for are: (# freq(Hz) Period(s)) &#39;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">klst</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">fdict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">key</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        
        <span class="c">#make lists of parameters to write to file    </span>
        <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">offsetlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">stationlstsort</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstat</span><span class="p">):</span>
            <span class="n">z</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">zvar</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span>
            <span class="n">freq</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;freq&#39;</span><span class="p">]</span>
            <span class="n">offsetlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">])</span>  
            <span class="n">stationlstsort</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">])</span>
            <span class="n">tip</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span>
            <span class="n">tipvar</span><span class="o">=</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span>
            <span class="c">#loop over frequencies to pick out the ones desired</span>
            <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
                <span class="c">#jj is the index of edi file frequency list, this index </span>
                <span class="c">#corresponds to the impedance tensor component index</span>
                <span class="c">#ff is the frequency from the edi file frequency list</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c">#nn is the frequency number out of extracted frequency list</span>
                    <span class="n">nn</span><span class="o">=</span><span class="n">fdict</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">]</span>
                    
                    <span class="c">#calculate apparent resistivity </span>
                    <span class="n">wt</span><span class="o">=.</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
                    <span class="n">resxy</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">resyx</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            
                    <span class="c">#calculate the phase putting the yx in the 1st quadrant        </span>
                    <span class="n">phasexy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                    <span class="n">phaseyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span>\
                            <span class="mi">180</span>
                    <span class="c">#put phases in correct quadrant if should be negative</span>
                    <span class="k">if</span> <span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">:</span>
                        <span class="n">phaseyx</span><span class="o">=</span><span class="n">phaseyx</span><span class="o">-</span><span class="mi">360</span>
                        <span class="k">print</span> <span class="s">&#39;Found Negative Phase&#39;</span><span class="p">,</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">],</span><span class="n">ff</span>    
                    
                    <span class="c">#calculate errors</span>
                    <span class="c">#res_xy (TE)</span>
                    <span class="k">if</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">dresxyerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resxy</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresxyerr</span><span class="o">/</span><span class="n">resxy</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    
                    <span class="c">#Res_yx(TM)</span>
                    <span class="k">if</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">dresyxerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resyx</span>
                        <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresyxerr</span><span class="o">/</span><span class="n">resyx</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    
                    <span class="c">#phase_xy(TE)</span>
                    <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span>\
                                    <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dphasexyerr</span><span class="o">=</span><span class="p">(</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                        
                    <span class="c">#phase_yx (TM)</span>
                    <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                        <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span>\
                                    <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dphaseyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                    
                    <span class="c">#calculate log10 of resistivity as prescribed by OCCAM</span>
                    <span class="n">lresyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resyx</span><span class="p">)</span>
                    <span class="n">lresxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resxy</span><span class="p">)</span>
                    
                    <span class="c">#if include the tipper</span>
                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c">#calculate the projection angle for real and imaginary</span>
                            <span class="n">tipphir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span>\
                                    <span class="n">theta</span>
                            <span class="n">tipphii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">-</span>\
                                    <span class="n">theta</span>
                            
                            <span class="c">#project the tipper onto the profile line</span>
                            <span class="n">projtipr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                      <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphir</span><span class="p">)</span>
                            <span class="n">projtipi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                      <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphii</span><span class="p">)</span>
                                      
                            <span class="c">#error of tipper is a decimal percentage</span>
                            <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                            
                            <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                            
                        
                    <span class="c">#make a list of lines to write to the data file</span>
                    <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;mmode&#39;</span> <span class="o">+</span><span class="n">mmode</span><span class="o">+</span><span class="s">&#39; not defined&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="c">#search around the frequency given by ftol</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">ff</span><span class="o">&gt;</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ftol</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ff</span><span class="o">&lt;</span><span class="nb">float</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ftol</span><span class="p">):</span>
                                <span class="n">nn</span><span class="o">=</span><span class="n">fdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>                           
                                <span class="n">wt</span><span class="o">=.</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>
                                <span class="n">resxy</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                                <span class="n">resyx</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                        
                                <span class="c">#calculate the phase putting the yx in the 1st quadrant        </span>
                                <span class="n">phasexy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span>\
                                        <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                                <span class="n">phaseyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span>\
                                        <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="mi">180</span>
                                <span class="c">#put phases in correct quadrant if should be negative</span>
                                <span class="k">if</span> <span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">:</span>
                                    <span class="n">phaseyx</span><span class="o">=</span><span class="n">phaseyx</span><span class="o">-</span><span class="mi">360</span>
                                    <span class="k">print</span> <span class="s">&#39;Found Negative Phase&#39;</span><span class="p">,</span><span class="n">surveylst</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">],</span><span class="n">ff</span>    
                                
                                <span class="c">#calculate errors</span>
                                <span class="c">#res_xy (TE)</span>
                                <span class="k">if</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                    <span class="n">dresxyerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resxy</span>
                                    <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresxyerr</span><span class="o">/</span><span class="n">resxy</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                                
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                                
                                <span class="c">#Res_yx(TM)</span>
                                <span class="k">if</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                    <span class="n">dresyxerr</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">resyx</span>
                                    <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">dresyxerr</span><span class="o">/</span><span class="n">resyx</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                                
                                <span class="c">#phase_xy(TE)</span>
                                <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                    <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span>\
                                                <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">dphasexyerr</span><span class="o">=</span><span class="p">(</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                                    
                                <span class="c">#phase_yx (TM)</span>
                                <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                                    <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span>\
                                                <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">dphaseyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                                
                                <span class="c">#calculate log10 of resistivity as prescribed by OCCAM</span>
                                <span class="n">lresyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resyx</span><span class="p">)</span>
                                <span class="n">lresxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resxy</span><span class="p">)</span>
                                
                                <span class="c">#if include the tipper</span>
                                <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                                        <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="c">#calculate the projection angle for real and imaginary</span>
                                        <span class="n">tipphir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span>
                                        <span class="n">tipphii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">-</span><span class="n">theta</span>
                                        
                                        <span class="c">#project the tipper onto the profile line</span>
                                        <span class="n">projtipr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                                  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphir</span><span class="p">)</span>
                                        <span class="n">projtipi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                                  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphii</span><span class="p">)</span>
                                                  
                                        <span class="c">#error of tipper is a decimal percentage</span>
                                        <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                                        
                                        <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                                        
                                    
                                <span class="c">#make a list of lines to write to the data file</span>
                                <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                        <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                    <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;mmode&#39;</span> <span class="o">+</span><span class="n">mmode</span><span class="o">+</span><span class="s">&#39; not defined&#39;</span><span class="p">)</span>    
                            
                                <span class="k">break</span>                         
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">pass</span>
            <span class="c">#                           print &#39;Did not find frequency {0} for station {1}&#39;.format(ff,surveylst[kk][&#39;station&#39;])</span>
                                <span class="c">#calculate resistivity </span>
                                   
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
        
        <span class="c">#===========================================================================</span>
        <span class="c">#                             write dat file</span>
        <span class="c">#===========================================================================</span>
        <span class="k">if</span> <span class="n">savepath</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">=</span><span class="n">savepath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;Data.dat&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="s">&#39;Data.dat&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Occam Inversion&#39;</span>
            
        <span class="n">datfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FORMAT:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">11</span><span class="o">+</span><span class="s">&#39;OCCAM2MTDATA_1.0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TITLE:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="s">&#39;{0:.4g}--&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span>\
                      <span class="n">title</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write station sites</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nstat</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stationlstsort</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write offsets</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OFFSETS (M):&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="n">offsetlst</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">offset</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write frequencies</span>
        <span class="c">#writefreq=[freq[ff] for ff in range(0,len(freq),freqstep)]</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FREQUENCIES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fdict</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">klst</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">fkey</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write data block</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA BLOCKS:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reslst</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;FREQ&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;TYPE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;DATUM&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;ERROR&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">datline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reslst</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">datline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Found #IND on line &#39;</span><span class="p">,</span><span class="n">ll</span>
                <span class="n">ndline</span><span class="o">=</span><span class="n">datline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">,</span><span class="s">&#39;00&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Replaced with 00&#39;</span>
                <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ndline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datline</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">print</span> <span class="s">&#39;Wrote Occam2D data file to: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span>
        </div>
<div class="viewcode-block" id="Occam2DData.read2DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.read2DdataFile">[docs]</a>    <span class="k">def</span> <span class="nf">read2DdataFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            read2DdataFile will read in data from a 2D occam data file.  </span>
<span class="sd">            Only supports the first 6 data types of occam2D</span>
<span class="sd">        </span>
<span class="sd">        Input: </span>
<span class="sd">            datafn = full path to data file</span>
<span class="sd">        </span>
<span class="sd">        Output:</span>
<span class="sd">            rplst = list of dictionaries for each station with keywords:</span>
<span class="sd">                &#39;station&#39; = station name</span>
<span class="sd">                &#39;offset&#39; = relative offset,</span>
<span class="sd">                &#39;resxy&#39; = TE resistivity and error as row 0 and 1 ressectively,</span>
<span class="sd">                &#39;resyx&#39;= TM resistivity and error as row 0 and 1 respectively,</span>
<span class="sd">                &#39;phasexy&#39;= TE phase and error as row 0 and 1 respectively,</span>
<span class="sd">                &#39;phaseyx&#39;= Tm phase and error as row 0 and 1 respectively,</span>
<span class="sd">                &#39;realtip&#39;= Real Tipper and error as row 0 and 1 respectively,</span>
<span class="sd">                &#39;imagtip&#39;= Imaginary Tipper and error as row 0 and 1 respectively</span>
<span class="sd">                </span>
<span class="sd">                Note: that the resistivity will be in log10 space.  Also, there are</span>
<span class="sd">                2 extra rows in the data arrays, this is to put the response from</span>
<span class="sd">                the inversion. </span>
<span class="sd">            </span>
<span class="sd">            stationlst = list of stations in order from one side of the profile</span>
<span class="sd">                         to the other.</span>
<span class="sd">            freq = list of frequencies used in the inversion</span>
<span class="sd">            title = title, could be useful for plotting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">dfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        
        <span class="n">dlines</span><span class="o">=</span><span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c">#get format of input data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occamfmt</span><span class="o">=</span><span class="n">dlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c">#get title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">=</span><span class="n">dlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">tstr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta_profile</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">tstr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="n">tstr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta_profile</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">print</span> <span class="s">&#39;Need to figure out angle of profile line&#39;</span>
        <span class="c">#get number of sits</span>
        <span class="n">nsites</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        
        <span class="c">#get station names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="o">=</span><span class="p">[</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nsites</span><span class="o">+</span><span class="mi">3</span><span class="p">)]</span>
        
        <span class="c">#get offsets in meters</span>
        <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="n">nsites</span><span class="p">,</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="p">)]</span>
        
        <span class="c">#get number of frequencies</span>
        <span class="n">nfreq</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    
        <span class="c">#get frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> 
                                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="p">,</span><span class="mi">5</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="o">+</span><span class="n">nfreq</span><span class="p">)])</span>
        
        <span class="c">#get periods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
                                                          
    
        <span class="c">#-----------get data-------------------</span>
        <span class="c">#set zero array size the first row will be the data and second the error</span>
        <span class="n">asize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">nfreq</span><span class="p">)</span>
        <span class="c">#make a list of dictionaries for each station.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="o">=</span><span class="p">[{</span><span class="s">&#39;station&#39;</span><span class="p">:</span><span class="n">station</span><span class="p">,</span><span class="s">&#39;offset&#39;</span><span class="p">:</span><span class="n">offsets</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                <span class="s">&#39;resxy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                <span class="s">&#39;resyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                <span class="s">&#39;phasexy&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                <span class="s">&#39;phaseyx&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                <span class="s">&#39;realtip&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                <span class="s">&#39;imagtip&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">asize</span><span class="p">),</span>
                <span class="p">}</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">dlines</span><span class="p">[</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsites</span><span class="o">+</span><span class="n">nfreq</span><span class="p">:]:</span>
            <span class="n">ls</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c">#station index</span>
            <span class="n">ss</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
            <span class="c">#component key</span>
            <span class="n">comp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
            <span class="c">#frequency index        </span>
            <span class="n">ff</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
            <span class="c">#print ls,ss,comp,ff</span>
            <span class="c">#put into array</span>
            <span class="c">#input data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">0</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> 
            <span class="c">#error       </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">1</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            </div>
<div class="viewcode-block" id="Occam2DData.rewrite2DdataFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.rewrite2DdataFile">[docs]</a>    <span class="k">def</span> <span class="nf">rewrite2DdataFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edipath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">resxyerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span>
                          <span class="n">resyxerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span><span class="n">phasexyerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span><span class="n">phaseyxerr</span><span class="o">=</span><span class="s">&#39;prev&#39;</span><span class="p">,</span>
                          <span class="n">tippererr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">mmode</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span><span class="n">flst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">removestation</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewrite2DDataFile will rewrite an existing data file so you can redefine </span>
<span class="sd">        some of the parameters, such as rotation angle, or errors for the different</span>
<span class="sd">        components or only invert for one mode or add one or add tipper or remove</span>
<span class="sd">        tipper.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            datafn = full path to data file to rewrite</span>
<span class="sd">            </span>
<span class="sd">            rotz = rotation angle with positive clockwise</span>
<span class="sd">            </span>
<span class="sd">            resxyerr = error for TE mode resistivity (percent) or &#39;data&#39; for data </span>
<span class="sd">                        or prev to take errors from data file.</span>
<span class="sd">            </span>
<span class="sd">            resyxerr = error for TM mode resistivity (percent) or &#39;data&#39; for data</span>
<span class="sd">                        or prev to take errors from data file.</span>
<span class="sd">                        </span>
<span class="sd">            phasexyerr = error for TE mode phase (percent) or &#39;data&#39; for data</span>
<span class="sd">                        or prev to take errors from data file.</span>
<span class="sd">                        </span>
<span class="sd">            phaseyxerr = error for TM mode phase (percent) or &#39;data&#39; for data</span>
<span class="sd">                        or prev to take errors from data file.</span>
<span class="sd">                        </span>
<span class="sd">            tippererr = error for tipper (percent) input only if you want to invert</span>
<span class="sd">                        for the tipper or &#39;data&#39; for data errors</span>
<span class="sd">                        or prev to take errors from data file.</span>
<span class="sd">                        </span>
<span class="sd">            mmodes = &#39;both&#39; for both TE and TM</span>
<span class="sd">                     &#39;TE&#39; for TE</span>
<span class="sd">                     &#39;TM&#39; for TM</span>
<span class="sd">                     </span>
<span class="sd">            flst = frequency list in Hz to rewrite, needs to be similar to the </span>
<span class="sd">                    datafile, cannot add frequencies</span>
<span class="sd">                    </span>
<span class="sd">            removestation = list of stations to remove if desired</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ss</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%2.6f</span><span class="s">&#39;</span>
        
        <span class="c">#load the data for the data file    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read2DdataFile</span><span class="p">()</span>
        <span class="c">#copy the information into local lists in case you want to keep the </span>
        <span class="c">#original data</span>
        <span class="n">rplst</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">)</span>
        <span class="n">stationlst</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">)</span>
        <span class="c">#make a dictionary of rplst for easier extraction of data</span>
        <span class="n">rpdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">station</span><span class="p">,</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> 
                                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">)])</span>
    
        <span class="c">#remove stations from rplst and stationlst if desired</span>
        <span class="k">if</span> <span class="n">removestation</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="c">#if removestation is not a list make it one</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">removestation</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">removestation</span><span class="o">=</span><span class="p">[</span><span class="n">removestation</span><span class="p">]</span>
            
            <span class="c">#remove station from station list           </span>
            <span class="k">for</span> <span class="n">rstation</span> <span class="ow">in</span> <span class="n">removestation</span><span class="p">:</span>        
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">stationlst</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rstation</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Did not find &#39;</span><span class="o">+</span><span class="n">rstation</span>
        
        <span class="c">#if flst is not the same as freq make freq=flst</span>
        <span class="k">if</span> <span class="n">flst</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">freq</span><span class="o">=</span><span class="n">flst</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
        
        
        <span class="c">#if the rotation angle is not 0 than need to read the original data in</span>
        <span class="k">if</span> <span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">edipath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;Need to input the edipath to original edifiles to&#39;</span><span class="o">+</span>
                               <span class="s">&#39; get rotations correct&#39;</span><span class="p">)</span>
            
            <span class="c">#get list of edifiles already in data file</span>
            <span class="n">edilst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">edi</span><span class="p">)</span> <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stationlst</span> 
                    <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">edi</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">stat</span><span class="p">)]</span><span class="o">==</span><span class="n">stat</span><span class="p">]</span>
            <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">edifn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilst</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">imp1</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">edifn</span><span class="p">)</span>
                <span class="n">rp</span><span class="o">=</span><span class="n">imp1</span><span class="o">.</span><span class="n">getResPhase</span><span class="p">(</span><span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
                <span class="n">imptip</span><span class="o">=</span><span class="n">imp1</span><span class="o">.</span><span class="n">getTipper</span><span class="p">()</span>
                <span class="n">tip</span><span class="o">=</span><span class="n">imptip</span><span class="o">.</span><span class="n">tipper</span>
                <span class="n">station</span><span class="o">=</span><span class="n">stationlst</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;{0:.6g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fr</span><span class="p">),</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">fr</span> <span class="ow">in</span> 
                                                    <span class="nb">enumerate</span><span class="p">(</span><span class="n">imp1</span><span class="o">.</span><span class="n">frequency</span><span class="p">)])</span>
                <span class="c">#loop over frequencies to pick out the ones desired</span>
                <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c">#jj is the index of edi file frequency list, this index corresponds</span>
                    <span class="c">#to the impedance tensor component index</span>
                    <span class="c">#ff is the frequency from the edi file frequency list</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c">#nn is the frequency number out of extracted frequency list</span>
                        <span class="n">nn</span><span class="o">=</span><span class="n">fdict</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ff</span><span class="p">]</span>
                        
                        <span class="c">#calculate resistivity</span>
                        <span class="n">resxy</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                        <span class="n">resyx</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                
                        <span class="c">#calculate the phase putting the yx in the 1st quadrant</span>
                        <span class="n">phasexy</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                        <span class="n">phaseyx</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">+</span><span class="mi">180</span>
                        <span class="c">#put phases in correct quadrant if should be negative</span>
                        <span class="k">if</span> <span class="n">phaseyx</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">:</span>
                            <span class="n">phaseyx</span><span class="o">=</span><span class="n">phaseyx</span><span class="o">-</span><span class="mi">360</span>
                            <span class="k">print</span> <span class="s">&#39;Found Negative Phase at&#39;</span><span class="p">,</span><span class="n">imp1</span><span class="o">.</span><span class="n">station</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">ff</span>    
                        
                        <span class="c">#calculate errors</span>
                        <span class="c">#res_xy (TE)</span>
                        <span class="k">if</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                            <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">/</span><span class="n">resxy</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                        <span class="c">#take errors from data file</span>
                        <span class="k">elif</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                            <span class="n">lresxyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lresxyerr</span><span class="o">=</span><span class="p">(</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                        
                        <span class="c">#Res_yx(TM)</span>
                        <span class="k">if</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                            <span class="n">lresxyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c">#take errors from data file</span>
                        <span class="k">elif</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                            <span class="n">lresyxerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lresyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                        
                        <span class="c">#phase_xy(TE)</span>
                        <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                            <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                            <span class="c">#take errors from data file</span>
                        <span class="k">elif</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                            <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dphasexyerr</span><span class="o">=</span><span class="p">(</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                            
                        <span class="c">#phase_yx (TM)</span>
                        <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;data&#39;</span><span class="p">:</span>
                            <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                            <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dphaseyxerr</span><span class="o">=</span><span class="p">(</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span>
                        
                        <span class="c">#calculate log10 of resistivity as prescribed by OCCAM</span>
                        <span class="n">lresyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resyx</span><span class="p">)</span>
                        <span class="n">lresxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">resxy</span><span class="p">)</span>
                        
                        <span class="c">#if include the tipper</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c">#calculate the projection angle for real and imaginary</span>
                                <span class="n">tipphir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span>\
                                        <span class="bp">self</span><span class="o">.</span><span class="n">theta_profile</span>
                                <span class="n">tipphii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">-</span>\
                                        <span class="bp">self</span><span class="o">.</span><span class="n">theta_profile</span>
                                
                                <span class="c">#project the tipper onto the profile line</span>
                                <span class="n">projtipr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                          <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphir</span><span class="p">)</span>
                                <span class="n">projtipi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>\
                                          <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tipphii</span><span class="p">)</span>
                                          
                                <span class="c">#error of tipper is a decimal percentage</span>
                                <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                                
                                <span class="n">tipyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                            
                        
                        <span class="c">#make a list of lines to write to the data file</span>
                        <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyx</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">phaseyx</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphaseyxerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxy</span> <span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">lresxyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">phasexy</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">dphasexyerr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipr</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">projtipi</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">projtiperr</span><span class="o">+</span>
                                                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;mmode&#39;</span> <span class="o">+</span><span class="n">mmode</span><span class="o">+</span><span class="s">&#39; not defined&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
        
        <span class="c">#If no rotation is desired but error bars are than...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stationlst</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">srp</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">]</span>
                <span class="n">nr</span><span class="o">=</span><span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#calculate errors and rewrite</span>
                <span class="c">#res_xy (TE)</span>
                <span class="k">if</span> <span class="n">resxyerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">resxyerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lresxyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">((</span><span class="n">resxyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">nr</span><span class="p">)</span>
                    <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">lresxyerr</span>
                
                <span class="c">#Res_yx(TM)</span>
                <span class="k">if</span> <span class="n">resyxerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">resyxerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">lresyxerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lresyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">((</span><span class="n">resyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">nr</span><span class="p">)</span>
                    <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">lresyxerr</span>
                
                <span class="c">#phase_xy(TE)</span>
                <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">phasexyerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dphasexyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">((</span><span class="n">phasexyerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
                    <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">dphasexyerr</span>
                    
                <span class="c">#phase_yx (TM)</span>
                <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">phaseyxerr</span><span class="o">==</span><span class="s">&#39;prev&#39;</span><span class="p">:</span>
                        <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dphaseyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">((</span><span class="n">phaseyxerr</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span><span class="o">*</span><span class="mi">57</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
                    <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">dphaseyxerr</span>
                
                <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="c">#error of tipper is a decimal percentage</span>
                    <span class="n">projtiperr</span><span class="o">=</span><span class="n">tippererr</span><span class="o">/</span><span class="mf">100.</span>
                    <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">projtiperr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
                    <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">projtiperr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c">#make a list of lines to write to the data file</span>
                    <span class="k">if</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TM&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">mmode</span><span class="o">==</span><span class="s">&#39;TE&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">tippererr</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">tipyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                        <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
        <span class="c">#===========================================================================</span>
        <span class="c">#                             write dat file</span>
        <span class="c">#===========================================================================</span>
        
        <span class="c">#make the file name of the data file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;RW&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;RW.dat&#39;</span>
            
        <span class="n">nstat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stationlst</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">=</span><span class="s">&#39;Occam Inversion&#39;</span>
            
        <span class="n">datfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FORMAT:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">11</span><span class="o">+</span><span class="s">&#39;OCCAM2MTDATA_1.0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TITLE:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write station sites</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nstat</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stationlst</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write offsets</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OFFSETS (M):&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stationlst</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write frequencies</span>
        <span class="c">#writefreq=[freq[ff] for ff in range(0,len(freq),freqstep)]</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FREQUENCIES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">ff</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write data block</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA BLOCKS:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reslst</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;FREQ&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;TYPE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;DATUM&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;ERROR&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">datline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reslst</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">datline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Found #IND on line &#39;</span><span class="p">,</span><span class="n">ll</span>
                <span class="n">ndline</span><span class="o">=</span><span class="n">datline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">,</span><span class="s">&#39;00&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Replaced with 00&#39;</span>
                <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ndline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datline</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">print</span> <span class="s">&#39;Rewrote the data file to: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span>
    </div>
<div class="viewcode-block" id="Occam2DData.plotMaskPoints"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.plotMaskPoints">[docs]</a>    <span class="k">def</span> <span class="nf">plotMaskPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plottype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">reserrinc</span><span class="o">=.</span><span class="mi">20</span><span class="p">,</span><span class="n">phaseerrinc</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                       <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">colormode</span><span class="o">=</span><span class="s">&#39;color&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                       <span class="n">reslimits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">phaselimits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">95</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An interactive plotting tool to mask points an add errorbars</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>
            <span class="c">#color for data</span>
            <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">mted</span><span class="o">=</span><span class="s">&#39;s&#39;</span>
            <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;o&#39;</span>
            
        <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
            <span class="c">#color for data</span>
            <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">mted</span><span class="o">=</span><span class="s">&#39;s&#39;</span>
            <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;o&#39;</span>
            
        <span class="c">#read in data file    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read2DdataFile</span><span class="p">()</span>
        <span class="n">rplst</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">)</span>
        
        <span class="c">#get periods</span>
        <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span>
     
        <span class="c">#define some empty lists to put things into</span>
        <span class="n">pstationlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">axlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">linelst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">errlst</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="c">#get the stations to plot</span>
        <span class="c">#if none plot all of them</span>
        <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">pstationlst</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">))</span>
            
        <span class="c">#otherwise pick out the stations to plot along with their index number</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">plottype</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">plottype</span><span class="o">=</span><span class="p">[</span><span class="n">plottype</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">station</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pstation</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> 
        
        <span class="c">#set the subplot grid</span>
        <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">top</span><span class="o">=.</span><span class="mi">93</span><span class="p">,</span><span class="n">bottom</span><span class="o">=.</span><span class="mo">07</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pstationlst</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            
            <span class="c">#make subplots</span>
            <span class="n">axrte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">axrtm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">axpte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>    
            <span class="n">axptm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrtm</span><span class="p">)</span>    
            
            
            <span class="c">#plot resistivity TE Mode</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rte</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                            <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">rxy</span><span class="p">]</span><span class="o">*</span>\
                                <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                            <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                            
            <span class="c">#plot Phase TE Mode</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">pxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pte</span><span class="o">=</span><span class="n">axpte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                               <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                               <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
            
                           
            <span class="c">#plot resistivity TM Mode</span>
            <span class="c">#cut out missing data points first                </span>
            <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rtm</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                            <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ryx</span><span class="p">]</span><span class="o">*</span>\
                                <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                            <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c">#plot Phase TM Mode</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">pyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">ptm</span><span class="o">=</span><span class="n">axptm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                            <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        
            <span class="c">#make the axis presentable</span>
            <span class="c">#set the apparent resistivity scales to log and x-axis to log</span>
            <span class="n">axplst</span><span class="o">=</span><span class="p">[</span><span class="n">axrte</span><span class="p">,</span><span class="n">axrtm</span><span class="p">,</span><span class="n">axpte</span><span class="p">,</span><span class="n">axptm</span><span class="p">]</span>
            <span class="n">llst</span><span class="o">=</span><span class="p">[</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pte</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ptm</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">elst</span><span class="o">=</span><span class="p">[[</span><span class="n">rte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">rte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">rte</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],[</span><span class="n">rtm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">rtm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">rtm</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">pte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pte</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">pte</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],[</span><span class="n">ptm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">ptm</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">ptm</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]]]</span>
                
            <span class="n">axlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axplst</span><span class="p">)</span>
            <span class="n">linelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">llst</span><span class="p">)</span>
            <span class="n">errlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elst</span><span class="p">)</span>
            
            <span class="c">#set the axes properties for each subplot</span>
            <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">xx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axplst</span><span class="p">):</span>
                <span class="c">#set xscale to logarithmic in period</span>
                <span class="n">xx</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                
                <span class="c">#if apparent resistivity </span>
                <span class="k">if</span> <span class="n">nn</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">nn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c">#set x-ticklabels to invisible</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    
                    <span class="c">#set apparent resistivity scale to logarithmic</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                    
                    <span class="c">#if there are resistivity limits set those</span>
                    <span class="k">if</span> <span class="n">reslimits</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="n">xx</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">reslimits</span><span class="p">)</span>
                    
                <span class="c">#Set the title of the TE plot                 </span>
                <span class="k">if</span> <span class="n">nn</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; Obs$_{xy}$ (TE-Mode)&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="c">#set the title of the TM plot</span>
                <span class="k">if</span> <span class="n">nn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; Obs$_{yx}$ (TM-Mode)&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                
                <span class="c">#set the phase axes properties</span>
                <span class="k">if</span> <span class="n">nn</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">nn</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="c">#set the phase limits</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">phaselimits</span><span class="p">)</span>
                    
                    <span class="c">#set label coordinates</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    
                    <span class="c">#give the y-axis label to the bottom left plot</span>
                    <span class="k">if</span> <span class="n">nn</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">xx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="c">#set the x-axis label</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    
                    <span class="c">#set tick marks of the y-axis</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
                    <span class="n">xx</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    
                <span class="n">xx</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span> 
        
        <span class="c">#make points an attribute of self which is a data type OccamPointPicker       </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">=</span><span class="n">OccamPointPicker</span><span class="p">(</span><span class="n">axlst</span><span class="p">,</span><span class="n">linelst</span><span class="p">,</span><span class="n">errlst</span><span class="p">,</span><span class="n">reserrinc</span><span class="o">=</span><span class="n">reserrinc</span><span class="p">,</span>
                                     <span class="n">phaseerrinc</span><span class="o">=</span><span class="n">phaseerrinc</span><span class="p">)</span>
        
        <span class="c">#be sure to show the plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   
        </div>
<div class="viewcode-block" id="Occam2DData.maskPoints"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.maskPoints">[docs]</a>    <span class="k">def</span> <span class="nf">maskPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        maskPoints will take in points found from plotMaskPoints and rewrite </span>
<span class="sd">        the data file to nameRW.dat.  Be sure to run plotMaskPoints first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">read2DdataFile</span><span class="p">()</span>
        <span class="n">rplst</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">)</span>
        <span class="c">#rewrite the data file</span>
        <span class="c">#make a reverse dictionary for locating the masked points in the data file</span>
        <span class="n">rploc</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">fndict</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">fndict</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
                    
        <span class="c">#make a period dictionary to locate points changed</span>
        <span class="n">frpdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;{0:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fr</span><span class="p">),</span><span class="n">ff</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">ff</span><span class="p">,</span><span class="n">fr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)])</span>
        
        <span class="c">#loop over the data list</span>
        <span class="k">for</span> <span class="n">dd</span><span class="p">,</span><span class="n">dat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="n">derror</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
            <span class="c">#loop over the 4 main entrie</span>
            <span class="k">for</span> <span class="n">ss</span><span class="p">,</span><span class="n">skey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;resxy&#39;</span><span class="p">,</span><span class="s">&#39;resyx&#39;</span><span class="p">,</span><span class="s">&#39;phasexy&#39;</span><span class="p">,</span><span class="s">&#39;phaseyx&#39;</span><span class="p">]):</span>
                <span class="c">#rewrite any coinciding points</span>
                <span class="k">for</span> <span class="n">frpkey</span> <span class="ow">in</span> <span class="n">frpdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ff</span><span class="o">=</span><span class="n">frpdict</span><span class="p">[</span><span class="n">frpkey</span><span class="p">]</span>
                        <span class="n">floc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">fdict</span><span class="p">[</span><span class="n">dd</span><span class="p">][</span><span class="n">ss</span><span class="p">][</span><span class="n">frpkey</span><span class="p">]</span>
                        
                        <span class="c">#CHANGE APPARENT RESISTIVITY</span>
                        <span class="k">if</span> <span class="n">ss</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">ss</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="c">#change the apparent resistivity value</span>
                            <span class="k">if</span> <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">!=</span>\
                                                        <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]):</span>
                                <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span>\
                                            <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">])</span>
                                
                            <span class="c">#change the apparent resistivity error value</span>
                            <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">rerr</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rerr</span><span class="o">=</span><span class="n">derror</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span><span class="o">/</span><span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">!=</span><span class="n">rerr</span><span class="p">:</span>
                                <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="n">rerr</span>
                        
                        <span class="c">#DHANGE PHASE</span>
                        <span class="k">elif</span> <span class="n">ss</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="n">ss</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                            <span class="c">#change the phase value</span>
                            <span class="k">if</span> <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">!=</span><span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span>
                                
                            <span class="c">#change the apparent resistivity error value</span>
                            <span class="k">if</span> <span class="n">dat</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                                <span class="n">rerr</span><span class="o">=</span><span class="mf">0.0</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rerr</span><span class="o">=</span><span class="n">derror</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">floc</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">!=</span><span class="n">rerr</span><span class="p">:</span>
                                <span class="n">rplst</span><span class="p">[</span><span class="n">rploc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dd</span><span class="p">)]][</span><span class="n">skey</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="n">rerr</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
            
            
        <span class="c">#rewrite the data file </span>
        <span class="n">ss</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%2.6f</span><span class="s">&#39;</span>
        <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="c">#make a dictionary of rplst for easier extraction of data</span>
        <span class="n">rpdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">station</span><span class="p">,</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">)])</span>
        
        <span class="c">#loop over stations in the data file</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">srp</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">]</span>
            
            <span class="c">#loop over frequencies</span>
            <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="c">#make a list of lines to write to the data file</span>
                <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;1&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;2&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;5&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;6&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                                <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;3&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;realtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;4&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span>
                            <span class="n">fmt</span> <span class="o">%</span> <span class="n">srp</span><span class="p">[</span><span class="s">&#39;imagtip&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#===========================================================================</span>
        <span class="c">#                             write dat file</span>
        <span class="c">#===========================================================================</span>
        <span class="c">#make the file name of the data file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;RW&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;RW.dat&#39;</span>
        
        <span class="c">#get number of stations</span>
        <span class="n">nstat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">)</span>
        
        <span class="c">#set title string</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">=</span><span class="s">&#39;Occam Inversion&#39;</span>
            
        <span class="n">datfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FORMAT:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">11</span><span class="o">+</span><span class="s">&#39;OCCAM2MTDATA_1.0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TITLE:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">titlestr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write station sites</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nstat</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write offsets</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OFFSETS (M):&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">rpdict</span><span class="p">[</span><span class="n">station</span><span class="p">][</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write frequencies</span>
        <span class="c">#writefreq=[freq[ff] for ff in range(0,len(freq),freqstep)]</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FREQUENCIES:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">:</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ss</span><span class="o">+</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">ff</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#write data block</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA BLOCKS:&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reslst</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SITE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;FREQ&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;TYPE&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;DATUM&#39;</span><span class="o">+</span><span class="n">ss</span><span class="o">+</span><span class="s">&#39;ERROR&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">datline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reslst</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">datline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Found #IND on line &#39;</span><span class="p">,</span><span class="n">ll</span>
                <span class="n">ndline</span><span class="o">=</span><span class="n">datline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#IND&#39;</span><span class="p">,</span><span class="s">&#39;00&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Replaced with 00&#39;</span>
                <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ndline</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datline</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">print</span> <span class="s">&#39;Wrote Occam2D data file to: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ndatafn</span>
    </div>
<div class="viewcode-block" id="Occam2DData.read2DRespFile"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.read2DRespFile">[docs]</a>    <span class="k">def</span> <span class="nf">read2DRespFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">respfn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read2DRespFile will read in a response file and combine the data with info </span>
<span class="sd">        from the data file.</span>
<span class="sd">    </span>
<span class="sd">        Input:</span>
<span class="sd">            respfn = full path to the response file</span>
<span class="sd">            datafn = full path to data file</span>
<span class="sd">    </span>
<span class="sd">        Outputs:</span>
<span class="sd">            for each data array, the rows are ordered as:</span>
<span class="sd">                0 -&gt; input data</span>
<span class="sd">                1 -&gt; input error</span>
<span class="sd">                2 -&gt; model output</span>
<span class="sd">                3 -&gt; relative error (data-model)/(input error)</span>
<span class="sd">                </span>
<span class="sd">            rplst = list of dictionaries for each station with keywords:</span>
<span class="sd">                &#39;station&#39; = station name</span>
<span class="sd">                &#39;offset&#39; = relative offset,</span>
<span class="sd">                &#39;resxy&#39; = TE resistivity </span>
<span class="sd">                &#39;resyx&#39;= TM resistivity </span>
<span class="sd">                &#39;phasexy&#39;= TE phase </span>
<span class="sd">                &#39;phaseyx&#39;= TM phase a</span>
<span class="sd">                &#39;realtip&#39;= Real Tipper </span>
<span class="sd">                &#39;imagtip&#39;= Imaginary Tipper </span>
<span class="sd">                </span>
<span class="sd">                Note: that the resistivity will be in log10 space.  Also, there are</span>
<span class="sd">                2 extra rows in the data arrays, this is to put the response from</span>
<span class="sd">                the inversion. </span>
<span class="sd">            </span>
<span class="sd">            stationlst = list of stations in order from one side of the profile</span>
<span class="sd">                         to the other.</span>
<span class="sd">            freq = list of frequencies used in the inversion</span>
<span class="sd">            title = title, could be useful for plotting.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#make the response file an attribute        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">respfn</span><span class="o">=</span><span class="n">respfn</span>
        
        <span class="c">#read in the current data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read2DdataFile</span><span class="p">()</span>
        
        <span class="n">rfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">respfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        
        <span class="n">rlines</span><span class="o">=</span><span class="n">rfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">rlines</span><span class="p">:</span>
            <span class="n">ls</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c">#station index</span>
            <span class="n">ss</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
            <span class="c">#component key</span>
            <span class="n">comp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
            <span class="c">#frequency index        </span>
            <span class="n">ff</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="mi">1</span>
            <span class="c">#put into array</span>
            <span class="c">#model response</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">2</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> 
            <span class="c">#relative error        </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">occamdict</span><span class="p">[</span><span class="n">comp</span><span class="p">]][</span><span class="mi">3</span><span class="p">,</span><span class="n">ff</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            </div>
<div class="viewcode-block" id="Occam2DData.plot2DResponses"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.plot2DResponses">[docs]</a>    <span class="k">def</span> <span class="nf">plot2DResponses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">respfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">wlfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">maxcol</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">plottype</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span>
                        <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">phaselimits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">95</span><span class="p">),</span><span class="n">colormode</span><span class="o">=</span><span class="s">&#39;color&#39;</span><span class="p">,</span>
                        <span class="n">reslimits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">plotnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plotResponse will plot the responses modeled from winglink against the </span>
<span class="sd">        observed data.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            respfn = full path to response file</span>
<span class="sd">            datafn = full path to data file</span>
<span class="sd">            wlfn = full path to a winglink data file used for a similar</span>
<span class="sd">                              inversion.  This will be plotted on the response</span>
<span class="sd">                              plots for comparison of fits.</span>
<span class="sd">            maxcol = maximum number of columns for the plot</span>
<span class="sd">            plottype = &#39;all&#39; to plot all on the same plot</span>
<span class="sd">                       &#39;1&#39; to plot each respones in a different figure</span>
<span class="sd">                       station to plot a single station or enter as a list of </span>
<span class="sd">                       stations to plot a few stations [station1,station2].  </span>
<span class="sd">                       Does not have to be verbatim but should have similar</span>
<span class="sd">                       unique characters input pb01 for pb01cs in outputfile</span>
<span class="sd">            ms = marker size </span>
<span class="sd">            phaselimits = limits of phase in degrees (min,max)</span>
<span class="sd">            colormode = &#39;color&#39; for color plots</span>
<span class="sd">                        &#39;bw&#39; for black and white plots</span>
<span class="sd">            reslimits = resistivity limits on a log scale (</span>
<span class="sd">                        log10(min),log10(max))</span>
<span class="sd">            plotnum = 1 to plot both TE and TM in the same plot</span>
<span class="sd">                      2 to plot TE and TM in separate subplots</span>
<span class="sd">                      </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">2</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dpi</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dpi&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span>
        
        <span class="c">#color mode</span>
        <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>
            <span class="c">#color for data</span>
            <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">mted</span><span class="o">=</span><span class="s">&#39;s&#39;</span>
            <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;o&#39;</span>
            
            <span class="c">#color for occam model</span>
            <span class="n">ctem</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ctmm</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">mtem</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
            <span class="n">mtmm</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
            
            <span class="c">#color for Winglink model</span>
            <span class="n">ctewl</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">ctmwl</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">8</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">mtewl</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
            <span class="n">mtmwl</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
         
        <span class="c">#black and white mode</span>
        <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
            <span class="c">#color for data</span>
            <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">mted</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
            <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;v&#39;</span>
            
            <span class="c">#color for occam model</span>
            <span class="n">ctem</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">ctmm</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">mtem</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
            <span class="n">mtmm</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
            
            <span class="c">#color for Wingling model</span>
            <span class="n">ctewl</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ctmwl</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>    
            <span class="n">mtewl</span><span class="o">=</span><span class="s">&#39;|&#39;</span>
            <span class="n">mtmwl</span><span class="o">=</span><span class="s">&#39;_&#39;</span>
        
        <span class="c">#if there is a response file to plot</span>
        <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="c">#read in the data    </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read2DRespFile</span><span class="p">(</span><span class="n">respfn</span><span class="p">)</span>
            <span class="c">#boolean for plotting response</span>
            <span class="n">plotresp</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#read in current data file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read2DdataFile</span><span class="p">()</span>
            <span class="c">#boolean for plotting response</span>
            <span class="n">plotresp</span><span class="o">=</span><span class="bp">False</span>
            
        <span class="c">#make a local copy of the rplst    </span>
        <span class="n">rplst</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">)</span>
        
        <span class="c">#boolean for adding winglink output to the plots 0 for no, 1 for yes</span>
        <span class="n">addwl</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">hspace</span><span class="o">=.</span><span class="mi">15</span>
        <span class="c">#read in winglink data file</span>
        <span class="k">if</span> <span class="n">wlfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">addwl</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">hspace</span><span class="o">=.</span><span class="mi">25</span>
            <span class="n">wld</span><span class="p">,</span><span class="n">wlrplst</span><span class="p">,</span><span class="n">wlplst</span><span class="p">,</span><span class="n">wlslst</span><span class="p">,</span><span class="n">wltlst</span><span class="o">=</span><span class="n">wlt</span><span class="o">.</span><span class="n">readOutputFile</span><span class="p">(</span><span class="n">wlfn</span><span class="p">)</span>
            <span class="n">sdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">ostation</span><span class="p">,</span><span class="n">wlstation</span><span class="p">)</span> <span class="k">for</span> <span class="n">wlstation</span> <span class="ow">in</span> <span class="n">wlslst</span> 
                        <span class="k">for</span> <span class="n">ostation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span> 
                        <span class="k">if</span> <span class="n">wlstation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">ostation</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c">#set a local parameter period for less typing</span>
        <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span>
                                          
        <span class="c">#---------------plot each respones in a different figure------------------</span>
        <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="s">&#39;1&#39;</span><span class="p">:</span>
            
            <span class="c">#set the grid of subplots</span>
            <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mi">09</span><span class="p">,</span><span class="n">top</span><span class="o">=.</span><span class="mi">93</span><span class="p">,</span><span class="n">bottom</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span><span class="n">top</span><span class="o">=.</span><span class="mi">93</span><span class="p">,</span><span class="n">bottom</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
            <span class="c">#loop over each station</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">):</span>
                
                <span class="n">rlst</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">llst</span><span class="o">=</span><span class="p">[]</span>
                
<span class="c">#                rmslst=np.hstack((rplst[ii][&#39;resxy&#39;][3],</span>
<span class="c">#                                           rplst[ii][&#39;resyx&#39;][3],</span>
<span class="c">#                                            rplst[ii][&#39;phasexy&#39;][3],</span>
<span class="c">#                                            rplst[ii][&#39;phaseyx&#39;][3]))</span>
<span class="c">#                rms=np.sqrt(np.sum(ms**2 for ms in rmslst)/len(rmslst))</span>
                <span class="c">#get the RMS values for each TE and TM modes separately</span>
                <span class="n">rmslstte</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">rmslsttm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">rmste</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">rms</span> <span class="ow">in</span> <span class="n">rmslstte</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslstte</span><span class="p">))</span>
                <span class="n">rmstm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">rms</span> <span class="ow">in</span> <span class="n">rmslsttm</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslsttm</span><span class="p">))</span>
                
                <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
                
                <span class="c">#set subplot instances</span>
                <span class="c">#plot both TE and TM in same subplot</span>
                <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">axrte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,:])</span>
                    <span class="n">axrtm</span><span class="o">=</span><span class="n">axrte</span>
                    <span class="n">axpte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                    <span class="n">axptm</span><span class="o">=</span><span class="n">axpte</span>
                    
                <span class="c">#plot TE and TM in separate subplots</span>
                <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">axrte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">axrtm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">axpte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                    <span class="n">axptm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrtm</span><span class="p">)</span>
                
                <span class="c">#Plot Resistivity</span>
                
                <span class="c">#cut out missing data points first</span>
                <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c">#check to see if there is a xy component (TE Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">rte</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span>
                                     <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                    <span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                    <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">rxy</span><span class="p">]</span><span class="o">*</span>\
                                    <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                    <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Obs_{TE}$&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c">#check to see if there is a yx component (TM Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">rtm</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span>
                                       <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                       <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                       <span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                       <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ryx</span><span class="p">]</span><span class="o">*</span>\
                                       <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                       <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Obs_{TM}$&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>                                
                
                
                <span class="c">#plot phase</span>
                <span class="c">#cut out missing data points first</span>
                <span class="n">pxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">pyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c">#plot the xy component (TE Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axpte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                 <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c">#plot the yx component (TM Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axptm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                 <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c">#if there is a response file</span>
                <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">mrxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    
                    <span class="c">#plot the Model Resistivity</span>
                    <span class="c">#check for the xy of model component</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mrxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">r3</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span>
                                          <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">],</span>
                                          <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                          <span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                          <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">*</span>\
                                          <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                          <span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Mod_{TE}$&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                    
                    <span class="c">#check for the yx model component  of resisitivity</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mryx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">r4</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span>
                                          <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">],</span>
                                          <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                          <span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                          <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">*</span>\
                                          <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                          <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r4</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Mod_{TM}$&#39;</span><span class="p">)</span>
                                    
                    <span class="c">#plot the model phase</span>
                    <span class="c">#check for removed points</span>
                    <span class="n">mpxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mpyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    
                    <span class="c">#plot the xy component (TE Mode)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axpte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span>
                                     <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                     <span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                     <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                                     <span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                    
                    <span class="c">#plot the yx component (TM Mode)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpyx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axptm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span>
                                     <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                     <span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                     <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                                     <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                             
                <span class="c">#add in winglink responses</span>
                <span class="k">if</span> <span class="n">addwl</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">wlrms</span><span class="o">=</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">station</span><span class="p">]][</span><span class="s">&#39;rms&#39;</span><span class="p">]</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>\
                                <span class="s">&#39;rms_occ_TE={0:.2f}, rms_occ_TM={1:.2f}, rms_wl= {2:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">,</span><span class="n">rmstm</span><span class="p">,</span><span class="n">wlrms</span><span class="p">),</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">wlstation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wlslst</span><span class="p">):</span>
    <span class="c">#                        print station,wlstation</span>
                            <span class="k">if</span> <span class="n">wlstation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">station</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="k">print</span> <span class="n">station</span><span class="p">,</span><span class="n">wlstation</span>
                                <span class="n">wlrpdict</span><span class="o">=</span><span class="n">wlrplst</span><span class="p">[</span><span class="n">ww</span><span class="p">]</span>
                        
                        <span class="n">zrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="n">zryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                        
                         <span class="c">#plot winglink resistivity</span>
                        <span class="n">r5</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span>
                                        <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                        <span class="n">r6</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span>
                                        <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                        
                        <span class="c">#plot winglink phase</span>
                        <span class="n">axpte</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span>
                                       <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                       <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                       <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                        <span class="n">axptm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span>
                                       <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                       <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                       <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                        
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r6</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$WLMod_{TE}$&#39;</span><span class="p">)</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$WLMod_{TM}$&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;Station not present&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span>\
                        <span class="s">&#39; rms_TE={0:.2f}, rms_TM={1:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">,</span><span class="n">rmstm</span><span class="p">),</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span>\
                                        <span class="s">&#39; rms_TE={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">),</span>
                                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="n">axrtm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span>\
                                        <span class="s">&#39; rms_TM={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstm</span><span class="p">),</span>
                                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                
                <span class="c">#set the axis properties</span>
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span><span class="n">axr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">axrte</span><span class="p">,</span><span class="n">axrtm</span><span class="p">]):</span>
                    <span class="c">#set both axes to logarithmic scale</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                    
                    <span class="c">#put on a grid</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">07</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    
                    <span class="c">#set resistivity limits if desired</span>
                    <span class="k">if</span> <span class="n">reslimits</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">reslimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">reslimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        
                    <span class="c">#set the tick labels to invisible</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axr</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                               <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                               
                    <span class="c">#set legend based on the plot type</span>
                    <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlst</span><span class="p">,</span><span class="n">llst</span><span class="p">,</span>
                                       <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                       <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                       <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                       <span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                       <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span>
                    <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                                               <span class="p">[</span><span class="n">llst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">llst</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                                               <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                               <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                               <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                               <span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span> 
                                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                    <span class="k">pass</span>
                                               
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">llst</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                               <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                               <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                               <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                               <span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span>
                                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                    <span class="k">pass</span>
                        <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">rlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                               <span class="p">[</span><span class="n">llst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">llst</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                               <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                               <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                               <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span>
                                               <span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span>
                                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                    <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">llst</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                               <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                               <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                               <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                                               <span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                               <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span>    
                                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                    <span class="k">pass</span>
                
                <span class="c">#set Properties for the phase axes</span>
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span><span class="n">axp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">axpte</span><span class="p">,</span><span class="n">axptm</span><span class="p">]):</span>
                    <span class="c">#set the x-axis to log scale</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                    
                    <span class="c">#set the phase limits</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">phaselimits</span><span class="p">)</span>
                    
                    <span class="c">#put a grid on the subplot</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
                    
                    <span class="c">#set the tick locations</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    
                    <span class="c">#set the x axis label</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    
                    <span class="c">#put the y label on the far left plot</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">07</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    
                
        <span class="c">#---Plot single or subset of stations-------------------------------------</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pstationlst</span><span class="o">=</span><span class="p">[]</span>
    
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plottype</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">plottype</span><span class="o">=</span><span class="p">[</span><span class="n">plottype</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">station</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pstation</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
    <span class="c">#                    print &#39;plotting &#39;,station</span>
                        <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">addwl</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">pwlstationlst</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">wlstation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wlslst</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">wlstation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pstation</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
    <span class="c">#                        print &#39;plotting &#39;,wlstation</span>
                            <span class="n">pwlstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span>  
            <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mi">09</span><span class="p">,</span><span class="n">top</span><span class="o">=.</span><span class="mi">93</span><span class="p">,</span><span class="n">bottom</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span><span class="n">top</span><span class="o">=.</span><span class="mi">93</span><span class="p">,</span><span class="n">bottom</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pstationlst</span><span class="p">):</span>
                <span class="n">rlst</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">llst</span><span class="o">=</span><span class="p">[]</span>
                
                <span class="c">#get RMS values for TE and TM separately</span>
                <span class="n">rmslstte</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">rmslsttm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                    <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">rmste</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">rms</span> <span class="ow">in</span> <span class="n">rmslstte</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslstte</span><span class="p">))</span>
                <span class="n">rmstm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">rms</span> <span class="ow">in</span> <span class="n">rmslsttm</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslsttm</span><span class="p">))</span>
                
                
                <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
                
                <span class="c">#set subplot instances</span>
                <span class="c">#plot both TE and TM in same subplot</span>
                <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">axrte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,:])</span>
                    <span class="n">axrtm</span><span class="o">=</span><span class="n">axrte</span>
                    <span class="n">axpte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                    <span class="n">axptm</span><span class="o">=</span><span class="n">axpte</span>
                    
                <span class="c">#plot TE and TM in separate subplots</span>
                <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">axrte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">axrtm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">axpte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrte</span><span class="p">)</span>
                    <span class="n">axptm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">axrtm</span><span class="p">)</span>
                
                <span class="c">#Plot Resistivity</span>
                
                <span class="c">#cut out missing data points first</span>
                <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c">#check to see if there is a xy component (TE Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">rte</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span>
                                     <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                    <span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                    <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">rxy</span><span class="p">]</span><span class="o">*</span>\
                                    <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                    <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rte</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Obs_{TE}$&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c">#check to see if there is a yx component (TM Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ryx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">rtm</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span>
                                       <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                       <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                       <span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                       <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">ryx</span><span class="p">]</span><span class="o">*</span>\
                                       <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                       <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rtm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Obs_{TM}$&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>                                
                
                
                <span class="c">#plot phase</span>
                <span class="c">#cut out missing data points first</span>
                <span class="n">pxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">pyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c">#plot the xy component (TE Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axpte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                                 <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c">#plot the yx component (TM Mode)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pyx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">axptm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                 <span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span>
                                 <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
                <span class="c">#if there is a response file</span>
                <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                    <span class="n">mrxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    
                    <span class="c">#plot the Model Resistivity</span>
                    <span class="c">#check for the xy of model component</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mrxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">r3</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span>
                                          <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">],</span>
                                          <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                          <span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                          <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">*</span>\
                                          <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                          <span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Mod_{TE}$&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                    
                    <span class="c">#check for the yx model component  of resisitivity</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mryx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">r4</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span>
                                          <span class="mi">10</span><span class="o">**</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">],</span>
                                          <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                          <span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                          <span class="n">yerr</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">*</span>\
                                          <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)),</span>
                                          <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r4</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$Mod_{TM}$&#39;</span><span class="p">)</span>
                                    
                    <span class="c">#plot the model phase</span>
                    <span class="c">#check for removed points</span>
                    <span class="n">mpxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">mpyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    
                    <span class="c">#plot the xy component (TE Mode)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpxy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axpte</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span>
                                     <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                     <span class="n">mec</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctem</span><span class="p">,</span>
                                     <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                                     <span class="n">ecolor</span><span class="o">=</span><span class="n">ctem</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                    
                    <span class="c">#plot the yx component (TM Mode)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mpyx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axptm</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span>
                                     <span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                     <span class="n">mec</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">ctmm</span><span class="p">,</span>
                                     <span class="n">yerr</span><span class="o">=</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                                     <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmm</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                             
                <span class="c">#add in winglink responses</span>
                <span class="k">if</span> <span class="n">addwl</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">wlrms</span><span class="o">=</span><span class="n">wld</span><span class="p">[</span><span class="n">sdict</span><span class="p">[</span><span class="n">station</span><span class="p">]][</span><span class="s">&#39;rms&#39;</span><span class="p">]</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>\
                                    <span class="s">&#39; rms_occ_TE={0:.2f}, rms_occ_TM={1:.2f}, rms_wl= {2:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">,</span><span class="n">rmstm</span><span class="p">,</span><span class="n">wlrms</span><span class="p">),</span>
                                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">wlstation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wlslst</span><span class="p">):</span>
    <span class="c">#                        print station,wlstation</span>
                            <span class="k">if</span> <span class="n">wlstation</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">station</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="k">print</span> <span class="n">station</span><span class="p">,</span><span class="n">wlstation</span>
                                <span class="n">wlrpdict</span><span class="o">=</span><span class="n">wlrplst</span><span class="p">[</span><span class="n">ww</span><span class="p">]</span>
                        
                        <span class="n">zrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="n">zryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                        
                         <span class="c">#plot winglink resistivity</span>
                        <span class="n">r5</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span>
                                        <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                        <span class="n">r6</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span>
                                        <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                        <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                        
                        <span class="c">#plot winglink phase</span>
                        <span class="n">axpte</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zrxy</span><span class="p">],</span>
                                       <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zrxy</span><span class="p">],</span>
                                       <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtewl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctewl</span><span class="p">,</span>
                                       <span class="n">mfc</span><span class="o">=</span><span class="n">ctewl</span><span class="p">)</span>
                        <span class="n">axptm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">wlplst</span><span class="p">[</span><span class="n">zryx</span><span class="p">],</span>
                                       <span class="n">wlrpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">zryx</span><span class="p">],</span>
                                       <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-.&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmwl</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">,</span>
                                       <span class="n">mfc</span><span class="o">=</span><span class="n">ctmwl</span><span class="p">)</span>
                        
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r6</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$WLMod_{TE}$&#39;</span><span class="p">)</span>
                        <span class="n">llst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;$WLMod_{TM}$&#39;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;Station not present&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span>\
                        <span class="s">&#39; rms_TE={0:.2f}, rms_TM={1:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">,</span><span class="n">rmstm</span><span class="p">),</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span>\
                                        <span class="s">&#39; rms_TE={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmste</span><span class="p">),</span>
                                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                        <span class="n">axrtm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span>\
                                        <span class="s">&#39; rms_TM={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstm</span><span class="p">),</span>
                                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                
                
                <span class="c">#set the axis properties</span>
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span><span class="n">axr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">axrte</span><span class="p">,</span><span class="n">axrtm</span><span class="p">]):</span>
                    <span class="c">#set both axes to logarithmic scale</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                    
                    <span class="c">#put on a grid</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">07</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    
                    <span class="c">#set resistivity limits if desired</span>
                    <span class="k">if</span> <span class="n">reslimits</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">reslimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="n">reslimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        
                    <span class="c">#set the tick labels to invisible</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axr</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                               <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">rlst</span><span class="p">,</span><span class="n">llst</span><span class="p">,</span>
                               <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                               <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                               <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span>
                    <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                                <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]],[</span><span class="n">llst</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">llst</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                                   <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span> 
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="n">llst</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                   <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span>
                        <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">plotresp</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                                <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">rlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]],[</span><span class="n">llst</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">llst</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                   <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span> 
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">rlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="n">llst</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                   <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">08</span><span class="p">,</span>
                                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span>
                                   <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">})</span>
                
                <span class="k">for</span> <span class="n">aa</span><span class="p">,</span><span class="n">axp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">axpte</span><span class="p">,</span><span class="n">axptm</span><span class="p">]):</span>
                    <span class="c">#set the x-axis to log scale</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
                    
                    <span class="c">#set the phase limits</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">phaselimits</span><span class="p">)</span>
                    
                    <span class="c">#put a grid on the subplot</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
                    
                    <span class="c">#set the tick locations</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    
                    <span class="c">#set the x axis label</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span>
                                   <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    
                    <span class="c">#put the y label on the far left plot</span>
                    <span class="n">axp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">07</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">axp</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    
    </div>
<div class="viewcode-block" id="Occam2DData.plotPseudoSection"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.plotPseudoSection">[docs]</a>    <span class="k">def</span> <span class="nf">plotPseudoSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">respfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">rcmap</span><span class="o">=</span><span class="s">&#39;jet_r&#39;</span><span class="p">,</span><span class="n">pcmap</span><span class="o">=</span><span class="s">&#39;jet&#39;</span><span class="p">,</span>
                      <span class="n">rlim</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">)),</span><span class="n">plim</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">)),</span><span class="n">ml</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                      <span class="n">stationid</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plots a pseudo section of the data</span>
<span class="sd">        </span>
<span class="sd">        datafn = full path to data file</span>
<span class="sd">        respfn = full path to response file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read2DRespFile</span><span class="p">(</span><span class="n">respfn</span><span class="p">)</span>
            <span class="n">nr</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">nr</span><span class="o">=</span><span class="mi">1</span>
        
        <span class="n">ns</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">)</span>
        <span class="n">nf</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">ylimits</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="c">#    print ylimits</span>
        
        <span class="c">#make a grid for pcolormesh so you can have a log scale</span>
        <span class="c">#get things into arrays for plotting</span>
        <span class="n">offsetlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
        <span class="n">resxyarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>    
        <span class="n">resyxarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>    
        <span class="n">phasexyarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>    
        <span class="n">phaseyxarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">nr</span><span class="p">))</span>
    
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">rpdict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">):</span>
            <span class="n">offsetlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span>     
            <span class="n">resxyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">resyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">phasexyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">phaseyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">resxyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">resyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">phasexyarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">phaseyxarr</span><span class="p">[:,</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                
                
        <span class="c">#make a meshgrid for plotting</span>
        <span class="c">#flip frequency so bottom corner is long period</span>
        <span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
        <span class="c">#make list for station labels</span>
        <span class="n">slabel</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="n">stationid</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">stationid</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> 
                    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ml</span><span class="p">)]</span>
        <span class="n">labellst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;$r_{TE-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$r_{TE-Model}$&#39;</span><span class="p">,</span>
                  <span class="s">&#39;$r_{TM-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$r_{TM-Model}$&#39;</span><span class="p">,</span>
                  <span class="s">&#39;$\phi_{TE-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$\phi_{TE-Model}$&#39;</span><span class="p">,</span>
                  <span class="s">&#39;$\phi_{TM-Data}$&#39;</span><span class="p">,</span><span class="s">&#39;$\phi_{TM-Model}$&#39;</span><span class="p">]</span>
        <span class="n">xloc</span><span class="o">=</span><span class="n">offsetlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">offsetlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">5</span>
        <span class="n">yloc</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">7</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">09</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">96</span>        
            
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">gs1</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=.</span><span class="mi">48</span><span class="p">,</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mo">005</span><span class="p">)</span>
            <span class="n">gs2</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.52</span><span class="p">,</span><span class="n">right</span><span class="o">=.</span><span class="mi">98</span><span class="p">,</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mo">005</span><span class="p">)</span>
            
            <span class="n">ax1r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax1r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resxyarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">ax2r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax2r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resxyarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                           
            <span class="n">ax3r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax3r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resyxarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">ax4r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax4r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resyxarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    
            <span class="n">ax1p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax1p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phasexyarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">ax2p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax2p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phasexyarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                           
            <span class="n">ax3p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax3p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phaseyxarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">ax4p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax4p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phaseyxarr</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">axlst</span><span class="o">=</span><span class="p">[</span><span class="n">ax1r</span><span class="p">,</span><span class="n">ax2r</span><span class="p">,</span><span class="n">ax3r</span><span class="p">,</span><span class="n">ax4r</span><span class="p">,</span><span class="n">ax1p</span><span class="p">,</span><span class="n">ax2p</span><span class="p">,</span><span class="n">ax3p</span><span class="p">,</span><span class="n">ax4p</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">xx</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axlst</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ml</span><span class="p">)])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">,</span><span class="n">minor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">offsetlst</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">offsetlst</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="mf">2.0</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="n">cbx</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">015</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">xx</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                                            <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                            <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                                            <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                         <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
                            <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                                            <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
                            <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                                            <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                           <span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xloc</span><span class="p">,</span><span class="n">yloc</span><span class="p">,</span><span class="n">labellst</span><span class="p">[</span><span class="n">xx</span><span class="p">],</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;facecolor&#39;</span><span class="p">:</span><span class="s">&#39;white&#39;</span><span class="p">},</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">xx</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">xx</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Station&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                                                      <span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                
                    
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
        <span class="k">else</span><span class="p">:</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">7</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">09</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">96</span>        
            
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">gs1</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">right</span><span class="o">=.</span><span class="mi">48</span><span class="p">,</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">wspace</span><span class="o">=.</span><span class="mo">005</span><span class="p">)</span>
            <span class="n">gs2</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">left</span><span class="o">=</span><span class="mf">0.52</span><span class="p">,</span><span class="n">right</span><span class="o">=.</span><span class="mi">98</span><span class="p">,</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">wspace</span><span class="o">=.</span><span class="mo">005</span><span class="p">)</span>
            
            <span class="n">ax1r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
            <span class="n">ax1r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resxyarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
                           
            <span class="n">ax3r</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
            <span class="n">ax3r</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resyxarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
    
            <span class="n">ax1p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
            <span class="n">ax1p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phasexyarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
                           
            <span class="n">ax3p</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
            <span class="n">ax3p</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dgrid</span><span class="p">,</span><span class="n">fgrid</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">phaseyxarr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                           <span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            
            
            <span class="n">axlst</span><span class="o">=</span><span class="p">[</span><span class="n">ax1r</span><span class="p">,</span><span class="n">ax3r</span><span class="p">,</span><span class="n">ax1p</span><span class="p">,</span><span class="n">ax3p</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">xx</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axlst</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ml</span><span class="p">)])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">offsetlst</span><span class="p">,</span><span class="n">minor</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">slabel</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">offsetlst</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">offsetlst</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">cbx</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">015</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">xx</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rcmap</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">vmax</span><span class="o">=</span><span class="n">rlim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                 <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
                <span class="k">elif</span> <span class="n">xx</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="n">xx</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">cb</span><span class="o">=</span><span class="n">mcb</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">pcmap</span><span class="p">,</span>
                                    <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">vmax</span><span class="o">=</span><span class="n">plim</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">})</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xloc</span><span class="p">,</span><span class="n">yloc</span><span class="p">,</span><span class="n">labellst</span><span class="p">[</span><span class="n">xx</span><span class="p">],</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;facecolor&#39;</span><span class="p">:</span><span class="s">&#39;white&#39;</span><span class="p">},</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xx</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">xx</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">xx</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Station&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                                                      <span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                
                    
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="Occam2DData.plotAllResponses"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DData.plotAllResponses">[docs]</a>    <span class="k">def</span> <span class="nf">plotAllResponses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot all the responses of occam inversion from data file.  This assumes</span>
<span class="sd">        the response curves are in the same folder as the datafile.</span>
<span class="sd">    </span>
<span class="sd">        Input:</span>
<span class="sd">            datafile = full path to occam data file</span>
<span class="sd">            </span>
<span class="sd">        Output:</span>
<span class="sd">            Plot</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="n">rpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">)</span>
        
        <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">20</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">08</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">92</span>
    
    
        <span class="n">rlst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rpath</span><span class="p">,</span><span class="n">rfile</span><span class="p">)</span> <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">rpath</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">rfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.resp&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">nresp</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rlst</span><span class="p">)</span>
        
        <span class="n">colorlst</span><span class="o">=</span><span class="p">[(</span><span class="n">cc</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">cc</span><span class="p">)</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">nresp</span><span class="p">)]</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">axrte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">axrtm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axpte</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">axptm</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">rmstelst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">rmstmlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">rmstestr</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">rmstmstr</span><span class="o">=</span><span class="p">[]</span>
        <span class="c">#read responses</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">rfile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rlst</span><span class="p">):</span>
            <span class="n">respfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rpath</span><span class="p">,</span><span class="n">rfile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read2DRespFile</span><span class="p">(</span><span class="n">respfn</span><span class="p">)</span>
            
            <span class="n">ii</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stationlst</span><span class="p">)</span><span class="o">==</span><span class="n">station</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="n">period</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
            
            <span class="n">rmslstte</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">rmslsttm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">rmste</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">rmslstte</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslstte</span><span class="p">))</span>
            <span class="n">rmstm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ms</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">rmslsttm</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">rmslsttm</span><span class="p">))</span>
            <span class="n">rmstelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> rms=</span><span class="si">%.3f</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">rmste</span><span class="p">))</span>
            <span class="n">rmstmlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> rms=</span><span class="si">%.3f</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">rmstm</span><span class="p">))</span>
            <span class="n">rmstestr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmste</span><span class="p">)</span>
            <span class="n">rmstmstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmstm</span><span class="p">)</span>
            <span class="c">#plot resistivity</span>
            
            
            <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="c">#cut out missing data points first</span>
                <span class="n">rxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ryx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">r1</span><span class="p">,</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rxy</span><span class="p">],</span>
                                 <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">rxy</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">r2</span><span class="p">,</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ryx</span><span class="p">],</span>
                                 <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">ryx</span><span class="p">],</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">rlstte</span><span class="o">=</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span>
                <span class="n">rlsttm</span><span class="o">=</span><span class="p">[</span><span class="n">r2</span><span class="p">]</span>
        
            <span class="n">mrxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">mryx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">r3</span><span class="p">,</span><span class="o">=</span><span class="n">axrte</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mrxy</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resxy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mrxy</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
            <span class="n">r4</span><span class="p">,</span><span class="o">=</span><span class="n">axrtm</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mryx</span><span class="p">],</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;resyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mryx</span><span class="p">],</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        
            <span class="n">rlstte</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span>
            <span class="n">rlsttm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r4</span><span class="p">)</span>
                                
            <span class="c">#plot phase</span>
            <span class="c">#cut out missing data points first</span>
            <span class="n">pxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            
            <span class="k">if</span> <span class="n">jj</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>            
                <span class="n">axpte</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pxy</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pxy</span><span class="p">],</span>
                             <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">axptm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">pyx</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">pyx</span><span class="p">],</span>
                             <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
                             
            <span class="n">mpxy</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">mpyx</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">axpte</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpxy</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phasexy&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpxy</span><span class="p">],</span>
                         <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
            <span class="n">axptm</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mpyx</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;phaseyx&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">mpyx</span><span class="p">],</span>
                         <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorlst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                       
        <span class="n">axrte</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">axrtm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
        
        
        <span class="n">axrtm</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
        <span class="n">axrte</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
        
        <span class="n">rmstestr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rmstestr</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">rmstmstr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rmstmstr</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">axrte</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;TE rms={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstestr</span><span class="p">),</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">axrtm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;TM rms={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rmstmstr</span><span class="p">),</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        
        <span class="n">axpte</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">axpte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">axpte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="n">axrte</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">axpte</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">axpte</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    
        <span class="n">axrte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">axpte</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="n">axrtm</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
        <span class="n">axptm</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">axptm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">axptm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="n">axrtm</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot m$)&#39;</span><span class="p">,</span>
                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">axptm</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                       <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">axptm</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    
        <span class="n">axrtm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">axptm</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">station</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                                       </div></div>
<div class="viewcode-block" id="Occam2DModel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel">[docs]</a><span class="k">class</span> <span class="nc">Occam2DModel</span><span class="p">(</span><span class="n">Occam2DData</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class deals with the model side of Occam inversions, including </span>
<span class="sd">    plotting the model, the L-curve, depth profiles.  It will also be able to </span>
<span class="sd">    build a mesh and regularization grid at some point.  </span>
<span class="sd">    </span>
<span class="sd">    It inherits Occam2DData and the data can be extracted from the method</span>
<span class="sd">    get2DData().  After this call you can use all the methods of Occam2DData,</span>
<span class="sd">    such as plotting the model responses and pseudo sections.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="Occam2DModel.__init__"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">iterfn</span><span class="p">,</span><span class="n">meshfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">inmodelfn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="o">=</span><span class="n">iterfn</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="p">)</span>
        
        <span class="c">#get meshfile if none is provides assuming the mesh file is named</span>
        <span class="c">#with mesh</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meshfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">,</span><span class="s">&#39;MESH&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;mesh&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">meshfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Could not find a mesh file, &#39;</span><span class="o">+</span>\
                                    <span class="s">&#39;input manually&#39;</span><span class="p">)</span>
            
        <span class="c">#get inmodelfile if none is provides assuming the mesh file is </span>
        <span class="c">#named with inmodel</span>
        <span class="k">if</span> <span class="n">inmodelfn</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inmodelfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">,</span><span class="s">&#39;INMODEL&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inmodelfn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;inmodel&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">inmodelfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inmodelfn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Could not find a model file, &#39;</span><span class="o">+</span>\
                                    <span class="s">&#39;input manually&#39;</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Occam2DModel.read2DIter"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.read2DIter">[docs]</a>    <span class="k">def</span> <span class="nf">read2DIter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read2DIter will read an iteration file and combine that info from the </span>
<span class="sd">        datafn and return a dictionary of variables.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            iterfn = full path to iteration file if iterpath=None.  If </span>
<span class="sd">                           iterpath is input then iterfn is just the name</span>
<span class="sd">                           of the file without the full path.</span>
<span class="sd">        </span>
<span class="sd">        Outputs:</span>
<span class="sd">            idict = dictionary of parameters, keys are verbatim from the file, </span>
<span class="sd">                    except for the key &#39;model&#39; which is the contains the model</span>
<span class="sd">                    numbers in a 1D array.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="c">#check to see if the file exists</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;File: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="o">+</span><span class="s">&#39; does not exist, check path&#39;</span><span class="p">)</span>
    
        <span class="c">#open file, read lines, close file</span>
        <span class="n">ifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ilines</span><span class="o">=</span><span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">ifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="c">#create dictionary to put things</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
        <span class="c">#put header info into dictionary with similar keys</span>
        <span class="k">while</span> <span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Param&#39;</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">iline</span><span class="o">=</span><span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#get number of parameters</span>
        <span class="n">iline</span><span class="o">=</span><span class="n">ilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">nparam</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">nparam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nparam</span><span class="p">)</span>
        <span class="n">kk</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">jj</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">jj</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">ilines</span><span class="p">)</span><span class="o">-</span><span class="n">kk</span><span class="p">:</span>
            <span class="n">iline</span><span class="o">=</span><span class="n">ilines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">][</span><span class="n">jj</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">iline</span><span class="p">[</span><span class="n">ll</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#get the data file name from the iteration header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Data File&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ff</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.dat&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invpath</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Could not find a data file, input manually&#39;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Occam2DModel.read2DInmodel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.read2DInmodel">[docs]</a>    <span class="k">def</span> <span class="nf">read2DInmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read an INMODEL file for occam 2D</span>
<span class="sd">        </span>
<span class="sd">        Input:</span>
<span class="sd">            inmodelfn = full path to INMODEL file</span>
<span class="sd">        </span>
<span class="sd">        Output:</span>
<span class="sd">            rows = list of combined data blocks where first number of each list</span>
<span class="sd">                    represents the number of combined mesh layers for this </span>
<span class="sd">                    regularization block.  The second number is the number of </span>
<span class="sd">                    columns in the regularization block layer</span>
<span class="sd">            cols = list of combined mesh columns for the regularization layer.</span>
<span class="sd">                   The sum of this list must be equal to the number of mesh</span>
<span class="sd">                   columns.</span>
<span class="sd">            headerdict = dictionary of all the header information including the</span>
<span class="sd">                         binding offset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inmodelfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        
        <span class="n">headerdict</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">rows</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">cols</span><span class="o">=</span><span class="p">[]</span>    
        <span class="n">ncols</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="n">ilines</span><span class="o">=</span><span class="n">ifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">iline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ilines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">iline</span><span class="o">=</span><span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">headerdict</span><span class="p">[</span><span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">iline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#append the last line</span>
                <span class="k">if</span> <span class="n">iline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;EXCEPTIONS&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iline</span><span class="o">=</span><span class="n">iline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">iline</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">iline</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>
                    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span>
                    <span class="n">ncols</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">iline</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="o">+</span><span class="n">iline</span>
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inmodel_headerdict</span><span class="o">=</span><span class="n">headerdict</span>
        </div>
<div class="viewcode-block" id="Occam2DModel.read2DMesh"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.read2DMesh">[docs]</a>    <span class="k">def</span> <span class="nf">read2DMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        read a 2D meshfn</span>
<span class="sd">        </span>
<span class="sd">        Input:</span>
<span class="sd">            meshfn = full path to mesh file</span>
<span class="sd">    </span>
<span class="sd">        Output:</span>
<span class="sd">            hnodes = array of horizontal nodes (column locations (m))</span>
<span class="sd">            vnodes = array of vertical nodes (row locations(m))</span>
<span class="sd">            mdata = free parameters</span>
<span class="sd">            </span>
<span class="sd">        Things to do:</span>
<span class="sd">            incorporate fixed values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">mfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        
        <span class="n">mlines</span><span class="o">=</span><span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        
        <span class="n">nh</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">nv</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
        
        <span class="n">hnodes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
        <span class="n">vnodes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span>
        <span class="n">mdata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nh</span><span class="p">,</span><span class="n">nv</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>    
        
        <span class="c">#get horizontal nodes</span>
        <span class="n">jj</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">ii</span><span class="o">&lt;</span><span class="n">nh</span><span class="p">:</span>
            <span class="n">hline</span><span class="o">=</span><span class="n">mlines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">hline</span><span class="p">:</span>
                <span class="n">hnodes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>
                <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#get vertical nodes</span>
        <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="n">ii</span><span class="o">&lt;</span><span class="n">nv</span><span class="p">:</span>
            <span class="n">vline</span><span class="o">=</span><span class="n">mlines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">vline</span><span class="p">:</span>
                <span class="n">vnodes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span>
                <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>    
        
        <span class="c">#get free parameters        </span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">mm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">while</span> <span class="n">kk</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>        
                <span class="n">mline</span><span class="o">=</span><span class="n">mm</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">mline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;EXCEPTION&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nh</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">mdata</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="n">mline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#make the node information an attributes of the occamModel class </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hnodes</span><span class="o">=</span><span class="n">hnodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="o">=</span><span class="n">vnodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshdata</span><span class="o">=</span><span class="n">mdata</span>
        </div>
<div class="viewcode-block" id="Occam2DModel.get2DData"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.get2DData">[docs]</a>    <span class="k">def</span> <span class="nf">get2DData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read2DdataFile</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;No Data file defined&#39;</span>
        </div>
<div class="viewcode-block" id="Occam2DModel.get2DModel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.get2DModel">[docs]</a>    <span class="k">def</span> <span class="nf">get2DModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get2DModel will create an array based on the FE mesh and fill the </span>
<span class="sd">        values found from the regularization grid.  This way the array can </span>
<span class="sd">        be manipulated as a 2D object and plotted as an image or a mesh.</span>
<span class="sd">        </span>
<span class="sd">        Outputs:</span>
<span class="sd">            self.2Dmodel -&gt; model array with log resistivity values</span>
<span class="sd">            self.plotx -&gt; horizontal distance of FE mesh (m) blocks</span>
<span class="sd">            self.ploty -&gt; depth of vertical nodes of FE mesh (m)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c">#read iteration file to get model and data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read2DIter</span><span class="p">()</span> 
        
        <span class="c">#read in data file as an OccamData type</span>
        <span class="k">print</span> <span class="s">&#39;Reading data from: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">datafn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get2DData</span><span class="p">()</span>
        
        <span class="c">#read in MESH file</span>
        <span class="k">print</span> <span class="s">&#39;Reading mesh from: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">meshfn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read2DMesh</span><span class="p">()</span>
        
        <span class="c">#read in INMODEL</span>
        <span class="k">print</span> <span class="s">&#39;Reading model from: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">inmodelfn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read2DInmodel</span><span class="p">()</span>
        <span class="c">#get the binding offset which is the right side of the furthest left</span>
        <span class="c">#block, this helps locate the model in relative space</span>
        <span class="n">bndgoff</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inmodel_headerdict</span><span class="p">[</span><span class="s">&#39;BINDING OFFSET&#39;</span><span class="p">])</span>
        
        <span class="c">#make sure that the number of rows and number of columns are the same</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        
        <span class="c">#initiate the resistivity model to the shape of the FE mesh</span>
        <span class="n">resmodel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">hnodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="c">#read in the model and set the regularization block values to map onto</span>
        <span class="c">#the FE mesh so that the model can be plotted as an image or regular </span>
        <span class="c">#mesh.</span>
        <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
            <span class="c">#get the number of layers to combine</span>
            <span class="c">#this index will be the first index in the vertical direction</span>
            <span class="n">ny1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="c">#the second index  in the vertical direction</span>
            <span class="n">ny2</span><span class="o">=</span><span class="n">ny1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#make the list of amalgamated columns an array for ease</span>
            <span class="n">lc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="c">#loop over the number of amalgamated blocks</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                <span class="c">#get first in index in the horizontal direction</span>
                <span class="n">nx1</span><span class="o">=</span><span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="c">#get second index in horizontal direction</span>
                <span class="n">nx2</span><span class="o">=</span><span class="n">nx1</span><span class="o">+</span><span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="c">#put the apporpriate resistivity value into all the amalgamated </span>
                <span class="c">#model blocks of the regularization grid into the forward model</span>
                <span class="c">#grid</span>
                <span class="n">resmodel</span><span class="p">[</span><span class="n">ny1</span><span class="p">:</span><span class="n">ny2</span><span class="p">,</span><span class="n">nx1</span><span class="p">:</span><span class="n">nx2</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;model&#39;</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span>
                <span class="n">mm</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#make some arrays for plotting the model</span>
        <span class="n">plotx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">hnodes</span><span class="p">[:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
                        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hnodes</span><span class="p">))])</span>
        <span class="n">ploty</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="p">[:</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
                        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="p">))])</span>
        
        <span class="c">#center the grid onto the station coordinates</span>
        <span class="n">x0</span><span class="o">=</span><span class="n">bndgoff</span><span class="o">-</span><span class="n">plotx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">plotx</span><span class="o">=</span><span class="n">plotx</span><span class="o">+</span><span class="n">x0</span>
        
        <span class="c">#flip the arrays around for plotting purposes</span>
        <span class="c">#plotx=plotx[::-1] and make the first layer start at zero</span>
        <span class="n">ploty</span><span class="o">=</span><span class="n">ploty</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ploty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c">#make a mesh grid to plot in the model coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">meshy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">plotx</span><span class="p">,</span><span class="n">ploty</span><span class="p">)</span>
        
        <span class="c">#flip the resmodel upside down so that the top is the stations</span>
        <span class="n">resmodel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">resmodel</span><span class="p">)</span>
        
        <span class="c">#make attributes of the class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="o">=</span><span class="n">resmodel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="o">=</span><span class="n">plotx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="o">=</span><span class="n">ploty</span>
        
        <span class="c">#set the offsets of the stations and station list.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">rpdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">])</span>
        </div>
<div class="viewcode-block" id="Occam2DModel.plot2DModel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.plot2DModel">[docs]</a>    <span class="k">def</span> <span class="nf">plot2DModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">datafn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">xpad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">ypad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">mpad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">spad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="n">stationid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">fdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;rotation&#39;</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;normal&#39;</span><span class="p">},</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">ylimits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xminorticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">yminorticks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">climits</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;jet_r&#39;</span><span class="p">,</span><span class="n">fs</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">femesh</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span>
                    <span class="n">regmesh</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="n">meshnum</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span>
                    <span class="n">blocknum</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span><span class="n">blkfdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">plotdimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">grid</span><span class="o">=</span><span class="s">&#39;off&#39;</span><span class="p">,</span><span class="n">yscale</span><span class="o">=</span><span class="s">&#39;km&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plotModel will plot the model output by occam in the iteration file.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            </span>
<span class="sd">            datafn = full path to data file.  If none is input it will use the</span>
<span class="sd">                        data file found in the iteration file.</span>
<span class="sd">            </span>
<span class="sd">            xpad = padding in the horizontal direction of model</span>
<span class="sd">            </span>
<span class="sd">            ypad = padding the in the vertical direction of the top of the model</span>
<span class="sd">                   to fit the station names and markers</span>
<span class="sd">                   </span>
<span class="sd">            mpad = marker pad to fit right at the surface, haven&#39;t found a better</span>
<span class="sd">                   way of doing this automatically yet</span>
<span class="sd">                   </span>
<span class="sd">            spad = padding of station names away from the top of the model, this</span>
<span class="sd">                    is kind of awkward at the moment especially if you zoom into </span>
<span class="sd">                    the model, it usually looks retarded and doesn&#39;t fit</span>
<span class="sd">                    </span>
<span class="sd">            ms = marker size in ambiguous points</span>
<span class="sd">            </span>
<span class="sd">            stationid = index of station names to plot -&gt; ex. pb01sdr would be </span>
<span class="sd">                        stationid=(0,4) to plot pb01</span>
<span class="sd">                        </span>
<span class="sd">            fdict = font dictionary for the station names, can have keys:</span>
<span class="sd">                    &#39;size&#39; = font size</span>
<span class="sd">                    &#39;rotation&#39; = angle of rotation (deg) of font</span>
<span class="sd">                    &#39;weight&#39; = weight of font </span>
<span class="sd">                    &#39;color&#39; = color of font</span>
<span class="sd">                    &#39;style&#39; = style of font ex. &#39;italics&#39;</span>
<span class="sd">                    </span>
<span class="sd">            plotdimensions = x-y dimensions of the figure (10,10) in inches</span>
<span class="sd">                    </span>
<span class="sd">            dpi = dot per inch of figure, should be 300 for publications</span>
<span class="sd">            </span>
<span class="sd">            ylimits = limits of depth scale (km). ex, ylimits=(0,30)</span>
<span class="sd">            </span>
<span class="sd">            xminorticks = location of minor tick marks for the horizontal axis</span>
<span class="sd">            </span>
<span class="sd">            yminorticks = location of minor tick marks for vertical axis</span>
<span class="sd">            </span>
<span class="sd">            climits = limits of log10(resistivity). ex. climits=(0,4)</span>
<span class="sd">            </span>
<span class="sd">            cmap = color map to plot the model image</span>
<span class="sd">            </span>
<span class="sd">            fs = font size of axis labels</span>
<span class="sd">            </span>
<span class="sd">            femesh = &#39;on&#39; to plot finite element forward modeling mesh (black)</span>
<span class="sd">            </span>
<span class="sd">            regmesh = &#39;on&#39; to plot regularization mesh (blue)</span>
<span class="sd">            </span>
<span class="sd">            aspect = aspect ratio of the figure, depends on your line length and</span>
<span class="sd">                    the depth you want to investigate</span>
<span class="sd">            </span>
<span class="sd">            title = &#39;on&#39; to put the RMS and Roughness as the title, or input a </span>
<span class="sd">                    string that will be added to the RMS and roughness, or put </span>
<span class="sd">                    None to not put a title on the plot and print out RMS and </span>
<span class="sd">                    roughness</span>
<span class="sd">            </span>
<span class="sd">            meshnum = &#39;on&#39; to plot FE mesh block numbers</span>
<span class="sd">            </span>
<span class="sd">            fignum = figure number to plot to</span>
<span class="sd">            </span>
<span class="sd">            blocknum = &#39;on&#39; to plot numbers on the regularization blocks</span>
<span class="sd">            </span>
<span class="sd">            blkfdict = font dictionary for the numbering of regularization blocks</span>
<span class="sd">            </span>
<span class="sd">            grid = major for major ticks grid</span>
<span class="sd">                   minor for a grid of the minor ticks</span>
<span class="sd">                   both for a grid with major and minor ticks</span>
<span class="sd">            </span>
<span class="sd">            yscale = &#39;km&#39; for depth in km or &#39;m&#39; for depth in meters</span>
<span class="sd">        &quot;&quot;&quot;</span>   
                    
        <span class="c">#set the scale of the plot</span>
        <span class="k">if</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">dfactor</span><span class="o">=</span><span class="mf">1000.</span>
            <span class="n">pfactor</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">elif</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">dfactor</span><span class="o">=</span><span class="mf">1.</span>
            <span class="n">pfactor</span><span class="o">=</span><span class="mf">1000.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfactor</span><span class="o">=</span><span class="mf">1000.</span>
            <span class="n">pfactor</span><span class="o">=</span><span class="mf">1.0</span>
        
        <span class="c">#get the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get2DModel</span><span class="p">()</span>
        
        <span class="c">#set some figure properties to use the maiximum space </span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="o">/</span><span class="mf">40.</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">08</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">99</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">92</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">01</span>
<span class="c">#        plt.rcParams[&#39;text.usetex&#39;]=True</span>
        
        <span class="c">#plot the model as a mesh</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">plotdimensions</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        
        <span class="c">#add a subplot to the figure with the specified aspect ratio</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="n">aspect</span><span class="p">)</span>
        
        <span class="c">#plot the model as a pcolormesh so the extents are constrained to </span>
        <span class="c">#the model coordinates</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshx</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">meshy</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="p">,</span>
                      <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c">#make a colorbar for the resistivity</span>
        <span class="n">cbx</span><span class="o">=</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">vmax</span><span class="o">=</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s">&#39;10$^{0}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> 
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">climits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        
        <span class="c">#set the offsets of the stations and plot the stations</span>
        <span class="c">#need to figure out a way to set the marker at the surface in all</span>
        <span class="c">#views.</span>
        <span class="k">for</span> <span class="n">rpdict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rplst</span><span class="p">:</span>
            <span class="c">#plot the station marker</span>
            <span class="c">#plots a V for the station cause when you use scatter the spacing</span>
            <span class="c">#is variable if you change the limits of the y axis, this way it</span>
            <span class="c">#always plots at the surface.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="s">&#39;V&#39;</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span>
                    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">ms</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">,</span><span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;black&#39;</span><span class="p">})</span>
                    
            <span class="c">#put station id onto station marker</span>
            <span class="c">#if there is a station id index</span>
            <span class="k">if</span> <span class="n">stationid</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="o">-</span><span class="n">spad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">,</span>
                        <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">][</span><span class="n">stationid</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">stationid</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>
            <span class="c">#otherwise put on the full station name found form data file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="o">-</span><span class="n">spad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">,</span>
                        <span class="n">rpdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">],</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span>
                        <span class="n">fontdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>
        
        <span class="c">#set the initial limits of the plot to be square about the profile line  </span>
        <span class="k">if</span> <span class="n">ylimits</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>  
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span><span class="p">))</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span>
                        <span class="o">-</span><span class="n">ypad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pfactor</span><span class="p">,(</span><span class="n">ylimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ypad</span><span class="p">)</span><span class="o">*</span><span class="n">pfactor</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span><span class="p">)</span><span class="o">/</span><span class="n">dfactor</span><span class="o">-</span><span class="p">(</span><span class="n">xpad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">),</span>
                     <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span><span class="p">)</span><span class="o">/</span><span class="n">dfactor</span><span class="o">+</span><span class="p">(</span><span class="n">xpad</span><span class="o">*</span><span class="n">pfactor</span><span class="p">)))</span>
        <span class="c">#set the axis properties</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">xminorticks</span><span class="o">*</span><span class="n">pfactor</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">yminorticks</span><span class="o">*</span><span class="n">pfactor</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;km&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Horizontal Distance (km)&#39;</span><span class="p">,</span>
                          <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (km)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Horizontal Distance (m)&#39;</span><span class="p">,</span>
                          <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (m)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        
        <span class="c">#put a grid on if one is desired    </span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">==</span><span class="s">&#39;major&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;major&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">==</span><span class="s">&#39;minor&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;minor&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">==</span><span class="s">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="c">#set title as rms and roughness</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">title</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
                <span class="n">titlestr</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="p">)),</span>
                                      <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titlestr</span><span class="o">+</span>\
                            <span class="s">&#39;: RMS {0:.2f}, Roughness={1:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">]),</span>
                            <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">])),</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="o">+</span><span class="s">&#39;; RMS {0:.2f}, Roughness={1:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">]),</span>
                         <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">])),</span>
                         <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="n">fs</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;RMS {0:.2f}, Roughness={1:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">]),</span>
                         <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">]))</span> 
        
        <span class="c">#plot forward model mesh    </span>
        <span class="k">if</span> <span class="n">femesh</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="o">/</span><span class="n">dfactor</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xx</span><span class="p">,</span><span class="n">xx</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="o">/</span><span class="n">dfactor</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">yy</span><span class="p">,</span><span class="n">yy</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="c">#plot the regularization mesh</span>
        <span class="k">if</span> <span class="n">regmesh</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">linelst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                <span class="c">#get the number of layers to combine</span>
                <span class="c">#this index will be the first index in the vertical direction</span>
                <span class="n">ny1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="c">#the second index  in the vertical direction</span>
                <span class="n">ny2</span><span class="o">=</span><span class="n">ny1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#make the list of amalgamated columns an array for ease</span>
                <span class="n">lc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">yline</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">],</span>
                              <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">],</span>
                              <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">linelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yline</span><span class="p">)</span>
                <span class="c">#loop over the number of amalgamated blocks</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                    <span class="c">#get first in index in the horizontal direction</span>
                    <span class="n">nx1</span><span class="o">=</span><span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="c">#get second index in horizontal direction</span>
                    <span class="n">nx2</span><span class="o">=</span><span class="n">nx1</span><span class="o">+</span><span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ny1</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">ny1</span><span class="o">=</span><span class="mi">1</span>
                        <span class="n">xline</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">],</span>
                                      <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny2</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">],</span>
                                      <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
                        <span class="n">linelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xline</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    
        <span class="c">##plot the mesh block numbers</span>
        <span class="k">if</span> <span class="n">meshnum</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">kk</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dfactor</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="o">/</span><span class="n">dfactor</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                    
        <span class="c">##plot regularization block numbers</span>
        <span class="k">if</span> <span class="n">blocknum</span><span class="o">==</span><span class="s">&#39;on&#39;</span><span class="p">:</span>
            <span class="n">kk</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                <span class="c">#get the number of layers to combine</span>
                <span class="c">#this index will be the first index in the vertical direction</span>
                <span class="n">ny1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[:</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="c">#the second index  in the vertical direction</span>
                <span class="n">ny2</span><span class="o">=</span><span class="n">ny1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#make the list of amalgamated columns an array for ease</span>
                <span class="n">lc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="c">#loop over the number of amalgamated blocks</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])):</span>
                    <span class="c">#get first in index in the horizontal direction</span>
                    <span class="n">nx1</span><span class="o">=</span><span class="n">lc</span><span class="p">[:</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                    <span class="c">#get second index in horizontal direction</span>
                    <span class="n">nx2</span><span class="o">=</span><span class="n">nx1</span><span class="o">+</span><span class="n">lc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ny1</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">ny1</span><span class="o">=</span><span class="mi">1</span>
                        <span class="c">#get center points of the blocks</span>
                        <span class="n">yy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny1</span><span class="p">]</span><span class="o">-</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="n">ny2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                        <span class="n">xx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="n">nx2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                        <span class="c">#put the number</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xx</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="n">yy</span><span class="o">/</span><span class="n">dfactor</span><span class="p">,</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span>
                                <span class="n">fontdict</span><span class="o">=</span><span class="n">blkfdict</span><span class="p">,</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">)</span>
                        <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="Occam2DModel.plotL2Curve"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.plotL2Curve">[docs]</a>    <span class="k">def</span> <span class="nf">plotL2Curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fnstem</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PlotL2Curve will plot the RMS vs iteration number for the given </span>
<span class="sd">        inversion folder and roughness vs iteration number</span>
<span class="sd">        </span>
<span class="sd">        Inputs: </span>
<span class="sd">            fnstem = filename stem to look for in case multiple inversions were</span>
<span class="sd">                    run in the same folder.  If none then searches for anything</span>
<span class="sd">                    ending in .iter</span>
<span class="sd">            fignum = figure number</span>
<span class="sd">            dpi = dpi of the figure</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">invpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="p">)</span>        
        
        <span class="k">if</span> <span class="n">fnstem</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">iterlst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">itfile</span><span class="p">)</span> 
                    <span class="k">for</span> <span class="n">itfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">invpath</span><span class="p">)</span> <span class="k">if</span> <span class="n">itfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.iter&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iterlst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invpath</span><span class="p">,</span><span class="n">itfile</span><span class="p">)</span> 
                    <span class="k">for</span> <span class="n">itfile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">invpath</span><span class="p">)</span> <span class="k">if</span> <span class="n">itfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.iter&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span>
                    <span class="n">itfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">fnstem</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
                    
        <span class="n">nr</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">iterlst</span><span class="p">)</span>
        
        <span class="n">rmsarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nr</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">itfile</span> <span class="ow">in</span> <span class="n">iterlst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iterfn</span><span class="o">=</span><span class="n">itfile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read2DIter</span><span class="p">()</span>
            <span class="n">ii</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Iteration&#39;</span><span class="p">])</span>
            <span class="n">rmsarr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Misfit Value&#39;</span><span class="p">])</span>
            <span class="n">rmsarr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idict</span><span class="p">[</span><span class="s">&#39;Roughness Value&#39;</span><span class="p">])</span>
        
        <span class="c">#set the dimesions of the figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="o">/</span><span class="mf">40.</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">08</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">90</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">90</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">01</span>
        
        <span class="c">#make figure instance</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        
        <span class="c">#make a subplot for RMS vs Iteration</span>
        <span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c">#plot the rms vs iteration</span>
        <span class="n">l1</span><span class="p">,</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;-k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="c">#plot the median of the RMS</span>
        <span class="n">m1</span><span class="p">,</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">nr</span><span class="p">),</span>
                     <span class="s">&#39;--r&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">75</span><span class="p">)</span>
        
        <span class="c">#plot the mean of the RMS</span>
        <span class="n">m2</span><span class="p">,</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">nr</span><span class="p">),</span>
                     <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;orange&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">75</span><span class="p">)</span>
    
        <span class="c">#make subplot for RMS vs Roughness Plot</span>
        <span class="n">ax2</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
        
        <span class="c">#plot the rms vs roughness </span>
        <span class="n">l2</span><span class="p">,</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">],</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;--b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                     <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">rms</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">rms</span><span class="p">,</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                     <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">,</span><span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;blue&#39;</span><span class="p">})</span>
        
        <span class="c">#make a legend</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">],[</span><span class="s">&#39;RMS&#39;</span><span class="p">,</span><span class="s">&#39;Roughness&#39;</span><span class="p">,</span>
                   <span class="s">&#39;Median_RMS={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">])),</span>
                    <span class="s">&#39;Mean_RMS={0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rmsarr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]))],</span>
                    <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper center&#39;</span><span class="p">,</span><span class="n">columnspacing</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=.</span><span class="mi">75</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>
                    
        <span class="c">#set the axis properties for RMS vs iteration</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;RMS&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>                                   
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Iteration&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Roughness&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">,</span>
                                             <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;blue&#39;</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t2</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>          
        
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
                </div>
<div class="viewcode-block" id="Occam2DModel.plotDepthModel"><a class="viewcode-back" href="../../../core.OCCAMTools.html#MTpy.core.OCCAMTools.Occam2DModel.plotDepthModel">[docs]</a>    <span class="k">def</span> <span class="nf">plotDepthModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">depth</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">plottype</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="n">yscale</span><span class="o">=</span><span class="s">&#39;log&#39;</span><span class="p">,</span>
                       <span class="n">plotdimensions</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">plotnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        will plot a depth section profile for a given set of stations.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            </span>
<span class="sd">            plotnum = 1 to plot in different figures, &#39;all&#39; to plot in all into</span>
<span class="sd">                      one figure.</span>
<span class="sd">            </span>
<span class="sd">            dpi = dpi of figure</span>
<span class="sd">            </span>
<span class="sd">            depth = max depth to estimate the profile</span>
<span class="sd">            </span>
<span class="sd">            stationnames = list of station names corresponding to the starting</span>
<span class="sd">                           block numbers</span>
<span class="sd">            </span>
<span class="sd">            yscale = &#39;log&#39; for logarithmic or &#39;linear&#39; for linear</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get2DModel</span><span class="p">()</span>
        <span class="c">#get stations to plot</span>
        <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="s">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">pstationlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stationlst</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pstationlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plottype</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">plottype</span><span class="o">=</span><span class="p">[</span><span class="n">plottype</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ps</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stationlst</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
                                  
        <span class="c">#get the average x-spacing within the station region, occam pads by </span>
        <span class="c">#7 cells by default        </span>
        <span class="n">xavg</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> 
                        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">)</span><span class="o">-</span><span class="mi">7</span><span class="p">)]))</span>
        
        <span class="c">#get the station indices to extract from the model</span>
        <span class="n">slst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">pstationlst</span><span class="p">:</span>
            <span class="n">offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetlst</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">xx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotx</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">offset</span><span class="o">&gt;=</span><span class="n">xx</span><span class="o">-</span><span class="n">xavg</span><span class="o">/</span><span class="mf">2.</span> <span class="ow">and</span> <span class="n">offset</span><span class="o">&lt;=</span><span class="n">xx</span><span class="o">+</span><span class="n">xavg</span><span class="o">/</span><span class="mf">2.</span><span class="p">:</span>
                    <span class="n">slst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        
        <span class="c">#set the dimesions of the figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="o">/</span><span class="mf">40.</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">15</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">95</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">15</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">90</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">05</span>
        
        <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="c">#set the dimesions of the figure</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dpi</span><span class="o">/</span><span class="mf">60.</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">09</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">95</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">15</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">90</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
            
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,</span><span class="n">plotdimensions</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">ns</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">slst</span><span class="p">)</span>
            <span class="c">#plot the depth section for each station        </span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slst</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c">#plot resistivity vs depth</span>
                <span class="k">if</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;linear&#39;</span><span class="p">:</span>
                    <span class="n">p1</span><span class="p">,</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="p">[:,</span><span class="n">ss</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">,</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps-&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;log&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">p1</span><span class="p">,</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="p">[:,</span><span class="n">ss</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">,</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps-&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">pstationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span>
                             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (m)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ns</span><span class="o">/</span><span class="mf">2.</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#plot the depth section for each station        </span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slst</span><span class="p">):</span>
                <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">plotdimensions</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c">#plot resistivity vs depth</span>
                <span class="k">if</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;linear&#39;</span><span class="p">:</span>
                    <span class="n">p1</span><span class="p">,</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="p">[:,</span><span class="n">ss</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">,</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps-&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">yscale</span><span class="o">==</span><span class="s">&#39;log&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">p1</span><span class="p">,</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">resmodel</span><span class="p">[:,</span><span class="n">ss</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">,</span>
                                  <span class="n">ls</span><span class="o">=</span><span class="s">&#39;steps-&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ploty</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stationlst</span><span class="p">[</span><span class="n">pstationlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]],</span>
                             <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>    
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Depth (m)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Resistivity ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                              <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>       
            
        
    </div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jared Peacock, Lars Krieger, Stephan Thiel, Kent Inverarity.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>