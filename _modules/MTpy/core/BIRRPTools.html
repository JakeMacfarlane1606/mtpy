

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MTpy.core.BIRRPTools &mdash; MTpy 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MTpy.core.BIRRPTools</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module of tool that can be applied to BIRRP outputs</span>

<span class="sd">Created on %(date)s</span>

<span class="sd">@author: %(Jared Peacock)s</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">MTpy.core.MTtools</span> <span class="kn">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="c">#import winsound as ws</span>

<span class="c">#short spaces 3 spaces</span>
<span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span>
<span class="c">#long spaces 6 spaces</span>
<span class="n">lsp</span><span class="o">=</span><span class="s">&#39;      &#39;</span>

<div class="viewcode-block" id="finishBeep"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.finishBeep">[docs]</a><span class="k">def</span> <span class="nf">finishBeep</span><span class="p">():</span>
    <span class="k">pass</span>
    <span class="c">#ws.Beep(1000,80)</span>
    <span class="c">#ws.Beep(300,150)</span>
<span class="c">#    ws.Beep(150,40)</span>
<span class="c">#    ws.Beep(200,40)</span>
<span class="c">#    ws.Beep(300,80)</span>
<span class="c">#    ws.Beep(1000,100)</span>
    <span class="c">#for ii in np.arange(50,1200,100):</span>
        <span class="c">#ws.Beep(ii,25)</span>
<span class="c">#    ws.Beep(523,50)</span>
<span class="c">#    ws.Beep(100,25)</span>
<span class="c">#    ws.Beep(264,50)</span>
</div>
<div class="viewcode-block" id="readProDict"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.readProDict">[docs]</a><span class="k">def</span> <span class="nf">readProDict</span><span class="p">(</span><span class="n">processinginfofile</span><span class="p">,</span><span class="n">dirpath</span><span class="p">,</span><span class="n">filtered</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rrfiltered</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    readProDict will read in the information from processing infofile and output</span>
<span class="sd">    as a list of dictionaries.  </span>
<span class="sd">    Inputs:</span>
<span class="sd">        processinginfofile=tab delimited text file with appropriate information.</span>
<span class="sd">        dirpath = directory path to where station folders are</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        plst = list of dictionaries with key words related to headers of txt </span>
<span class="sd">                file</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">pfid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">processinginfofile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plines</span><span class="o">=</span><span class="n">pfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">pkeys</span><span class="o">=</span><span class="n">plines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">pkeys</span><span class="o">=</span><span class="n">pkeys</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">plst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">pline</span> <span class="ow">in</span> <span class="n">plines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">pstr</span><span class="o">=</span><span class="n">pline</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">pstr</span><span class="o">=</span><span class="n">pstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pstr</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">pdict</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">pkey</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pkeys</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">pstr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">pstr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="n">pstr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">pdict</span><span class="p">[</span><span class="n">pkey</span><span class="p">]</span><span class="o">=</span><span class="n">pstr</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span>
        <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dirpath</span>
        <span class="k">if</span> <span class="n">filtered</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;filtered&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;Filtered&#39;</span>
        <span class="k">if</span> <span class="n">rrfiltered</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">pdict</span><span class="p">[</span><span class="s">&#39;rrfiltered&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;Filtered&#39;</span>
        <span class="n">plst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdict</span><span class="p">)</span>
        
    <span class="n">pfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">plst</span>
</div>
<div class="viewcode-block" id="scriptfilePrep"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.scriptfilePrep">[docs]</a><span class="k">def</span> <span class="nf">scriptfilePrep</span><span class="p">(</span><span class="n">prepdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    scriptfilePrep(prepdict) will calculate parameters, combine files and </span>
<span class="sd">    convert if need be. Keys for prepdict are:</span>
<span class="sd">        dirpath = dirpath to station folders -&gt; d:\Data</span>
<span class="sd">        cdirpath = full path to time series files if not entered will default to</span>
<span class="sd">                    dirpath\station\day</span>
<span class="sd">        cdirpathr = full path to remote reference time series if not entered</span>
<span class="sd">                    dirpath\rrstation\day</span>
<span class="sd">        station = station name</span>
<span class="sd">        day = UTC day string of length 3 -&gt; 035</span>
<span class="sd">        rrstation = remote reference station name</span>
<span class="sd">        cacherate = length of data files string of hhmmss -&gt; 1 hour data files</span>
<span class="sd">                    is 010000, 10 min is 001000</span>
<span class="sd">        start = start time for combining files in hhmmss</span>
<span class="sd">        stop = stop time for combining files in hhmmss</span>
<span class="sd">        rrstart = start time of remote reference in hhmmss</span>
<span class="sd">        rrstop = stop time of remote reference in hhmmss</span>
<span class="sd">        dec = decimation factor (0 for no decimation, needs to be an integer)</span>
<span class="sd">        df = sampling frequency in Hz</span>
<span class="sd">        magori = orientation of magnetic components as N,E,Z -&gt; for measured BX </span>
<span class="sd">                 to East input as [BY,BX,BZ] omit BZ if not measured</span>
<span class="sd">        elecori = orientation of electric components as N,E -&gt; for EX measured</span>
<span class="sd">                  to N input as [EX,EY]</span>
<span class="sd">        rrmagori = orientation of remote reference magnetometers as N,E,Z omit</span>
<span class="sd">                   Z if not measured</span>
<span class="sd">        filtered = &#39;Filtered&#39; if filtered, don&#39;t enter if not filtered</span>
<span class="sd">        rrfiltered = &#39;Filtered&#39; if remote reference is filtered </span>
<span class="sd">        fdict = dictionary for adaptive notch filter see </span>
<span class="sd">                MTtools.adaptiveNotchFilter() for details</span>
<span class="sd">        </span>
<span class="sd">    returns procesing dictionary with keys:</span>
<span class="sd">        cfilelst = list of files combined full path</span>
<span class="sd">        rrcfilelst = list of remote reference files combined full path</span>
<span class="sd">        station = station</span>
<span class="sd">        deltat = sampling rate (+) for time (-) for frequency</span>
<span class="sd">        nfft = max window length</span>
<span class="sd">        nsctmax = max number of windows</span>
<span class="sd">        nskipr = number of points to skip for remote reference</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#print the dictionary going into combining files</span>
    
<span class="c">#    pkeys=prepdict.keys()</span>
<span class="c">#    for key in pkeys.sort():</span>
<span class="c">#        print key+&#39;: &#39;+str(prepdict[key])</span>
        
    <span class="n">station</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>    
        <span class="n">rrstation</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rrstation</span><span class="o">=</span><span class="p">[</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstation&#39;</span><span class="p">],</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstation&#39;</span><span class="p">],</span>
                  <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstation&#39;</span><span class="p">]]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fdictc</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;fdict&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fdictc</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fdictc</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">:</span>
                
                <span class="n">fd1</span><span class="o">=</span><span class="n">fdictc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">=</span><span class="p">{}</span>
                <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">fd1</span><span class="p">:</span>
                    <span class="n">ff</span><span class="o">=</span><span class="n">ff</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">fv</span><span class="o">=</span><span class="n">ff</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
                        <span class="n">fd</span><span class="p">[</span><span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">fv</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fd</span><span class="p">[</span><span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">fdictc</span><span class="o">=</span><span class="n">fd</span>
            <span class="k">elif</span> <span class="n">fdictc</span><span class="o">==</span><span class="s">&#39;-1&#39;</span><span class="p">:</span>
                <span class="n">fdictc</span><span class="o">=</span><span class="bp">None</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">fdictc</span><span class="o">=</span><span class="bp">None</span>
    <span class="c">#cacherate</span>
    <span class="n">cacherate</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;cacherate&#39;</span><span class="p">]</span>
    
    <span class="c">#list of components to combine</span>
    <span class="n">combcomplst</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;elecori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;magori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">complstp</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;elecori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;magori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">combcomplstr</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrmagori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">complstpr</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrmagori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">dec</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dec&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">dec</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">dec</span><span class="o">=</span><span class="mi">1</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        
        <span class="n">dayslst</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">dstartlst</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">dstoplst</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">drrstartlst</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstart&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">drrstoplst</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">cfilelst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">rrcfilelst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">nread</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">nskipr</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">days</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dayslst</span><span class="p">):</span>
            <span class="n">combcomplst</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;elecori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;magori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">combcomplstr</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrmagori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">days</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">daylst</span><span class="o">=</span><span class="n">days</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">startlst</span><span class="o">=</span><span class="n">dstartlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">stoplst</span><span class="o">=</span><span class="n">dstoplst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">dlst</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">nreadi</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daylst</span><span class="p">)):</span>
                    <span class="n">ddict</span><span class="o">=</span><span class="p">{}</span>
                    <span class="n">ddict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">daylst</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
                    <span class="n">ddict</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">startlst</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
                    <span class="n">ddict</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">stoplst</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">ddict</span><span class="p">[</span><span class="s">&#39;filt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;filtered&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">dlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ddict</span><span class="p">)</span>
                    <span class="n">nreadi</span><span class="o">+=</span><span class="nb">float</span><span class="p">(</span><span class="n">ddict</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">ddict</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">nreadi</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nreadi</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span>
                <span class="n">cfilelsti</span><span class="p">,</span><span class="n">fileslsti</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">combineFiles</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span>
                                                    <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">],</span>
                                                    <span class="n">dlst</span><span class="p">,</span><span class="n">cacherate</span><span class="p">,</span>
                                                    <span class="n">complst</span><span class="o">=</span><span class="n">combcomplst</span><span class="p">,</span>
                                                    <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span><span class="n">fdict</span><span class="o">=</span><span class="n">fdictc</span><span class="p">)</span>
                <span class="c">#remote reference</span>
                <span class="k">if</span> <span class="n">rrstation</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">!=</span><span class="n">station</span><span class="p">:</span>
                    <span class="n">rrstartlst</span><span class="o">=</span><span class="n">drrstartlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">rrstoplst</span><span class="o">=</span><span class="n">drrstoplst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                    <span class="n">rrdlst</span><span class="o">=</span><span class="p">[]</span>
                    <span class="c">#nreadr=0</span>
                    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daylst</span><span class="p">)):</span>
                        <span class="n">rrddict</span><span class="o">=</span><span class="p">{}</span>
                        <span class="n">rrddict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">daylst</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
                        <span class="n">rrddict</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rrstartlst</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
                        <span class="n">rrddict</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rrstoplst</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
                        <span class="k">try</span><span class="p">:</span>
                           <span class="n">rrddict</span><span class="p">[</span><span class="s">&#39;filt&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrfiltered&#39;</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="k">pass</span>
                        <span class="n">rrdlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rrddict</span><span class="p">)</span>
                        
                    <span class="n">rrcfilelsti</span><span class="p">,</span><span class="n">rrfileslsti</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">combineFiles</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span>
                                                            <span class="n">rrstation</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                            <span class="n">rrdlst</span><span class="p">,</span>
                                                            <span class="n">cacherate</span><span class="p">,</span>
                                                            <span class="n">complst</span><span class="o">=</span><span class="n">combcomplstr</span><span class="p">,</span>
                                                            <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
                                                            <span class="n">fdict</span><span class="o">=</span><span class="n">fdictc</span><span class="p">)</span>
                    <span class="c">#get number of points to skip for remote reference</span>
                    <span class="n">nskipri</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span>\
                            <span class="nb">float</span><span class="p">(</span><span class="n">rrdlst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;start&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span><span class="o">*</span>\
                           <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rrcfilelsti</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">cfile</span> <span class="ow">in</span> <span class="n">cfilelsti</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">rcomp</span> <span class="ow">in</span> <span class="n">combcomplstr</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">cfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">rcomp</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">rrcfilelsti</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span>
                    <span class="n">nskipri</span><span class="o">=</span><span class="mi">0</span> 
            <span class="c">#if multiple files but not continuous.  </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">day</span><span class="o">=</span><span class="n">days</span>
                <span class="n">start</span><span class="o">=</span><span class="n">dstartlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">stop</span><span class="o">=</span><span class="n">dstoplst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">filt</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;filtered&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">filt</span><span class="o">=</span><span class="s">&#39;&#39;</span>
                        
                <span class="c">#get number of points to read</span>
                <span class="n">nreadi</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span>\
                        <span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">dec</span><span class="p">)</span>
                
                <span class="c">#make a directory path</span>
                <span class="k">if</span> <span class="n">filt</span><span class="o">!=</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">cdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span><span class="n">station</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">filt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span><span class="n">station</span><span class="p">,</span><span class="n">day</span><span class="p">)</span>
                <span class="c">#combine files</span>
                <span class="c">#print &#39;combining &#39;,cdirpath,start,stop,cacherate,combcomplst,dec</span>
                <span class="n">cfilelsti</span><span class="p">,</span><span class="n">fileslsti</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">combineFewFiles</span><span class="p">(</span><span class="n">cdirpath</span><span class="p">,</span>
                                                       <span class="n">station</span><span class="p">,</span>
                                                       <span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">cacherate</span><span class="p">,</span>
                                                       <span class="n">complst</span><span class="o">=</span><span class="n">combcomplst</span><span class="p">,</span>
                                                       <span class="n">d</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span><span class="n">fdict</span><span class="o">=</span><span class="n">fdictc</span><span class="p">)</span>

                <span class="c">#remote reference</span>
                <span class="k">if</span> <span class="n">rrstation</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">!=</span><span class="n">station</span><span class="p">:</span>
                    <span class="n">rrday</span><span class="o">=</span><span class="n">days</span>
                    <span class="n">rrstart</span><span class="o">=</span><span class="n">drrstartlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">rrstop</span><span class="o">=</span><span class="n">drrstoplst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">filt</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrfiltered&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">filt</span><span class="o">=</span><span class="s">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">filt</span><span class="o">!=</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">rrcdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span>
                                                <span class="n">rrstation</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">rrday</span><span class="p">,</span><span class="n">filt</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rrcdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span>
                                                <span class="n">rrstation</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">rrday</span><span class="p">)</span>  
        
                    <span class="n">rrcfilelsti</span><span class="p">,</span><span class="n">rrfileslsti</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">combineFewFiles</span><span class="p">(</span><span class="n">rrcdirpath</span><span class="p">,</span>
                                                               <span class="n">rrstation</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                                                               <span class="n">rrstart</span><span class="p">,</span><span class="n">rrstop</span><span class="p">,</span>
                                                               <span class="n">cacherate</span><span class="p">,</span>
                                                               <span class="n">complst</span><span class="o">=</span>
                                                               <span class="n">combcomplstr</span><span class="p">,</span>
                                                               <span class="n">d</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
                                                               <span class="n">fdict</span><span class="o">=</span><span class="n">fdictc</span><span class="p">)</span>
                    <span class="c">#get number of points to skip for remote reference</span>
                    <span class="n">nskipri</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">dstartlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span>\
                                <span class="nb">float</span><span class="p">(</span><span class="n">drrstartlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span><span class="o">*</span>\
                                <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">))))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rrcfilelsti</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">cfile</span> <span class="ow">in</span> <span class="n">cfilelsti</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">rcomp</span> <span class="ow">in</span> <span class="n">combcomplstr</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">cfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">rcomp</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">rrcfilelsti</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span>
                    <span class="n">nskipri</span><span class="o">=</span><span class="mi">0</span>  
            <span class="c">#append files to a list</span>
            <span class="n">cfilelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfilelsti</span><span class="p">)</span>
            <span class="n">rrcfilelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rrcfilelsti</span><span class="p">)</span>
            <span class="n">nread</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nreadi</span><span class="p">)</span>
            <span class="n">nskipr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nskipri</span><span class="p">)</span>                                        
    <span class="c">#else normal input for one day    </span>
    <span class="k">else</span><span class="p">:</span>  
        <span class="c">#dirpath for timeseries</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cdirpath</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;cdirpath&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">],</span>
                                      <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">],</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;filtered&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">cdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">],</span>
                                      <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">])</span>
        <span class="c">#dirpath for remote reference station </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cdirpathr</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;cdirpathr&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cdirpathr</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span><span class="n">rrstation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">],</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrfiltered&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">cdirpathr</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dirpath&#39;</span><span class="p">],</span><span class="n">rrstation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">])</span>
        
        <span class="c">#start and stop time for both data and remote reference time series</span>
        <span class="n">stime</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span>
        <span class="n">etime</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">]</span>
        
        <span class="n">stimer</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstart&#39;</span><span class="p">]</span>
        <span class="n">etimer</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrstop&#39;</span><span class="p">]</span>
    
        <span class="c">#Combine time series files</span>
        <span class="n">cfilelst</span><span class="p">,</span><span class="n">fileslst</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">combineFewFiles</span><span class="p">(</span><span class="n">cdirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">stime</span><span class="p">,</span><span class="n">etime</span><span class="p">,</span>
                                             <span class="n">cacherate</span><span class="p">,</span><span class="n">complst</span><span class="o">=</span><span class="n">combcomplst</span><span class="p">,</span>
                                             <span class="n">d</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span><span class="n">fdict</span><span class="o">=</span><span class="n">fdictc</span><span class="p">)</span>
        
        <span class="c">#combine remote reference files</span>
        <span class="k">if</span> <span class="n">rrstation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="n">station</span><span class="p">:</span>
            <span class="n">rrcfilelst</span><span class="p">,</span><span class="n">rrfileslst</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">combineFewFiles</span><span class="p">(</span><span class="n">cdirpathr</span><span class="p">,</span><span class="n">rrstation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">stimer</span><span class="p">,</span><span class="n">etimer</span><span class="p">,</span><span class="n">cacherate</span><span class="p">,</span>
                                                     <span class="n">complst</span><span class="o">=</span><span class="n">combcomplstr</span><span class="p">,</span>
                                                     <span class="n">d</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span><span class="n">fdict</span><span class="o">=</span><span class="n">fdictc</span><span class="p">)</span>
            <span class="c">#get number of points to skip for remote reference</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">dec</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span> 
            
            <span class="n">nskipr</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">stime</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">stimer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span><span class="o">*</span>\
                <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">)))</span>                                                          
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rrcfilelst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">cfile</span> <span class="ow">in</span> <span class="n">cfilelst</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rcomp</span> <span class="ow">in</span> <span class="n">combcomplstr</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">rcomp</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">rrcfilelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span>
            <span class="n">nskipr</span><span class="o">=</span><span class="mi">0</span>
             
                        
        <span class="c">#get number of points to read, length of fft and maximum decimations</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">dec</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>        
        <span class="n">nread</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">3600</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">))</span><span class="o">*</span>\
             <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">etime</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">stime</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])))</span>
        

    <span class="c">#sampling frequency</span>
    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dec&#39;</span><span class="p">])</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dec&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">deltat</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;dec&#39;</span><span class="p">]))</span> 
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nfft</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c">#get max length of time window</span>
        <span class="n">npow</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nread</span><span class="p">)))</span><span class="o">-</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">npow</span><span class="o">&gt;</span><span class="mi">6</span><span class="p">:</span>
            <span class="n">nfftpow</span><span class="o">=</span><span class="mi">17</span>
        <span class="k">elif</span> <span class="n">npow</span><span class="o">&gt;=</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">npow</span><span class="o">&lt;=</span><span class="mi">6</span><span class="p">:</span>
            <span class="n">nfftpow</span><span class="o">=</span><span class="mi">16</span>
        <span class="k">elif</span> <span class="n">npow</span><span class="o">&gt;=-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">npow</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">nfftpow</span><span class="o">=</span><span class="mi">15</span>
        <span class="k">elif</span> <span class="n">npow</span><span class="o">&gt;=-</span><span class="mi">6</span> <span class="ow">and</span> <span class="n">npow</span><span class="o">&lt;-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">nfftpow</span><span class="o">=</span><span class="mi">14</span>
        <span class="k">elif</span> <span class="n">npow</span><span class="o">&gt;=-</span><span class="mi">6</span> <span class="ow">and</span> <span class="n">npow</span><span class="o">&lt;-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">nfftpow</span><span class="o">=</span><span class="mi">13</span>
        <span class="n">nfft</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="n">nfftpow</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nsctmax</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c">#get max length of time window</span>
        <span class="n">npow</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nread</span><span class="p">)))</span><span class="o">-</span><span class="mi">16</span><span class="p">)</span>
        <span class="c">#get max number of windows</span>
        <span class="n">nsctmax</span><span class="o">=</span><span class="n">nfftpow</span><span class="o">-</span><span class="mi">4</span>
            
    
    <span class="c">#make sure the cfilelst is in order according to complst</span>
    <span class="n">cfarray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cfilelst</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nds</span><span class="p">,</span><span class="n">ndf</span><span class="o">=</span><span class="n">cfarray</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">nds</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">if</span> <span class="n">nds</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">cflst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstp</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cfile</span> <span class="ow">in</span> <span class="n">cfarray</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">):</span>
                    <span class="n">cflst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cflst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nds</span><span class="p">):</span>
            <span class="n">cfnlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstp</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cfile</span> <span class="ow">in</span> <span class="n">cfarray</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>    
                    <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">cfile</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">):</span>
                        <span class="n">cfnlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span>
            <span class="n">cflst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfnlst</span><span class="p">)</span>
    
    <span class="c">#make sure the rrcfilelst is in order according to complst</span>
    <span class="n">rrcfarray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rrcfilelst</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rrnds</span><span class="p">,</span><span class="n">rrndf</span><span class="o">=</span><span class="n">rrcfarray</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">rrnds</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">if</span> <span class="n">rrnds</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">rrcflst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">compr</span> <span class="ow">in</span> <span class="n">complstpr</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rcfile</span> <span class="ow">in</span> <span class="n">rrcfarray</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">rcfile</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">compr</span><span class="p">):</span>
                    <span class="n">rrcflst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rcfile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rrcflst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rrnds</span><span class="p">):</span>
            <span class="n">rrcfnlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">compr</span> <span class="ow">in</span> <span class="n">complstpr</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rcfile</span> <span class="ow">in</span> <span class="n">rrcfarray</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>    
                    <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">rcfile</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">compr</span><span class="p">):</span>
                        <span class="n">rrcfnlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rcfile</span><span class="p">)</span>
            <span class="n">rrcflst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rrcfnlst</span><span class="p">)</span>    
    
    <span class="n">processingdict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cflst</span>
    <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rrcflst</span>
    <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">station</span>
    <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;deltat&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">deltat</span>
    <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nfft</span>
    <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nsctmax</span>
    <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nread&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nread</span>
    
    <span class="k">for</span> <span class="n">pkey</span> <span class="ow">in</span> <span class="n">prepdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">processingdict</span><span class="p">[</span><span class="n">pkey</span><span class="p">]</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="n">pkey</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nskipr</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">]):</span>
                <span class="n">nskipr</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">]))]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">nskipr</span><span class="o">=</span><span class="n">nskipr</span>
        <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nskipr</span>

    <span class="k">return</span> <span class="n">processingdict</span>
    
    </div>
<div class="viewcode-block" id="writeScriptfile"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.writeScriptfile">[docs]</a><span class="k">def</span> <span class="nf">writeScriptfile</span><span class="p">(</span><span class="n">processingdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writeScriptfile(processingdict will write a script file for BIRRP using </span>
<span class="sd">    info in processingdict which is a dictionary with keys:</span>
<span class="sd">        cfilelst = list of combined filenames (full path) ordered as:</span>
<span class="sd">            [electric N, electric E, mag N, mag E, mag Z] can omit Z if not </span>
<span class="sd">            measured </span>
<span class="sd">        rrcfilelst = list of combined remote reference filenames (full </span>
<span class="sd">            path) ordered as: [mag N, mag E, mag Z] omit z if not measured </span>
<span class="sd">        station = station name</span>
<span class="sd">        magtype = bb for broadband lp for longperiod</span>
<span class="sd">        any BIRRP parameters you desire, (if not input default values will be </span>
<span class="sd">        assigned) namely:</span>
<span class="sd">            ilev = processing mode 0 for basic and 1 for advanced RR-2 stage</span>
<span class="sd">            nout = Number of Output time series (2 or 3-&gt; for BZ)</span>
<span class="sd">            ninp = Number of input time series for E-field (1,2,3) </span>
<span class="sd">            nref = Number of reference channels (2 for MT)</span>
<span class="sd">            nrr = bounded remote reference (0) or 2 stage bounded influence (1)</span>
<span class="sd">            tbw = Time bandwidth for Sepian sequence</span>
<span class="sd">            deltat = Sampling rate (+) for (s), (-) for (Hz)</span>
<span class="sd">            nfft = Length of FFT (should be even)</span>
<span class="sd">            nsctinc = section increment divisor (2 to divide by half)</span>
<span class="sd">            nsctmax = Number of windows used in FFT</span>
<span class="sd">            nf1 = 1st frequency to extract from FFT window (&gt;=3)</span>
<span class="sd">            nfinc = frequency extraction increment </span>
<span class="sd">            nfsect = number of frequencies to extract</span>
<span class="sd">            mfft = AR filter factor, window divisor (2 for half)</span>
<span class="sd">            uin = Quantile factor determination</span>
<span class="sd">            ainlin =  Residual rejection factor low end (usually 0)</span>
<span class="sd">            ainuin = Residual rejection factor high end (.95-.99)</span>
<span class="sd">            c2threshb = Coherence threshold for magnetics (0 if undesired)</span>
<span class="sd">            c2threshe = Coherence threshold for electrics (0 if undesired)</span>
<span class="sd">            nz= Threshold for Bz (0=separate from E, 1=E threshold, 2=E and B) </span>
<span class="sd">                Input if 3 B components else None</span>
<span class="sd">            c2thresh1= Squared coherence for Bz, input if NZ=0, Nout=3</span>
<span class="sd">            perlo = longest period to apply coherence threshold over</span>
<span class="sd">            perhi = shortes period to apply coherence threshold over</span>
<span class="sd">            ofil = Output file root(usually three letters, can add full path)</span>
<span class="sd">            nlev = Output files (0=Z; 1=Z,qq; 2=Z,qq,w; 3=Z,qq,w,d)</span>
<span class="sd">            nprej = number of frequencies to reject</span>
<span class="sd">            prej = frequencies to reject (+) for period, (-) for frequency</span>
<span class="sd">            npcs = Number of independent data to be processed (1 for one </span>
<span class="sd">                   segement)</span>
<span class="sd">            nar = Prewhitening Filter (3&lt; &gt;15) or 0 if not desired&#39;,</span>
<span class="sd">            imode = Output file mode (0=ascii; 1=binary; 2=headerless ascii; </span>
<span class="sd">                    3=ascii in TS mode&#39;,</span>
<span class="sd">            jmode = nput file mode (0=user defined; 1=start time </span>
<span class="sd">                    YYYY-MM-DD HH:MM:SS)&#39;,</span>
<span class="sd">            nread = Number of points to be read for each data set  </span>
<span class="sd">                    (if segments&gt;1 -&gt; npts1,npts2...)&#39;,</span>
<span class="sd">            nfil = Filter parameters (0=none; &gt;0=input parameters; &lt;0=filename</span>
<span class="sd">            nskip = Skip number of points in time series (0) if no skip, </span>
<span class="sd">                    (if segements &gt;1 -&gt; input1,input2...)&#39;,</span>
<span class="sd">            nskipr = Number of points to skip over (0) if none,</span>
<span class="sd">                     (if segements &gt;1 -&gt; input1,input2...)&#39;,</span>
<span class="sd">            thetae = Rotation angles for electrics (relative to geomagnetic </span>
<span class="sd">                     North)(N,E,rot)&#39;,</span>
<span class="sd">            thetab = Rotation angles for magnetics (relative to geomagnetic </span>
<span class="sd">                     North)(N,E,rot)&#39;,</span>
<span class="sd">            thetar = Rotation angles for calculation (relative to geomagnetic </span>
<span class="sd">                     North)(N,E,rot)&#39;</span>
<span class="sd">                     </span>
<span class="sd">        =&gt; see BIRRP Manual for more details on the parameters</span>
<span class="sd">        =&gt; see A. D. Chave and D. J. Thomson [1989,2003,2004] for more</span>
<span class="sd">            information on Bounded influence and robust processing.</span>
<span class="sd">    </span>
<span class="sd">    ouputs:</span>
<span class="sd">        scriptfile (full path typically(\dirpath\station\day\CombSTtoETddec\BF)</span>
<span class="sd">        birrpdict = dictionary of all birrp parameters in script file</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
     
    <span class="c">#===================================================================</span>
    <span class="c"># Write a script file for BIRRP, Chave et al. [2004]            </span>
    <span class="c">#===================================================================</span>
    <span class="c">#print processingdict</span>
    <span class="c">#compute how many timeseries and days there are </span>
    <span class="c">#ndf = # of files per day</span>
    <span class="c">#nds = # of day</span>
    <span class="n">cfarray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">])</span>    
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nds</span><span class="p">,</span><span class="n">ndf</span><span class="o">=</span><span class="n">cfarray</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">ndf</span><span class="o">=</span><span class="n">cfarray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nds</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">if</span> <span class="n">nds</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">bfpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="s">&#39;BF&#39;</span><span class="p">)</span>
        <span class="n">npcs</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">nds</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">nds</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">npcs</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  
        
        <span class="n">bfpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="s">&#39;BF&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">bfpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="s">&#39;BF&#39;</span><span class="p">)</span>
        <span class="n">npcs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nds</span><span class="p">)</span>
    <span class="c">#make a directory to put BIRRP Files (BF)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bfpath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">bfpath</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Made directory: &#39;</span><span class="p">,</span> <span class="n">bfpath</span>
<span class="c">#    else:</span>
<span class="c">#        nruns=len([folder for folder in os.listdir(bfpath) if bfpath.find(&#39;.&#39;==-1)])</span>
<span class="c">#        bfpath=os.path.join(bfpath,&#39;Run{0}&#39;.format(nruns+1))</span>
    <span class="c">#output file stem, full path</span>
    <span class="n">ofil</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">])</span> 
    
    <span class="c">#are the frequencies ok always y in 0 interactive mode</span>
    <span class="n">yesno</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
    
    
    <span class="c">#see if user input some values if not put default ones in</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">magtype</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">magtype</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;input magnetometer type broadband (bb), long period(lp)&#39;</span><span class="p">)</span>

    <span class="c">#mode to process: default is basic</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ilev</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">ilev</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="c">#number of output channels</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nds</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndf</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
                <span class="n">nout</span><span class="o">=</span><span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nout</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">ndf</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
            <span class="n">nout</span><span class="o">=</span><span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nout</span><span class="o">=</span><span class="mi">2</span>
    
    <span class="c">#number of input channels default is 2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ninp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">ninp</span><span class="o">=</span><span class="mi">2</span>
        
    <span class="c">#time bandwidth window size            </span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tbw</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">tbw</span><span class="o">=</span><span class="mi">2</span>
        
    <span class="c">#------------Options for Advanced mode-------------------------</span>
    <span class="k">if</span> <span class="n">ilev</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="c">#Advanced: number of remote reference channels</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nref</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nref&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nref</span><span class="o">=</span><span class="mi">2</span>
            
        <span class="c">#Advanced: remote reference type processing</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nrr</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nrr&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nrr</span><span class="o">=</span><span class="mi">1</span>            
            
        <span class="c">#Advanced: magnetic coherence threshold</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">c2threshb</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;c2threshb&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">c2threshb</span><span class="o">=</span><span class="mi">0</span>
            
        <span class="c">#Advanced: window increment divisor</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nsctinc</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nsctinc&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nsctinc</span><span class="o">=</span><span class="mi">2</span>
            
        <span class="c">#first frequency to extract</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nf1</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nf1&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nf1</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tbw</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span>
        
        <span class="c">#frequency increment</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nfinc</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nfinc&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nfinc</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tbw</span><span class="p">)</span>
            
        <span class="c">#number of frequencies to extract</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nfsect</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nfsect&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nfsect</span><span class="o">=</span><span class="mi">2</span>
            
        <span class="c">#number AR filter is divided by</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mfft</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;mfft&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">mfft</span><span class="o">=</span><span class="mi">2</span>
        
        <span class="c">#Advanced: lower bound of leverage point rejection</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ainlin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;ainlin&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">ainlin</span><span class="o">=.</span><span class="mo">0001</span>
        
        <span class="c">#Advanced: coherence threshold low period</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">perlo</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;perlo&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">perlo</span><span class="o">=</span><span class="mi">1000</span>
            
        <span class="c">#Advanced: coherenct threshold high period</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">perhi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;perhi&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">perhi</span><span class="o">=.</span><span class="mo">001</span>
            
        <span class="c">#Advanced:  number of frequencies to reject</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nprej</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nprej&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">nprej</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="c">#Advanced</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prej</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;prej&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">prej</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="n">prej</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">prej</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">nprej</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">prej</span><span class="p">):</span>
                <span class="n">nprej</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">prej</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">prej</span><span class="o">=</span><span class="p">[]</span>
            
    <span class="c">#---------------------Options for Basic Mode--------------------------</span>
    
    <span class="c">#time series sampling rate</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">deltat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;deltat&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">deltat</span><span class="o">=-</span><span class="mi">100</span>
    
    <span class="c">#max length of fft window    </span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nfft</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">nfft</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span>

    <span class="c">#maximum number of sections</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nsctmax</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">nsctmax</span><span class="o">=</span><span class="mi">12</span>
    
    <span class="c">#quantile factor            </span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">uin</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="c">#upper bound of leverage point rejection</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ainuin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">ainuin</span><span class="o">=.</span><span class="mi">9999</span>
 
    <span class="c">#electric channel coherence threshold</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c2threshe</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">c2threshe</span><span class="o">=</span><span class="mi">0</span>

    <span class="c">#Bz coherency threshold mode</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nz</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nout</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">nz</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nz</span><span class="o">=</span><span class="bp">None</span>
    
    <span class="c">#Bz coherence threshold</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">c2threshe1</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nout</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">c2threshe1</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c2threshe1</span><span class="o">=</span><span class="bp">None</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nlev</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">nlev</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">nread</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nread&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">nread</span><span class="o">=</span><span class="mi">1440000</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nar</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">nar</span><span class="o">=</span><span class="mi">5</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">imode</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">imode</span><span class="o">=</span><span class="mi">0</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">jmode</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">jmode</span><span class="o">=</span><span class="mi">0</span>    
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nfil</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">nfil</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nskip</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nskip&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nds</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">nskip</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nds</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nskip</span><span class="o">=</span><span class="mi">0</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nskipr</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span>
        <span class="c">#print &#39;1) &#39;, nskipr</span>
        <span class="k">if</span> <span class="n">nds</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">nskipr</span><span class="o">=</span><span class="n">nskipr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nskipr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">pass</span>
    
            <span class="k">else</span><span class="p">:</span>        
                <span class="n">nskipr</span><span class="o">=</span><span class="p">[</span><span class="n">nskipr</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nds</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nds</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">nskipr</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nskipr</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nds</span><span class="p">)]</span>
            <span class="c">#print &#39;5) &#39;,nskipr</span>
    
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">thetae</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c">#rotation angles</span>
        <span class="k">if</span> <span class="n">magtype</span><span class="o">==</span><span class="s">&#39;bb&#39;</span><span class="p">:</span>
            <span class="n">thetae</span><span class="o">=</span><span class="s">&#39;0,90,180&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thetae</span><span class="o">=</span><span class="s">&#39;0,90,0&#39;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">thetab</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">thetab</span><span class="o">=</span><span class="s">&#39;0,90,0&#39;</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">thetaf</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">thetaf</span><span class="o">=</span><span class="s">&#39;0,90,0&#39;</span>

    <span class="c">#===================================================================</span>
    <span class="c"># Write values to a .script file</span>
    <span class="c">#===================================================================</span>
    <span class="c">#print &#39;+++ &#39;,nskipr</span>
    <span class="c">#print ndf,nds</span>
    <span class="c">#write to a file</span>
    <span class="n">scriptfile</span><span class="o">=</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.script&#39;</span>
    <span class="n">fid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ilev</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ilev</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nout</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ninp</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tbw</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deltat</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d},{1:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nfft</span><span class="p">,</span><span class="n">nsctmax</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;y </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.5f},{1:.5f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uin</span><span class="p">,</span><span class="n">ainuin</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe</span><span class="p">))</span>
        <span class="c">#parameters for bz component if ninp=3</span>
        <span class="k">if</span> <span class="n">nout</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c2threshe</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nz</span><span class="p">))</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlev</span><span class="p">))</span>
        
    <span class="k">elif</span> <span class="n">ilev</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Writing Advanced mode&#39;</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ilev</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nout</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ninp</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nref</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nref</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">nrrlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">rrlst</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">rrlst</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">]])</span>
            <span class="n">nr3</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nrrlst</span><span class="o">==</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nr2</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nrrlst</span><span class="o">==</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d},{1:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nr3</span><span class="p">,</span><span class="n">nr2</span><span class="p">))</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nrr</span><span class="p">))</span>
        <span class="c">#if remote referencing</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">nrr</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tbw</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deltat</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d},{1:.2g},{2:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nfft</span><span class="p">,</span><span class="n">nsctinc</span><span class="p">,</span><span class="n">nsctmax</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d},{1:.2g},{2:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nf1</span><span class="p">,</span><span class="n">nfinc</span><span class="p">,</span><span class="n">nfsect</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;y </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.2g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mfft</span><span class="p">))</span>        
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.5g},{1:.5g},{2:.5g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uin</span><span class="p">,</span><span class="n">ainlin</span><span class="p">,</span><span class="n">ainuin</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe</span><span class="p">))</span>
            <span class="c">#parameters for bz component if ninp=3</span>
            <span class="k">if</span> <span class="n">nout</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c2threshe</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nz</span><span class="p">))</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">c2threshe1</span><span class="o">!=</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">c2threshe</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.6g},{1:.6g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perlo</span><span class="p">,</span><span class="n">perhi</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c2threshe</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.6g},{1:.6g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perlo</span><span class="p">,</span><span class="n">perhi</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlev</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nprej</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">nprej</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">prej</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">prej</span><span class="o">=</span><span class="p">[</span><span class="n">prej</span><span class="p">]</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="s">&#39;{0:.5g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">prej</span><span class="p">])</span>
        <span class="c">#if 2 stage processing</span>
        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">nrr</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.5g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tbw</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.5g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deltat</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d},{1:.2g},{2:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nfft</span><span class="p">,</span><span class="n">nsctinc</span><span class="p">,</span><span class="n">nsctmax</span><span class="p">))</span>        
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d},{1:.2g},{2:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nf1</span><span class="p">,</span><span class="n">nfinc</span><span class="p">,</span><span class="n">nfsect</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;y </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.2g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mfft</span><span class="p">))</span>        
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.5g},{1:.5g},{2:.5g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uin</span><span class="p">,</span><span class="n">ainlin</span><span class="p">,</span><span class="n">ainuin</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshb</span><span class="p">))</span>        
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">nout</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c2threshb</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">c2threshe</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nz</span><span class="p">))</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2threshe1</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">c2threshb</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">c2threshe</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">c2threshb</span><span class="o">!=</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">c2threshe</span><span class="o">!=</span><span class="mf">0.0</span><span class="p">:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.6g},{1:.6g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">perlo</span><span class="p">,</span><span class="n">perhi</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nlev</span><span class="p">))</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nprej</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">nprej</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">prej</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">prej</span><span class="o">=</span><span class="p">[</span><span class="n">prej</span><span class="p">]</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="s">&#39;{0:.5g} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">prej</span><span class="p">])</span>
        
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">npcs</span><span class="p">))</span>    
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nar</span><span class="p">))</span>    
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">imode</span><span class="p">))</span>    
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">jmode</span><span class="p">))</span>    
    <span class="c">#write in filenames </span>
    <span class="k">if</span> <span class="n">npcs</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nread</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c">#write filenames</span>
        <span class="k">for</span> <span class="n">tfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nfil</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskip</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nfil</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskipr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">npcs</span><span class="p">):</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nread</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>            
            <span class="c">#write filenames</span>
            <span class="k">for</span> <span class="n">tfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">][</span><span class="n">nn</span><span class="p">]:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskip</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">][</span><span class="n">nn</span><span class="p">]:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskipr</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nread</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nread</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nread</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c">#write filenames</span>
        <span class="k">if</span> <span class="n">nds</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">]:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nfil</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nskip</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskip</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskip</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">]:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nfil</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nskipr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskipr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskipr</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nfil</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nskip</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskip</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskip</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nfil</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nskipr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskipr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nskipr</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#write rotation angles</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">thetae</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">thetab</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">fid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">thetaf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="p">))</span>    
    <span class="n">fid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">birrpdict</span><span class="o">=</span><span class="p">{}</span>
    
    <span class="k">if</span> <span class="n">ilev</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ilev</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nout</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ninp</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tbw</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nfft</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nsctmax</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">uin</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ainuin</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">c2threshe</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nz</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">c2threshe1</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ofil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ofil</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nlev</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nar</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imode</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">jmode</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nfil</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nskip&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nskip</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nskipr</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">thetae</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">thetab</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">thetaf</span>
    <span class="k">elif</span> <span class="n">ilev</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ilev</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nout</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ninp</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nref&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nref</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nrr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nrr</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tbw</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nfft</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nsctinc&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nsctinc</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nsctmax</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nf1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nf1</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfinc&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nfinc</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfsect&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nfsect</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">uin</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ainlin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ainlin</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ainuin</span>
        <span class="k">if</span> <span class="n">nrr</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshb&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">c2threshb</span>
            <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">c2threshe</span>
            <span class="k">if</span> <span class="n">c2threshe</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">c2threshb</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;perlo&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">perlo</span>
                <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;perhi&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">perhi</span>
        <span class="k">elif</span> <span class="n">nrr</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshb&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">c2threshe</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nprej&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nprej</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;prej&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">prej</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">c2threshe1</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ofil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ofil</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nlev</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nar</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imode</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">jmode</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nfil</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nskip&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nskip</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">nskipr</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">thetae</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">thetab</span>
        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">thetaf</span>

    <span class="k">print</span> <span class="s">&#39;Made .script file: &#39;</span><span class="o">+</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.script&#39;</span>
    
    <span class="k">return</span> <span class="n">scriptfile</span><span class="p">,</span><span class="n">birrpdict</span>
    </div>
<div class="viewcode-block" id="callBIRRP"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.callBIRRP">[docs]</a><span class="k">def</span> <span class="nf">callBIRRP</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">,</span><span class="n">birrploc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    callBIRRP(scriptfile,birrploc) will call BIRRP from a command window and </span>
<span class="sd">    run the script file provided.</span>
<span class="sd">    </span>
<span class="sd">    Inputs: </span>
<span class="sd">        scriptfile = full path script file</span>
<span class="sd">        birrploc = path to BIRRP on your computer, can be the full path to a </span>
<span class="sd">                   BIRRP executable C:\BIRRP\birrp5.exe</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        bfpath = path to BIRRP output files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#if the birrploc is just a path to the directory</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">birrploc</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>

        <span class="n">birrpstr</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">birrploc</span><span class="p">,</span><span class="s">&#39;birrp5&lt;&#39;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">birrploc</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.exe&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">birrpstr</span><span class="o">=</span><span class="n">birrploc</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;&lt;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">birrpstr</span><span class="o">=</span><span class="n">birrploc</span>
    <span class="c">#----Run BIRRP---</span>
    <span class="n">stimeburp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">station</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">)[:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&#39;Started BIRRP at: &#39;</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span> 
    
    <span class="n">subprocess</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">birrpstr</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">scriptfile</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
    
    <span class="c">#print run time</span>
    <span class="n">etimeburp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">dtburp</span><span class="o">=</span><span class="n">etimeburp</span><span class="o">-</span><span class="n">stimeburp</span>
    
    <span class="k">print</span> <span class="s">&#39;BIRRP Run time (m:s) for &#39;</span> <span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;: </span><span class="si">%.0f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">dtburp</span><span class="o">/</span><span class="mi">60</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;:</span><span class="si">%2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">dtburp</span><span class="p">,</span><span class="mi">60</span><span class="p">)))</span>
    
    <span class="n">bfpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bfpath</span>
    </div>
<div class="viewcode-block" id="convertBIRRPoutputs"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.convertBIRRPoutputs">[docs]</a><span class="k">def</span> <span class="nf">convertBIRRPoutputs</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">rrstation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">bbfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">birrpdict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">edipath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convertBIRRPoutputs(bfpath,stationinfodict) will take the outputs of BIRRP</span>
<span class="sd">    and manipulate them into .edi, .dat, .coh, .imp files as well as generate </span>
<span class="sd">    plots of apparent resistivity and phase and coherence.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        bfpath = path to BIRRP output files</span>
<span class="sd">        stationinfodict = dictionary containing pertanent information with keys:</span>
<span class="sd">            </span>
<span class="sd">        station = station to process</span>
<span class="sd">        rrstation = remote reference station name</span>
<span class="sd">        bbfile = broad band calibration file path</span>
<span class="sd">        birrpdict = dictionary of birrp parameters used</span>
<span class="sd">        ffactor = scaling factor for apparent resistivities and phase</span>
<span class="sd">        edipath = path to save edifile to</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        cohfile</span>
<span class="sd">        datfile</span>
<span class="sd">        edifile</span>
<span class="sd">        impfile</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">spath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">bfpath</span><span class="p">)</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">day</span><span class="o">=</span><span class="bp">None</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">spath</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;t&#39;</span><span class="p">:</span>
        <span class="n">st</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">spath</span><span class="p">)[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">st</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">while</span> <span class="n">day</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">count</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dayf</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">spath</span><span class="p">))</span>
            <span class="n">day</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">spath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
            <span class="n">day</span><span class="o">=</span><span class="bp">None</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">day</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    
    <span class="n">brpexcept</span><span class="o">=</span><span class="s">&#39;BIRRP Ran incorrectly check script file&#39;</span>
    <span class="k">if</span> <span class="n">rrstation</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">rrstation</span><span class="o">=</span><span class="n">station</span>
    <span class="c">#get station info</span>
    <span class="n">statdict</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">getStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">station</span><span class="p">)</span>  

    <span class="c">#try to write a coherence file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cohfile</span><span class="o">=</span><span class="n">writecoh</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">brpexcept</span><span class="o">+</span><span class="s">&#39; did not produce .coh file&#39;</span>
        <span class="n">cohfile</span><span class="o">=</span><span class="s">&#39; &#39;</span>
    
    <span class="c">#try to write an edifile</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifile</span><span class="o">=</span><span class="n">writeedi</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">stationinfofile</span><span class="o">=</span><span class="n">stationinfofile</span><span class="p">,</span>
                         <span class="n">rrstation</span><span class="o">=</span><span class="n">rrstation</span><span class="p">,</span>
                         <span class="n">birrpdict</span><span class="o">=</span><span class="n">birrpdict</span><span class="p">,</span>
                         <span class="n">bbfile</span><span class="o">=</span><span class="n">bbfile</span><span class="p">,</span><span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">brpexcept</span><span class="o">+</span><span class="s">&#39; did not find all files to produce a complete .edi file&#39;</span>
        <span class="n">edifile</span><span class="o">=</span><span class="s">&#39; &#39;</span>
                         
    <span class="n">magtype</span><span class="o">=</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span>
    <span class="n">dlgain</span><span class="o">=</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">]</span>
    <span class="n">egain</span><span class="o">=</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]</span>
    <span class="n">dlen</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ex&#39;</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ey&#39;</span><span class="p">])]</span>
    
    <span class="c">#try to write a dat file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">datfile</span><span class="o">=</span><span class="n">writedat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;.j&#39;</span><span class="p">),</span>
                         <span class="n">egain</span><span class="o">=</span><span class="n">egain</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="n">dlgain</span><span class="p">,</span><span class="n">dlen</span><span class="o">=</span><span class="n">dlen</span><span class="p">,</span>
                         <span class="n">magtype</span><span class="o">=</span><span class="n">magtype</span><span class="p">,</span><span class="n">bbfile</span><span class="o">=</span><span class="n">bbfile</span><span class="p">,</span><span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">,</span>
                         <span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">brpexcept</span><span class="o">+</span><span class="s">&#39; did not produce a .dat file&#39;</span>
        <span class="n">datfile</span><span class="o">=</span><span class="s">&#39; &#39;</span>

    <span class="c">#try to write an imp file    </span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">impfile</span><span class="o">=</span><span class="n">writeimp</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="n">egain</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="n">dlgain</span><span class="p">,</span><span class="n">dlen</span><span class="o">=</span><span class="n">dlen</span><span class="p">,</span>
                         <span class="n">magtype</span><span class="o">=</span><span class="n">magtype</span><span class="p">,</span><span class="n">bbfile</span><span class="o">=</span><span class="n">bbfile</span><span class="p">,</span><span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">,</span>
                         <span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">brpexcept</span><span class="o">+</span><span class="s">&#39; did not produce a .imp file&#39;</span>
        <span class="n">impfile</span><span class="o">=</span><span class="s">&#39; &#39;</span>
    
    <span class="n">stationdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">bfpath</span><span class="p">)</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stationdir</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="n">station</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">count</span><span class="o">&lt;</span><span class="mi">12</span><span class="p">:</span>
        <span class="n">stationdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">)</span>
        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>    
        <span class="c">#make a folder to put all .edi files into</span>
        <span class="k">if</span> <span class="n">edipath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">edipath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">),</span><span class="s">&#39;EDIfiles&#39;</span><span class="p">)</span>
        <span class="c">#make folder if it doesn&#39;t exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">edipath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Made path: &#39;</span><span class="o">+</span><span class="n">edipath</span>
        
        <span class="c">#copy .edi file to common folder</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">day</span><span class="o">+</span><span class="n">st</span><span class="o">+</span><span class="s">&#39;.edi&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;No edi file&#39;</span>

    <span class="k">return</span> <span class="n">cohfile</span><span class="p">,</span><span class="n">edifile</span><span class="p">,</span><span class="n">datfile</span><span class="p">,</span><span class="n">impfile</span>
    </div>
<div class="viewcode-block" id="plotBFfiles"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.plotBFfiles">[docs]</a><span class="k">def</span> <span class="nf">plotBFfiles</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="n">cohfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">cfilelst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span>
                <span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">,</span><span class="n">sdict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plotFiles(edifile,cohfile,cfilelst) will plot the apparent resisitivty</span>
<span class="sd">    and phase calculated from edifile as 2 seperate plots for the different </span>
<span class="sd">    polarizations.  It will plot the coherency between components and if input</span>
<span class="sd">    will plot the time series.</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        edifile = full path to edifile</span>
<span class="sd">        cohfile = full path to coherence file</span>
<span class="sd">        cfilelst = list of paths to combined files</span>
<span class="sd">        saveyn= &#39;y&#39; to save plots, &#39;n&#39; to not save plots</span>
<span class="sd">        seeyn = &#39;y&#39; if you want to see the plots, &#39;n&#39; if you just want to save</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">station</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">edifile</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">stationdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
    <span class="n">sname</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">day</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>    
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">))[</span><span class="mi">6</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">st</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">))[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">st</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stationdir</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="n">station</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<span class="c">#        if os.path.basename(stationdir).find(&#39;to&#39;)&gt;=0:</span>
<span class="c">#            combstr=os.path.basename(stationdir)</span>
<span class="c">#            tspot=combstr.find(&#39;to&#39;)</span>
<span class="c">#            start=combstr[tspot-2:tspot]+&#39;0000&#39;</span>
<span class="c">#            stop=combstr[tspot+2:tspot+4]+&#39;0000&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stationdir</span><span class="p">))</span>
            <span class="n">day</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stationdir</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">day</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="n">sname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stationdir</span><span class="p">))</span>
        <span class="n">stationdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">MTpy.imaging.MTPlotTools</span> <span class="kn">as</span> <span class="nn">mtplot</span>
        <span class="c">#plot the coherence and apparent resistivity and phase</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">),</span><span class="s">&#39;Plots&#39;</span><span class="p">)):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">),</span><span class="s">&#39;Plots&#39;</span><span class="p">))</span>
            <span class="k">print</span> <span class="s">&#39;Made path: &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">),</span><span class="s">&#39;Plots&#39;</span><span class="p">)</span>
        
        <span class="n">plotpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">stationdir</span><span class="p">),</span><span class="s">&#39;Plots&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cohfile</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">fig1</span><span class="o">=</span><span class="n">mtplot</span><span class="o">.</span><span class="n">plotcoh</span><span class="p">(</span><span class="n">cohfile</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">savefigfilename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotpath</span><span class="p">,</span>
                                                             <span class="n">station</span><span class="o">+</span><span class="n">day</span><span class="o">+</span><span class="n">st</span><span class="o">+</span>
                                                             <span class="s">&#39;coh.pdf&#39;</span><span class="p">))</span>
            <span class="k">print</span> <span class="s">&#39;Save plots: &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;coh.pdf&#39;</span><span class="p">)</span>

        <span class="c">#plot and save apparent resistivity and phase</span>
        <span class="n">svstr</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sdict</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">svstr</span><span class="o">+=</span><span class="n">key</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sdict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        
        <span class="n">svfn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">day</span><span class="o">+</span><span class="n">st</span><span class="o">+</span><span class="n">svstr</span><span class="o">+</span><span class="s">&#39;Res.pdf&#39;</span><span class="p">)</span>
        
        <span class="n">fig2</span><span class="o">=</span><span class="n">mtplot</span><span class="o">.</span><span class="n">plotResPhase</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">plotnum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">,</span>
                                 <span class="n">savefigfilename</span><span class="o">=</span><span class="n">svfn</span><span class="p">)</span>
        
        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s"> &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">day</span><span class="o">+</span><span class="n">st</span><span class="o">+</span><span class="n">svstr</span><span class="o">+</span><span class="s">&#39;Resxy.pdf&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s"> &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">day</span><span class="o">+</span><span class="n">st</span><span class="o">+</span><span class="n">svstr</span><span class="o">+</span><span class="s">&#39;Resxx.pdf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfilelst</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">mtplot</span><span class="o">.</span><span class="n">plotTS</span><span class="p">(</span><span class="n">cfilelst</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                          <span class="n">savefigname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;TS.pdf&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">show</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
	<span class="kn">import</span> <span class="nn">MTpy.imaging.MTPlotTools</span> <span class="kn">as</span> <span class="nn">mtplot</span>
        <span class="k">if</span> <span class="n">cohfile</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">mtplot</span><span class="o">.</span><span class="n">plotcoh</span><span class="p">(</span><span class="n">cohfile</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mtplot</span><span class="o">.</span><span class="n">plotResPhase</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">plotnum</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfilelst</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">mtplot</span><span class="o">.</span><span class="n">plotTS</span><span class="p">(</span><span class="n">cfilelst</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="writeLogfile"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.writeLogfile">[docs]</a><span class="k">def</span> <span class="nf">writeLogfile</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">cohfile</span><span class="p">,</span><span class="n">datfile</span><span class="p">,</span><span class="n">impfile</span><span class="p">,</span><span class="n">scriptfile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writeLogfile will write a log file of how a station was processed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">logfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;.log&#39;</span><span class="p">)</span>
    <span class="n">logfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">todaysdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;===========================================================&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Processing log for station: &#39;</span> <span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">station</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Processed on: &#39;</span> 
                <span class="o">+</span><span class="n">todaysdate</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%b </span><span class="si">%d</span><span class="s">, %Y at %I:%M:%S %p local time&quot;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-----BIRRP Parameters----- </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">birrpfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">birrplines</span><span class="o">=</span><span class="n">birrpfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">birrplines</span><span class="p">)):</span>
        <span class="n">line</span><span class="o">=</span><span class="n">birrplines</span><span class="p">[</span><span class="n">bb</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">birrpfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-----Impedance Calculated from BIRRP-----&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>    
        <span class="n">impfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">impfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">implines</span><span class="o">=</span><span class="n">impfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">implines</span><span class="p">)):</span>
            <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">implines</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">impfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-----Coherence Calculated from BIRRP-----&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>    
        <span class="n">cohfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">cohfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">cohlines</span><span class="o">=</span><span class="n">cohfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cohlines</span><span class="p">)):</span>
            <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cohlines</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">cohfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-----Resistivity and Phase Calculated from BIRRP-----&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>    
        <span class="n">datfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">datfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">datlines</span><span class="o">=</span><span class="n">datfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datlines</span><span class="p">)):</span>
            <span class="n">logfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datlines</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">logfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">logfile</span>
</div>
<div class="viewcode-block" id="runBIRRPpp"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.runBIRRPpp">[docs]</a><span class="k">def</span> <span class="nf">runBIRRPpp</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">processingdict</span><span class="p">,</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">birrploc</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">edipath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    runBIRRPpp will processes a station from start to finish on seperate </span>
<span class="sd">    processors</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        dirpath = full path to station folders</span>
<span class="sd">        processinginfodict = dictionary of processing info</span>
<span class="sd">        </span>
<span class="sd">        stationinfofile = full path to station info file containing info about</span>
<span class="sd">                          survey parameters</span>
<span class="sd">        birrploc = location of BIRRP and bbconv.csv</span>
<span class="sd">        ffactor = factor to scale apparent resistivities and phases</span>
<span class="sd">        edipath = common folder to copy edifiles</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        dictionary with keys:</span>
<span class="sd">            cohfile</span>
<span class="sd">            datfile</span>
<span class="sd">            edifile</span>
<span class="sd">            impfile</span>
<span class="sd">            logfile</span>
<span class="sd">            scriptfile</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="c">#===============================================================================</span>
    <span class="c"># Run scriptfilePrep</span>
    <span class="c">#===============================================================================</span>
    <span class="n">prepdict</span><span class="o">=</span><span class="n">scriptfilePrep</span><span class="p">(</span><span class="n">processingdict</span><span class="p">)</span>


            
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;npcs&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;npcs&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>    
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nskip&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nskip&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;nskipr&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
                         
<span class="c">#    print prepdict</span>
    <span class="c">#===========================================================================</span>
    <span class="c"># Run writeScriptfile</span>
    <span class="c">#===========================================================================</span>
    <span class="n">scriptfile</span><span class="p">,</span><span class="n">birrpdict</span><span class="o">=</span><span class="n">writeScriptfile</span><span class="p">(</span><span class="n">prepdict</span><span class="p">)</span>
    <span class="c">#===========================================================================</span>
    <span class="c"># Run callBIRRP </span>
    <span class="c">#===========================================================================</span>

    <span class="n">bfpath</span><span class="o">=</span><span class="n">callBIRRP</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">,</span><span class="n">birrploc</span><span class="p">)</span>


    <span class="c">#===========================================================================</span>
    <span class="c"># Run convertBIRRPoutputs</span>
    <span class="c">#===========================================================================</span>
    
    <span class="n">station</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span>
    <span class="n">rrstation</span><span class="o">=</span><span class="n">processingdict</span><span class="p">[</span><span class="s">&#39;rrstation&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">birrploc</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">bbfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">birrploc</span><span class="p">),</span><span class="s">&#39;BBConv.txt&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bbfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">birrploc</span><span class="p">,</span><span class="s">&#39;BBConv.txt&#39;</span><span class="p">)</span>
    <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;bbfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">bbfile</span>
    <span class="c">#print birrpdict</span>
    <span class="n">cohfile</span><span class="p">,</span><span class="n">edifile</span><span class="p">,</span><span class="n">datfile</span><span class="p">,</span><span class="n">impfile</span><span class="o">=</span><span class="n">convertBIRRPoutputs</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span>
                                                        <span class="n">stationinfofile</span><span class="p">,</span>
                                                        <span class="n">station</span><span class="p">,</span>
                                                        <span class="n">rrstation</span><span class="o">=</span><span class="n">rrstation</span><span class="p">,</span>
                                                        <span class="n">bbfile</span><span class="o">=</span><span class="n">bbfile</span><span class="p">,</span>
                                                        <span class="n">birrpdict</span><span class="o">=</span><span class="n">birrpdict</span><span class="p">,</span>
                                                        <span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">,</span>
                                                        <span class="n">edipath</span><span class="o">=</span><span class="n">edipath</span><span class="p">)</span>
    
    <span class="c">#===========================================================================</span>
    <span class="c"># Run writeLogfile</span>
    <span class="c">#===========================================================================</span>
    
    <span class="n">logfile</span><span class="o">=</span><span class="n">writeLogfile</span><span class="p">(</span><span class="n">bfpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">cohfile</span><span class="p">,</span><span class="n">datfile</span><span class="p">,</span><span class="n">impfile</span><span class="p">,</span><span class="n">scriptfile</span><span class="p">)</span>
    
    <span class="n">returndict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;cohfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cohfile</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;datfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">datfile</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;edifile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edifile</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;impfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">impfile</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;logfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">logfile</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;scriptfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">scriptfile</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;cfilelst&#39;</span><span class="p">]</span>
    <span class="n">returndict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">prepdict</span><span class="p">[</span><span class="s">&#39;rrcfilelst&#39;</span><span class="p">]</span>
    
<span class="c">#    #need to delete the day folder due to naming convention</span>
<span class="c">#    if type(returndict[&#39;rrcfilelst&#39;][0]) is str or\</span>
<span class="c">#        type(returndict[&#39;rrcfilelst&#39;][0]) is np.string_:</span>
<span class="c">#        rrfind=returndict[&#39;rrcfilelst&#39;][0].find(&#39;Comb&#39;)</span>
<span class="c">#        try:</span>
<span class="c">#            float(returndict[&#39;rrcfilelst&#39;][0][rrfind+6])</span>
<span class="c">#            cbn=os.path.dirname(returndict[&#39;rrcfilelst&#39;][0])</span>
<span class="c">#            for cfile in os.listdir(cbn):</span>
<span class="c">#                os.remove(os.path.join(cbn,cfile))</span>
<span class="c">#            os.rmdir(cbn)</span>
<span class="c">#            print &#39;Removed directory: &#39;,cbn</span>
<span class="c">#        except ValueError:</span>
<span class="c">#            pass</span>
<span class="c">#        except WindowsError:</span>
<span class="c">#            pass</span>
<span class="c">#    elif type(returndict[&#39;rrcfilelst&#39;][0]) is list:</span>
<span class="c">#        for cc in range(len(returndict[&#39;rrcfilelst&#39;])):</span>
<span class="c">#            rrfind=returndict[&#39;rrcfilelst&#39;][cc][0].find(&#39;Comb&#39;)</span>
<span class="c">#            try:</span>
<span class="c">#                float(returndict[&#39;rrcfilelst&#39;][cc][0][rrfind+6])</span>
<span class="c">#                cbn=os.path.dirname(returndict[&#39;rrcfilelst&#39;][cc][0])</span>
<span class="c">#                for cfile in os.listdir(cbn):</span>
<span class="c">#                    os.remove(os.path.join(cbn,cfile))</span>
<span class="c">#                os.rmdir(cbn)</span>
<span class="c">#                print &#39;Removed directory: &#39;,cbn</span>
<span class="c">#            except ValueError:</span>
<span class="c">#                pass</span>
<span class="c">#            except WindowsError:</span>
<span class="c">#                pass</span>
    
    
    <span class="c">#finishBeep()</span>
    
    <span class="k">return</span> <span class="n">returndict</span>

</div>
<div class="viewcode-block" id="sigfigs"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.sigfigs">[docs]</a><span class="k">def</span> <span class="nf">sigfigs</span><span class="p">(</span><span class="n">numstr</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;sigfigs(numstr,digits=8,fmt=&#39;g&#39;) will return a string with the proper </span>
<span class="sd">    amount of significant digits for the input number, can be str or float.&quot;&quot;&quot;</span>
    <span class="n">numfmt</span><span class="o">=</span><span class="s">&#39;%.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span><span class="o">+</span><span class="n">fmt</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">numstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">numstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">numstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">numstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;+Inf&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">signum</span><span class="o">=</span><span class="n">numfmt</span> <span class="o">%</span> <span class="o">-</span><span class="mf">6.66666666</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signum</span><span class="o">=</span><span class="n">numfmt</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">signum</span>
</div>
<div class="viewcode-block" id="sil"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.sil">[docs]</a><span class="k">def</span> <span class="nf">sil</span><span class="p">(</span><span class="n">iniline</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;sil(iniline) will split a single line written in an .ini file</span>
<span class="sd">    for burpinterface and return the list of strings.&quot;&quot;&quot;</span>
    
    <span class="n">inistr</span><span class="o">=</span><span class="n">iniline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">linelst</span><span class="o">=</span><span class="n">inistr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">linelst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="read2c2"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.read2c2">[docs]</a><span class="k">def</span> <span class="nf">read2c2</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;read2c2(filename) will read in a .2c2 file output from BIRRP and return a list </span>
<span class="sd">    containing [period],[freq],[coh],[zcoh]. Note if any of the coherences are </span>
<span class="sd">    negative a value of 0 will be given to them.&quot;&quot;&quot;</span>
    <span class="n">period</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">freq</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">coh1</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">zcoh1</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">fid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">fidlines</span><span class="o">=</span><span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fidlines</span><span class="p">)):</span>
        <span class="n">cohline</span><span class="o">=</span><span class="n">fidlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">cohstr</span><span class="o">=</span><span class="n">cohline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">cohlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cohstr</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cohstr</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">cohstr</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">cohlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigfigs</span><span class="p">(</span><span class="s">&#39;0.00&#39;</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cohlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigfigs</span><span class="p">(</span><span class="n">cohstr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">))</span>
        <span class="n">period</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">coh1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">zcoh1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">coh1</span><span class="p">,</span><span class="n">zcoh1</span>
</div>
<div class="viewcode-block" id="writecoh"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.writecoh">[docs]</a><span class="k">def</span> <span class="nf">writecoh</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;writecoh(dirpath) will write a coherence file using the BIRRP outputs </span>
<span class="sd">    residing in the dirpath folder.  The output file is tab delimited and if any </span>
<span class="sd">    values are negative they are put to 0. Each value has 7 significant digits.</span>
<span class="sd">    Returns written to filename.&quot;&quot;&quot;</span>

    <span class="c">#locate file names</span>
    <span class="n">cohfilenames</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.1r.2c2&#39;</span><span class="p">):</span>
            <span class="n">cohfilenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.2r.2c2&#39;</span><span class="p">):</span>
            <span class="n">cohfilenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.3r.2c2&#39;</span><span class="p">):</span>
            <span class="n">cohfilenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">ofilloc</span><span class="o">=</span><span class="n">cohfilenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">ofil</span><span class="o">=</span><span class="n">cohfilenames</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">ofilloc</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cohfilenames</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">coh1</span><span class="p">,</span><span class="n">zcoh1</span><span class="o">=</span><span class="n">read2c2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">cohfilenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">coh2</span><span class="p">,</span><span class="n">zcoh2</span><span class="o">=</span><span class="n">read2c2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">cohfilenames</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">coh3</span><span class="p">,</span><span class="n">zcoh3</span><span class="o">=</span><span class="n">read2c2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">cohfilenames</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">cohfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">dirpath</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.coh&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">cohfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">cohfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;period&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;freq&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;coh1&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;zcoh1&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;coh2&#39;</span><span class="o">+</span><span class="n">tsp</span>
                                           <span class="o">+</span><span class="s">&#39;zcoh2&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;coh3&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;zcoh3&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c1</span><span class="o">=</span><span class="n">coh1</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
                <span class="n">zc1</span><span class="o">=</span><span class="n">zcoh1</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">c1</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
                <span class="n">zc1</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c2</span><span class="o">=</span><span class="n">coh2</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
                <span class="n">zc2</span><span class="o">=</span><span class="n">zcoh2</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">c2</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
                <span class="n">zc2</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c3</span><span class="o">=</span><span class="n">coh3</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
                <span class="n">zc3</span><span class="o">=</span><span class="n">zcoh3</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">c3</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
                <span class="n">zc3</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
            <span class="n">cohfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">freq</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">c1</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">zc1</span><span class="o">+</span><span class="n">tsp</span>
                        <span class="o">+</span><span class="n">c2</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">zc2</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">c3</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">zc3</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">cohfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cohfilenames</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">coh1</span><span class="p">,</span><span class="n">zcoh1</span><span class="o">=</span><span class="n">read2c2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">cohfilenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">coh2</span><span class="p">,</span><span class="n">zcoh2</span><span class="o">=</span><span class="n">read2c2</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">cohfilenames</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">cohfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">dirpath</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.coh&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">cohfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">cohfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;period&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;freq&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;coh1&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;zcoh1&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;coh2&#39;</span><span class="o">+</span><span class="n">tsp</span>
                                        <span class="o">+</span><span class="s">&#39;zcoh2&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;coh3&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;zcoh3&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c1</span><span class="o">=</span><span class="n">coh1</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
                <span class="n">zc1</span><span class="o">=</span><span class="n">zcoh1</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">c1</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
                <span class="n">zc1</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c2</span><span class="o">=</span><span class="n">coh2</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
                <span class="n">zc2</span><span class="o">=</span><span class="n">zcoh2</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">c2</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
                <span class="n">zc2</span><span class="o">=</span><span class="s">&#39;0.0000000&#39;</span>
            <span class="n">cohfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">freq</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">c1</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">zc1</span><span class="o">+</span><span class="n">tsp</span>
                        <span class="o">+</span><span class="n">c2</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">zc2</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;0.000000&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;0.000000&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">cohfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Somethings wrong.  Either no coherence files or there are </span><span class="se">\r</span><span class="s">&#39;</span>
        <span class="s">&#39;too many in the dirpath, retard&#39;</span>
    
    <span class="k">return</span> <span class="n">dirpath</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.coh&#39;</span>
</div>
<div class="viewcode-block" id="readcoh"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.readcoh">[docs]</a><span class="k">def</span> <span class="nf">readcoh</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;readcoh(filename) will read a coherence file writen by writecoh.  The </span>
<span class="sd">    output is period,frequency,coh1,zcoh1,coh2,zcoh2,coh3,zcoh3&quot;&quot;&quot;</span>
    
    <span class="n">fid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">=</span><span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">station</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">period</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">freq</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">coh1</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">zcoh1</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">coh2</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">zcoh2</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">coh3</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">zcoh3</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">cohstr</span><span class="o">=</span><span class="n">lines</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">cohlst</span><span class="o">=</span><span class="n">cohstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tsp</span><span class="p">)</span>
        <span class="n">period</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">coh1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">zcoh1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">coh2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">zcoh2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">coh3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">zcoh3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">cohlst</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="n">station</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">period</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coh1</span><span class="p">),</span>\
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zcoh1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coh2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zcoh2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coh3</span><span class="p">),</span>\
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zcoh3</span><span class="p">)</span></div>
<div class="viewcode-block" id="bbcalfunc"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.bbcalfunc">[docs]</a><span class="k">def</span> <span class="nf">bbcalfunc</span><span class="p">(</span><span class="n">bbfile</span><span class="p">,</span><span class="n">nfreqlst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;bbcalfunc(bbfile,nfreqlst) will generate a function fitting the </span>
<span class="sd">    calibration data in bbfile to the frequencies in nfreqlst using a cubic</span>
<span class="sd">    interpolation algorithm.  The output is the real and imaginary functions</span>
<span class="sd">    as a function of the nfreqlst in units of microV/nT.&quot;&quot;&quot;</span> 
    
    <span class="n">fid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">bbfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">fidlines</span><span class="o">=</span><span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c">#define the delimiter</span>
    <span class="k">if</span> <span class="n">bbfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.txt&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span>
    <span class="k">elif</span> <span class="n">bbfile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.csv&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span>
    
    <span class="n">freq</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">breal</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">bimag</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">fidlines</span><span class="p">)):</span>
        <span class="n">linestr</span><span class="o">=</span><span class="n">fidlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">linestr</span><span class="o">=</span><span class="n">linestr</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">linelst</span><span class="o">=</span><span class="n">linestr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linelst</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">linelst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">breal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">linelst</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">bimag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">linelst</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    
    <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">breal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">breal</span><span class="p">)</span>
    <span class="n">bimag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bimag</span><span class="p">)</span>
    <span class="n">nfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nfreqlst</span><span class="p">))</span>
    
    <span class="n">brinterp</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">breal</span><span class="p">)</span>
    <span class="n">brep</span><span class="o">=</span><span class="mf">1E3</span><span class="o">*</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">nfreq</span><span class="p">,</span> <span class="n">brinterp</span><span class="p">)</span>
    
    <span class="n">biinterp</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splrep</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">bimag</span><span class="p">)</span>
    <span class="n">bip</span><span class="o">=</span><span class="mf">1E3</span><span class="o">*</span><span class="n">interpolate</span><span class="o">.</span><span class="n">splev</span><span class="p">(</span><span class="n">nfreq</span><span class="p">,</span> <span class="n">biinterp</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">brep</span><span class="p">,</span><span class="n">bip</span>
    </div>
<div class="viewcode-block" id="readj"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.readj">[docs]</a><span class="k">def</span> <span class="nf">readj</span><span class="p">(</span><span class="n">jfn</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dlen</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span><span class="n">magtype</span><span class="o">=</span><span class="s">&#39;bb&#39;</span><span class="p">,</span>
          <span class="n">bbfile</span><span class="o">=</span><span class="s">r&#39;c:\Peacock\PHD\BIRRP\bbconv.txt&#39;</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    readj will read in the .j file output by BIRRP, which is better than </span>
<span class="sd">    reading in the .irj.rf files.</span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">print</span> <span class="s">&#39;Reading &#39;</span><span class="p">,</span><span class="n">jfn</span>    
    
    <span class="n">jfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">jfn</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">jlines</span><span class="o">=</span><span class="n">jfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>        
    <span class="n">jfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">tz</span><span class="o">=-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">jline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">jlines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">jline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;ZXX&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>
        <span class="k">elif</span> <span class="n">jline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;TZX&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">tz</span><span class="o">=</span><span class="n">ii</span>
            <span class="k">print</span> <span class="s">&#39;Found Tipper&#39;</span>
    
    <span class="c">#get impedance tensor components and period</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nf</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">jlines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Did not produce a legit .j file&#39;</span>
    <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">nf</span><span class="p">))</span>
    <span class="n">period</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="n">nf</span><span class="p">))</span>
    <span class="n">pnot</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">prange</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c">#    for ii in range(2,10,2):</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">nn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">kk</span><span class="o">*</span><span class="n">nf</span><span class="p">,</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nf</span><span class="p">)):</span>
            <span class="n">jline</span><span class="o">=</span><span class="n">jlines</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">per</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">zr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">zi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">zerr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">per</span><span class="o">!=-</span><span class="mi">999</span><span class="p">:</span>
                <span class="n">period</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prange</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">pnot</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">kk</span><span class="p">,</span><span class="n">ll</span><span class="p">))</span>
            <span class="c">#get z_real</span>
            <span class="k">if</span> <span class="n">zr</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">or</span> <span class="n">zr</span><span class="o">!=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;Inf&#39;</span><span class="p">):</span>
                <span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">zr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            
            <span class="c">#get z_imaginary</span>
            <span class="k">if</span> <span class="n">zi</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">or</span> <span class="n">zi</span><span class="o">!=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;Inf&#39;</span><span class="p">):</span>
                <span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">zi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            
            <span class="c">#get z_error</span>
            <span class="k">if</span> <span class="n">zerr</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">or</span> <span class="n">zerr</span><span class="o">!=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;Inf&#39;</span><span class="p">):</span>
                <span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">zerr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="n">ffactor</span>
    <span class="c">#convert electric channels to microV/m</span>
    <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:,:]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dlen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">egain</span><span class="p">))</span>
    <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:,:]</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:,:]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dlen</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">egain</span><span class="p">))</span>

    <span class="c">#get tipper components</span>
    <span class="n">tip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">nf</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">tz</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">nn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">tz</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">kk</span><span class="o">*</span><span class="n">nf</span><span class="p">,</span><span class="n">tz</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nf</span><span class="p">)):</span>           
                <span class="n">jline</span><span class="o">=</span><span class="n">jlines</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">tr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ti</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">terr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">jline</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="c">#get Tipper_real</span>
                <span class="k">if</span> <span class="n">tr</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">or</span> <span class="n">tr</span><span class="o">!=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;Inf&#39;</span><span class="p">):</span>
                    <span class="n">tip</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">tr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="c">#get Tipper_real</span>
                <span class="k">if</span> <span class="n">ti</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">or</span> <span class="n">ti</span><span class="o">!=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;Inf&#39;</span><span class="p">):</span>
                    <span class="n">tip</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">ti</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="c">#get Tipper_real</span>
                <span class="k">if</span> <span class="n">terr</span><span class="o">!=-</span><span class="mi">999</span> <span class="ow">or</span> <span class="n">terr</span><span class="o">!=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;Inf&#39;</span><span class="p">):</span>
                    <span class="n">tip</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">=</span><span class="n">terr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="c">#find the frequency with no -999 in it</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">prange</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">plen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">per</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">per</span><span class="p">)</span><span class="o">&gt;</span><span class="n">plen</span><span class="p">:</span>
                <span class="n">prange</span><span class="o">=</span><span class="n">ll</span>
        <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">[</span><span class="n">prange</span><span class="p">,:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pnot</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">nclst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Z_xx&#39;</span><span class="p">,</span><span class="s">&#39;Z_xy&#39;</span><span class="p">,</span><span class="s">&#39;Z_yx&#39;</span><span class="p">,</span><span class="s">&#39;Z_yy&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">pnot</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;No response for {1} at T={0:.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">mm</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nclst</span><span class="p">[</span><span class="n">mm</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="c">#flip array so frequency is decreasing, period is increasing</span>
    <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">period</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">[:,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">tip</span><span class="o">=</span><span class="n">tip</span><span class="p">[:,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c">#convert magnetics</span>
    <span class="k">if</span> <span class="n">magtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;bb&#39;</span><span class="p">:</span>
        <span class="n">zconv</span><span class="o">=</span><span class="n">bbconvz</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">bbfile</span><span class="p">,</span><span class="n">dlgain</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">magtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;lp&#39;</span><span class="p">:</span>
        <span class="n">zconv</span><span class="o">=</span><span class="n">lpconvz</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">dlgain</span><span class="p">)</span>
    
    <span class="n">ofil</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">jfn</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">ofil</span><span class="p">,</span><span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">zconv</span><span class="p">,</span><span class="n">tip</span>
                
</div>
<div class="viewcode-block" id="readrf"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.readrf">[docs]</a><span class="k">def</span> <span class="nf">readrf</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dlen</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">magtype</span><span class="o">=</span><span class="s">&#39;bb&#39;</span><span class="p">,</span>
           <span class="n">bbfile</span><span class="o">=</span><span class="s">r&#39;c:\Peacock\PHD\BIRRP\bbconv.txt&#39;</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;readrf(dirpath) will read in .irj.rf file output by BIRRP that reside in </span>
<span class="sd">    the folder nominated by dirpath. Returns: period, freq, </span>
<span class="sd">    z[ijreal,ijimag,ijvar] as array.  If any of the numbers are NaN or +Inf they</span>
<span class="sd">    are set to zero&quot;&quot;&quot;</span>
    <span class="n">impfn</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">tipfn</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;*.1r1.rf&#39;</span><span class="p">):</span>
            <span class="n">impfn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;*.1r2.rf&#39;</span><span class="p">):</span>
            <span class="n">impfn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;*.2r1.rf&#39;</span><span class="p">):</span>
            <span class="n">impfn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;*.2r2.rf&#39;</span><span class="p">):</span>
            <span class="n">impfn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;*.3r1.rf&#39;</span><span class="p">):</span>
            <span class="n">tipfn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;*.3r2.rf&#39;</span><span class="p">):</span>
            <span class="n">tipfn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">impfn</span><span class="p">)</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Somethings a miss, did not find all .rf files&#39;</span><span class="p">)</span> 
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipfn</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Got Tipper files&#39;</span>
    
    
    <span class="c">#get ofil from filenames</span>
    <span class="n">ofilloc</span><span class="o">=</span><span class="n">impfn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">ofil</span><span class="o">=</span><span class="n">impfn</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">ofilloc</span><span class="p">]</span>
    <span class="n">z</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">period</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">freq</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">tip</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">impfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">impfn</span><span class="p">[</span><span class="n">ll</span><span class="p">]),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">implines</span><span class="o">=</span><span class="n">impfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">period</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">freq</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">zijreal</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">zijimag</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">zijerr</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">implines</span><span class="p">)):</span>
            <span class="n">line</span><span class="o">=</span><span class="n">implines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">impstr</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="n">implst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">impstr</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">impstr</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">impstr</span><span class="o">==</span><span class="s">&#39;NaN&#39;</span><span class="p">:</span>
                        <span class="n">implst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">impstr</span><span class="o">==</span><span class="s">&#39;+Inf&#39;</span><span class="p">:</span>
                        <span class="n">implst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">implst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">impstr</span><span class="p">[</span><span class="n">kk</span><span class="p">]))</span>
            <span class="n">period</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">implst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">implst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">zijreal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">implst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">zijimag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">implst</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">zijerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">implst</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">zijreal</span><span class="p">,</span><span class="n">zijimag</span><span class="p">,</span><span class="n">zijerr</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">*</span><span class="n">ffactor</span>
        <span class="c">#convert electric channels to microV/m</span>
        <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:,:]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dlen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">egain</span><span class="p">))</span>
        <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:,:]</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:,:]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dlen</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">egain</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;BIRRP has output uneven file lengths, try running &#39;</span><span class="o">+</span>
                         <span class="s">&#39;again with slight change in parameters.&#39;</span><span class="p">)</span>

    <span class="c">#get tipper</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipfn</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">tfn</span> <span class="ow">in</span> <span class="n">tipfn</span><span class="p">:</span>
            <span class="n">tipfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">tfn</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">tiplines</span><span class="o">=</span><span class="n">tipfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">tipijreal</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">tipijimag</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">tipijerr</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tiplines</span><span class="p">)):</span>
                <span class="n">line</span><span class="o">=</span><span class="n">tiplines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="n">tipstr</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
                <span class="n">tiplst</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tipstr</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipstr</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">tipstr</span><span class="o">==</span><span class="s">&#39;NaN&#39;</span><span class="p">:</span>
                            <span class="n">tiplst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">impstr</span><span class="o">==</span><span class="s">&#39;+Inf&#39;</span><span class="p">:</span>
                            <span class="n">tiplst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">tiplst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tipstr</span><span class="p">[</span><span class="n">kk</span><span class="p">]))</span>
                <span class="n">tipijreal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tiplst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">tipijimag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tiplst</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">tipijerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tiplst</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">tip</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">tipijreal</span><span class="p">,</span><span class="n">tipijimag</span><span class="p">,</span><span class="n">tipijerr</span><span class="p">])</span>
        <span class="n">tip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
        
    <span class="c">#flip array so frequency is decreasing, period is increasing</span>
    <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">period</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">[:,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">tip</span><span class="o">=</span><span class="n">tip</span><span class="p">[:,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c">#convert magnetics</span>
    <span class="k">if</span> <span class="n">magtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;bb&#39;</span><span class="p">:</span>
        <span class="n">zconv</span><span class="o">=</span><span class="n">bbconvz</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">bbfile</span><span class="p">,</span><span class="n">dlgain</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">magtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;lp&#39;</span><span class="p">:</span>
        <span class="n">zconv</span><span class="o">=</span><span class="n">lpconvz</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">dlgain</span><span class="p">)</span>
        
        
    <span class="k">return</span> <span class="n">ofil</span><span class="p">,</span><span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">zconv</span><span class="p">,</span><span class="n">tip</span>
    </div>
<div class="viewcode-block" id="bbconvz"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.bbconvz">[docs]</a><span class="k">def</span> <span class="nf">bbconvz</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">bbfile</span><span class="p">,</span><span class="n">dlgain</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;bbconvz(dirpath,bbfile,dlgain)will convert the .rf output files of BIRRP </span>
<span class="sd">    into correct units using broadband calibrations given by file bbcalfile that</span>
<span class="sd">    has format log(freq),breal,bimag. dlgain is the data logger gain (verylow=</span>
<span class="sd">    2.5,low=1,high=.1) The output is period,freq,z[[zijr,ziji,zije]].</span>
<span class="sd">    Note that it assumes the efields are already converted.&quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dlgain</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>    
        <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span><span class="o">!=</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    
    <span class="c">#interpolate values from frequency</span>
    <span class="n">brep</span><span class="p">,</span><span class="n">bip</span><span class="o">=</span><span class="n">bbcalfunc</span><span class="p">(</span><span class="n">bbfile</span><span class="p">,</span><span class="n">freq</span><span class="p">)</span>
    
    <span class="n">zconv</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
        <span class="n">zr</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">zi</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">ze</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span>
            <span class="n">ztest</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">bcal</span><span class="o">=</span><span class="p">(</span><span class="n">brep</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">bip</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">zcal</span><span class="o">=</span><span class="n">ztest</span><span class="o">*</span><span class="n">bcal</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dlgain</span><span class="p">)</span>
            <span class="n">zr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zcal</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
            <span class="n">zi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zcal</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">ze</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">bcal</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dlgain</span><span class="p">))</span>
        <span class="n">zconv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">zr</span><span class="p">,</span><span class="n">zi</span><span class="p">,</span><span class="n">ze</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zconv</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="lpconvz"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.lpconvz">[docs]</a><span class="k">def</span> <span class="nf">lpconvz</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the magnetic field from counts to units of microV/nT.</span>
<span class="sd">    bfield is a list of numbers. dlain is amount of gain applied</span>
<span class="sd">    by data logger(verylow=2.5,low=1, high=.1)</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        bfield = 1D array of long period data</span>
<span class="sd">        dlgain = data logger gain (very low= 2.5,low = 1, high = .1)</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        bfieldc = scaled bfield 1D array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zconv</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="mf">10.E7</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">70000.</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">zconv</span>
</div>
<div class="viewcode-block" id="writeimp"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.writeimp">[docs]</a><span class="k">def</span> <span class="nf">writeimp</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dlen</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span><span class="n">magtype</span><span class="o">=</span><span class="s">&#39;bb&#39;</span><span class="p">,</span>
           <span class="n">bbfile</span><span class="o">=</span><span class="s">r&#39;c:\Peacock\PHD\BIRRP\bbconv.txt&#39;</span><span class="p">,</span><span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writebbimp(dirpath,magtype,dlgain,bbfile=None)writes a tab delimited .imp </span>
<span class="sd">    file of converted impedances from.rf outputs of BIRRP and calibrates using </span>
<span class="sd">    file bbfile and dlgain which is the data logger gain </span>
<span class="sd">    (verylow=2.5,low=1,high=.1). Returns written to filename.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">ofil</span><span class="p">,</span><span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">tip</span><span class="o">=</span><span class="n">readrf</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="n">egain</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="n">dlgain</span><span class="p">,</span>
                                  <span class="n">dlen</span><span class="o">=</span><span class="n">dlen</span><span class="p">,</span><span class="n">magtype</span><span class="o">=</span><span class="n">magtype</span><span class="p">,</span><span class="n">bbfile</span><span class="o">=</span><span class="n">bbfile</span><span class="p">)</span>
        
    <span class="n">impfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.imp&#39;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">impfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
        <span class="n">impfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;period&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;rxx&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ixx&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;rxy&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ixy&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ryx&#39;</span>
                        <span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;iyx&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ryy&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;iyy&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;txxr&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;txxi&#39;</span><span class="o">+</span>
                        <span class="n">tsp</span><span class="o">+</span><span class="s">&#39;tyyr&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;tyyi&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">impfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;period&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;rxx&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ixx&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;rxy&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ixy&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ryx&#39;</span>
                        <span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;iyx&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ryy&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;iyy&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)):</span>
        <span class="n">per</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">rxx</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">ixx</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">rxy</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">ixy</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">ryx</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">iyx</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">ryy</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="n">iyy</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">txxr</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
            <span class="n">txxi</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
            <span class="n">tyyr</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
            <span class="n">tyyi</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
            <span class="n">impfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">per</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">rxx</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ixx</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">rxy</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ixy</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ryx</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">iyx</span>
                            <span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ryy</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">iyy</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">txxr</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">txxi</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">tyyr</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span>
                            <span class="n">tyyi</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">impfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">per</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">rxx</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ixx</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">rxy</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ixy</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ryx</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">iyx</span>
                                                        <span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">ryy</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">iyy</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">impfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c">#print &#39;Wrote .imp file to:&#39;+os.path.join(dirpath,ofil+&#39;.imp&#39;) </span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.imp&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="readimp"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.readimp">[docs]</a><span class="k">def</span> <span class="nf">readimp</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;readimp(filename) will read in the impedances from a .imp file written </span>
<span class="sd">    by writeimp. the output is ofil,period,z[zr,zi]&quot;&quot;&quot;</span>
    
    <span class="n">impfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">implines</span><span class="o">=</span><span class="n">impfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">ofil</span><span class="o">=</span><span class="n">implines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">period</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">z</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">tip</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">implines</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">line</span><span class="o">=</span><span class="n">implines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tsp</span><span class="p">)</span>
        <span class="n">period</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">zxxr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">zxxi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">zxyr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">zxyi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">zyxr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">zyxi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">zyyr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">zyyi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="n">zxxr</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zxxi</span><span class="p">,</span><span class="n">zxyr</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zxyi</span><span class="p">],[</span><span class="n">zyxr</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zyxi</span><span class="p">,</span><span class="n">zyyr</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zyyi</span><span class="p">]])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">txxr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">txxi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">tyyr</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
            <span class="n">tyyi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
            <span class="n">tip</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="n">txxr</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">txxi</span><span class="p">],[</span><span class="n">tyyr</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">tyyi</span><span class="p">]])</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>
  
    <span class="k">return</span> <span class="n">ofil</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">period</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span> 
    </div>
<div class="viewcode-block" id="writedat"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.writedat">[docs]</a><span class="k">def</span> <span class="nf">writedat</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dlen</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span><span class="n">magtype</span><span class="o">=</span><span class="s">&#39;bb&#39;</span><span class="p">,</span>
           <span class="n">bbfile</span><span class="o">=</span><span class="s">r&#39;c:\Peacock\PHD\BIRRP\bbconv.txt&#39;</span><span class="p">,</span><span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writebbdat(dirpath,magtype,df,dlgain,bbfile=None) will write a .dat </span>
<span class="sd">    (resistivity and phase) file from .rf output </span>
<span class="sd">    files from birrp after converting the broadband magnetic channels. dirpath</span>
<span class="sd">    is where the .rf files reside, bb file is where the conversion file</span>
<span class="sd">    resides and df is the sampling frequency. Returns written to filename.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<span class="c">#    ofil,period,freq,z,tip=readrf(dirpath,egain=egain,dlgain=dlgain,</span>
<span class="c">#                                  dlen=dlen,magtype=magtype,bbfile=bbfile)</span>
    <span class="n">ofil</span><span class="p">,</span><span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">tip</span><span class="o">=</span><span class="n">readj</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span>
                                  <span class="n">egain</span><span class="o">=</span><span class="n">egain</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="n">dlgain</span><span class="p">,</span><span class="n">dlen</span><span class="o">=</span><span class="n">dlen</span><span class="p">,</span>
                                  <span class="n">magtype</span><span class="o">=</span><span class="n">magtype</span><span class="p">,</span><span class="n">bbfile</span><span class="o">=</span><span class="n">bbfile</span><span class="p">)</span>
                                  
    <span class="n">res</span><span class="p">,</span><span class="n">phase</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">imp2resphase</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
    
    <span class="n">r</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;R11&#39;</span><span class="p">,</span><span class="s">&#39;R12&#39;</span><span class="p">,</span><span class="s">&#39;R21&#39;</span><span class="p">,</span><span class="s">&#39;R22&#39;</span><span class="p">]</span>
    <span class="n">datfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dirpath</span><span class="p">),</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.dat&#39;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)):</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Period&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;App Res (Ohm.m)&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;App Res Err&#39;</span>
                                        <span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;Phase(deg)&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;Phase err&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)):</span>
            <span class="n">datfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
                <span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">tsp</span>
                <span class="o">+</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">jj</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">tsp</span>
                <span class="o">+</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
                <span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">jj</span><span class="p">]),</span><span class="n">digits</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                
<span class="c">#    res=[[resxx,resxxerr],[resxy,resxyerr],[resyx,resyxerr],[resyy,resyyerr]]</span>
<span class="c">#    phase=[[phasexx,phasexxerr],[phasexy,phasexyerr],[phaseyx,phaseyxerr],</span>
<span class="c">#           [phaseyy,phaseyyerr]]</span>
    
    <span class="n">datfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.dat&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="readdat"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.readdat">[docs]</a><span class="k">def</span> <span class="nf">readdat</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;readdat(filename) will read in a .dat file written by writedat and output </span>
<span class="sd">    ofil, period,[resistivity,resistivityerr],[phase,phaseerr]&quot;&quot;&quot;</span>

    <span class="n">datfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">datlines</span><span class="o">=</span><span class="n">datfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">ofil</span><span class="o">=</span><span class="n">datlines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">rfind</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">datlines</span><span class="p">),</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">datlines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">rfind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
    <span class="n">numper</span><span class="o">=</span><span class="n">rfind</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">rfind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span>
    <span class="n">numcomp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datlines</span><span class="p">)</span><span class="o">/</span><span class="n">numper</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numcomp</span><span class="o">!=</span><span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Not right amoung of components in .dat file, check file&#39;</span><span class="p">)</span>

    <span class="n">res</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">reserr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phase</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phaseerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numcomp</span><span class="p">):</span>
        <span class="n">resij</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">resijerr</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">phaseij</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">phaseijerr</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">period</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">rfind</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="n">rfind</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">numper</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">line</span><span class="o">=</span><span class="n">datlines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">tsp</span><span class="p">)</span>
            <span class="n">period</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">resij</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">resijerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">phaseij</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">phaseijerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resij</span><span class="p">)</span>
        <span class="n">reserr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resijerr</span><span class="p">)</span>
        <span class="n">phase</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phaseij</span><span class="p">)</span>
        <span class="n">phaseerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phaseijerr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ofil</span><span class="p">,</span><span class="n">period</span><span class="p">,[</span><span class="n">res</span><span class="p">,</span><span class="n">reserr</span><span class="p">],[</span><span class="n">phase</span><span class="p">,</span><span class="n">phaseerr</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="writeedi"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.writeedi">[docs]</a><span class="k">def</span> <span class="nf">writeedi</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">stationinfofile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rrstation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">birrpdict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">bbfile</span><span class="o">=</span><span class="s">r&#39;c:\Peacock\PHD\BIRRP\bbconv.txt&#39;</span><span class="p">,</span>
             <span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writeedi2(dirpath,stationinfofile,station,bbfile=</span>
<span class="sd">    r&#39;c:\Peacock\PHD\BIRRP\bbconv.txt&#39;) will write an .edi file for a station </span>
<span class="sd">    processed by BIRRP given the station info file, station and bbfile if</span>
<span class="sd">    applicable. Returns the full path to the .edi file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c">#long spaces 6 spaces</span>
    <span class="n">lsp</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">tsp</span>
    
    <span class="c">#get station info from station info file</span>
    <span class="k">if</span> <span class="n">stationinfofile</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">stationinfofile</span><span class="o">==</span><span class="s">&#39;None&#39;</span><span class="p">:</span>
        <span class="n">statdict</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">statdict</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">getStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">station</span><span class="p">)</span>
    
    <span class="c">#convert outputs of BIRRP to impedances depending on magtype</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">magtype</span><span class="o">=</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">magtype</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter magtype bb for broadband, lp for longperiod. &#39;</span><span class="o">+</span>\
                    <span class="s">&#39;be sure to put quotes around answer. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">statdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter latitude. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">statdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter longitude. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ex&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter Ex length (m). </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ey&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter Ey length (m). </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="n">statdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter Elevation (m). </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
        <span class="n">statdict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter interface box gain (10 or 100). </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dlgain</span><span class="o">=</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">dlgain</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Enter data logger gain (verylow=2.5,low=1,high=.1)&#39;</span><span class="o">+</span>\
                    <span class="s">&#39;be sure to put quotes around answer. </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
<span class="c">#    ofil,period,freq,z,tip=readrf(dirpath,</span>
<span class="c">#                                  egain=float(statdict[&#39;egain&#39;]),</span>
<span class="c">#                                  dlgain=float(dlgain),</span>
<span class="c">#                                  dlen=[float(statdict[&#39;ex&#39;]),</span>
<span class="c">#                                        float(statdict[&#39;ey&#39;])],</span>
<span class="c">#                                  magtype=magtype,</span>
<span class="c">#                                  bbfile=bbfile,ffactor=ffactor)</span>
    <span class="n">ofil</span><span class="p">,</span><span class="n">period</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">tip</span><span class="o">=</span><span class="n">readj</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;.j&#39;</span><span class="p">),</span>
                                  <span class="n">egain</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]),</span>
                                  <span class="n">dlgain</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">),</span>
                                  <span class="n">dlen</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ex&#39;</span><span class="p">]),</span>
                                        <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ey&#39;</span><span class="p">])],</span>
                                  <span class="n">magtype</span><span class="o">=</span><span class="n">magtype</span><span class="p">,</span>
                                  <span class="n">bbfile</span><span class="o">=</span><span class="n">bbfile</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">[:,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
            <span class="n">tip</span><span class="o">=</span><span class="n">tip</span><span class="p">[:,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;Flipped array so frequency is decending&#39;</span>
                    
    <span class="n">nfreq</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
        
    <span class="c">#list of orientation components</span>
    <span class="n">orilst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;HX&#39;</span><span class="p">,</span><span class="s">&#39;HY&#39;</span><span class="p">,</span><span class="s">&#39;EX&#39;</span><span class="p">,</span><span class="s">&#39;EY&#39;</span><span class="p">,</span><span class="s">&#39;RX&#39;</span><span class="p">,</span><span class="s">&#39;RY&#39;</span><span class="p">]</span>
    
    <span class="c">#open an edifile to write to</span>
    <span class="k">if</span> <span class="n">ofil</span><span class="o">!=</span><span class="n">station</span><span class="p">:</span>
        <span class="n">ofil</span><span class="o">=</span><span class="n">station</span>
    <span class="n">edifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.edi&#39;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write header information</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HEAD </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;DATAID=&quot;&#39;</span><span class="o">+</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#acquired by:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQBY=&quot;&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;acqby&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQBY=&quot;&#39;</span><span class="o">+</span><span class="s">&#39;Adelaide University&#39;</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#aqcuired date</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mdate</span><span class="o">=</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">mday</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mmonth</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">myear</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;20&#39;</span><span class="o">+</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
            <span class="n">myear</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">myear</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">md</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">myear</span><span class="p">,</span><span class="n">mmonth</span><span class="p">,</span><span class="n">mday</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQDATE=&#39;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">md</span><span class="p">,</span><span class="s">&#39;%B </span><span class="si">%d</span><span class="s">, %Y&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQDATE=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#date edi file written</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;FILEDATE=&#39;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span>
                                                       <span class="s">&#39;%B </span><span class="si">%d</span><span class="s">, %Y&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#survey location</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;PROSPECT=&quot;&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;PROSPECT=&quot; &quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#station name</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LOC=&quot;&#39;</span><span class="o">+</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#latitude</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LAT=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LAT= </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="c">#longitude</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LONG=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LONG= </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#elevation</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ELEV=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ELEV= </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#Write info block</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;INFO&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAX LINES=1000&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#survey parameters</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;Survey Parameters: </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Sampling Frequency (Hz): &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Cache Rate (HHMMSS): &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;cacherate&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Data Logger Gain: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Interface Box Gain: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Instrument Box no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;box no&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Coil Numbers (BX,BY,BZ): &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;coil no(bx,by)&#39;</span><span class="p">]</span>
                                                                    <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Data Logger: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;dlbox&#39;</span><span class="p">]</span>
                                                                <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Hard Drive no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;harddrive&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Interface Box no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;interfacebox&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Battery no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;battery&#39;</span><span class="p">]</span>
                        <span class="o">+</span><span class="s">&#39; Starting Voltage: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;start volt&#39;</span><span class="p">]</span>
                        <span class="o">+</span><span class="s">&#39; End Voltage &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;end volt&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Other Notes: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;notes&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="c">#BIRRP parameters</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;   Transfer Functions Computed using BIRRP 5.1  </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">birrpdict</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Coil Calibration File=&#39;</span><span class="o">+</span><span class="n">bbfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Interaction Level (ILEV)=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">])</span><span class="o">+</span>
                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">ilevyn</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Number of outputs (NOUT)=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">])</span><span class="o">+</span>
                       <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Number of inputs (NINP)=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">])</span><span class="o">+</span>
                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">ilevyn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Number of Remote Reference time series (NREF)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nref&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote reference(0) or bounded influence(1)&#39;</span><span class="o">+</span>
                            <span class="s">&#39;(NRR)=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nrr&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Slepian Filter order (TBW)=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">])</span><span class="o">+</span>
                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Max length of fft window (NFFT)=&#39;</span><span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">ilevyn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Section Increment divisor (NSCTINC)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nsctinc&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Maximum number of fft sections (NSCTMAX)=&#39;</span><span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">if</span> <span class="n">ilevyn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;First frequency extracted (NF1)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nf1&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Frequency increment per window (NFINC)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfinc&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Number of frequencies per window (NFSECT)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nf1&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Small leverage point control (UIN)=&#39;</span><span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">ilevyn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Lower leverage point control (AINLIN)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ainlin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Large leverage point control (AINUIN)=&#39;</span><span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">if</span> <span class="n">ilevyn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Magnetic coherence threshold (C2THRESHEB)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshb&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Electric coherence threshold (C2THRESHE)=&#39;</span><span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Z component (NZ)=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">try</span><span class="p">:</span>  
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Coherence threshold z channel (c2threshe1)=&#39;</span><span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">ilevyn</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Low and high periods for coherence threshold &#39;</span>
                            <span class="o">+</span><span class="s">&#39;(PERLO,PERHI)=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;perlo&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;perhi&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Number of periods to reject (NPREJ)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nprej&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Periods to reject (PREJ)=&#39;</span>
                             <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;prej&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Order of prewhitening filter (NAR)=&#39;</span><span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Electric channel rotation angles (THETAE)=&#39;</span><span class="o">+</span>
                        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Magnetic channel rotation angles (THETAB)=&#39;</span><span class="o">+</span>
                        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Final channel rotation angles (THETAF)=&#39;</span><span class="o">+</span>
                        <span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
            
    <span class="c">#remote reference</span>
    <span class="k">if</span> <span class="n">rrstation</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">rrstation</span><span class="o">=</span><span class="n">rrstation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">rrstationlst</span><span class="o">=</span><span class="n">rrstation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rrstationlst</span><span class="o">=</span><span class="p">[</span><span class="n">station</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rrstationlst</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">rrstation</span><span class="o">=</span><span class="n">rrstationlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rrstation</span><span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">rrstation</span><span class="o">!=</span><span class="n">station</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stationinfofile</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">stationinfofile</span><span class="o">==</span><span class="s">&#39;None&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rrdict</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">getStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">rrstation</span><span class="p">)</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Station: &#39;</span><span class="o">+</span><span class="n">rrstation</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Lat=&#39;</span>
                                            <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Long=&#39;</span>
                                            <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Elev=&#39;</span><span class="o">+</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Station: &#39;</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Lat=&#39;</span>
                                        <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Long=&#39;</span>
                                        <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Elev=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rrs</span> <span class="ow">in</span> <span class="n">rrstationlst</span><span class="p">:</span>
            <span class="n">rfind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rrstationlst</span><span class="p">)</span><span class="o">==</span><span class="n">rrs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rfind</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rfind</span><span class="p">)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rrstationlst</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="n">rfind</span><span class="p">[</span><span class="n">rf</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="n">rrs</span><span class="o">!=</span><span class="n">station</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stationinfofile</span><span class="o">==</span><span class="bp">None</span> <span class="ow">or</span> <span class="n">stationinfofile</span><span class="o">==</span><span class="s">&#39;None&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rrdict</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">getStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">rrs</span><span class="p">)</span>
                    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Station: &#39;</span><span class="o">+</span><span class="n">rrs</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Lat=&#39;</span>
                                                <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Long=&#39;</span>
                                                <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Elev=&#39;</span><span class="o">+</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
    
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write define measurement block</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;=DEFINEMEAS&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAXCHAN=6&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAXRUN=999&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAXMEAS=99999&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;UNITS=M&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFTYPY=CART&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFLAT=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFLONG=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFELEV=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1001.001 CHTYPE=HX X=0 Y=0 AZM=0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1002.001 CHTYPE=HY X=0 Y=0 AZM=90&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;EMEAS ID=1003.001 CHTYPE=EX X=0 Y=0 X2=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ex&#39;</span><span class="p">]</span>
                                                            <span class="o">+</span><span class="s">&#39; Y2=0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;EMEAS ID=1004.001 CHTYPE=EY X=0 Y=0 X2=0 Y2=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ey&#39;</span><span class="p">]</span>
                                                            <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1005.001 CHTYPE=RX X=0 Y=0 AZM=0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1006.001 CHTYPE=RY X=0 Y=0 AZM=90&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write mtsect block</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;=MTSECT </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;SECTID=&#39;</span><span class="o">+</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="n">nfreq</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1001.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1002.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1003.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1004.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1005.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1006.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****FREQUENCIES****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">order</span><span class="o">=</span><span class="s">&#39;INC&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">order</span><span class="o">=</span><span class="s">&#39;DEC&#39;</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;FREQ&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="n">nfreq</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ORDER=&#39;</span><span class="o">+</span><span class="n">order</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;// &#39;</span><span class="o">+</span>
                                                                    <span class="n">nfreq</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">freq</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****IMPEDANCES****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="n">implst</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;ZXXR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXXI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZXX.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="s">&#39;ZXYR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXYI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>\
        <span class="p">[</span><span class="s">&#39;ZXY.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="s">&#39;ZYXR&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZYXI&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;ZYX.VAR&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>\
        <span class="p">[</span><span class="s">&#39;ZYYR&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZYYI&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYY.VAR&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
    <span class="c">#write new impedances and variances</span>
    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">imp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">implst</span><span class="p">):</span>
        <span class="n">mm</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nn</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="n">nfreq</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
            <span class="n">znum</span><span class="o">=</span><span class="s">&#39;{0:+.6e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">kk</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">znum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;INF&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">znum</span><span class="o">=</span><span class="s">&#39;{0:+.6e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mf">6.666</span><span class="p">)</span>  
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">znum</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write tipper info</span>
    
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****TIPPER****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">tiplst</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;TXR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TXI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;TX.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="s">&#39;TYR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TYI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&#39;TY.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">tip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)))</span>
        <span class="n">ntip</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
        <span class="n">ntip</span><span class="o">=</span><span class="n">tip</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">tcomp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tiplst</span><span class="p">):</span>
        <span class="n">mm</span><span class="o">=</span><span class="n">tcomp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nn</span><span class="o">=</span><span class="n">tcomp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">tcomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ntip</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ntip</span><span class="p">)):</span>
            <span class="n">tipnum</span><span class="o">=</span><span class="s">&#39;{0:+.6e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tip</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">kk</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tipnum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;INF&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">znum</span><span class="o">=</span><span class="s">&#39;{0:+.6e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="mf">6.666</span><span class="p">)</span>   
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">tipnum</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;END&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">ofil</span><span class="o">+</span><span class="s">&#39;.edi&#39;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="readini"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.readini">[docs]</a><span class="k">def</span> <span class="nf">readini</span><span class="p">(</span><span class="n">inifilename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;readini(inifilename) will read in an inifile and return a dictionary of </span>
<span class="sd">    initial parameters for the burpinterface program.&quot;&quot;&quot;</span>
    
    <span class="n">inifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">inifilename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">inilines</span><span class="o">=</span><span class="n">inifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">inidict</span><span class="o">=</span><span class="p">{}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inilines</span><span class="p">)</span><span class="o">==</span><span class="mi">38</span><span class="p">:</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;defdirpath&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;lpyn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;eyn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;mcomps&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;magdec&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;cacherate&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;dlength&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;lpbzcor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;bbfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;magori&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;birrploc&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">20</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">22</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">23</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">24</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">25</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ofil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">27</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">28</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">29</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">30</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">31</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">32</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;complstr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">33</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">34</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">35</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">36</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;stationinfofile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">37</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">inilines</span><span class="p">)</span><span class="o">==</span><span class="mi">37</span><span class="p">:</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;defdirpath&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;lpyn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;eyn&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;mcomps&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;magdec&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;cacherate&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;dlength&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;lpbzcor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;bbfile&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;magori&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;birrploc&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">20</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">22</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">23</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">24</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">25</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">26</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;ofil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">27</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">28</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">29</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">30</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">31</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">32</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;complstr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">33</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">34</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">35</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sil</span><span class="p">(</span><span class="n">inilines</span><span class="p">[</span><span class="mi">36</span><span class="p">])</span>
        <span class="n">inidict</span><span class="p">[</span><span class="s">&#39;stationinfofile&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Length of .ini file is not correct (len= </span><span class="si">%.3g</span><span class="s">&#39;</span> <span class="o">%</span> 
                <span class="nb">len</span><span class="p">(</span><span class="n">inilines</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;) check to make sure all values are entered&#39;</span><span class="p">)</span>
          
    <span class="k">return</span> <span class="n">inidict</span>
    </div>
<div class="viewcode-block" id="writeini"><a class="viewcode-back" href="../../../core.BIRRPTools.html#MTpy.core.BIRRPTools.writeini">[docs]</a><span class="k">def</span> <span class="nf">writeini</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">argsdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;writeini(filepath,station,argsdict) will write an .ini file from the to</span>
<span class="sd">    the filepath as station.ini.  The argsdict must be len 40 or will not write,</span>
<span class="sd">    the variables should be: dict[defdirpath,station,magtype,lpyn,eyn,mcomps,magdec,</span>
<span class="sd">    df,cacherate, dlength,dlgain,egain,lpbzcor,bbcal,magori,birrploc,ilev,nout,</span>
<span class="sd">    ninp,tbw,nfft,nsctmax,uin,ainuin,c2threshe,nz,c2threshe1,ofil,</span>
<span class="sd">    nlev,nar,imode,jmode,nfil,complstr,thetae,thetab,thetaf].&quot;&quot;&quot;</span> 

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">argsdict</span><span class="p">)</span><span class="o">!=</span><span class="mi">38</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Length of argsdict is not correct (len= </span><span class="si">%.3g</span><span class="s">&#39;</span> <span class="o">%</span> 
                <span class="nb">len</span><span class="p">(</span><span class="n">argsdict</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;) check to make sure all values are entered.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.ini&#39;</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Default directory path=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;defdirpath&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Station=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Magnetic type=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Long period magnetic fields converted to microV/nT=&#39;</span>
                                                        <span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;lpyn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Electric fields converted to microV/m=&#39;</span><span class="o">+</span>
                                                        <span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;eyn&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Measurement components in order for BIRRP=&#39;</span><span class="o">+</span>
                                                        <span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;mcomps&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Magnetic declination=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;magdec&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Sampling frequency (Hz)=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Cache rate (hhmmss)=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;cacherate&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Dipole lengths Ex,Ey (m)=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;dlength&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Data logger gain=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Interface box gain=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Long period Bz correction=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;lpbzcor&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Broadband calibration file=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;bbfile&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Magnectic measured orientation relative to Cartesian &#39;</span>\
                                        <span class="o">+</span><span class="s">&#39;Bx,By,Bz=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;magori&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;BIRRP location=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;birrploc&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Interaction Level=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Number of output time series=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Number of input time series=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Number of reference timeseries=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;tbw&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Length of FFT window=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Number of windows used in FFT=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Residual rejection factor low end (usually 0)=&#39;</span>
                                                        <span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Residual rejection factor high end (.95-.99)=&#39;</span>
                                                    <span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Coherence threshold (0 if not desired)=&#39;</span>
                                                    <span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Threshold for Bz=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Squared coherence for Bz=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;c2threshe1&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Output file root=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;ofil&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Output files mode=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;nlev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Prewhitening filter (3&lt; &gt;15) or 0 if not desired=&#39;</span>
                                                        <span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Output file mode=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;imode&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Input file mode=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;jmode&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Filter parameters=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;nfil&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Remote Reference component list (in order)=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;complstr&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Rotation angles for electrics (relative to geomagnetic &#39;</span>\
                                    <span class="o">+</span><span class="s">&#39;North)(N,E,rot)=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Rotation angles for magnetics (relative to geomagnetic &#39;</span>\
                                    <span class="o">+</span><span class="s">&#39;North)(N,E,rot)=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Rotation angles for calculation (relative to geomagnetic&#39;</span>\
                                    <span class="o">+</span><span class="s">&#39;North)(N,E,rot)=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Station Info File=&#39;</span><span class="o">+</span><span class="n">argsdict</span><span class="p">[</span><span class="s">&#39;stationinfofile&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">inifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jared Peacock, Lars Krieger, Stephan Thiel, Kent Inverarity.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>