

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MTpy.core.WS3DTools &mdash; MTpy 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MTpy.core.WS3DTools</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon Apr 02 11:54:33 2012</span>

<span class="sd">@author: a1185872</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">pylab</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span><span class="n">FormatStrFormatter</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span><span class="p">,</span><span class="n">Rectangle</span><span class="p">,</span><span class="n">Arrow</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span><span class="p">,</span><span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">matplotlib.colorbar</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>


<span class="c">#tolerance to find frequencies</span>
<span class="n">ptol</span><span class="o">=.</span><span class="mi">15</span>

<span class="c">#error of data in percentage</span>
<span class="n">zerr</span><span class="o">=.</span><span class="mo">05</span>
<span class="c">#errormap values which is multiplied by zerr to get a total error</span>
<span class="n">zxxerrmap</span><span class="o">=</span><span class="mi">10</span>
<span class="n">zxyerrmap</span><span class="o">=</span><span class="mi">1</span>
<span class="n">zyxerrmap</span><span class="o">=</span><span class="mi">1</span>
<span class="n">zyyerrmap</span><span class="o">=</span><span class="mi">10</span>
<span class="n">zerrmap</span><span class="o">=</span><span class="p">[</span><span class="n">zxxerrmap</span><span class="p">,</span><span class="n">zxyerrmap</span><span class="p">,</span><span class="n">zyxerrmap</span><span class="p">,</span><span class="n">zyyerrmap</span><span class="p">]</span>

<span class="c">#==============================================================================</span>
<span class="c"># Colormaps for plots</span>
<span class="c">#==============================================================================</span>
<span class="c">#phase tensor map</span>
<span class="n">ptcmapdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;red&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)),</span>
            <span class="s">&#39;green&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)),</span>
            <span class="s">&#39;blue&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))}</span>
<span class="n">ptcmap</span><span class="o">=</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s">&#39;ptcmap&#39;</span><span class="p">,</span><span class="n">ptcmapdict</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>

<span class="c">#phase tensor map for difference (reverse)</span>
<span class="n">ptcmapdictr</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;red&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)),</span>
            <span class="s">&#39;green&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;blue&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))}</span>
<span class="n">ptcmapr</span><span class="o">=</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s">&#39;ptcmapr&#39;</span><span class="p">,</span><span class="n">ptcmapdictr</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>

<span class="c">#resistivity tensor map for calculating delta</span>
<span class="n">ptcmapdict2</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;red&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;green&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)),</span>
            <span class="s">&#39;blue&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))}</span>
<span class="n">ptcmap2</span><span class="o">=</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s">&#39;ptcmap2&#39;</span><span class="p">,</span><span class="n">ptcmapdict2</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>

<span class="c">#resistivity tensor map for calcluating resistivity difference</span>
<span class="n">rtcmapdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;red&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;green&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;blue&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))}</span>
<span class="n">rtcmap</span><span class="o">=</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s">&#39;rtcmap&#39;</span><span class="p">,</span><span class="n">rtcmapdict</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>

<span class="c">#resistivity tensor map for calcluating apparent resistivity</span>
<span class="n">rtcmapdictr</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;red&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;green&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;blue&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))}</span>
<span class="n">rtcmapr</span><span class="o">=</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s">&#39;rtcmapr&#39;</span><span class="p">,</span><span class="n">rtcmapdictr</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>

<span class="c">#==============================================================================</span>
<span class="c">#  define some helping functions</span>
<span class="c">#==============================================================================</span>
<span class="c">#make a class to pick periods</span>
<div class="viewcode-block" id="ListPeriods"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.ListPeriods">[docs]</a><span class="k">class</span> <span class="nc">ListPeriods</span><span class="p">:</span>
<div class="viewcode-block" id="ListPeriods.__init__"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.ListPeriods.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plst</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span></div>
<div class="viewcode-block" id="ListPeriods.connect"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.ListPeriods.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;button_press_event&#39;</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">onclick</span><span class="p">)</span></div>
<div class="viewcode-block" id="ListPeriods.onclick"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.ListPeriods.onclick">[docs]</a>    <span class="k">def</span> <span class="nf">onclick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;{0} Period: {1:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="ListPeriods.disconnect"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.ListPeriods.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="readWLOutFile"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.readWLOutFile">[docs]</a><span class="k">def</span> <span class="nf">readWLOutFile</span><span class="p">(</span><span class="n">outfn</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read .out file from winglink</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        outfn = full path to .out file from winglink</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        dx,dy,dz = cell nodes in x,y,z directions (note x is to the East here</span>
<span class="sd">                    and y is to the north.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">wingLinkDataFH</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">outfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">raw_data</span>       <span class="o">=</span> <span class="n">wingLinkDataFH</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    
    <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw_data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>


    <span class="n">dx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
    <span class="n">dy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
    <span class="n">dz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">x_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
      <span class="n">dx</span><span class="p">[</span><span class="n">x_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="n">x_idx</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">y_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
      <span class="n">dy</span><span class="p">[</span><span class="n">y_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="n">y_idx</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">nx</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">z_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
      <span class="n">dz</span><span class="p">[</span><span class="n">z_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="n">z_idx</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">nx</span> <span class="o">+</span> <span class="n">ny</span><span class="p">]</span>

    <span class="c">#dx[0:nx/2]=-dx[0:nx/2]</span>
    <span class="c">#dy[0:ny/2]=-dy[0:ny/2]</span>
    


            
    <span class="k">return</span> <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span>
    </div>
<div class="viewcode-block" id="readSitesFile"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.readSitesFile">[docs]</a><span class="k">def</span> <span class="nf">readSitesFile</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read sites_ file output from winglink</span>
<span class="sd">    </span>
<span class="sd">    Input: </span>
<span class="sd">        sitesfn = full path to the sites file output by winglink</span>
<span class="sd">        </span>
<span class="sd">    Output:</span>
<span class="sd">        slst = list of dictionaries for each station.  Keys include:</span>
<span class="sd">            station = station name</span>
<span class="sd">            dx = number of blocks from center of grid in East-West direction</span>
<span class="sd">            dy = number of blocks from center of grid in North-South direction</span>
<span class="sd">            dz = number of blocks from center of grid vertically</span>
<span class="sd">            number = block number in the grid</span>
<span class="sd">        sitelst = list of station names </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">sfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">slines</span><span class="o">=</span><span class="n">sfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
    <span class="n">slst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">sitelst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">slines</span><span class="p">:</span>
        <span class="n">sdict</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">sline</span><span class="o">=</span><span class="n">ss</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sline</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sline</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sline</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;something&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sline</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;number&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sline</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">slst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sdict</span><span class="p">)</span>
        <span class="n">sitelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">slst</span><span class="p">,</span><span class="n">sitelst</span>
    </div>
<div class="viewcode-block" id="getXY"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.getXY">[docs]</a><span class="k">def</span> <span class="nf">getXY</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">,</span><span class="n">outfn</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get x (e-w) and y (n-s) position of station and put in middle of cell</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        sitesfn = full path to sites file output from winglink</span>
<span class="sd">        outfn = full path to .out file output from winglink</span>
<span class="sd">        ncol = number of columns the data is in</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        xarr = array of relative distance for each station from center of the</span>
<span class="sd">                grid.  Note this is E-W direction</span>
<span class="sd">        yarr = array of relative distance for each station from center of the</span>
<span class="sd">                grid.  Note this is N-S direction</span>
<span class="sd">                </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">slst</span><span class="p">,</span><span class="n">sitelst</span><span class="o">=</span><span class="n">readSitesFile</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">)</span>
    
    <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="o">=</span><span class="n">readWLOutFile</span><span class="p">(</span><span class="n">outfn</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">)</span>
    
    <span class="n">ns</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">slst</span><span class="p">)</span>
    <span class="n">nxh</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">nyh</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">xarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    <span class="n">yarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    
    
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">sdict</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slst</span><span class="p">):</span>
        <span class="n">xx</span><span class="o">=</span><span class="n">sdict</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span>
        <span class="n">yy</span><span class="o">=</span><span class="n">sdict</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xx</span><span class="o">&lt;</span><span class="n">nxh</span><span class="p">:</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">dx</span><span class="p">[</span><span class="n">xx</span><span class="p">:</span><span class="n">nxh</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">-</span><span class="n">dx</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">dx</span><span class="p">[</span><span class="n">nxh</span><span class="p">:</span><span class="n">xx</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">dx</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span>                    
        <span class="k">if</span> <span class="n">yy</span><span class="o">&lt;</span><span class="n">nyh</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="n">yy</span><span class="p">:</span><span class="n">nyh</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">-</span><span class="n">dy</span><span class="p">[</span><span class="n">yy</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="n">nyh</span><span class="p">:</span><span class="n">yy</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">+</span><span class="n">dy</span><span class="p">[</span><span class="n">yy</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>   

    <span class="k">return</span> <span class="n">xarr</span><span class="p">,</span><span class="n">yarr</span>  
</div>
<div class="viewcode-block" id="getPeriods"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.getPeriods">[docs]</a><span class="k">def</span> <span class="nf">getPeriods</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">errthresh</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots periods for all stations in edipath and the plot is interactive, just</span>
<span class="sd">    clikc on the period you want to select and it will appear in the console,</span>
<span class="sd">    it will also be saved to lp.plst.  To sort this list type lp.plst.sort()</span>
<span class="sd">    </span>
<span class="sd">    The x&#39;s mark a conformation that the station contains that period.  So </span>
<span class="sd">    when looking for the best periods to invert for look for a dense line of </span>
<span class="sd">    x&#39;s</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        edipath = path to where all your edi files are.  Note that only the </span>
<span class="sd">            impedance components are supported so if you have spectra data, </span>
<span class="sd">            export them from wingling to have impedance information.</span>
<span class="sd">        errthresh = threshold on the error in impedance estimation, this just </span>
<span class="sd">                    gives an indication on where bad stations and bad periods</span>
<span class="sd">                    are, anything above this level will be colored in red.</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        periodlst = list of periods for each station</span>
<span class="sd">        errorlst = error in the impedance determinant for each station at </span>
<span class="sd">                   each period.</span>
<span class="sd">        lp = data type lp has attributes: </span>
<span class="sd">            plst = period list of chosen periods, again to sort this list type</span>
<span class="sd">                    lp.plst.sort().  this will then be the input to make the </span>
<span class="sd">                    data file later.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">MTpy.core.Z</span> <span class="kn">as</span> <span class="nn">Z</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">13</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">95</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">25</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">05</span>    
    
    <span class="n">periodlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">errorlst</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="n">fig1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">edi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.edi&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">z1</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">edi</span><span class="p">))</span>
            <span class="n">periodlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
            <span class="n">zdet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">zz</span><span class="p">)))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">z1</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
            <span class="n">error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">zz</span><span class="p">)))</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">z1</span><span class="o">.</span><span class="n">zvar</span><span class="p">])</span>
            <span class="n">perror</span><span class="o">=</span><span class="p">(</span><span class="n">error</span><span class="o">/</span><span class="n">zdet</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>            
            <span class="n">errorlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perror</span><span class="p">)</span>
            <span class="c">#make a plot to pick frequencies from showing period and percent </span>
            <span class="c">#error</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">perror</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">pfind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">perror</span><span class="o">&gt;</span><span class="n">errthresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pfind</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> 
                <span class="k">print</span> <span class="s">&#39;Error greater than {0:.3f} for &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">errthresh</span><span class="p">)</span><span class="o">+</span><span class="n">z1</span><span class="o">.</span><span class="n">station</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">pfind</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">perror</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">perror</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">station</span><span class="p">,</span>
                            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                            <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span>
                            <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;red&#39;</span><span class="p">})</span>
                    <span class="k">print</span> <span class="n">jj</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                <span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">errthresh</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Percent Error&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s">&#39;on&#39;</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">)</span>
    
    <span class="n">lp</span><span class="o">=</span><span class="n">ListPeriods</span><span class="p">(</span><span class="n">fig1</span><span class="p">)</span>
    <span class="n">lp</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">periodlst</span><span class="p">,</span><span class="n">errorlst</span><span class="p">,</span><span class="n">lp</span>
    
            
    
    </div>
<div class="viewcode-block" id="writeWSDataFile"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.writeWSDataFile">[docs]</a><span class="k">def</span> <span class="nf">writeWSDataFile</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">,</span><span class="n">outfn</span><span class="p">,</span><span class="n">periodlst</span><span class="p">,</span><span class="n">edipath</span><span class="p">,</span><span class="n">zerr</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">ptol</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span>
                    <span class="n">zerrmap</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;mv&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    writes a data file for WSINV3D from winglink outputs</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        sitesfn = sites filename (full path)</span>
<span class="sd">        outfn = winglink .out file</span>
<span class="sd">        periodlst = periods to extract from edifiles can get them from </span>
<span class="sd">                    using the function getPeriods.</span>
<span class="sd">        edipath = path to edifiles</span>
<span class="sd">        savepath = directory or full path to save data file to, default path</span>
<span class="sd">                    is dirname sitesfn.  saves as: savepath/WSDataFile.dat</span>
<span class="sd">        zerr = percent error to give to impedance tensor components</span>
<span class="sd">        ptol = percent tolerance to locate frequencies in case edi files don&#39;t</span>
<span class="sd">                have the same frequencies.  Need to add interpolation</span>
<span class="sd">        zerrmap = multiple to multiply err of zxx,zxy,zyx,zyy by.</span>
<span class="sd">                  Note the total error is zerr*zerrmap[ii]</span>
<span class="sd">        ncol = number of columns in outfn</span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        datafn = full path to data file, saved in dirname(sitesfn) or savepath</span>
<span class="sd">                where savepath can be a directory or full filename</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">MTpy.core.Z</span> <span class="kn">as</span> <span class="nn">Z</span>

    
    <span class="c">#get units correctly</span>
    <span class="k">if</span> <span class="n">units</span><span class="o">==</span><span class="s">&#39;mv&#39;</span><span class="p">:</span>
        <span class="n">zconv</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">796.</span>

    <span class="c">#create the output filename</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">ofile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">),</span><span class="s">&#39;WSDataFile.dat&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">ofile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;WSDataFile.dat&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ofile</span><span class="o">=</span><span class="n">savepath</span>
        
    <span class="c">#read in stations from sites file</span>
    <span class="n">sitelst</span><span class="p">,</span><span class="n">slst</span><span class="o">=</span><span class="n">readSitesFile</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">)</span>
    
    <span class="c">#get x and y locations on a relative grid</span>
    <span class="n">xlst</span><span class="p">,</span><span class="n">ylst</span><span class="o">=</span><span class="n">getXY</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">,</span><span class="n">outfn</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">)</span>
    
    <span class="c">#define some lengths</span>
    <span class="n">ns</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">slst</span><span class="p">)</span>
    <span class="n">nperiod</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">periodlst</span><span class="p">)</span>
    
    <span class="c">#make an array to put data into for easy writing</span>
    <span class="n">zarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ns</span><span class="p">,</span><span class="n">nperiod</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
    
    <span class="c">#--------find frequencies---------------------------------------------------</span>
    <span class="n">linelst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ss</span><span class="p">,</span><span class="n">s1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slst</span><span class="p">):</span>
        <span class="n">edifn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">s1</span><span class="o">+</span><span class="s">&#39;.edi&#39;</span><span class="p">)</span>
        <span class="c">#find the edi file if not named the same as in the site file</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">edifn</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="n">edifn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="n">count</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.edi&#39;</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span><span class="o">&gt;</span><span class="mi">6</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;Could not find an .edi file for:&#39;</span><span class="o">+</span><span class="n">s1</span><span class="p">)</span>
    
        <span class="n">z1</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edifn</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">station</span><span class="p">)]</span><span class="o">==</span><span class="n">z1</span><span class="o">.</span><span class="n">station</span><span class="p">:</span>
            <span class="n">sdict</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">fspot</span><span class="o">=</span><span class="p">{}</span>
            <span class="k">for</span> <span class="n">ff</span><span class="p">,</span><span class="n">f1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periodlst</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">f2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">period</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">f2</span><span class="o">&gt;=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ptol</span><span class="p">)</span><span class="o">*</span><span class="n">f1</span> <span class="ow">and</span> <span class="n">f2</span><span class="o">&lt;=</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ptol</span><span class="p">)</span><span class="o">*</span><span class="n">f1</span><span class="p">:</span>
                        <span class="n">zderr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">mm</span><span class="p">])</span><span class="o">/</span>
                                        <span class="nb">abs</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">mm</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span> 
                                        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>
                        <span class="n">fspot</span><span class="p">[</span><span class="s">&#39;{0:.6g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f1</span><span class="p">)]</span><span class="o">=</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">zderr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">zderr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                      <span class="n">zderr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">zderr</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                        <span class="n">zarr</span><span class="p">[</span><span class="n">ss</span><span class="p">,</span><span class="n">ff</span><span class="p">,:]</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
                        
            <span class="k">print</span> <span class="n">z1</span><span class="o">.</span><span class="n">station</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fspot</span><span class="p">)</span>
            <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fspot</span>
            <span class="n">sdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">station</span>
            <span class="n">linelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sdict</span><span class="p">)</span>
    
    <span class="c">#-----Write data file-------------------------------------------------------</span>
    
    <span class="n">ofid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:d} {1:d} {2:d}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="n">nperiod</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    
    <span class="c">#write N-S locations</span>
    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Station_Location: N-S </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="o">/</span><span class="mi">8</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:+.4e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ylst</span><span class="p">[</span><span class="n">ii</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">ll</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write E-W locations</span>
    <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Station_Location: E-W </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="o">/</span><span class="mi">8</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:+.4e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlst</span><span class="p">[</span><span class="n">ii</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="n">ll</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
    <span class="c">#write impedance tensor components</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">p1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periodlst</span><span class="p">):</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA_Period: {0:3.6f}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
            <span class="n">zline</span><span class="o">=</span><span class="n">zarr</span><span class="p">[</span><span class="n">ss</span><span class="p">,</span><span class="n">ii</span><span class="p">,:]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:+.4e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">zconv</span><span class="p">))</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:+.4e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">-</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">zconv</span><span class="p">))</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#write error as a percentage of Z</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">p1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periodlst</span><span class="p">):</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;ERROR_Period: {0:3.6f}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
            <span class="n">zline</span><span class="o">=</span><span class="n">zarr</span><span class="p">[</span><span class="n">ss</span><span class="p">,</span><span class="n">ii</span><span class="p">,:]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:+.4e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">zerr</span><span class="o">*</span><span class="n">zconv</span><span class="p">))</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:+.4e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">zerr</span><span class="o">*</span><span class="n">zconv</span><span class="p">))</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            
    <span class="c">#write error maps</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">p1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periodlst</span><span class="p">):</span>
        <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;ERMAP_Period: {0:3.6f}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
            <span class="n">zline</span><span class="o">=</span><span class="n">zarr</span><span class="p">[</span><span class="n">ss</span><span class="p">,</span><span class="n">ii</span><span class="p">,:]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.5e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zerrmap</span><span class="p">[</span><span class="n">jj</span><span class="p">]))</span>
                <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0:.5e} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zerrmap</span><span class="p">[</span><span class="n">jj</span><span class="p">]))</span>
            <span class="n">ofid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">ofid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;Wrote file to: &#39;</span><span class="o">+</span><span class="n">ofile</span>
    
    <span class="c">#write out places where errors are larger than error tolerance</span>
    <span class="n">errfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">ofile</span><span class="p">),</span><span class="s">&#39;DataErrorLocations.txt&#39;</span><span class="p">),</span>
                <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Errors larger than error tolerance of: </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Zxx={0} Zxy={1} Zyx={2} Zyy={3} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zerrmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">zerr</span><span class="p">,</span>
                 <span class="n">zerrmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">zerr</span><span class="p">,</span><span class="n">zerrmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">zerr</span><span class="p">,</span><span class="n">zerrmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">zerr</span><span class="p">))</span>
    <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;station  T=period(s) Zij err=percentage </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pfdict</span> <span class="ow">in</span> <span class="n">linelst</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">zerr</span><span class="o">*</span><span class="mi">100</span><span class="o">*</span><span class="n">zerrmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;  T=&#39;</span><span class="o">+</span><span class="n">ff</span><span class="o">+</span>\
                        <span class="s">&#39; Zxx err={0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span> 
            <span class="k">if</span> <span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span><span class="n">zerr</span><span class="o">*</span><span class="mi">100</span><span class="o">*</span><span class="n">zerrmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;  T=&#39;</span><span class="o">+</span><span class="n">ff</span><span class="o">+</span>\
                        <span class="s">&#39; Zxy err={0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span> 
            <span class="k">if</span> <span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">&gt;</span><span class="n">zerr</span><span class="o">*</span><span class="mi">100</span><span class="o">*</span><span class="n">zerrmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;  T=&#39;</span><span class="o">+</span><span class="n">ff</span><span class="o">+</span>\
                        <span class="s">&#39; Zyx err={0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">&gt;</span><span class="n">zerr</span><span class="o">*</span><span class="mi">100</span><span class="o">*</span><span class="n">zerrmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">errfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;  T=&#39;</span><span class="o">+</span><span class="n">ff</span><span class="o">+</span>\
                        <span class="s">&#39; Zyy err={0:.3f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pfdict</span><span class="p">[</span><span class="s">&#39;fspot&#39;</span><span class="p">][</span><span class="n">ff</span><span class="p">][</span><span class="mi">5</span><span class="p">]))</span> 
    <span class="n">errfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;Wrote errors lager than tolerance to: &#39;</span>
    <span class="k">print</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">ofile</span><span class="p">),</span><span class="s">&#39;DataErrorLocations.txt&#39;</span><span class="p">)</span>
                
    
    <span class="k">return</span> <span class="n">ofile</span><span class="p">,</span><span class="n">linelst</span>

</div>
<div class="viewcode-block" id="writeInit3DFile"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.writeInit3DFile">[docs]</a><span class="k">def</span> <span class="nf">writeInit3DFile</span><span class="p">(</span><span class="n">outfn</span><span class="p">,</span><span class="n">rhostart</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes an init3d file for WSINV3D</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        outfn = full path to .out file from winglink</span>
<span class="sd">        rhostart = starting homogeneous half space in Ohm-m</span>
<span class="sd">        ncol = number of columns for data to be written in</span>
<span class="sd">        savepath = full path to save the init file</span>
<span class="sd">        </span>
<span class="sd">    Output:</span>
<span class="sd">        ifile = full path to init file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c">#create the output filename</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">ifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">outfn</span><span class="p">),</span><span class="s">&#39;init3d&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">ifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;init3d&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ifile</span><span class="o">=</span><span class="n">savepath</span>
        
    <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="o">=</span><span class="n">readWLOutFile</span><span class="p">(</span><span class="n">outfn</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">)</span>
    
    <span class="n">nx</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">ny</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
    <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dz</span><span class="p">)</span>
    
    <span class="n">init_modelFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ifile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">init_modelFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#Initial model </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">init_modelFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> 1 </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">nz</span><span class="p">))</span>
        
    <span class="c">#write y locations</span>
    <span class="n">y_string</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="n">y_counter</span><span class="o">=</span><span class="mi">0</span> 
    <span class="k">for</span> <span class="n">y_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
        <span class="n">y_string</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%.3e</span><span class="s">  &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">dy</span><span class="p">[</span><span class="n">y_idx</span><span class="p">])</span>
        <span class="n">y_counter</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">y_counter</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">y_string</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">y_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">ny</span><span class="o">%</span><span class="mi">8</span><span class="p">:</span>
        <span class="n">y_string</span> <span class="o">+=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">init_modelFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">y_string</span><span class="p">)</span>
    
    <span class="c">#write x locations</span>
    <span class="n">x_string</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="n">x_counter</span><span class="o">=</span><span class="mi">0</span> 
    <span class="k">for</span> <span class="n">x_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
        <span class="n">x_string</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%.3e</span><span class="s">  &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">dx</span><span class="p">[</span><span class="n">x_idx</span><span class="p">])</span>
        <span class="n">x_counter</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">x_counter</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">x_string</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">x_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">nx</span><span class="o">%</span><span class="mi">8</span><span class="p">:</span>		    
	<span class="n">x_string</span> <span class="o">+=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">init_modelFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x_string</span><span class="p">)</span>

    <span class="c">#write z locations</span>
    <span class="n">z_string</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="n">z_counter</span><span class="o">=</span><span class="mi">0</span> 
    <span class="k">for</span> <span class="n">z_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
        <span class="n">z_string</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%.3e</span><span class="s">  &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">z_idx</span><span class="p">])</span>
        <span class="n">z_counter</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">z_counter</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">z_string</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">z_counter</span> <span class="o">=</span> <span class="mi">0</span>   
    <span class="k">if</span> <span class="n">nz</span><span class="o">%</span><span class="mi">8</span><span class="p">:</span>
        <span class="n">z_string</span> <span class="o">+=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">init_modelFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">z_string</span><span class="p">)</span>
   

        
    <span class="n">init_modelFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%i</span><span class="s"> </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="nb">int</span><span class="p">(</span><span class="n">rhostart</span><span class="p">))</span>
    
    <span class="n">init_modelFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">print</span> <span class="s">&#39;Wrote init file to: &#39;</span><span class="o">+</span> <span class="n">ifile</span>

    
    <span class="k">return</span> <span class="n">ifile</span>
        </div>
<div class="viewcode-block" id="writeStartupFile"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.writeStartupFile">[docs]</a><span class="k">def</span> <span class="nf">writeStartupFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">initialfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">outputfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">apriorfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">modells</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">],</span><span class="n">targetrms</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">control</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">errortol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">staticfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">lagrange</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makes a startup file for WSINV3D t.  Most of these parameters are not input</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        datafn = full path to the data file written for inversion</span>
<span class="sd">        initialfn = full path to init file</span>
<span class="sd">        outputfn = output stem to which the _model and _resp will be written</span>
<span class="sd">        savepath = full path to save the startup file to</span>
<span class="sd">        apriorfn = full path to apriori model</span>
<span class="sd">        modells = smoothing parameters </span>
<span class="sd">        targetrms = target rms</span>
<span class="sd">        control = something</span>
<span class="sd">        maxiter = maximum number of iterations</span>
<span class="sd">        errotol = error tolerance for the computer?</span>
<span class="sd">        staticfn = full path to static shift file name</span>
<span class="sd">        lagrange = starting lagrange multiplier</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">        sfile = full path to startup file</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c">#create the output filename</span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">datafn</span><span class="p">),</span><span class="s">&#39;startup&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">sfile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;startup&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfile</span><span class="o">=</span><span class="n">savepath</span>
    
    <span class="n">sfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    
    <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">11</span><span class="o">+</span><span class="s">&#39;../&#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">datafn</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
 
    <span class="k">if</span> <span class="n">outputfn</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OUTPUT_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">9</span><span class="o">+</span><span class="s">&#39;Iter_ </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OUTPUT_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">9</span><span class="o">+</span><span class="n">outputfn</span><span class="o">+</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">initialfn</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;INITIAL_MODEL_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="s">&#39;../init3d </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;INITIAL_MODEL_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">initialfn</span><span class="o">+</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">apriorfn</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PRIOR_MODEL_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="s">&#39;default </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PRIOR_MODEL_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">apriorfn</span><span class="o">+</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">control</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CONTROL_MODEL_INDEX&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="s">&#39;default </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CONTROL_MODEL_INDEX&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">control</span><span class="o">+</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
    <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TARGET_RMS&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="s">&#39;{0} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">targetrms</span><span class="p">))</span>
    
    <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;MAX_NO_ITERATION&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="s">&#39;{0} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxiter</span><span class="p">))</span>

    <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;MODEL_LENGTH_SCALE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span>
                <span class="s">&#39;{0} {1:.1f} {1:.1f} {1:.1f} </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modells</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">modells</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                        <span class="n">modells</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">modells</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        
    <span class="k">if</span> <span class="n">initialfn</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;LAGRANGE_INFO&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="s">&#39;default </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;LAGRANGE_INFO&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="n">lagrange</span><span class="o">+</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    

    <span class="k">if</span> <span class="n">initialfn</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;ERROR_TOL_LEVEL&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="s">&#39;default </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;ERROR_TOL_LEVEL&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="n">errortol</span><span class="o">+</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
         
    <span class="k">if</span> <span class="n">initialfn</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;STATIC_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">9</span><span class="o">+</span><span class="s">&#39;default </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
         <span class="n">sfid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;STATIC_FILE&#39;</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">*</span><span class="mi">9</span><span class="o">+</span><span class="n">staticfn</span><span class="o">+</span><span class="s">&#39; </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="n">sfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">print</span> <span class="s">&#39;Wrote startup file to: &#39;</span><span class="o">+</span><span class="n">sfile</span>
    
    <span class="k">return</span> <span class="n">sfile</span>
    </div>
<div class="viewcode-block" id="readDataFile"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.readDataFile">[docs]</a><span class="k">def</span> <span class="nf">readDataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">sitesfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;mv&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read in data file</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        datafn = full path to data file</span>
<span class="sd">        sitesfn = full path to sites file output by winglink</span>
<span class="sd">        units = &#39;mv&#39; always</span>
<span class="sd">        </span>
<span class="sd">    Outputs:</span>
<span class="sd">       period = list of periods used for the inversion</span>
<span class="sd">       zarr = array of impedance values </span>
<span class="sd">               (number of staitons x number of periods x 2 x 2)</span>
<span class="sd">       zerr = array of errors in impedance component</span>
<span class="sd">       nsarr = station locations relative distance from center of grid in N-S</span>
<span class="sd">       ewarr = station locations relative distance from center of grid in E-W</span>
<span class="sd">       sitelst = list of sites used in data         </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">units</span><span class="o">==</span><span class="s">&#39;mv&#39;</span><span class="p">:</span>
        <span class="n">zconv</span><span class="o">=</span><span class="mf">796.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zconv</span><span class="o">=</span><span class="mi">1</span>
    
        
    <span class="n">dfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">dlines</span><span class="o">=</span><span class="n">dfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c">#get size number of stations, number of frequencies, number of Z components    </span>
    <span class="n">ns</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="n">nz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
    <span class="n">nsstart</span><span class="o">=</span><span class="mi">2</span>
    
    <span class="n">findlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">50</span><span class="p">],</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Station_Location: N-S&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">findlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Station_Location: E-W&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">findlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;DATA_Period:&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">findlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            
    <span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">nsstart</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="c">#    print ncol</span>
<span class="c">#    nsstop=nsstart+ns/ncol+1</span>
<span class="c">#    ewstart=nsstop+1</span>
<span class="c">#    ewstop=ewstart+ns/ncol+1</span>
<span class="c">#    zstart=ewstop</span>
<span class="c">#    print nsstop,ewstart,ewstop,zstart</span>
    
    <span class="c">#get site names if entered a sites file</span>
    <span class="k">if</span> <span class="n">sitesfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">slst</span><span class="p">,</span><span class="n">sitelst</span><span class="o">=</span><span class="n">readSitesFile</span><span class="p">(</span><span class="n">sitesfn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sitelst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>

    <span class="c">#get N-S locations</span>
    <span class="n">nsarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">findlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">dline</span><span class="o">=</span><span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nsarr</span><span class="p">[</span><span class="n">ii</span><span class="o">*</span><span class="n">ncol</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dline</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">break</span>
            
    <span class="c">#get E-W locations</span>
    <span class="n">ewarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">findlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">dline</span><span class="o">=</span><span class="n">dline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ewarr</span><span class="p">[</span><span class="n">ii</span><span class="o">*</span><span class="n">ncol</span><span class="o">+</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dline</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="c">#make some empty array to put stuff into</span>
    <span class="n">period</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
    <span class="n">zarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ns</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>
    <span class="n">zerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">zarr</span><span class="p">)</span>
    <span class="n">zerrmap</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">zarr</span><span class="p">)</span>

    <span class="c">#get data</span>
    <span class="n">pcount</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">zcount</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">findlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">nf</span><span class="o">*</span><span class="p">(</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">)]):</span>
        <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;DATA_Period&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">period</span><span class="p">[</span><span class="n">pcount</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">pcount</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zcount</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zline</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span><span class="o">*</span><span class="n">zconv</span>
            <span class="n">zarr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">zcount</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="n">zline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                                <span class="p">[</span><span class="n">zline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                                 <span class="n">zline</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">7</span><span class="p">]]])</span>
            <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="c">#if the data file is made from this program or is the input data file than</span>
    <span class="c">#get the errors from that file</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlines</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">nf</span><span class="o">*</span><span class="n">ns</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Getting Error&#39;</span>
        <span class="n">pecount</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">zecount</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">nf</span><span class="o">*</span><span class="p">(</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">findlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nf</span><span class="o">*</span><span class="p">(</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">)]):</span>
            <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;ERROR_Period&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">pecount</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zecount</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zline</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span><span class="o">*</span><span class="n">zconv</span>
                <span class="n">zerr</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">zecount</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                    <span class="n">zline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                                    <span class="p">[</span><span class="n">zline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                                     <span class="n">zline</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">7</span><span class="p">]]])</span>
                <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                
    <span class="c">#get errormap values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dlines</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">*</span><span class="n">nf</span><span class="o">*</span><span class="n">ns</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Getting Error Map&#39;</span>
        <span class="n">pmcount</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">zmcount</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">dl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dlines</span><span class="p">[</span><span class="n">findlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nf</span><span class="o">*</span><span class="p">(</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">findlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">nf</span><span class="o">*</span><span class="p">(</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">)]):</span>
            <span class="k">if</span> <span class="n">dl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;ERMAP_Period&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">pmcount</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zmcount</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#account for end of file empty lines</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">zline</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
                    <span class="n">zerrmap</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">zmcount</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zline</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                        <span class="n">zline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                                        <span class="p">[</span><span class="n">zline</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                                         <span class="n">zline</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zline</span><span class="p">[</span><span class="mi">7</span><span class="p">]]])</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="c">#multiply errmap and error and convert from Ohm to mv/km nT</span>
    <span class="n">zerr</span><span class="o">=</span><span class="n">zerr</span><span class="o">*</span><span class="n">zerrmap</span>                                           

        
    <span class="k">return</span> <span class="n">period</span><span class="p">,</span><span class="n">zarr</span><span class="p">,</span><span class="n">zerr</span><span class="p">,</span><span class="n">nsarr</span><span class="p">,</span><span class="n">ewarr</span><span class="p">,</span><span class="n">sitelst</span>
    </div>
<div class="viewcode-block" id="plotDataResPhase"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.plotDataResPhase">[docs]</a><span class="k">def</span> <span class="nf">plotDataResPhase</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">respfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">sitesfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">plottype</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="n">plotnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;mv&#39;</span><span class="p">,</span><span class="n">colormode</span><span class="o">=</span><span class="s">&#39;color&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot responses from the data file and if there is a response file</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        datafn = fullpath to data file</span>
<span class="sd">        respfn = full path to respsonse file, if not input, just the data is</span>
<span class="sd">                 plotted. Can be a list of response files from the same </span>
<span class="sd">                 inversion</span>
<span class="sd">        plottype= &#39;1&#39; to plot each station in a different window</span>
<span class="sd">                  [stations] for list of stations to plot (stations are numbers)</span>
<span class="sd">        plotnum = 1 for just xy,yx</span>
<span class="sd">                  2 for all components</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">MTpy.core.Z</span> <span class="kn">as</span> <span class="nn">Z</span>

    
    <span class="c">#plot in color mode or black and white</span>
    <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>
        <span class="c">#color for data</span>
        <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mted</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
        <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
        
        <span class="c">#color for occam model</span>
        <span class="n">ctem</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ctmm</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mtem</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
        <span class="n">mtmm</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
        
    <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
        <span class="c">#color for data</span>
        <span class="n">cted</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ctmd</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mted</span><span class="o">=</span><span class="s">&#39;*&#39;</span>
        <span class="n">mtmd</span><span class="o">=</span><span class="s">&#39;v&#39;</span>
        
        <span class="c">#color for occam model</span>
        <span class="n">ctem</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ctmm</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">mtem</span><span class="o">=</span><span class="s">&#39;+&#39;</span>
        <span class="n">mtmm</span><span class="o">=</span><span class="s">&#39;x&#39;</span>
    
    
    <span class="c">#load the data file     </span>
    <span class="n">period</span><span class="p">,</span><span class="n">dz</span><span class="p">,</span><span class="n">dzerr</span><span class="p">,</span><span class="n">north</span><span class="p">,</span><span class="n">east</span><span class="p">,</span><span class="n">slst</span><span class="o">=</span><span class="n">readDataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">sitesfn</span><span class="o">=</span><span class="n">sitesfn</span><span class="p">,</span>
                                                 <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    <span class="c">#get shape of impedance tensors</span>
    <span class="n">ns</span><span class="p">,</span><span class="n">nf</span><span class="o">=</span><span class="n">dz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c">#read in response files</span>
    <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">rzlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">rzerrlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">respfn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">respfn</span><span class="o">=</span><span class="p">[</span><span class="n">respfn</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rfile</span> <span class="ow">in</span> <span class="n">respfn</span><span class="p">:</span>
            <span class="n">period</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span><span class="n">rzerr</span><span class="p">,</span><span class="n">north</span><span class="p">,</span><span class="n">east</span><span class="p">,</span><span class="n">slst</span><span class="o">=</span><span class="n">readDataFile</span><span class="p">(</span><span class="n">rfile</span><span class="p">,</span><span class="n">sitesfn</span><span class="o">=</span><span class="n">sitesfn</span><span class="p">,</span>
                                                         <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
            <span class="n">rzlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>
            <span class="n">rzerrlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rzerr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rzlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="c">#get number of response files</span>
    <span class="n">nr</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rzlst</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plottype</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">ns</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">plottype</span><span class="p">)</span>
      
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">13</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">92</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">25</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">05</span>
    
    <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">}</span>    
    <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>    
    
    
    <span class="k">if</span> <span class="n">plottype</span><span class="o">!=</span><span class="s">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">pstationlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">plottype</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">plottype</span><span class="o">=</span><span class="p">[</span><span class="n">plottype</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">station</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slst</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">station</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">station</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pstation</span><span class="p">))</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pstation</span> <span class="ow">in</span> <span class="n">plottype</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">station</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">pstation</span><span class="p">):</span>
                        <span class="n">pstationlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pstationlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">pstationlst</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Plotting: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">slst</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        
        <span class="c">#check for masked points</span>
        <span class="n">dz</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">==</span><span class="mf">7.95204E5</span><span class="o">-</span><span class="mf">7.95204E5</span><span class="n">j</span><span class="p">)]</span><span class="o">=</span><span class="mf">0.0</span><span class="o">+</span><span class="mf">0.0</span><span class="n">j</span>
        <span class="n">dzerr</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">==</span><span class="mf">7.95204E5</span><span class="o">-</span><span class="mf">7.95204E5</span><span class="n">j</span><span class="p">)]</span><span class="o">=</span><span class="mf">1.0</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span>
        
        <span class="c">#convert to apparent resistivity and phase</span>
        <span class="n">rp</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="n">dzerr</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        
        <span class="c">#find locations where points have been masked</span>
        <span class="n">nzxx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxx</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nzxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nzyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nzyy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resyy</span><span class="o">!=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">plotr</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotr</span><span class="o">=</span><span class="bp">False</span>
        
        <span class="c">#make figure for xy,yx components</span>
        <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> 
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">jj</span><span class="p">,[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">jj</span><span class="p">,[</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mo">07</span><span class="p">)</span>
        
        <span class="c">#---------plot the apparent resistivity-----------------------------------</span>
        <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">slst</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">erxy</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                         <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span>
                         <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">)</span>
        <span class="n">eryx</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                         <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span>
                         <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resyxerr</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotr</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>   
                    <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">4</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="o">.</span><span class="mi">13</span><span class="p">,</span><span class="o">.</span><span class="mi">63</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
                    <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>                    
                    <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>
                
                <span class="n">rpr</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">rzlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">],</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="n">rzerrlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                
<span class="c">#                rms=np.sqrt(np.sum([abs(np.linalg.det(rp.z[ll])-</span>
<span class="c">#                                        np.linalg.det(rpr.z[ll]))**2 </span>
<span class="c">#                            for ll in range(len(rp.period))])/len(rp.period))</span>
                <span class="n">rms</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ll</span><span class="p">]))</span><span class="o">-</span>
                                    <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">rpr</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ll</span><span class="p">])))</span> 
                                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">period</span><span class="p">))]))</span>
                <span class="k">print</span> <span class="n">rms</span>
                <span class="n">erxyr</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">rpr</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span>
                                  <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span>
                                  <span class="n">yerr</span><span class="o">=</span><span class="n">rpr</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                                  <span class="n">ecolor</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">)</span>
                <span class="n">eryxr</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">rpr</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span>
                                  <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span>
                                  <span class="n">yerr</span><span class="o">=</span><span class="n">rpr</span><span class="o">.</span><span class="n">resyxerr</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                                  <span class="n">ecolor</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">)</span>
        <span class="c">#ax.set_xlabel(&#39;Period (s)&#39;,fontdict=fontdict)</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\mathbf{\Omega \cdot m}$)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
                 <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotr</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">erxyr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryxr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                      <span class="p">(</span><span class="s">&#39;Data $E_x/B_y$&#39;</span><span class="p">,</span><span class="s">&#39;Data $E_y/B_x$&#39;</span><span class="p">,</span>
                      <span class="s">&#39;Mod $E_x/B_y$&#39;</span><span class="p">,</span><span class="s">&#39;Mod $E_y/B_x$&#39;</span><span class="p">),</span>
                      <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span>
                      <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;$E_x/B_y$&#39;</span><span class="p">,</span><span class="s">&#39;$E_y/B_x$&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
        
        <span class="c">#-----Plot the phase----------------------------------------------------</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                     <span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">])</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span>
                     <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span>
                     <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span>
                     <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotr</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>   
                    <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">4</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="o">.</span><span class="mi">13</span><span class="p">,</span><span class="o">.</span><span class="mi">63</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
                    <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>                    
                    <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>
                <span class="n">rpr</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">rzlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">],</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="n">rzerrlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">rpr</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                             <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span>
                             <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">[</span><span class="n">nzxy</span><span class="p">],</span>
                             <span class="n">ecolor</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rpr</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">nzyx</span><span class="p">])</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span>
                             <span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span>
                             <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">[</span><span class="n">nzyx</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="c">#ax2.set_xlim(xmin=10**(np.floor(np.log10(period[0]))),</span>
        <span class="c">#         xmax=10**(np.ceil(np.log10(period[-1]))))</span>
        <span class="c">#check the phase to see if any point are outside of [0:90]    </span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">pymin</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">pymin</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">pymin</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pymin</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">90</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">pymax</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">pymax</span><span class="o">&lt;</span><span class="mi">91</span><span class="p">:</span>
                <span class="n">pymax</span><span class="o">=</span><span class="mi">90</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pymax</span><span class="o">=</span><span class="mi">90</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">pymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">pymax</span><span class="p">)</span>        
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="c">#---------plot the apparent resistivity-----------------------------------</span>
            <span class="n">ax3</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">erxx</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                              <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span>
                              <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resxxerr</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                              <span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">)</span>
            <span class="n">eryy</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                              <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span>
                              <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resyyerr</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                              <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plotr</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>   
                        <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">4</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="o">.</span><span class="mi">13</span><span class="p">,</span><span class="o">.</span><span class="mi">63</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
                        <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>                    
                        <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>
                    <span class="n">rpr</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">rzlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">],</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="n">rzerrlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                    <span class="n">erxxr</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">rpr</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                       <span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span>
                                       <span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rpr</span><span class="o">.</span><span class="n">resxxerr</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                       <span class="n">ecolor</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">)</span>
                    <span class="n">eryyr</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span><span class="n">rpr</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                       <span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span>
                                       <span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rpr</span><span class="o">.</span><span class="n">resyyerr</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                                       <span class="n">ecolor</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">)</span>

            <span class="n">ax3</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax3</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
                     <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plotr</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">erxxr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryyr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                          <span class="p">(</span><span class="s">&#39;Data $E_x/B_x$&#39;</span><span class="p">,</span><span class="s">&#39;Data $E_y/B_y$&#39;</span><span class="p">,</span>
                          <span class="s">&#39;Mod $E_x/B_x$&#39;</span><span class="p">,</span><span class="s">&#39;Mod $E_y/B_y$&#39;</span><span class="p">),</span>
                          <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span>
                          <span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span><span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryy</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;$E_x/B_x$&#39;</span><span class="p">,</span><span class="s">&#39;$E_y/B_y$&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span>
                            <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
            
            <span class="c">#-----Plot the phase----------------------------------------------------</span>
            <span class="n">ax4</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
            
            <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mted</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                         <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span>
                         <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexxerr</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">ecolor</span><span class="o">=</span><span class="n">cted</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cted</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">]),</span><span class="n">marker</span><span class="o">=</span><span class="n">mtmd</span><span class="p">,</span>
                         <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span>
                         <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyyerr</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span>
                         <span class="n">ecolor</span><span class="o">=</span><span class="n">ctmd</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">ctmd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plotr</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nr</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;color&#39;</span><span class="p">:</span>   
                        <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">4</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">),</span><span class="o">.</span><span class="mi">13</span><span class="p">,</span><span class="o">.</span><span class="mi">63</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">nr</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">colormode</span><span class="o">==</span><span class="s">&#39;bw&#39;</span><span class="p">:</span>
                        <span class="n">cxy</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>                    
                        <span class="n">cyx</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="mf">1.25</span><span class="o">/</span><span class="p">(</span><span class="n">rr</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>
                    <span class="n">rpr</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">rzlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">],</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="n">rzerrlst</span><span class="p">[</span><span class="n">rr</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">rpr</span><span class="o">.</span><span class="n">phasexx</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="n">mtem</span><span class="p">,</span>
                                 <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span>
                                 <span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexxerr</span><span class="p">[</span><span class="n">nzxx</span><span class="p">],</span>
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">cxy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cxy</span><span class="p">)</span>
                    <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rpr</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">[</span><span class="n">nzyy</span><span class="p">]),</span>
                                 <span class="n">marker</span><span class="o">=</span><span class="n">mtmm</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyyerr</span><span class="p">[</span><span class="n">nzyy</span><span class="p">],</span> 
                                 <span class="n">ecolor</span><span class="o">=</span><span class="n">cyx</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">cyx</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
            <span class="c">#ax4.set_ylabel(&#39;Imepdance Phase (deg)&#39;,fontdict)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="c">#ax2.set_xlim(xmin=10**(np.floor(np.log10(period[0]))),</span>
            <span class="c">#         xmax=10**(np.ceil(np.log10(period[-1]))))</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>        
            <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="plotTensorMaps"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.plotTensorMaps">[docs]</a><span class="k">def</span> <span class="nf">plotTensorMaps</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">respfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">sitesfn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">periodlst</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">esize</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;phimin&#39;</span><span class="p">,</span>
                   <span class="n">colormm</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span>
                   <span class="n">xpad</span><span class="o">=.</span><span class="mi">500</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;mv&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot phase tensor maps for data and or response, each figure is of a</span>
<span class="sd">    different period.  If response is input a third column is added which is </span>
<span class="sd">    the residual phase tensor showing where the model is not fitting the data </span>
<span class="sd">    well.  The data is plotted in km in units of ohm-m.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        datafn = full path to data file</span>
<span class="sd">        respfn = full path to response file, if none just plots data</span>
<span class="sd">        sitesfn = full path to sites file</span>
<span class="sd">        periodlst = indicies of periods you want to plot</span>
<span class="sd">        esize = size of ellipses as:</span>
<span class="sd">                0 = phase tensor ellipse</span>
<span class="sd">                1 = phase tensor residual</span>
<span class="sd">                2 = resistivity tensor ellipse</span>
<span class="sd">                3 = resistivity tensor residual</span>
<span class="sd">        ecolor = &#39;phimin&#39; for coloring with phimin or &#39;beta&#39; for beta coloring</span>
<span class="sd">        colormm = list of min and max coloring for plot, list as follows:</span>
<span class="sd">                0 = phase tensor min and max for ecolor in degrees</span>
<span class="sd">                1 = phase tensor residual min and max [0,1]</span>
<span class="sd">                2 = resistivity tensor coloring as resistivity on log scale</span>
<span class="sd">                3 = resistivity tensor residual coloring as resistivity on </span>
<span class="sd">                    linear scale</span>
<span class="sd">        xpad = padding of map from stations at extremities (km)</span>
<span class="sd">        units = &#39;mv&#39; to convert to Ohm-m </span>
<span class="sd">        dpi = dots per inch of figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">MTpy.core.Z</span> <span class="kn">as</span> <span class="nn">Z</span>
    
    <span class="n">period</span><span class="p">,</span><span class="n">zd</span><span class="p">,</span><span class="n">zderr</span><span class="p">,</span><span class="n">nsarr</span><span class="p">,</span><span class="n">ewarr</span><span class="p">,</span><span class="n">sitelst</span><span class="o">=</span><span class="n">readDataFile</span><span class="p">(</span><span class="n">datafn</span><span class="p">,</span><span class="n">sitesfn</span><span class="o">=</span><span class="n">sitesfn</span><span class="p">,</span>
                                                      <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">period</span><span class="p">,</span><span class="n">zr</span><span class="p">,</span><span class="n">zrerr</span><span class="p">,</span><span class="n">nsarr</span><span class="p">,</span><span class="n">ewarr</span><span class="p">,</span><span class="n">sitelst</span><span class="o">=</span><span class="n">readDataFile</span><span class="p">(</span><span class="n">respfn</span><span class="p">,</span><span class="n">sitesfn</span><span class="o">=</span><span class="n">sitesfn</span><span class="p">,</span>
                                                         <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">periodlst</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">periodlst</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">))</span>
        
    <span class="c">#put locations into an logical coordinate system in km</span>
    <span class="n">nsarr</span><span class="o">=-</span><span class="n">nsarr</span><span class="o">/</span><span class="mi">1000</span>
    <span class="n">ewarr</span><span class="o">=-</span><span class="n">ewarr</span><span class="o">/</span><span class="mi">1000</span>

    <span class="c">#get coloring min&#39;s and max&#39;s    </span>
    <span class="k">if</span> <span class="n">colormm</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">ptmin</span><span class="p">,</span><span class="n">ptmax</span><span class="o">=</span><span class="p">(</span><span class="n">colormm</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span><span class="n">colormm</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">ptrmin</span><span class="p">,</span><span class="n">ptrmax</span><span class="o">=</span><span class="n">colormm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">rtmin</span><span class="p">,</span><span class="n">rtmax</span><span class="o">=</span><span class="n">colormm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">rtrmin</span><span class="p">,</span><span class="n">rtrmax</span><span class="o">=</span><span class="n">colormm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="c">#get ellipse sizes</span>
    <span class="n">ptsize</span><span class="o">=</span><span class="n">esize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ptrsize</span><span class="o">=</span><span class="n">esize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">rtsize</span><span class="o">=</span><span class="n">esize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">rtrsize</span><span class="o">=</span><span class="n">esize</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">03</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">90</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">005</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">005</span>
    
    <span class="n">ns</span><span class="o">=</span><span class="n">zd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">ff</span><span class="p">,</span><span class="n">per</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">periodlst</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;Plotting Period: {0:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">per</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">per</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>

        <span class="c">#get phase tensor</span>
        <span class="n">pt</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="n">zd</span><span class="p">[:,</span><span class="n">per</span><span class="p">])</span>

        <span class="c">#get resistivity tensor</span>
        <span class="n">rt</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResistivityTensor</span><span class="p">(</span><span class="n">zd</span><span class="p">[:,</span><span class="n">per</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">period</span><span class="p">[</span><span class="n">per</span><span class="p">],</span><span class="n">ns</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">respfn</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="c">#get phase tensor and residual phase tensor</span>
            <span class="n">ptr</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="n">zr</span><span class="p">[:,</span><span class="n">per</span><span class="p">])</span>
            <span class="n">ptd</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">PhaseTensorResidual</span><span class="p">(</span><span class="n">zd</span><span class="p">[:,</span><span class="n">per</span><span class="p">],</span><span class="n">zr</span><span class="p">[:,</span><span class="n">per</span><span class="p">])</span>
            
            <span class="c">#get resistivity tensor and residual</span>
            <span class="n">rtr</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResistivityTensor</span><span class="p">(</span><span class="n">zr</span><span class="p">[:,</span><span class="n">per</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">period</span><span class="p">[</span><span class="n">per</span><span class="p">],</span><span class="n">ns</span><span class="p">))</span>
            <span class="n">rtd</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">ResistivityTensorResidual</span><span class="p">(</span><span class="n">zd</span><span class="p">[:,</span><span class="n">per</span><span class="p">],</span><span class="n">zr</span><span class="p">[:,</span><span class="n">per</span><span class="p">],</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">period</span><span class="p">[</span><span class="n">per</span><span class="p">],</span><span class="n">ns</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">colormm</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;phimin&#39;</span><span class="p">:</span>
                    <span class="n">ptmin</span><span class="p">,</span><span class="n">ptmax</span><span class="o">=</span><span class="p">(</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimin</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                                 <span class="n">ptr</span><span class="o">.</span><span class="n">phimin</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;beta&#39;</span><span class="p">:</span>
                    <span class="n">ptmin</span><span class="p">,</span><span class="n">ptmax</span><span class="o">=</span><span class="p">(</span><span class="n">ptr</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">ptr</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                    
                <span class="n">ptrmin</span><span class="p">,</span><span class="n">ptrmax</span><span class="o">=</span><span class="p">(</span><span class="n">ptd</span><span class="o">.</span><span class="n">ecolor</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">ptd</span><span class="o">.</span><span class="n">ecolor</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                <span class="n">rtmin</span><span class="p">,</span><span class="n">rtmax</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhodet</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhodet</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
                <span class="n">rtrmin</span><span class="p">,</span><span class="n">rtrmax</span><span class="o">=</span><span class="n">rtd</span><span class="o">.</span><span class="n">rhodet</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">rtd</span><span class="o">.</span><span class="n">rhodet</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="c">#make subplots            </span>
            <span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax5</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax6</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
                <span class="c">#-----------plot data phase tensors---------------</span>
                <span class="n">eheightd</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptsize</span>
                <span class="n">ewidthd</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptsize</span>
            
                <span class="n">ellipd</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">ewidthd</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">eheightd</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="c">#color ellipse:</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;phimin&#39;</span><span class="p">:</span>
                    <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptmax</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;beta&#39;</span><span class="p">:</span>
                    <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptmax</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cvars</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">cvars</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                
                <span class="n">ax1</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellipd</span><span class="p">)</span>
                
                <span class="c">#----------plot response phase tensors---------------------</span>
                <span class="n">eheightr</span><span class="o">=</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptsize</span>
                <span class="n">ewidthr</span><span class="o">=</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptsize</span>
            
                <span class="n">ellipr</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">ewidthr</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">eheightr</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">ptr</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="c">#color ellipse:</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;phimin&#39;</span><span class="p">:</span>
                    <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">ptr</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptmax</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;beta&#39;</span><span class="p">:</span>
                    <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ptr</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptmax</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cvars</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">cvars</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellipr</span><span class="p">)</span>
                
                <span class="c">#--------plot residual phase tensors-------------</span>
                <span class="n">eheight</span><span class="o">=</span><span class="n">ptd</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">ptd</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptrsize</span>
                <span class="n">ewidth</span><span class="o">=</span><span class="n">ptd</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">ptd</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptrsize</span>
            
                <span class="n">ellip</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">ewidth</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">eheight</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">ptd</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span>
                <span class="c">#color ellipse:</span>
                <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">ptd</span><span class="o">.</span><span class="n">ecolor</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">ptrmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptrmax</span><span class="o">-</span><span class="n">ptrmin</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">))</span>
                
                <span class="n">ax3</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellip</span><span class="p">)</span>
                
                <span class="c">#-----------plot data resistivity tensors---------------</span>
                <span class="n">rheightd</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtsize</span>
                <span class="n">rwidthd</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtsize</span>
            
                <span class="n">rellipd</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">rwidthd</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">rheightd</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">rhoazimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="c">#color ellipse:</span>
                <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">-</span><span class="n">rtmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rtmax</span><span class="o">-</span><span class="n">rtmin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;.</span><span class="mi">5</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)))</span>
                
                <span class="n">ax4</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">rellipd</span><span class="p">)</span>
                
                <span class="c">#----------plot response resistivity tensors---------------------</span>
                <span class="n">rheightr</span><span class="o">=</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtsize</span>
                <span class="n">rwidthr</span><span class="o">=</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtsize</span>
            
                <span class="n">rellipr</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">rwidthr</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">rheightr</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhoazimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>

                <span class="c">#color ellipse:</span>
                <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rtr</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">-</span><span class="n">rtmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rtmax</span><span class="o">-</span><span class="n">rtmin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;.</span><span class="mi">5</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellipr</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)))</span>
                
                <span class="n">ax5</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">rellipr</span><span class="p">)</span>
                
                <span class="c">#--------plot residual resistivity tensors-------------</span>
                <span class="n">rheight</span><span class="o">=</span><span class="n">rtd</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rtd</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtrsize</span>
                <span class="n">rwidth</span><span class="o">=</span><span class="n">rtd</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rtd</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtrsize</span>
            
                <span class="n">rellip</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">rwidth</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">rheight</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">rtd</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span>
                <span class="c">#color ellipse:</span>
                <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">rtd</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">-</span><span class="n">rtrmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rtrmax</span><span class="o">-</span><span class="n">rtrmin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cvar</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)))</span>
                    
                <span class="n">ax6</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">rellip</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">,</span><span class="n">ax5</span><span class="p">,</span><span class="n">ax6</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ewarr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">xpad</span><span class="p">,</span><span class="n">ewarr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">xpad</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">nsarr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">xpad</span><span class="p">,</span><span class="n">nsarr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">xpad</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">aa</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                
                <span class="n">cbax</span><span class="o">=</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">aa</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">cbx</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">ptcmap</span><span class="p">,</span>
                                     <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ptmin</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                                    <span class="n">vmax</span><span class="o">=</span><span class="n">ptmax</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                                     <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="p">)</span>
                    
                    <span class="n">cbx</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">cbx</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">ptcmap2</span><span class="p">,</span>
                                     <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ptrmin</span><span class="p">,</span>
                                                    <span class="n">vmax</span><span class="o">=</span><span class="n">ptrmax</span><span class="p">),</span>
                                     <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="p">)</span>
                    
                    <span class="n">cbx</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;$\Delta_{\Phi}$&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">3</span> <span class="ow">or</span> <span class="n">aa</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                    <span class="n">cbx</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rtcmapr</span><span class="p">,</span>
                                     <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">rtmin</span><span class="p">,</span>
                                                    <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">rtmax</span><span class="p">),</span>
                                     <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="p">)</span>
                    
                    <span class="n">cbx</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
                    <span class="n">cbx</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rtcmap</span><span class="p">,</span>
                                     <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rtrmin</span><span class="p">,</span>
                                                    <span class="n">vmax</span><span class="o">=</span><span class="n">rtrmax</span><span class="p">),</span>
                                     <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="p">)</span>
                    
                    <span class="n">cbx</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;$\Delta_{rho}$&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                 
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="c">#----Plot Just the data------------------        </span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colormm</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;phimin&#39;</span><span class="p">:</span>
                    <span class="n">ptmin</span><span class="p">,</span><span class="n">ptmax</span><span class="o">=</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                                 <span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;beta&#39;</span><span class="p">:</span>
                    <span class="n">ptmin</span><span class="p">,</span><span class="n">ptmax</span><span class="o">=</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">pt</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
                    
                <span class="n">rtmin</span><span class="p">,</span><span class="n">rtmax</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">rhodet</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">rhodet</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ns</span><span class="p">):</span>
                <span class="c">#-----------plot data phase tensors---------------</span>
                <span class="c">#check for nan in the array cause it messes with the max                </span>
                <span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">)</span>
                
                <span class="c">#scale the ellipse</span>
                <span class="n">eheightd</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptsize</span>
                <span class="n">ewidthd</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">ptsize</span>
            
                <span class="c">#make the ellipse</span>
                <span class="n">ellipd</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">ewidthd</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">eheightd</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="c">#color ellipse:</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;phimin&#39;</span><span class="p">:</span>
                    <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptmax</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">ecolor</span><span class="o">==</span><span class="s">&#39;beta&#39;</span><span class="p">:</span>
                    <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptmax</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">cvars</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">cvars</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                
                <span class="n">ax1</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellipd</span><span class="p">)</span>
                
                <span class="c">#-----------plot data resistivity tensors---------------</span>
                <span class="n">rt</span><span class="o">.</span><span class="n">rhomax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">rhomax</span><span class="p">)</span>
                <span class="n">rheightd</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rt</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtsize</span>
                <span class="n">rwidthd</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">/</span><span class="n">rt</span><span class="o">.</span><span class="n">rhomax</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="n">rtsize</span>
            
                <span class="n">rellipd</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">ewarr</span><span class="p">[</span><span class="n">jj</span><span class="p">],</span><span class="n">nsarr</span><span class="p">[</span><span class="n">jj</span><span class="p">]),</span><span class="n">width</span><span class="o">=</span><span class="n">rwidthd</span><span class="p">,</span>
                               <span class="n">height</span><span class="o">=</span><span class="n">rheightd</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">rt</span><span class="o">.</span><span class="n">rhoazimuth</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
                <span class="c">#color ellipse:</span>
                <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rt</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">-</span><span class="n">rtmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rtmax</span><span class="o">-</span><span class="n">rtmin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;.</span><span class="mi">5</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cvar</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rellipd</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)))</span>
                
                <span class="n">ax2</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">rellipd</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span><span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ewarr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">xpad</span><span class="p">,</span><span class="n">ewarr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">xpad</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">nsarr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="n">xpad</span><span class="p">,</span><span class="n">nsarr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">xpad</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;easting (km)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                              <span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>

                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;northing (km)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                              <span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
<span class="c">#                cbax=make_axes(ax,shrink=.8,pad=.15,orientation=&#39;horizontal&#39;,</span>
<span class="c">#                               anchor=(.5,1))</span>
                <span class="c">#l,b,w,h</span>
<span class="c">#                cbax=fig.add_axes([.1,.95,.35,.05])</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">cbax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="o">.</span><span class="mi">12</span><span class="p">,</span><span class="o">.</span><span class="mi">97</span><span class="p">,</span><span class="o">.</span><span class="mi">31</span><span class="p">,</span><span class="o">.</span><span class="mo">02</span><span class="p">])</span>
                    <span class="n">cbx</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">ptcmap</span><span class="p">,</span>
                                     <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ptmin</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                                    <span class="n">vmax</span><span class="o">=</span><span class="n">ptmax</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                                     <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="p">)</span>
                    
                    <span class="n">cbx</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                <span class="k">if</span> <span class="n">aa</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">cbax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="o">.</span><span class="mi">59</span><span class="p">,</span><span class="o">.</span><span class="mi">97</span><span class="p">,</span><span class="o">.</span><span class="mi">31</span><span class="p">,</span><span class="o">.</span><span class="mo">02</span><span class="p">])</span>
                    <span class="n">cbx</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">rtcmapr</span><span class="p">,</span>
                                     <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">rtmin</span><span class="p">,</span>
                                                    <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">rtmax</span><span class="p">),</span>
                                     <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="p">)</span>
                    
                    <span class="n">cbx</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;App. Res. ($\Omega \cdot$m)&#39;</span><span class="p">,</span>
                                  <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
                    <span class="n">cbx</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">((</span><span class="mi">10</span><span class="o">**</span><span class="n">rtmin</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="n">rtmax</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            
</div>
<div class="viewcode-block" id="readModelFile"><a class="viewcode-back" href="../../../core.WS3DTools.html#MTpy.core.WS3DTools.readModelFile">[docs]</a><span class="k">def</span> <span class="nf">readModelFile</span><span class="p">(</span><span class="n">mfile</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    read in a model file</span>
<span class="sd">    &quot;&quot;&quot;</span>            
    
    <span class="n">mfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">mfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">mlines</span><span class="o">=</span><span class="n">mfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="c">#get info at the beggining of file</span>
    <span class="n">info</span><span class="o">=</span><span class="n">mlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">infodict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]),(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">]),(</span><span class="n">info</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">info</span><span class="p">[</span><span class="mi">5</span><span class="p">])])</span>
    
    <span class="c">#get lengths of things</span>
    <span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">nn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    
    <span class="c">#make empty arrays to put stuff into</span>
    <span class="n">xarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
    <span class="n">yarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
    <span class="n">zarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
<span class="c">#    resarr=np.zeros((nx,ny,nz))</span>
    <span class="n">resarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">ny</span><span class="o">*</span><span class="n">nz</span><span class="p">)</span>
    
    <span class="c">#make indices to get information from</span>
    <span class="n">ls</span><span class="o">=</span><span class="mi">2</span>
    <span class="n">lx</span><span class="o">=</span><span class="n">nx</span><span class="o">/</span><span class="n">ncol</span><span class="o">+</span><span class="n">ls</span>
    <span class="n">ly</span><span class="o">=</span><span class="n">lx</span><span class="o">+</span><span class="n">ny</span><span class="o">/</span><span class="n">ncol</span>
    <span class="n">lz</span><span class="o">=</span><span class="n">ly</span><span class="o">+</span><span class="n">nz</span><span class="o">/</span><span class="n">ncol</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="k">print</span> <span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">,</span><span class="n">lz</span>
    
    <span class="c">#get x positions</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">mline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">ls</span><span class="p">:</span><span class="n">lx</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">xline</span><span class="o">=</span><span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">xarr</span><span class="p">[</span><span class="n">ll</span><span class="o">+</span><span class="n">ii</span><span class="o">*</span><span class="n">ncol</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">xline</span><span class="p">[</span><span class="n">ll</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="n">xarr</span><span class="p">[</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">:]</span><span class="o">=-</span><span class="n">xarr</span><span class="p">[</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">:]</span>

    <span class="c">#get y positions</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">mline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">lx</span><span class="p">:</span><span class="n">ly</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">yline</span><span class="o">=</span><span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">yarr</span><span class="p">[</span><span class="n">ll</span><span class="o">+</span><span class="n">ii</span><span class="o">*</span><span class="n">ncol</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">yline</span><span class="p">[</span><span class="n">ll</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="n">yarr</span><span class="p">[</span><span class="n">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">:]</span><span class="o">=-</span><span class="n">yarr</span><span class="p">[</span><span class="n">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">:]</span>
            
    <span class="c">#get z positions        </span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">mline</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">ly</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">lz</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">zline</span><span class="o">=</span><span class="n">mline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zarr</span><span class="p">[</span><span class="n">ll</span><span class="o">+</span><span class="n">ii</span><span class="o">*</span><span class="n">ncol</span><span class="p">]</span><span class="o">=-</span><span class="nb">float</span><span class="p">(</span><span class="n">zline</span><span class="p">[</span><span class="n">ll</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>
        
<span class="c">#    get resistivity values</span>
    <span class="n">mm</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">resarr</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">mlines</span><span class="p">[</span><span class="n">lz</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">mm</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">mm</span><span class="o">+=</span><span class="mi">1</span>
    
<span class="c">#    resarr=resarr.reshape(nz,ny,nx)</span>
    <span class="k">return</span> <span class="n">xarr</span><span class="p">,</span><span class="n">yarr</span><span class="p">,</span><span class="n">zarr</span><span class="p">,</span><span class="n">resarr</span><span class="p">,</span><span class="n">infodict</span>
        
                
    
        
    
                        
        
        
        
    
    </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jared Peacock, Lars Krieger, Stephan Thiel, Kent Inverarity.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>