

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MTpy.core.MTtools &mdash; MTpy 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MTpy.core.MTtools</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#module for MT calculations</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">sps</span>
<span class="kn">import</span> <span class="nn">simplekml</span> <span class="kn">as</span> <span class="nn">skml</span>
<span class="kn">import</span> <span class="nn">Z</span>

<span class="c">#short spaces 3 spaces</span>
<span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span>
<span class="c">#long spaces 6 spaces</span>
<span class="n">lsp</span><span class="o">=</span><span class="s">&#39;      &#39;</span>

<div class="viewcode-block" id="convertlpB"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.convertlpB">[docs]</a><span class="k">def</span> <span class="nf">convertlpB</span><span class="p">(</span><span class="n">bfield</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zadj</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the magnetic field from counts to units of microV/nT.</span>
<span class="sd">    bfield is a list of numbers. dlain is amount of gain applied</span>
<span class="sd">    by data logger(verylow=2.5,low=1, high=.1)</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        bfield = 1D array of long period data</span>
<span class="sd">        dlgain = data logger gain (very low= 2.5,low = 1, high = .1)</span>
<span class="sd">        zadj = Bz adjustment if using corrected Bartingtons</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        bfieldc = scaled bfield 1D array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bfieldc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bfield</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">)</span><span class="o">/</span><span class="mf">10.E7</span><span class="o">*</span><span class="mf">70000.</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">zadj</span><span class="p">)</span>
<span class="c">#    for ii in range(len(bfield)):</span>
<span class="c">#        bfield[ii]=(float(bfield[ii])/10.E7)*70000.*float(dlgain)*float(zadj)</span>
    <span class="k">return</span> <span class="n">bfieldc</span>
</div>
<div class="viewcode-block" id="convertE"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.convertE">[docs]</a><span class="k">def</span> <span class="nf">convertE</span><span class="p">(</span><span class="n">efield</span><span class="p">,</span><span class="n">dlgain</span><span class="p">,</span><span class="n">egain</span><span class="p">,</span><span class="n">dlength</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the electric field from counts to units of microV/m.</span>
<span class="sd">    efield is a list, dlgain is gain applied by data logger(verylow=2.5,</span>
<span class="sd">    low=1, high=.1), egain is interface box gain (10,100),dlength is</span>
<span class="sd">    the dipole length of that component.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        efield = 1d array of electric field measurements</span>
<span class="sd">        dlgain = data logger gain (very low= 2.5,low = 1, high = .1)</span>
<span class="sd">        egain = gain from interface box</span>
<span class="sd">        dlength = length of dipole in (m)</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        efieldc = scaled electric field 1D array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">efieldc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">efield</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">)</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlgain</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dlength</span><span class="p">)</span><span class="o">*</span>\
             <span class="nb">float</span><span class="p">(</span><span class="n">egain</span><span class="p">))</span>
<span class="c">#    for ii in range(len(efield)):</span>
<span class="c">#        efield[ii]=(float(efield[ii])*float(dlgain))/(float(dlength)*float(egain))</span>
    <span class="k">return</span> <span class="n">efieldc</span>

</div>
<div class="viewcode-block" id="rotateE"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.rotateE">[docs]</a><span class="k">def</span> <span class="nf">rotateE</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="n">ey</span><span class="p">,</span><span class="n">declination</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rotate the electric field to geographic north, ex &amp; ey are</span>
<span class="sd">    lists, declination is in degrees&quot;&quot;&quot;</span>
    <span class="n">s</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="o">-</span><span class="n">declination</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="o">-</span><span class="n">declination</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">exrot</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">eyrot</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ex</span><span class="p">)):</span>
        <span class="n">exrot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="n">ey</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">eyrot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="n">ey</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">exrot</span><span class="p">,</span><span class="n">eyrot</span>
</div>
<div class="viewcode-block" id="rotateB"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.rotateB">[docs]</a><span class="k">def</span> <span class="nf">rotateB</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;rotateB(bx,by) will Rotate the magnetic field such that Bx is pointing to</span>
<span class="sd">    magnetic north and by to geomagnetic east.  Assumes setup was orthogonal. </span>
<span class="sd">    Returns list of strings that are 8 significant digits.&quot;&quot;&quot;</span>

    <span class="n">meanbx</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
    <span class="n">meanby</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">by</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">by</span><span class="p">)</span>
    <span class="n">z</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">meanby</span><span class="o">/</span><span class="n">meanbx</span><span class="p">)</span>
    <span class="n">rotang</span><span class="o">=</span><span class="n">z</span>
        
    <span class="n">s</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotang</span><span class="p">)</span>
    <span class="n">c</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotang</span><span class="p">)</span>
    <span class="n">bxrot</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">byrot</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)):</span>
        <span class="n">bxrot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="n">by</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">),</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">byrot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bx</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="n">by</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">),</span><span class="mi">8</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bxrot</span><span class="p">,</span><span class="n">byrot</span>
    </div>
<div class="viewcode-block" id="padzeros"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.padzeros">[docs]</a><span class="k">def</span> <span class="nf">padzeros</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">npad</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;padzeros(f) will return a function that is padded with zeros to the next</span>
<span class="sd">    power of 2 for faster processing for fft or to length npad if given.&quot;&quot;&quot;</span>
    
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">npad</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="nb">pow</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">fpow</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">pow</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">pow</span><span class="o">!=</span><span class="n">fpow</span><span class="p">:</span>
            <span class="n">npow</span><span class="o">=</span><span class="n">fpow</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">npow</span><span class="o">=</span><span class="nb">pow</span>
        <span class="n">fpad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">npow</span><span class="p">)</span>
        <span class="n">fpad</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fpad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npad</span><span class="p">)</span>
        <span class="n">fpad</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">fpad</span>
    </div>
<div class="viewcode-block" id="filter"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.filter">[docs]</a><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">fcutoff</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">w</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span><span class="n">dt</span><span class="o">=.</span><span class="mo">001</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Will apply a sinc filter of width w to the function f by multipling in</span>
<span class="sd">    the frequency domain. Returns filtered function&quot;&quot;&quot;</span>

    <span class="n">tshift</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
    
    <span class="n">fpad</span><span class="o">=</span><span class="n">padzeros</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">Fpad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">fpad</span><span class="p">)</span>
    <span class="n">fc</span><span class="o">=</span><span class="n">fcutoff</span>
    
    <span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="n">tshift</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="n">tshift</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">filt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fpad</span><span class="p">))</span>
    <span class="n">fs</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">fc</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">fc</span><span class="p">)</span>
    <span class="n">norm</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">filt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span><span class="o">=</span><span class="n">fs</span><span class="o">/</span><span class="n">norm</span>
    <span class="n">Filt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">filt</span><span class="p">)</span>
    
    <span class="n">Filtfunc</span><span class="o">=</span><span class="n">Fpad</span><span class="o">*</span><span class="n">Filt</span>
    <span class="n">filtfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">Filtfunc</span><span class="p">)</span>
    <span class="n">filtfunc</span><span class="o">=</span><span class="n">filtfunc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">filtfunc</span>
</div>
<div class="viewcode-block" id="dctrend"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.dctrend">[docs]</a><span class="k">def</span> <span class="nf">dctrend</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;dctrend(f) will remove a dc trend from the function f.&quot;&quot;&quot;</span>
    
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">dc</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">/</span><span class="n">n</span>
    <span class="n">fdc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">dc</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
    
    <span class="k">return</span> <span class="n">fdc</span>
</div>
<div class="viewcode-block" id="normalizeL2"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.normalizeL2">[docs]</a><span class="k">def</span> <span class="nf">normalizeL2</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;normalizeL2(f) will return the function f normalized by the L2 norm -&gt;</span>
<span class="sd">    f/(sqrt(sum(abs(x_i)^2))).&quot;&quot;&quot;</span>
    
    <span class="n">f</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">fnorm</span><span class="o">=</span><span class="n">f</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">fnorm</span>
</div>
<div class="viewcode-block" id="decimatef"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.decimatef">[docs]</a><span class="k">def</span> <span class="nf">decimatef</span><span class="p">(</span><span class="n">farray</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Will decimate a function by the factor m. First an 8th order Cheybechev </span>
<span class="sd">    type I filter with a cuttoff frequency of .8/m  is applied in both </span>
<span class="sd">    directions to minimize any phase distortion and remove any aliasing. If m </span>
<span class="sd">    is greater than 10, decimatef will be called multiple times.&quot;&quot;&quot;</span>
    
    
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">farray</span><span class="p">)</span>
    <span class="n">fdec</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">farray</span><span class="p">,</span><span class="n">n</span><span class="o">/</span><span class="n">m</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="s">&#39;hanning&#39;</span><span class="p">)</span>
<span class="c">#    print &#39;Decimating using Chebyshev&#39;</span>
<span class="c">#    n=len(farray)</span>
<span class="c">#    nout=np.ceil(n/m)</span>
<span class="c">#    nfilt=8</span>
<span class="c">#    rip=.05</span>
<span class="c">#    </span>
<span class="c">#    if m&gt;10:</span>
<span class="c">#        mlst=[]</span>
<span class="c">#        mlst.append(10)</span>
<span class="c">#        for mm in range(1,int(np.ceil(np.log10(m)))):</span>
<span class="c">#            if mm&lt;np.floor(np.log10(m)):</span>
<span class="c">#                mlst.append(10)</span>
<span class="c">#            else: </span>
<span class="c">#                mlst.append(np.floor(m/10**mm))</span>
<span class="c">#        </span>
<span class="c">#        #make a cheybeshev1 zero-phase filter with cuttoff frequency of .8/m</span>
<span class="c">#        b,a=sps.iirfilter(8,.8/mlst[0],rp=.05,btype=&#39;low&#39;,ftype=&#39;cheby1&#39;,output=&#39;ba&#39;)</span>
<span class="c">#        #check to make sure the filter will produce good results</span>
<span class="c">#        nb=len(b)</span>
<span class="c">#        na=len(a)</span>
<span class="c">#        top=sum(np.exp(-1j*np.arange(nb)*np.pi*.8/mlst[0])*b)</span>
<span class="c">#        bottom=sum(np.exp(-1j*np.arange(na)*np.pi*.8/mlst[0])*a)</span>
<span class="c">#        H=abs(20*np.log10(abs(top/bottom)))</span>
<span class="c">#        while b[0]&lt;10**-5 or H&gt;10**-6:</span>
<span class="c">#            nfilt=nfilt-1</span>
<span class="c">#            if nfilt==0:</span>
<span class="c">#                ValueError(&quot;length of filter is 0 decimation value might be to large&quot;)</span>
<span class="c">#            else:</span>
<span class="c">#                b,a=sps.iirfilter(nfilt,.8/mlst[0],rp=rip,btype=&#39;low&#39;,ftype=&#39;cheby1&#39;,output=&#39;ba&#39;)</span>
<span class="c">#                nb=len(b)</span>
<span class="c">#            na=len(a)</span>
<span class="c">#            top=sum(np.exp(-1j*np.arange(nb)*np.pi*.8/mlst[0])*b)</span>
<span class="c">#            bottom=sum(np.exp(-1j*np.arange(na)*np.pi*.8/mlst[0])*a)</span>
<span class="c">#            H=abs(20*np.log10(abs(top/bottom))+rip)</span>
<span class="c">#            </span>
<span class="c">#        </span>
<span class="c">#        ffilt=sps.filtfilt(b,a,farray)</span>
<span class="c">#        nout=np.ceil(n/mlst[0])</span>
<span class="c">#        nbeg=n-mlst[0]*nout</span>
<span class="c">#        fdec=np.array([ffilt[ii] for ii in np.arange(start=nbeg,stop=int(n),step=mlst[0])])</span>
<span class="c">#        print &#39;Decimated once&#39;</span>
<span class="c">#        </span>
<span class="c">#        for dd in range(1,len(mlst)):</span>
<span class="c">#            #make a cheybeshev1 zero-phase filter with cuttoff frequency of .8/m</span>
<span class="c">#            b,a=sps.iirfilter(8,.8/mlst[dd],rp=.05,btype=&#39;low&#39;,ftype=&#39;cheby1&#39;,output=&#39;ba&#39;)</span>
<span class="c">#            #check to make sure the filter will produce good results</span>
<span class="c">#            nb=len(b)</span>
<span class="c">#            na=len(a)</span>
<span class="c">#            top=sum(np.exp(-1j*np.arange(nb)*np.pi*.8/mlst[dd])*b)</span>
<span class="c">#            bottom=sum(np.exp(-1j*np.arange(na)*np.pi*.8/mlst[dd])*a)</span>
<span class="c">#            H=abs(20*np.log10(abs(top/bottom)))</span>
<span class="c">#            while b[0]&lt;10**-5 or H&gt;10**-6:</span>
<span class="c">#                nfilt=nfilt-1</span>
<span class="c">#                if nfilt==0:</span>
<span class="c">#                    ValueError(&quot;length of filter is 0 decimation value might be to large&quot;)</span>
<span class="c">#                else:</span>
<span class="c">#                    b,a=sps.iirfilter(nfilt,.8/mlst[dd],rp=rip,btype=&#39;low&#39;,ftype=&#39;cheby1&#39;,output=&#39;ba&#39;)</span>
<span class="c">#                    nb=len(b)</span>
<span class="c">#                na=len(a)</span>
<span class="c">#                top=sum(np.exp(-1j*np.arange(nb)*np.pi*.8/mlst[dd])*b)</span>
<span class="c">#                bottom=sum(np.exp(-1j*np.arange(na)*np.pi*.8/mlst[dd])*a)</span>
<span class="c">#                H=abs(20*np.log10(abs(top/bottom))+rip)</span>
<span class="c">#                </span>
<span class="c">#            </span>
<span class="c">#            ffilt=sps.filtfilt(b,a,fdec)</span>
<span class="c">#            n=len(fdec)</span>
<span class="c">#            nout=np.ceil(n/mlst[dd])</span>
<span class="c">#            nbeg=n-mlst[dd]*nout</span>
<span class="c">#            fdec=np.array([ffilt[ii] for ii in np.arange(start=nbeg,stop=int(n),step=mlst[dd])])</span>
<span class="c">#            print &#39;Decimated &#39;+str(dd+1)+&#39; by &#39;+str(mlst[dd])</span>
<span class="c">#    else:</span>
<span class="c">#        #make a cheybeshev1 zero-phase filter with cuttoff frequency of .8/m</span>
<span class="c">#        b,a=sps.iirfilter(8,.8/m,rp=.05,btype=&#39;low&#39;,ftype=&#39;cheby1&#39;,output=&#39;ba&#39;)</span>
<span class="c">#        #check to make sure the filter will produce good results</span>
<span class="c">#        nb=len(b)</span>
<span class="c">#        na=len(a)</span>
<span class="c">#        top=sum(np.exp(-1j*np.arange(nb)*np.pi*.8/m)*b)</span>
<span class="c">#        bottom=sum(np.exp(-1j*np.arange(na)*np.pi*.8/m)*a)</span>
<span class="c">#        H=abs(20*np.log10(abs(top/bottom)))</span>
<span class="c">#        while b[0]&lt;10**-5 or H&gt;10**-6:</span>
<span class="c">#            nfilt=nfilt-1</span>
<span class="c">#            if nfilt==0:</span>
<span class="c">#                ValueError(&quot;length of filter is 0 decimation value might be to large&quot;)</span>
<span class="c">#            else:</span>
<span class="c">#                b,a=sps.iirfilter(nfilt,.8/m,rp=rip,btype=&#39;low&#39;,ftype=&#39;cheby1&#39;,output=&#39;ba&#39;)</span>
<span class="c">#                nb=len(b)</span>
<span class="c">#            na=len(a)</span>
<span class="c">#            top=sum(np.exp(-1j*np.arange(nb)*np.pi*.8/m)*b)</span>
<span class="c">#            bottom=sum(np.exp(-1j*np.arange(na)*np.pi*.8/m)*a)</span>
<span class="c">#            H=abs(20*np.log10(abs(top/bottom))+rip)</span>
<span class="c">#            </span>
<span class="c">#        </span>
<span class="c">#        ffilt=sps.filtfilt(b,a,farray)</span>
<span class="c">#        nout=np.ceil(n/m)</span>
<span class="c">#        nbeg=n-m*nout</span>
<span class="c">#        fdec=np.array([ffilt[ii] for ii in np.arange(start=nbeg,stop=int(n),step=m)])</span>
            
    <span class="k">return</span> <span class="n">fdec</span>
    </div>
<div class="viewcode-block" id="openMTfile"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.openMTfile">[docs]</a><span class="k">def</span> <span class="nf">openMTfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">gain</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">dlength</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">magtype</span><span class="o">=</span><span class="s">&#39;lp&#39;</span><span class="p">,</span><span class="n">zadj</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open an MT file, convert counts to units and return an 1D-array.  </span>
<span class="sd">    Make sure filename includes the entire path.  gain (verylow=2.5,low=1,</span>
<span class="sd">    high=.1), egain same as gain, dlength is dipole length in m of EX,EY. </span>
<span class="sd">    magtype is the magnetic measurment type &#39;lp&#39; for long period and &#39;bb&#39; for </span>
<span class="sd">    broadband, zadj is an adjustment for lp instruments on the z channel&quot;&quot;&quot;</span>
        
    <span class="n">mtfile</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">s</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">magtype</span><span class="o">==</span><span class="s">&#39;lp&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;BY&#39;</span><span class="p">:</span>
            <span class="n">convmtfile</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">mtfile</span><span class="p">,</span><span class="n">gain</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;BX&#39;</span><span class="p">:</span>
            <span class="n">convmtfile</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">mtfile</span><span class="p">,</span><span class="n">gain</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;BZ&#39;</span><span class="p">:</span>
            <span class="n">convmtfile</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">mtfile</span><span class="p">,</span><span class="n">gain</span><span class="p">,</span><span class="n">zadj</span><span class="o">=</span><span class="n">zadj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">magtype</span><span class="o">==</span><span class="s">&#39;bb&#39;</span><span class="p">:</span>
        <span class="n">convmtfile</span><span class="o">=</span><span class="n">mtfile</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;EX&#39;</span><span class="p">:</span>
        <span class="n">convmtfile</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">mtfile</span><span class="p">,</span><span class="n">gain</span><span class="p">,</span><span class="n">egain</span><span class="p">,</span><span class="n">dlength</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">s</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;EY&#39;</span><span class="p">:</span>
        <span class="n">convmtfile</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">mtfile</span><span class="p">,</span><span class="n">gain</span><span class="p">,</span><span class="n">egain</span><span class="p">,</span><span class="n">dlength</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">convmtfile</span>
    
    </div>
<div class="viewcode-block" id="convertCounts2Units"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.convertCounts2Units">[docs]</a><span class="k">def</span> <span class="nf">convertCounts2Units</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span><span class="n">eyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">,</span><span class="n">lpyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">,</span><span class="n">egain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">dlgain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">exlen</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span><span class="n">eylen</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span><span class="n">magtype</span><span class="o">=</span><span class="s">&#39;lp&#39;</span><span class="p">,</span><span class="n">zadj</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;convertCounts2Units(filenames,eyn=&#39;n&#39;,lpyn=&#39;n&#39;,egain=1.0,dlgain=1.0,exlen=100.,eylen=100.,</span>
<span class="sd">    magtype=&#39;lp&#39;,zadj=2) will convert a set of files given by filenames with</span>
<span class="sd">    parameters defined:</span>
<span class="sd">    filenames,</span>
<span class="sd">    eyn =&gt; electric channels converted y or n</span>
<span class="sd">    lpyn =&gt; long period magnetic channels converted y or n</span>
<span class="sd">    egain =&gt; electric gain</span>
<span class="sd">    dlgain =&gt; data logger gain</span>
<span class="sd">    exlen =&gt; ex length (m)</span>
<span class="sd">    eylen =&gt; ey length (m)</span>
<span class="sd">    magtype =&gt; magnetic sensor type lp for longperiod or bb for broadband</span>
<span class="sd">    zadj =&gt; bz adjusting parameter for bartington sensor&quot;&quot;&quot;</span>
    
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">eyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
            <span class="c">#convert EX chanel</span>
            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;*.EX&#39;</span><span class="p">):</span>
                <span class="n">exfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">exlines</span><span class="o">=</span><span class="n">exfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">exlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
    					<span class="k">print</span> <span class="s">&#39;Found decimal point in &#39;</span><span class="o">+</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;. Check File&#39;</span>
    					<span class="n">exyn</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Still convert? (y/n) as a string&#39;</span><span class="p">)</span>
    					<span class="k">if</span> <span class="n">exyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
    						<span class="n">exfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    					<span class="k">else</span><span class="p">:</span>
    						<span class="n">exconv</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">exlines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">,</span><span class="n">egain</span><span class="p">,</span><span class="n">exlen</span><span class="p">)</span>
    						<span class="n">exfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    						<span class="n">exconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">exconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exconv</span><span class="p">))]</span>
    						<span class="n">exfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    						<span class="n">exfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">exconvlst</span><span class="p">)</span>
    						<span class="n">exfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">exconv</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">exlines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">,</span><span class="n">egain</span><span class="p">,</span><span class="n">exlen</span><span class="p">)</span>
                    <span class="n">exfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">exconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">exconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exconv</span><span class="p">))]</span>
                    <span class="n">exfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                    <span class="n">exfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">exconvlst</span><span class="p">)</span>
                    <span class="n">exfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;*.EY&#39;</span><span class="p">):</span>
                <span class="n">eyfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">eylines</span><span class="o">=</span><span class="n">eyfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">eylines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
    					<span class="k">print</span> <span class="s">&#39;Found decimal point &#39;</span><span class="o">+</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;. Check File.&#39;</span>
    					<span class="n">eyyn</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Still convert? (y/n) as a string&#39;</span><span class="p">)</span>
    					<span class="k">if</span> <span class="n">eyyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
    						<span class="n">eyfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    					<span class="k">else</span><span class="p">:</span>
    						<span class="n">eyconv</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">eylines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">,</span><span class="n">egain</span><span class="p">,</span><span class="n">eylen</span><span class="p">)</span>
    						<span class="n">eyfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    						<span class="n">eyconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">eyconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eyconv</span><span class="p">))]</span>
    						<span class="n">eyfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    						<span class="n">eyfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">eyconvlst</span><span class="p">)</span>
    						<span class="n">eyfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eyconv</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">eylines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">,</span><span class="n">egain</span><span class="p">,</span><span class="n">eylen</span><span class="p">)</span>
                    <span class="n">eyfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">eyconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">eyconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eyconv</span><span class="p">))]</span>
                    <span class="n">eyfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                    <span class="n">eyfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">eyconvlst</span><span class="p">)</span>
                    <span class="n">eyfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
            
        <span class="c">#convert Magnetic Channels for long period surveys</span>
        <span class="k">if</span> <span class="n">magtype</span><span class="o">==</span><span class="s">&#39;lp&#39;</span> <span class="ow">and</span> <span class="n">lpyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
            <span class="c">#Convert BX</span>
            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;*.BX&#39;</span><span class="p">):</span>
                <span class="n">bxfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">bxlines</span><span class="o">=</span><span class="n">bxfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">bxlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Found decimal point &#39;</span><span class="o">+</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;. Check File.&#39;</span>
                    <span class="n">bxyn</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Still convert? (y/n) as a string&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bxyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
							<span class="n">bxfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
							<span class="n">bxconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bxlines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">)</span>
							<span class="n">bxfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
							<span class="n">bxconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">bxconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bxconv</span><span class="p">))]</span>
							<span class="n">bxfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
							<span class="n">bxfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">bxconvlst</span><span class="p">)</span>
							<span class="n">bxfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c">#convert BY</span>
            <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;*.BY&#39;</span><span class="p">):</span>
                <span class="n">byfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">bylines</span><span class="o">=</span><span class="n">byfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">bylines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Found decimal point &#39;</span><span class="o">+</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;. Check File.&#39;</span>
                    <span class="n">byyn</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Still convert? (y/n) as a string&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">byyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
							<span class="n">byfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
							<span class="n">byconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bylines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">)</span>
							<span class="n">byfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
							<span class="n">byconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">byconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">byconv</span><span class="p">))]</span>
							<span class="n">byfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
							<span class="n">byfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">byconvlst</span><span class="p">)</span>
							<span class="n">byfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">byconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bylines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">)</span>
                    <span class="n">byfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">byconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">byconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">byconv</span><span class="p">))]</span>
                    <span class="n">byfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                    <span class="n">byfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">byconvlst</span><span class="p">)</span>
                    <span class="n">byfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c">#convert BZ</span>
            <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;*.BZ&#39;</span><span class="p">):</span>
                <span class="n">bzfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">bzlines</span><span class="o">=</span><span class="n">bzfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">bzlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Found decimal point &#39;</span><span class="o">+</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;. Check File.&#39;</span>
                    <span class="n">bzyn</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s">&#39;Still convert? (y/n) as a string&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">bzyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
							<span class="n">bzfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
							<span class="n">bzconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bzlines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">,</span><span class="n">zadj</span><span class="o">=</span><span class="n">zadj</span><span class="p">)</span>
							<span class="n">bzfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
							<span class="n">bzconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">bzconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bzconv</span><span class="p">))]</span>
							<span class="n">bzfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
							<span class="n">bzfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">bzconvlst</span><span class="p">)</span>
							<span class="n">bzfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bzconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bzlines</span><span class="p">,</span><span class="n">dlgain</span><span class="p">,</span><span class="n">zadj</span><span class="o">=</span><span class="n">zadj</span><span class="p">)</span>
                    <span class="n">bzfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">bzconvlst</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">bzconv</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bzconv</span><span class="p">))]</span>
                    <span class="n">bzfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                    <span class="n">bzfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">bzconvlst</span><span class="p">)</span>
                    <span class="n">bzfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    
    
    </div>
<div class="viewcode-block" id="combineFewFiles"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.combineFewFiles">[docs]</a><span class="k">def</span> <span class="nf">combineFewFiles</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">starttime</span><span class="p">,</span><span class="n">endtime</span><span class="p">,</span><span class="n">cachelength</span><span class="p">,</span>
                    <span class="n">complst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;BX&#39;</span><span class="p">,</span><span class="s">&#39;BY&#39;</span><span class="p">,</span><span class="s">&#39;BZ&#39;</span><span class="p">,</span><span class="s">&#39;EX&#39;</span><span class="p">,</span><span class="s">&#39;EY&#39;</span><span class="p">],</span><span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fdict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    combineFewFiles(dirpath,station,starttime,endtime,cachelength,</span>
<span class="sd">    complst=[&#39;BX&#39;,&#39;BY&#39;,&#39;BZ&#39;,&#39;EX&#39;,&#39;EY&#39;],d=0)</span>
<span class="sd">    Will combine files in a directory path (dirpath) that have a given start and </span>
<span class="sd">    end time in the form of (HHMMSS).  It looks for files at cachelength then </span>
<span class="sd">    decimates the data by d. </span>
<span class="sd">    Input:</span>
<span class="sd">        dirpath = directory path to folder where files to combine reside</span>
<span class="sd">        station = station name</span>
<span class="sd">        starttime = start time as 6 character string hhmmss</span>
<span class="sd">        endtime = end time as 6 character string hhmmss</span>
<span class="sd">        cachelength = cacherate of each file as 6 character string hhmmss</span>
<span class="sd">        complst = components to combine</span>
<span class="sd">        d = decimation factor, if no decimation enter as 0 or 1</span>
<span class="sd">        </span>
<span class="sd">    Output:</span>
<span class="sd">        cfilelst = list of combined files with full path for each component</span>
<span class="sd">                   files are saved as dirpath\CombHHtoHHd(d)\stationHHtoHH.comp</span>
<span class="sd">        fileslst = list of files that were combined including length of each </span>
<span class="sd">                   file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c">#set variables</span>
    <span class="n">hbegin</span><span class="o">=</span><span class="n">starttime</span>
    <span class="n">hend</span><span class="o">=</span><span class="n">endtime</span>
    <span class="n">sbegin</span><span class="o">=</span><span class="n">hbegin</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">send</span><span class="o">=</span><span class="n">hend</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">cachesize</span><span class="o">=</span><span class="n">cachelength</span>
    <span class="n">complst</span><span class="o">=</span><span class="n">complst</span>
    <span class="n">station</span><span class="o">=</span><span class="n">station</span>

    <span class="c">#compute total time</span>
    <span class="n">tottime</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">hend</span><span class="p">)</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">hbegin</span><span class="p">)</span>
    <span class="n">count</span><span class="o">=</span><span class="n">tottime</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">cachesize</span><span class="p">)</span>
    
    <span class="c">#set pattern to search for to combine files</span>
    <span class="n">patclst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="n">pat</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hbegin</span><span class="p">)</span><span class="o">+</span><span class="n">ii</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">cachesize</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">patc</span><span class="o">=</span><span class="s">&#39;00000&#39;</span><span class="o">+</span><span class="n">pat</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">patc</span><span class="o">=</span><span class="s">&#39;0000&#39;</span><span class="o">+</span><span class="n">pat</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">patc</span><span class="o">=</span><span class="s">&#39;000&#39;</span><span class="o">+</span><span class="n">pat</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
            <span class="n">patc</span><span class="o">=</span><span class="s">&#39;00&#39;</span><span class="o">+</span><span class="n">pat</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
            <span class="n">patc</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="n">pat</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
            <span class="n">patc</span><span class="o">=</span><span class="n">pat</span>
        <span class="n">patclst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">patc</span><span class="p">)</span>
    
    
    <span class="c">#create combpath</span>
    <span class="n">cfilenlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">d</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">dstr</span><span class="o">=</span><span class="s">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dstr</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="c">#make a copy of the list cause can be a global variable that python can </span>
    <span class="c">#change, not good, should think about tuples perhaps</span>
    <span class="n">complstt</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">complst</span><span class="p">)</span>  
    <span class="n">combpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="s">&#39;Comb&#39;</span><span class="o">+</span><span class="n">sbegin</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span><span class="n">send</span><span class="o">+</span><span class="n">dstr</span><span class="p">)</span>
    <span class="n">returnlst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">sbegin</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span><span class="n">send</span><span class="o">+</span><span class="n">dstr</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">)</span> 
                                                        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstt</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">combpath</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">combpath</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstt</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">):</span>
                    <span class="n">cfilenlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combpath</span><span class="p">,</span><span class="n">fn</span><span class="p">))</span>
                    <span class="n">complstt</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&#39;File already combined: &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combpath</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span>
      
    <span class="c">#check to see if all components have been combined already</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complstt</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">returnlst</span><span class="p">,[</span><span class="s">&#39;File already combined&#39;</span><span class="p">]</span>
   
   <span class="c">#if not combine them</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#-----------------if no decimation copy files into one------------------</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">combpath</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">combpath</span><span class="p">)</span>
            <span class="n">fileslst</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">cfilenlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstt</span><span class="p">:</span>
                <span class="n">fileextlst</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">cfilen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">sbegin</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span>
                                    <span class="n">send</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">)</span>
                <span class="c">##if the file already exists pass</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cfilen</span><span class="p">):</span>
                    <span class="n">cfilenlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfilen</span><span class="p">)</span>
                    <span class="n">fileslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Already combined&#39;</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&#39;File already combined &#39;</span><span class="o">+</span><span class="n">cfilen</span>
                    
                <span class="c">#if there is a filter dictionary filter the data</span>
                <span class="k">if</span> <span class="n">fdict</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Applying Adaptive Notch Filter&#39;</span>
                    <span class="n">cfilenlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfilen</span><span class="p">)</span>
                    <span class="n">combinemtfile</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">cfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">cfilen</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cc</span><span class="p">,</span><span class="n">ll</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)):</span>
                        <span class="n">ext</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">patclst</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span>
                        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">):</span>
                                <span class="n">sfile</span><span class="o">=</span><span class="n">adaptiveNotchFilter</span><span class="p">(</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">filename</span><span class="p">)),</span>
                                        <span class="o">**</span><span class="n">fdict</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">ls</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span>
                                <span class="c">##this is slow at the moment figure out a better</span>
                                <span class="c">##way to write these files</span>
                                <span class="n">cfile</span><span class="o">.</span><span class="n">writelines</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%.9g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ii</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> 
                                                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">sfile</span><span class="p">])</span>
<span class="c">#                                if cc==0:</span>
<span class="c">#                                    combinemtfile=sfile</span>
<span class="c">#                                else:</span>
<span class="c">#                                    combinemtfile=np.hstack(sfile)</span>
                                <span class="n">fileextlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="n">filename</span><span class="o">+</span><span class="s">&#39; -&gt; Length: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ls</span><span class="p">)])</span>
                                <span class="k">print</span> <span class="s">&#39;Opened file: &#39;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39; -&gt; Length= &#39;</span><span class="p">,</span><span class="n">ls</span>
                    <span class="n">cfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">print</span> <span class="n">comp</span><span class="o">+</span><span class="s">&#39; Finish Time: &#39;</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
<span class="c">#                    np.savetxt(cfilen,combinemtfile,fmt=&#39;%.9g&#39;)</span>
                    <span class="k">print</span> <span class="s">&#39;Combined file to: &#39;</span><span class="p">,</span><span class="n">cfilen</span>
                    <span class="n">fileslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileextlst</span><span class="p">)</span>
                <span class="c">#if no decimation and filtering needed combine files quickly</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cfilenlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfilen</span><span class="p">)</span>
                    <span class="n">cfile</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">cfilen</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                    <span class="n">fileextlst</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                        <span class="n">ext</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">patclst</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span>
                        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">):</span>
                                <span class="n">sfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dirpath</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                                <span class="n">sfn</span><span class="o">=</span><span class="n">sfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                                <span class="c">#make sure file position is 0</span>
                                <span class="k">if</span> <span class="n">sfile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> 
                                    <span class="n">sfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="n">cfile</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">fileextlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;File: &#39;</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span> \
                                                    <span class="s">&#39; -&gt; Length: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sfn</span><span class="p">)))])</span>
                                <span class="k">print</span> <span class="s">&#39;Opened file: &#39;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;Length= &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">sfn</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&#39;Combined file to: &#39;</span><span class="p">,</span><span class="n">cfilen</span>
                    <span class="n">fileslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileextlst</span><span class="p">)</span>
                    <span class="n">cfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">returnlst</span><span class="p">,</span><span class="n">fileslst</span>
        <span class="c">#if decimation</span>
        <span class="k">elif</span> <span class="n">d</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">combpath</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">combpath</span><span class="p">)</span>
            <span class="n">fileslst</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">cfilenlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstt</span><span class="p">:</span>
                <span class="n">fileextlst</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">cfilen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">sbegin</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span>
                                    <span class="n">send</span><span class="o">+</span><span class="n">dstr</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cfilen</span><span class="p">):</span>
                    <span class="n">cfilenlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfilen</span><span class="p">)</span>
                    <span class="n">fileslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Already combined&#39;</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&#39;File already combined &#39;</span><span class="o">+</span><span class="n">cfilen</span>
                <span class="c">#if there is a filter dictionary filter the data</span>
                <span class="k">if</span> <span class="n">fdict</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">cfilenlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfilen</span><span class="p">)</span>
                    <span class="n">countd</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">combinemtfile</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                        <span class="n">ext</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">patclst</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span>
                        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">):</span>
                                <span class="n">sfile</span><span class="o">=</span><span class="n">adaptiveNotchFilter</span><span class="p">(</span><span class="n">decimatef</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
                                                <span class="p">,</span><span class="n">d</span><span class="p">),</span><span class="o">**</span><span class="n">fdict</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">ls</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">countd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                                    <span class="n">combinemtfile</span><span class="o">=</span><span class="n">sfile</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">combinemtfile</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span>
                                <span class="n">fileextlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="n">filename</span><span class="o">+</span><span class="s">&#39; -&gt; Length: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ls</span><span class="p">)])</span>
                                <span class="k">print</span> <span class="s">&#39;Opened file: &#39;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39; -&gt; Length= &#39;</span><span class="p">,</span><span class="n">ls</span>
                                <span class="n">countd</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">print</span> <span class="n">comp</span><span class="o">+</span><span class="s">&#39; Finish Time: &#39;</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">cfilen</span><span class="p">,</span><span class="n">combinemtfile</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.9g</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&#39;Combined file to: &#39;</span><span class="p">,</span><span class="n">cfilen</span>
                    <span class="n">fileslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileextlst</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cfilenlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cfilen</span><span class="p">)</span>
                    <span class="n">countd</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">combinemtfile</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
                        <span class="n">ext</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">patclst</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span>
                        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="p">):</span>
                                <span class="n">sfile</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">dirpath</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
                                <span class="n">ls</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sfile</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">countd</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                                    <span class="n">combinemtfile</span><span class="o">=</span><span class="n">decimatef</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">combinemtfile</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">combinemtfile</span><span class="p">,</span>
                                                             <span class="n">decimatef</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span>
                                                                       <span class="n">d</span><span class="p">)))</span>
                                <span class="n">fileextlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;File: &#39;</span><span class="o">+</span> <span class="n">filename</span><span class="o">+</span><span class="s">&#39; -&gt; Length: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ls</span><span class="p">)])</span>
                                <span class="k">print</span> <span class="s">&#39;Opened file: &#39;</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39; -&gt; Length= &#39;</span><span class="p">,</span><span class="n">ls</span>
                                <span class="n">countd</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="k">print</span> <span class="n">comp</span><span class="o">+</span><span class="s">&#39; Finish Time: &#39;</span><span class="p">,</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">cfilen</span><span class="p">,</span><span class="n">combinemtfile</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.9g</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&#39;Combined file to: &#39;</span><span class="p">,</span><span class="n">cfilen</span>
                    <span class="n">fileslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileextlst</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">returnlst</span><span class="p">,</span><span class="n">fileslst</span>
        </div>
<div class="viewcode-block" id="combineFiles"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.combineFiles">[docs]</a><span class="k">def</span> <span class="nf">combineFiles</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">daylst</span><span class="p">,</span><span class="n">cacherate</span><span class="p">,</span>
                 <span class="n">complst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;EX&#39;</span><span class="p">,</span><span class="s">&#39;EY&#39;</span><span class="p">,</span><span class="s">&#39;BX&#39;</span><span class="p">,</span><span class="s">&#39;BY&#39;</span><span class="p">,</span><span class="s">&#39;BZ&#39;</span><span class="p">],</span><span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fdict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    combineFiles(dirpath,station,daydict,complst=[&#39;EX&#39;,&#39;EY&#39;,&#39;BX&#39;,&#39;BY&#39;,&#39;BZ&#39;])</span>
<span class="sd">    will combine files from different days into one file.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        dirpath = directory path where station files are</span>
<span class="sd">        station = name of station</span>
<span class="sd">        daylst = list of information to combine files with a dictionary for </span>
<span class="sd">                each day with keys:</span>
<span class="sd">                    day = utc day (thee character string)</span>
<span class="sd">                    start = start time in (&#39;hhmmss&#39;)</span>
<span class="sd">                    stop = end time in(&#39;hhmmss&#39;)</span>
<span class="sd">                    filt = &#39;Filtered&#39; if time series was filtered</span>
<span class="sd">        cacherate = length of file (&#39;hhmmss&#39;)</span>
<span class="sd">        dec = decimation factor (0 for none)</span>
<span class="sd">        complst = list of components to combine</span>
<span class="sd">        fdict = dictionary for adaptiveNotchFilter</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        cfilelst = list of combined files with full path as </span>
<span class="sd">                dirpath/station/Combdaylst[0]todaylst[-1] </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">complstd</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">complst</span><span class="p">)</span>
    
    <span class="n">sday</span><span class="o">=</span><span class="n">daylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;day&#39;</span><span class="p">]</span>
    <span class="n">eday</span><span class="o">=</span><span class="n">daylst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;day&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">dec</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">dec</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>    
        <span class="n">decstr</span><span class="o">=</span><span class="s">&#39;&#39;</span>
        <span class="n">dec</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">decstr</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">daylst</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;filt&#39;</span><span class="p">]</span>
        <span class="n">savepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="s">&#39;Comb&#39;</span><span class="o">+</span><span class="n">sday</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span><span class="n">eday</span><span class="o">+</span><span class="n">decstr</span><span class="o">+</span><span class="s">&#39;Filt&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">savepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="s">&#39;Comb&#39;</span><span class="o">+</span><span class="n">sday</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span><span class="n">eday</span><span class="o">+</span><span class="n">decstr</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
    
    <span class="c">#check to see if the files are already combined    </span>
    <span class="n">cfilelst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">sday</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span><span class="n">eday</span><span class="o">+</span><span class="n">decstr</span><span class="o">+</span>
             <span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">)</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstd</span><span class="p">]</span> 
    <span class="c">#remove any components that are already combined</span>
    <span class="k">for</span> <span class="n">cfile</span> <span class="ow">in</span> <span class="n">cfilelst</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="n">complstd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cfile</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
   
    <span class="c">#if there are components that are not already combined combine them</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">complstd</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="c">#make a dictionary for combining later        </span>
        <span class="n">cfiledict</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstd</span><span class="p">:</span>
            <span class="n">cfiledict</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="c">#for each day combine files</span>
        <span class="k">for</span> <span class="n">dd</span><span class="p">,</span><span class="n">day</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">daylst</span><span class="p">):</span>
            <span class="c">#make a directory path            </span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">day</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">],</span><span class="n">day</span><span class="p">[</span><span class="s">&#39;filt&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">cdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">day</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">])</span>
            
            <span class="c">#combine files using function combineFewFiles</span>
            <span class="n">clst</span><span class="p">,</span><span class="n">flst</span><span class="o">=</span><span class="n">combineFewFiles</span><span class="p">(</span><span class="n">cdirpath</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">day</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span><span class="n">day</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">],</span>
                                      <span class="n">cacherate</span><span class="p">,</span><span class="n">complst</span><span class="o">=</span><span class="n">complstd</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span>
                                      <span class="n">fdict</span><span class="o">=</span><span class="n">fdict</span><span class="p">)</span>

            <span class="c">#put files into a list for each component for easy combining</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstd</span><span class="p">:</span>
                <span class="n">ext</span><span class="o">=</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">comp</span>
                <span class="k">for</span> <span class="n">fnc</span> <span class="ow">in</span> <span class="n">clst</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">fnc</span><span class="p">,</span><span class="n">ext</span><span class="p">):</span>
                        <span class="n">cfiledict</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fnc</span><span class="p">)</span> 
        <span class="c">#combine day files into a days file</span>
        <span class="n">fileslst</span><span class="o">=</span><span class="p">[]</span>
        <span class="c">#ext=&#39;*&#39;+patc+&#39;.&#39;+complst[jj]</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complstd</span><span class="p">:</span>
            <span class="n">cfilen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">sday</span><span class="o">+</span><span class="s">&#39;to&#39;</span><span class="o">+</span><span class="n">eday</span><span class="o">+</span><span class="n">decstr</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">)</span>
            <span class="n">cfile</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">cfilen</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">fileextlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">cfiledict</span><span class="p">[</span><span class="n">comp</span><span class="p">]:</span>
                <span class="n">sfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">sfn</span><span class="o">=</span><span class="n">sfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">sfile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="c">#make sure file position is 0</span>
                    <span class="n">sfile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">sfile</span><span class="p">,</span> <span class="n">cfile</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">fileextlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;File: &#39;</span><span class="o">+</span><span class="n">fn</span><span class="o">+</span><span class="s">&#39; -&gt; Length: &#39;</span><span class="o">+</span>
                                    <span class="nb">str</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sfn</span><span class="p">)))])</span>
                <span class="k">print</span> <span class="s">&#39;Opened file: &#39;</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="s">&#39;Length= &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">sfn</span><span class="p">)</span>
                
            <span class="k">print</span> <span class="s">&#39;Combined file to: &#39;</span><span class="p">,</span><span class="n">cfilen</span>
            <span class="n">fileslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fileextlst</span><span class="p">)</span>
        <span class="c">#return the filenames of the combined files and the files used to </span>
        <span class="c">#combine</span>
        <span class="k">return</span> <span class="n">cfilelst</span><span class="p">,</span><span class="n">fileslst</span>
    <span class="c">#if the files are already combined return the filenames</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Files already combined&#39;</span>
        <span class="k">return</span> <span class="n">cfilelst</span><span class="p">,[]</span>
    </div>
<div class="viewcode-block" id="adaptiveNotchFilter"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.adaptiveNotchFilter">[docs]</a><span class="k">def</span> <span class="nf">adaptiveNotchFilter</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">notches</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">notchradius</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span><span class="n">freqrad</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span><span class="n">rp</span><span class="o">=.</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    adaptiveNotchFilter(bx,df,notches=[50,100],notchradius=.3,freqrad=.9)</span>
<span class="sd">    will apply a notch filter to the array bx by finding the nearest peak around</span>
<span class="sd">    the supplied notch locations.  The filter is a zero-phase Chebyshev type 1 </span>
<span class="sd">    bandstop filter with minimal ripples.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        bx = array to filter</span>
<span class="sd">        df = sampling frequency</span>
<span class="sd">        notches = list of notches to filter</span>
<span class="sd">        notchradius = radius of the notch in frequency domain</span>
<span class="sd">        freqrad = radius for searching for peak about notch</span>
<span class="sd">        rp = ripple of Chebyshev type 1 filter, lower numbers means less ripples</span>

<span class="sd">    Outputs:</span>
<span class="sd">        bx = filtered array</span>
<span class="sd">        filtlst = location of notches and power difference</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">notches</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
        <span class="n">notches</span><span class="o">=</span><span class="p">[</span><span class="n">notches</span><span class="p">]</span>
    
    <span class="n">df</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>         <span class="c">#make sure df is a float</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">df</span>             <span class="c">#sampling rate</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>            <span class="c">#length of array</span>
    <span class="n">dfn</span><span class="o">=</span><span class="n">df</span><span class="o">/</span><span class="n">n</span>             <span class="c">#frequency step</span>
    <span class="n">dfnn</span><span class="o">=</span><span class="n">freqrad</span><span class="o">/</span><span class="n">dfn</span>          <span class="c">#radius of frequency search</span>
    <span class="n">fn</span><span class="o">=</span><span class="n">notchradius</span>               <span class="c">#filter radius</span>

    <span class="n">BX</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
    <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
    
    <span class="n">filtlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">notch</span> <span class="ow">in</span> <span class="n">notches</span><span class="p">:</span>
        <span class="n">fspot</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">notch</span><span class="o">/</span><span class="n">dfn</span><span class="p">))</span>
        <span class="n">nspot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">BX</span><span class="p">)</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">BX</span><span class="p">[</span><span class="n">fspot</span><span class="o">-</span><span class="n">dfnn</span><span class="p">:</span><span class="n">fspot</span><span class="o">+</span><span class="n">dfnn</span><span class="p">])))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dbstop</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">BX</span><span class="p">[</span><span class="n">nspot</span><span class="p">])</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">BX</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">dbstop</span><span class="p">)</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">or</span> <span class="n">dbstop</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">filtlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;No need to filter </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">freq</span><span class="p">[</span><span class="n">nspot</span><span class="p">],</span><span class="n">dbstop</span><span class="p">])</span>
            <span class="n">ws</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">freq</span><span class="p">[</span><span class="n">nspot</span><span class="p">]</span><span class="o">-</span><span class="n">fn</span><span class="p">,</span><span class="n">freq</span><span class="p">[</span><span class="n">nspot</span><span class="p">]</span><span class="o">+</span><span class="n">fn</span><span class="p">])</span><span class="o">/</span><span class="n">df</span>
            <span class="n">wp</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">freq</span><span class="p">[</span><span class="n">nspot</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">fn</span><span class="p">,</span><span class="n">freq</span><span class="p">[</span><span class="n">nspot</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">fn</span><span class="p">])</span><span class="o">/</span><span class="n">df</span>
            <span class="nb">ord</span><span class="p">,</span><span class="n">wn</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">cheb1ord</span><span class="p">(</span><span class="n">wp</span><span class="p">,</span><span class="n">ws</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">dbstop</span><span class="p">)</span>
            <span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">cheby1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span><span class="n">wn</span><span class="p">,</span><span class="n">btype</span><span class="o">=</span><span class="s">&#39;bandstop&#39;</span><span class="p">)</span>
            <span class="n">bx</span><span class="o">=</span><span class="n">sps</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">bx</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">bx</span><span class="p">,</span><span class="n">filtlst</span>

        
</div>
<div class="viewcode-block" id="removePeriodicNoise"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.removePeriodicNoise">[docs]</a><span class="k">def</span> <span class="nf">removePeriodicNoise</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">noiseperiods</span><span class="p">,</span><span class="n">cacherate</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    removePeriodicNoise will take average a window of length noise period and </span>
<span class="sd">    average the signal for as many windows that can fit within the data.  This</span>
<span class="sd">    averaged window is convolved with a series of delta functions at each window</span>
<span class="sd">    location to create a noise time series. This is then subtracted from the </span>
<span class="sd">    data to get a &#39;noise free&#39; time series.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        filename = name of file to have periodic noise removed from</span>
<span class="sd">                    can be an array</span>
<span class="sd">        dt = time sample rate (s)</span>
<span class="sd">        noiseperiods = a list of estimated periods with a range of values to </span>
<span class="sd">                        look around [[noiseperiod1,df1]...] where df1 is a </span>
<span class="sd">                        fraction value find the peak about noiseperiod1 must be</span>
<span class="sd">                        less than 1.</span>
<span class="sd">        cacherate = length of file (min)</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        bxnf = filtered time series</span>
<span class="sd">        pn = periodic noise</span>
<span class="sd">        fitlst = list of peaks found</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">noiseperiods</span><span class="p">)</span><span class="o">!=</span><span class="nb">list</span><span class="p">:</span>
        <span class="n">noiseperiods</span><span class="o">=</span><span class="p">[</span><span class="n">noiseperiods</span><span class="p">]</span>
    
    <span class="n">dt</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>    
    <span class="c">#sampling frequency    </span>
    <span class="n">df</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">dt</span>
    <span class="c">#length of array</span>
    <span class="n">T</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cacherate</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="n">df</span><span class="p">)</span>
    <span class="c">#frequency step</span>
    <span class="n">dfn</span><span class="o">=</span><span class="n">df</span><span class="o">/</span><span class="n">T</span>
    <span class="c">#make a frequency array that describes BX</span>
    <span class="n">pfreq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="n">dt</span><span class="p">)</span> 
    
    <span class="n">filtlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">pnlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">nperiod</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">noiseperiods</span><span class="p">):</span>
        <span class="c">#if the nperiod is the first one load file or make an array of the input</span>
        <span class="k">if</span> <span class="n">kk</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#load file</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">bx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">m</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">m</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
        <span class="c">#else copy the already filtered array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bx</span><span class="o">=</span><span class="n">bxnf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">m</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
        <span class="c">#get length of array</span>
        <span class="n">T</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
        
        <span class="c">#get noise period in points along frequency axis</span>
        <span class="n">nperiodnn</span><span class="o">=</span><span class="nb">round</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">nperiod</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">dfn</span><span class="p">)</span>
        
        <span class="c">#get region to look around to find exact peak</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dfnn</span><span class="o">=</span><span class="n">nperiodnn</span><span class="o">*</span><span class="n">nperiod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">dfnn</span><span class="o">=.</span><span class="mi">2</span><span class="o">*</span><span class="n">nperiodnn</span>
        
        
        <span class="c">#comput FFT of input to find peak value</span>
        <span class="n">BX</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span>
        <span class="c">#if dfnn is not 0 then look for max with in region nperiod+-dfnn</span>
        <span class="k">if</span> <span class="n">dfnn</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">nspot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">BX</span><span class="p">)</span><span class="o">==</span>
                            <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">BX</span><span class="p">[</span><span class="n">nperiodnn</span><span class="o">-</span><span class="n">dfnn</span><span class="p">:</span><span class="n">nperiodnn</span><span class="o">+</span><span class="n">dfnn</span><span class="p">])))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nspot</span><span class="o">=</span><span class="n">nperiodnn</span>
        <span class="c">#output the peak frequency found</span>
        <span class="n">filtlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Found peak at : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pfreq</span><span class="p">[</span><span class="n">nspot</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Hz </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="c">#make nperiod the peak period in data points</span>
        <span class="n">nperiod</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">pfreq</span><span class="p">[</span><span class="n">nspot</span><span class="p">])</span><span class="o">/</span><span class="n">dt</span>

        <span class="c">#create list of time instances for windowing</span>
        <span class="c">#nlst=np.arange(start=nperiod,stop=T-nperiod,step=nperiod,dtype=&#39;int&#39;)</span>
        <span class="n">nlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="n">m</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">nperiod</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
        
        <span class="c">#convolve a series of delta functions with average of periodic window</span>
        <span class="n">dlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>               <span class="c">#delta function list</span>
        <span class="n">dlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">winlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">nlst</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">nperiod</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nlst</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">T</span><span class="o">-</span><span class="n">ii</span><span class="o">&lt;</span><span class="n">nperiod</span><span class="p">:</span>
                <span class="n">dlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">winlst</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">=</span><span class="n">bx</span><span class="p">[</span><span class="n">ii</span><span class="p">:</span><span class="n">ii</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">nperiod</span><span class="p">)]</span>
                <span class="n">dlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                
        <span class="c">#compute median window to remove any influence of outliers</span>
        <span class="n">medwin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">winlst</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c">#make a time series by convolving</span>
        <span class="n">pn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">medwin</span><span class="p">,</span><span class="n">dlst</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">T</span><span class="p">]</span>

        <span class="c">#remove noise from data</span>
        <span class="n">bxnf</span><span class="o">=</span><span class="p">(</span><span class="n">bx</span><span class="o">-</span><span class="n">pn</span><span class="p">)</span>
        
        <span class="n">pnlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pnlst</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">pn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pnlst</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
        <span class="n">savepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span><span class="s">&#39;Filtered&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="c">#savepathCN=os.path.join(savepath,&#39;CN&#39;)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span><span class="n">bxnf</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.7g</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c">#np.savetxt(os.path.join(savepathCN,filename[0:5]+&#39;CN&#39;+filename[5:]),pn)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bxnf</span><span class="p">,</span><span class="n">pn</span><span class="p">,</span><span class="n">filtlst</span>
</div>
<div class="viewcode-block" id="imp2resphase"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.imp2resphase">[docs]</a><span class="k">def</span> <span class="nf">imp2resphase</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;imp2resphase(z,zvar,freq) will convert impedances </span>
<span class="sd">    z[4,3,len(freq)] to resistivities (ohm-m) and phases (deg) as well as the </span>
<span class="sd">    errors of each.  Note the phase is calculated using arctan2 putting the </span>
<span class="sd">    phase in the correct quadrant.  The xy component is placed into the positive</span>
<span class="sd">    quadrant by adding 180 deg. </span>
<span class="sd">    INPUTS: </span>
<span class="sd">        z=[[zxxreal,zxximag,zxxvar],...]], shape=(4,3,len(freq) OR </span>
<span class="sd">        z=[[[zxxr+1j*zxxi,zxyr+1j*zxyi],[zyx,zyy]]], shape=(len(freq),2,2) </span>
<span class="sd">        freq=frequency array </span>
<span class="sd">        zvar=[[[zxxvar,zyyvar],[zyxvar,zyyvar]]], shape=(len(freq),2,2)  </span>
<span class="sd">        ffactor=fudge factor to make sure resistivities are the right order</span>
<span class="sd">    OUTPUTS: </span>
<span class="sd">        [[resxx,resxxvar],[resxy,resxyvar]...],[[phasexx,phasexxvar]...]&quot;&quot;&quot;</span>
    
    <span class="c">#if in first format (4,3,n) change to the second format with shape (n,2,2)</span>
    <span class="n">s</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">zvar</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">znew</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">zvar</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">zxx</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">zxy</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">zyx</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">zyy</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">znew</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="n">zxx</span><span class="p">,</span><span class="n">zxy</span><span class="p">],[</span><span class="n">zyx</span><span class="p">,</span><span class="n">zyy</span><span class="p">]])</span>
                <span class="n">zvar</span><span class="o">.</span><span class="n">append</span><span class="p">([[</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]],[</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]]])</span>
        <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">znew</span><span class="p">)</span>
        <span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zvar</span><span class="p">)</span>
    
    <span class="n">period</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">freq</span>
    <span class="k">if</span> <span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
        <span class="n">zvar</span><span class="o">=</span><span class="n">zvar</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
        <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;Flipped arrays so frequency is decending.&#39;</span>
    
    <span class="k">if</span> <span class="n">zvar</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">resxy</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">resxyerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">resyx</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">resyxerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">resxx</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">resxxerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">resyy</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">resyyerr</span><span class="o">=</span><span class="p">[]</span>
    
    <span class="n">phasexy</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phasexyerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phaseyx</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phaseyxerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phasexx</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phasexxerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phaseyy</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">phaseyyerr</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
        <span class="n">wt</span><span class="o">=.</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">ffactor</span><span class="p">)</span>
        <span class="n">resxx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">resxy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">resyx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">resyy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">resxxerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                                                            <span class="o">-</span><span class="n">resxx</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="n">resxyerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                                                            <span class="o">-</span><span class="n">resxy</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="n">resyxerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                                                            <span class="o">-</span><span class="n">resyx</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        <span class="n">resyyerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                                                            <span class="o">-</span><span class="n">resyy</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span>
        
        <span class="n">phasexx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">phasexy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">phaseyx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">phaseyy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        
        <span class="n">phasexxerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">phasexyerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">phaseyxerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="n">phaseyyerr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>\
                                                            <span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">res</span><span class="o">=</span><span class="p">[[</span><span class="n">resxx</span><span class="p">,</span><span class="n">resxxerr</span><span class="p">],[</span><span class="n">resxy</span><span class="p">,</span><span class="n">resxyerr</span><span class="p">],[</span><span class="n">resyx</span><span class="p">,</span><span class="n">resyxerr</span><span class="p">],[</span><span class="n">resyy</span><span class="p">,</span><span class="n">resyyerr</span><span class="p">]]</span>
    <span class="n">phase</span><span class="o">=</span><span class="p">[[</span><span class="n">phasexx</span><span class="p">,</span><span class="n">phasexxerr</span><span class="p">],[</span><span class="n">phasexy</span><span class="p">,</span><span class="n">phasexyerr</span><span class="p">],[</span><span class="n">phaseyx</span><span class="p">,</span><span class="n">phaseyxerr</span><span class="p">],</span>
           <span class="p">[</span><span class="n">phaseyy</span><span class="p">,</span><span class="n">phaseyyerr</span><span class="p">]]</span>
           
        
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sigfigs"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.sigfigs">[docs]</a><span class="k">def</span> <span class="nf">sigfigs</span><span class="p">(</span><span class="n">numstr</span><span class="p">,</span><span class="n">digits</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;sigfigs(numstr,digits=8,fmt=&#39;g&#39;) will return a string with the proper </span>
<span class="sd">    amount of significant digits for the input number, can be str or float.&quot;&quot;&quot;</span>
    <span class="n">numfmt</span><span class="o">=</span><span class="s">&#39;%.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span><span class="o">+</span><span class="n">fmt</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">numstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">numstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">numstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">numstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;+Inf&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">signum</span><span class="o">=</span><span class="n">numfmt</span> <span class="o">%</span> <span class="o">-</span><span class="mf">6.66666666</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signum</span><span class="o">=</span><span class="n">numfmt</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">numstr</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">signum</span><span class="p">)</span><span class="o">&gt;</span><span class="n">digits</span><span class="p">:</span>
        <span class="n">signum</span><span class="o">=</span><span class="n">signum</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">digits</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">signum</span>
    </div>
<div class="viewcode-block" id="writeedi"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.writeedi">[docs]</a><span class="k">def</span> <span class="nf">writeedi</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">zvar</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">edidir</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rrstation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">birrpdict</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;writeedi2(z,zvar,freq,stationinfofile,station,edidir=None,rrstation=None,</span>
<span class="sd">    birrpdict=None) will write an .edi file for a station. </span>
<span class="sd">    Returns full filepath.&quot;&quot;&quot;</span>
    
    <span class="c">#get station info from station info file</span>
    <span class="n">statdict</span><span class="o">=</span><span class="n">getStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">station</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">[:,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;Flipped array so frequency is decending&#39;</span>
    <span class="n">nfreq</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

        
    <span class="c">#list of orientation components</span>
    <span class="n">orilst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;HX&#39;</span><span class="p">,</span><span class="s">&#39;HY&#39;</span><span class="p">,</span><span class="s">&#39;EX&#39;</span><span class="p">,</span><span class="s">&#39;EY&#39;</span><span class="p">,</span><span class="s">&#39;RX&#39;</span><span class="p">,</span><span class="s">&#39;RY&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">edidir</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">dirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dirpath</span><span class="o">=</span><span class="n">edidir</span>
    <span class="n">edipath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;.edi&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write header information</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HEAD </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;DATAID=&quot;&#39;</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#acquired by:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQBY=&quot;&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;acqby&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQBY=&quot;&#39;</span><span class="o">+</span><span class="s">&#39;Adelaide University&#39;</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#aqcuired date</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mdate</span><span class="o">=</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="n">mday</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">mmonth</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">myear</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="s">&#39;20&#39;</span><span class="o">+</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">myear</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">mdate</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">md</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">myear</span><span class="p">,</span><span class="n">mmonth</span><span class="p">,</span><span class="n">mday</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQDATE=&#39;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">md</span><span class="p">,</span><span class="s">&#39;%B </span><span class="si">%d</span><span class="s">, %Y&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ACQDATE=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#date edi file written</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;FILEDATE=&#39;</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span>
                                                       <span class="s">&#39;%B </span><span class="si">%d</span><span class="s">, %Y&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#survey location</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;PROSPECT=&quot;&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;PROSPECT=&quot; &quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#station name</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LOC=&quot;&#39;</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#latitude</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LAT=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LAT= </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#longitude</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LONG=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;LONG= </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#elevation</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ELEV=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ELEV= </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#Write info block</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;INFO&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAX LINES=1000&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#survey parameters</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;Survey Parameters: </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Sampling Frequency (Hz): &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;df&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Cache Rate (HHMMSS): &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;cacherate&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Data Logger Gain: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Interface Box Gain: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Instrument Box no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;box no&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Coil Numbers (BX,BY,BZ): &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;coil no(bx,by)&#39;</span><span class="p">]</span>
                                                                    <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Data Logger: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;dlbox&#39;</span><span class="p">]</span>
                                                                <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Hard Drive no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;harddrive&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Interface Box no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;interfacebox&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Battery no: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;battery&#39;</span><span class="p">]</span>
                        <span class="o">+</span><span class="s">&#39; Starting Voltage: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;start volt&#39;</span><span class="p">]</span>
                        <span class="o">+</span><span class="s">&#39; End Voltage &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;end volt&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Other Notes: &#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;notes&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="c">#BIRRP parameters</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;   Transfer Functions Computed using BIRRP 5.1  </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">birrpdict</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Coil Calibration File=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;bbfile&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Interaction Level (ILEV)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ilev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Number of outputs (NOUT)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nout&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Number of inputs (NINP)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ninp&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Slepian Filter order (TBW)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nref&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Max length of fft window (NFFT)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nfft&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Maximum number of fft sections (NSCTMAX)=&#39;</span>
                                    <span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nsctmax&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Small leverage point control (UIN)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;uin&#39;</span><span class="p">]</span>
                                                                <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Large leverage point control (AINUIN)=&#39;</span>
                                <span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;ainuin&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Electric coherence threshold (C2THRESHE)=&#39;</span>
                                    <span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threshe&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Z component (NZ)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nz&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Coherence threshold z channel (C2threse1)=&#39;</span>
                                <span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;c2threse1&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Order of prewhitening filter (NAR)=&#39;</span><span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;nar&#39;</span><span class="p">]</span>
                                                                <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Electric channel rotation angles (THETAE)=&#39;</span>
                                        <span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetae&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Magnetic channel rotation angles (THETAB)=&#39;</span>
                                        <span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetab&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Final channel rotation angles (THETAF)=&#39;</span>
                                        <span class="o">+</span><span class="n">birrpdict</span><span class="p">[</span><span class="s">&#39;thetaf&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        
    <span class="c">#remote reference</span>
    <span class="k">if</span> <span class="n">rrstation</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">rrdict</span><span class="o">=</span><span class="n">getStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">rrstation</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Station: &#39;</span><span class="o">+</span><span class="n">rrstation</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Lat=&#39;</span>
                                    <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Long=&#39;</span>
                                    <span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lsp</span><span class="o">+</span><span class="s">&#39;Remote Reference Elev=&#39;</span><span class="o">+</span><span class="n">rrdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write define measurement block</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;=DEFINEMEAS&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAXCHAN=6&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAXRUN=999&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;MAXMEAS=99999&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;UNITS=M&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFTYPY=CART&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFLAT=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFLONG=&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">float</span><span class="p">(</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;long&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;REFELEV=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;elev&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1001.001 CHTYPE=HX X=0 Y=0 AZM=0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1002.001 CHTYPE=HY X=0 Y=0 AZM=90&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;EMEAS ID=1003.001 CHTYPE=EX X=0 Y=0 X2=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ex&#39;</span><span class="p">]</span>
                                                            <span class="o">+</span><span class="s">&#39; Y2=0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;EMEAS ID=1004.001 CHTYPE=EY X=0 Y=0 X2=0 Y2=&#39;</span><span class="o">+</span><span class="n">statdict</span><span class="p">[</span><span class="s">&#39;ey&#39;</span><span class="p">]</span>
                                                            <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1005.001 CHTYPE=RX X=0 Y=0 AZM=0&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;HMEAS ID=1006.001 CHTYPE=RY X=0 Y=0 AZM=90&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write mtsect block</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;=MTSECT </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;SECTID=&#39;</span><span class="o">+</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="n">nfreq</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1001.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1002.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1003.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1004.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1005.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="n">orilst</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;=1006.001&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****FREQUENCIES****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">order</span><span class="o">=</span><span class="s">&#39;INC&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">order</span><span class="o">=</span><span class="s">&#39;DEC&#39;</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;FREQ&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="n">nfreq</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ORDER=&#39;</span><span class="o">+</span><span class="n">order</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;// &#39;</span><span class="o">+</span>
                                                                    <span class="n">nfreq</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">freq</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****IMPEDANCES****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="n">implst</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;ZXXR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXXI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZXX.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="s">&#39;ZXYR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXYI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>\
        <span class="p">[</span><span class="s">&#39;ZXY.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="s">&#39;ZYXR&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZYXI&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;ZYX.VAR&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>\
        <span class="p">[</span><span class="s">&#39;ZYYR&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZYYI&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYY.VAR&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span>
    <span class="c">#write new impedances and variances</span>
    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">imp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">implst</span><span class="p">):</span>
        <span class="n">mm</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nn</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="n">nfreq</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.6e</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">z</span><span class="p">[</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">kk</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#write tipper info</span>
    
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****TIPPER****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">tiplst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;TXR&#39;</span><span class="p">,</span><span class="s">&#39;TXI&#39;</span><span class="p">,</span><span class="s">&#39;TX.VAR&#39;</span><span class="p">,</span><span class="s">&#39;TY&#39;</span><span class="p">,</span><span class="s">&#39;TYI&#39;</span><span class="p">,</span><span class="s">&#39;TY.VAR&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">tip</span> <span class="ow">in</span> <span class="n">tiplst</span><span class="p">:</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">tip</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="n">nfreq</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
            <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.6e</span><span class="s">&#39;</span> <span class="o">%</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">),</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nfreq</span><span class="p">),</span><span class="mf">5.</span><span class="p">):</span>
                <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;END&#39;</span><span class="p">)</span>
    <span class="n">edifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">edipath</span>
    </div>
<div class="viewcode-block" id="rewriteedi"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.rewriteedi">[docs]</a><span class="k">def</span> <span class="nf">rewriteedi</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="n">znew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">zvarnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">freqnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">newfile</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span>
               <span class="n">tipnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">tipvarnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dr</span><span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    rewriteedi(edifile) will rewrite an edifile say if it needs to be rotated </span>
<span class="sd">    or distortion removed.</span>

<span class="sd">    Inputs:</span>
<span class="sd">        edifile = full path to edifile to be rewritten</span>
<span class="sd">        znew = impedance tensor if a new one has been created</span>
<span class="sd">        zvarnew = errors in impedance tensor if a new one has been created</span>
<span class="sd">        freqnew = new frequency list if one has been created</span>
<span class="sd">        newfile = &#39;y&#39; for yes or &#39;n&#39; for no if you want a new file to be</span>
<span class="sd">                 created.</span>
<span class="sd">        tipnew = new tipper array</span>
<span class="sd">        tipvarnew = new tipper error array</span>
<span class="sd">        thetar = rotation angle counter clockwise (N=0, E=-90)</span>
<span class="sd">        dr = &#39;n&#39; if no distortion removal and &#39;y&#39; for distortion removal</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        nedi = dirpath(edifile)+basename(edifile)+rw or dr if dr=&#39;y&#39;</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#get direcotry path make one if not there    </span>
    <span class="n">dirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newfile</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dr</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">drdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="s">&#39;DR&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">drdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="s">&#39;Rot{0:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thetar</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Made directory: &#39;</span><span class="p">,</span><span class="n">drdirpath</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c">#copy files into a common directory</span>
        <span class="n">drpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">count</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
            <span class="n">drpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">drpath</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">drpath</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">folder</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;EDIfiles&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">edifolderyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                    <span class="n">drcopypath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drpath</span><span class="p">,</span><span class="s">&#39;EDIfiles&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="s">&#39;DR&#39;</span><span class="p">)):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="s">&#39;DR&#39;</span><span class="p">))</span>
                            <span class="k">print</span> <span class="s">&#39;Made directory &#39;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="s">&#39;DR&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edifolderyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                    <span class="n">drcopypath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#get new file name</span>
        <span class="k">if</span> <span class="n">dr</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">newedifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">edifile</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;dr.edi&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newedifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">edifile</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;rw.edi&#39;</span>
        <span class="c">#open a new edifile</span>
        <span class="n">newedifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">newedifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">edifile</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;c.edi&#39;</span>
        <span class="n">newedifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">edifolderyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
        
    <span class="k">if</span> <span class="n">znew</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">edidict</span><span class="o">=</span><span class="n">readedi</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
        <span class="c">#rotate data if desired</span>
        <span class="k">if</span> <span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">znew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">])</span>
            <span class="n">zvarnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">])</span>
            <span class="c">#convert thetar into radians</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="c">#make rotation matrix</span>
            <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetar</span><span class="p">)],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thetar</span><span class="p">)]])</span>
            <span class="c">#rotate the data</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">])):</span>
                <span class="n">znew</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                <span class="n">zvarnew</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">][</span><span class="n">rr</span><span class="p">],</span>
                                        <span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">znew</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">zvarnew</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span>
    
    <span class="c">#open existing edi file</span>
    <span class="n">edifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="c">#read existing edi file and find where impedances start and number of freq</span>
    <span class="n">edilines</span><span class="o">=</span><span class="n">edifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">spot</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;FREQ&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">spot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="n">linelst</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">)</span>
            <span class="n">nfreq</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linelst</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;IMPEDANCES&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">spot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;SPECTRA&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">spot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;TIPPER&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">spot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
    
    <span class="c">#if there is a new frequency list</span>
    <span class="k">if</span> <span class="n">freqnew</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="c">#get number of frequencies    </span>
        <span class="n">nfreq</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilines</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">spot</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;NFREQ=&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        
        <span class="c">#get order of frequencies        </span>
        <span class="k">if</span> <span class="n">freqnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freqnew</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">order</span><span class="o">=</span><span class="s">&#39;INC&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">order</span><span class="o">=</span><span class="s">&#39;DEC&#39;</span>
        
        <span class="c">#write frequency header</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;FREQ&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ORDER=&#39;</span><span class="o">+</span><span class="n">order</span><span class="o">+</span>
                        <span class="n">tsp</span><span class="o">+</span><span class="s">&#39;// &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2.8f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">freqnew</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****IMPEDANCES****!&#39;</span><span class="o">+</span><span class="s">&#39; Rotated {0:.0f} counterclockwise</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thetar</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="c">#from the start of file to where impedances start write from existing edifile</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">edilines</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">spot</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****IMPEDANCES****!&#39;</span><span class="o">+</span><span class="s">&#39; Rotated {0:.0f} counterclockwise</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thetar</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    
    <span class="c">#create an implst to make code simpler</span>
    <span class="n">implst</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;ZXXR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXXI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXX.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXYR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZXYI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>\
        <span class="p">[</span><span class="s">&#39;ZXY.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYXR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZYXI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;ZYX.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>\
        <span class="p">[</span><span class="s">&#39;ZYYR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYYI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYY.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
    <span class="c">#write new impedances and variances</span>
    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">imp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">implst</span><span class="p">):</span>
        <span class="n">mm</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nn</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%+.7E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">znew</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%+.7E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">znew</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%+.7E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">zvarnew</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">tipnew</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****TIPPER****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">tiplst</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;TXR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TXI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TX.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TYR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;TYI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="s">&#39;TY.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipnew</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">tipnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tipnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tipnew</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">tip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tiplst</span><span class="p">):</span>
            <span class="n">mm</span><span class="o">=</span><span class="n">tip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%+.7E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tipnew</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%+.7E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tipnew</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%+.7E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tipvarnew</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;END&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#print nlinesleft</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">edilines</span><span class="p">[</span><span class="n">spot</span><span class="p">[</span><span class="mi">2</span><span class="p">]:]:</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="n">edifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">newedifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c">#copy file to a common folder</span>
    <span class="k">if</span> <span class="n">edifolderyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">newfile</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dr</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="s">&#39;DR&#39;</span><span class="p">,</span><span class="n">newedifile</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="s">&#39;RW&#39;</span><span class="p">,</span><span class="n">newedifile</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">),</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="n">newfile</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="getnum"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.getnum">[docs]</a><span class="k">def</span> <span class="nf">getnum</span><span class="p">(</span><span class="n">numberlst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get number from string list and put it into an array&quot;&quot;&quot;</span>
    
    <span class="n">nlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numberlst</span><span class="p">)):</span>
        <span class="n">numlst</span><span class="o">=</span><span class="n">numberlst</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numlst</span><span class="p">)):</span>
            <span class="n">num</span><span class="o">=</span><span class="n">numlst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">nlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">nlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">6.666</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nlst</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="readedi"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.readedi">[docs]</a><span class="k">def</span> <span class="nf">readedi</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;readedi(edifile) will read in an edi file written in a format given by</span>
<span class="sd">    format given by http://www.dias.ie/mtnet/docs/ediformat.txt. </span>
<span class="sd">    Returns: lat,lon,frequency,Z[zreal+i*zimag],Zvar,tipper,tippervar (if </span>
<span class="sd">    applicable)</span>
<span class="sd">    </span>
<span class="sd">    Input: </span>
<span class="sd">        filename = full path to edifile</span>
<span class="sd">        </span>
<span class="sd">    Output:</span>
<span class="sd">        edidict = dictionary with keys:</span>
<span class="sd">            station = station name</span>
<span class="sd">            lat = latitude </span>
<span class="sd">            lon = longitude</span>
<span class="sd">            frequency = frequency array</span>
<span class="sd">            z = impedance tensor as (nfreq,2,2)</span>
<span class="sd">            zvar = variance of impedance tensor as (nfreq,2,2)</span>
<span class="sd">            tipper = tipper as (nfreq,2,1)</span>
<span class="sd">            tippervar = tipper variance as (nfreq,2,1)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">edifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">edilines</span><span class="o">=</span><span class="n">edifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">existlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">tfind</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edilines</span><span class="p">)):</span>
        <span class="n">strline</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;HEAD&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;head&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;INFO&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;info&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;DEFINE&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;define&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;MTSECT&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;mtsect&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;FREQUENCIES&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;frequencies&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;ROTATION&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;rotation&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;IMPEDANCES&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;impedances&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;TIPPER&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;tipper&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">strline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;END&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">existlst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;end&#39;</span><span class="p">,</span><span class="n">ii</span><span class="p">])</span>
            
<span class="c">#    print existlst</span>

    <span class="c">#get things into lists</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">existlst</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;head&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">header</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;LAT&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">latfind</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                    <span class="n">latstr</span><span class="o">=</span><span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">latlst</span><span class="o">=</span><span class="n">latstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c">#change from hh:mm:ss to decimal deg</span>
                    <span class="k">if</span> <span class="n">latlst</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">latlst</span><span class="o">=</span><span class="n">latlst</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                        <span class="n">latstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                            <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                        <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">latstr</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;LONG&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">lonfind</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                    <span class="n">lonstr</span><span class="o">=</span><span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">lonlst</span><span class="o">=</span><span class="n">lonstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="c">#change from hh:mm:ss to decimal deg</span>
                    <span class="k">if</span> <span class="n">lonlst</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">lonlst</span><span class="o">=</span><span class="n">lonlst</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                        <span class="n">lonstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                            <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                        <span class="n">lon</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lonstr</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lon</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;LOC&quot;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">locstr</span><span class="o">=</span><span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">locstr</span><span class="o">=</span><span class="n">locstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">station</span><span class="o">=</span><span class="n">locstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;DATAID&quot;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">locstr</span><span class="o">=</span><span class="n">header</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">locstr</span><span class="o">=</span><span class="n">locstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">station</span><span class="o">=</span><span class="n">locstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">station</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                    
            <span class="c">#print ii, &#39; Got Header&#39;</span>
        <span class="k">elif</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#print ii, &#39; Got info&#39;</span>
            <span class="n">info</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;define&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">definem</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">latfind</span>
                <span class="n">lonfind</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">definem</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">definem</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;LAT&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">latstr</span><span class="o">=</span><span class="n">definem</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">latlst</span><span class="o">=</span><span class="n">latstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c">#change from hh:mm:ss to decimal deg</span>
                        <span class="k">if</span> <span class="n">latlst</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">latlst</span><span class="o">=</span><span class="n">latlst</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                            <span class="n">latstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                                <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                            <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">latstr</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">definem</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;LONG&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">lonstr</span><span class="o">=</span><span class="n">definem</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">lonlst</span><span class="o">=</span><span class="n">lonstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c">#change from hh:mm:ss to decimal deg</span>
                        <span class="k">if</span> <span class="n">lonlst</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">lonlst</span><span class="o">=</span><span class="n">lonlst</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                            <span class="n">lonstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                                <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                            <span class="n">lon</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lonstr</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lon</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">)</span>
            
            <span class="c">#print ii, &#39; Got define measurement&#39;</span>
            
        <span class="k">elif</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;mtsect&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#print ii, &#39; Got mtsect&#39;</span>
            <span class="n">mtsect</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;frequencies&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#print ii, &#39; Got frequencies&#39;</span>
            <span class="n">frequencylst</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">freq</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">frequencylst</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;rotation&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#print ii, &#39; Got rotations&#39;</span>
            <span class="n">rotlst</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">rot</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">rotlst</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;impedances&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            
            <span class="n">impedancelst</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">imfindlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">impedancelst</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">imfindlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span>
            <span class="n">zxxr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">zxxi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">zxxv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
            <span class="n">zxyr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
            <span class="n">zxyi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
            <span class="n">zxyv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span>
            <span class="n">zyxr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">7</span><span class="p">]])</span>
            <span class="n">zyxi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">8</span><span class="p">]])</span>
            <span class="n">zyxv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">9</span><span class="p">]])</span>
            <span class="n">zyyr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">10</span><span class="p">]])</span>
            <span class="n">zyyi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">11</span><span class="p">]])</span>
            <span class="n">zyyv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">impedancelst</span><span class="p">[</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">+</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">imfindlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="c">#print ii, &#39; Got impedances&#39;</span>
        <span class="k">elif</span> <span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;tipper&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">tflst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;trot&#39;</span><span class="p">,</span><span class="s">&#39;txr&#39;</span><span class="p">,</span><span class="s">&#39;txi&#39;</span><span class="p">,</span><span class="s">&#39;txvar&#39;</span><span class="p">,</span><span class="s">&#39;tx.var&#39;</span><span class="p">,</span><span class="s">&#39;tyr&#39;</span><span class="p">,</span><span class="s">&#39;tyi&#39;</span><span class="p">,</span><span class="s">&#39;tyvar&#39;</span><span class="p">,</span>
                   <span class="s">&#39;ty.var&#39;</span><span class="p">]</span>
            <span class="n">tfind</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">tipperlst</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">existlst</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">tipfindlst</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">tflst</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tipperlst</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">tipfindlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
<span class="c">#                if tipperlst[nn].find(&#39;&gt;&#39;)&gt;=0:</span>
<span class="c">#                    tipfindlst.append(nn)</span>
<span class="c">#            print tipfindlst,len(tipfindlst)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipfindlst</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
                <span class="n">txr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">txi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">txv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
                <span class="n">tyr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
                <span class="n">tyi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
                <span class="n">tyv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span>
                                                <span class="n">tipfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tipfindlst</span><span class="p">)</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
                <span class="n">trot</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">txr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">txi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
                <span class="n">txv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
                <span class="n">tyr</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
                <span class="n">tyi</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span>
                <span class="n">tyv</span><span class="o">=</span><span class="n">getnum</span><span class="p">(</span><span class="n">tipperlst</span><span class="p">[</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span>
                                                <span class="n">tipfindlst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tipfindlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="c">#print ii, &#39; Got tipper&#39;</span>
    <span class="c">#put things into a dictionary to return values</span>
    <span class="n">edidict</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">station</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lat</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;lon&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lon</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zxxr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zxxi</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">zxyr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zxyi</span><span class="p">[</span><span class="n">ff</span><span class="p">]],[</span><span class="n">zyxr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zyxi</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">zyyr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">zyyi</span><span class="p">[</span><span class="n">ff</span><span class="p">]]]))</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zxxv</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">zxyv</span><span class="p">[</span><span class="n">ff</span><span class="p">]],[</span><span class="n">zyxv</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">zyyv</span><span class="p">[</span><span class="n">ff</span><span class="p">]]]))</span>
    <span class="k">if</span> <span class="n">tfind</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">txr</span><span class="p">)):</span>        
            <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">txr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">txi</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">tyr</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">tyi</span><span class="p">[</span><span class="n">ff</span><span class="p">]]))</span>
            <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">txv</span><span class="p">[</span><span class="n">ff</span><span class="p">],</span><span class="n">tyv</span><span class="p">[</span><span class="n">ff</span><span class="p">]]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">0.0</span><span class="p">]))</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">0.0</span><span class="p">]))</span>
    <span class="c">#make things into arrays for easy manipulation</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">])</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">])</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">])</span>
    <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;rotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;rotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tiprotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">trot</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tiprotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    
    <span class="k">if</span> <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;rotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;rotation&#39;</span><span class="p">]</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tiprotation&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;tiprotation&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;Flipped arrays so frequency is decending&#39;</span>
    <span class="k">return</span> <span class="n">edidict</span>
</div>
<div class="viewcode-block" id="combineEdifiles"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.combineEdifiles">[docs]</a><span class="k">def</span> <span class="nf">combineEdifiles</span><span class="p">(</span><span class="n">edifile1</span><span class="p">,</span><span class="n">edifile2</span><span class="p">,</span><span class="n">nread1</span><span class="p">,</span><span class="n">nread2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    combineEdifiles(edifile1,edifile2,read1,read2) will combine edifile1 with</span>
<span class="sd">    edifile2 according to read1 and read2. It will combine frequencies,</span>
<span class="sd">    impedance and tipper.</span>
<span class="sd">    </span>
<span class="sd">    Note nread1 is from the start for edifile1 and nread2 is from end for </span>
<span class="sd">    edifile2.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        edifile1 = full path to edifile with the largest frequencies</span>
<span class="sd">        edifile2 = full path to edifile with smallest frequencies, longest </span>
<span class="sd">                    periods</span>
<span class="sd">        nread1 = integer of number of frequencies to read in from edifile1.  </span>
<span class="sd">                Index is from the start, ie [0:nread1]</span>
<span class="sd">        nread2 = integer of number of frequencies to read in from edifile2.</span>
<span class="sd">                Index is from end of frequencies, ie [-nread2:]</span>
<span class="sd">    Outputs:</span>
<span class="sd">        newedifile = full path to new edifile, which is saved to edifile1 with</span>
<span class="sd">                    a c before .edi</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">edidict1</span><span class="o">=</span><span class="n">readedi</span><span class="p">(</span><span class="n">edifile1</span><span class="p">)</span>
    <span class="n">edidict2</span><span class="o">=</span><span class="n">readedi</span><span class="p">(</span><span class="n">edifile2</span><span class="p">)</span>
    
    <span class="n">znew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edidict1</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][:</span><span class="n">nread1</span><span class="p">],</span><span class="n">edidict2</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">nread2</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">zvarnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edidict1</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">][:</span><span class="n">nread1</span><span class="p">],</span><span class="n">edidict2</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">nread2</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">freqnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edidict1</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">][:</span><span class="n">nread1</span><span class="p">],</span>
                      <span class="n">edidict2</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">nread2</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tipnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edidict1</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">][:</span><span class="n">nread1</span><span class="p">],</span><span class="n">edidict2</span><span class="p">[</span><span class="s">&#39;tipper&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">nread2</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tipvarnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edidict1</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">][:</span><span class="n">nread1</span><span class="p">],</span>
                        <span class="n">edidict2</span><span class="p">[</span><span class="s">&#39;tippervar&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">nread2</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">newedifile</span><span class="o">=</span><span class="n">rewriteedi</span><span class="p">(</span><span class="n">edifile1</span><span class="p">,</span><span class="n">znew</span><span class="p">,</span><span class="n">zvarnew</span><span class="p">,</span><span class="n">freqnew</span><span class="o">=</span><span class="n">freqnew</span><span class="p">,</span><span class="n">newfile</span><span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">,</span>
                             <span class="n">tipnew</span><span class="o">=</span><span class="n">tipnew</span><span class="p">,</span><span class="n">tipvarnew</span><span class="o">=</span><span class="n">tipvarnew</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newedifile</span></div>
<div class="viewcode-block" id="sil"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.sil">[docs]</a><span class="k">def</span> <span class="nf">sil</span><span class="p">(</span><span class="n">iniline</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;sil(iniline) will split a single line written in an .ini file</span>
<span class="sd">    for burpinterface and return the list of strings.&quot;&quot;&quot;</span>
    
    <span class="n">inistr</span><span class="o">=</span><span class="n">iniline</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">linelst</span><span class="o">=</span><span class="n">inistr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">linelst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="readStationInfo"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.readStationInfo">[docs]</a><span class="k">def</span> <span class="nf">readStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;readStationInfo(stationinfofile) will read in a .txt (tab </span>
<span class="sd">    delimited) or .csv(comma delimited)file that has the following information: </span>
<span class="sd">    station name, latitude, longitude, elevation, date collected, </span>
<span class="sd">    components measured (a number: 4 for ex,ey,bx,by, 5 for </span>
<span class="sd">    ex,ey,bx,by,bz, 6 for ex,ey,bx,by,bz,tp), magnetic type (bb or lp), dipole </span>
<span class="sd">    lengths (m), data logger gain (very low=2.5,low=1,high=.1),interface box </span>
<span class="sd">    gain (10 or 100), bz correction for longperiod data and the bx,by,bz </span>
<span class="sd">    components as they were measured in the field. Use headers: station, lat,</span>
<span class="sd">    lon, elev, date, mcomps, magtype, ex, ey, dlgain, igain, lpbzcor, magori. </span>
<span class="sd">    Returns a list of the dictionaries with found information.&quot;&quot;&quot;</span>
    
    <span class="c">#figure out what type of file it is and choose the appropriate delimeter</span>
    <span class="n">filebase</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filebase</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.txt&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span>
    <span class="k">elif</span> <span class="n">filebase</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.csv&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span>
        
    <span class="c">#get header information    </span>
    <span class="n">infofid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">infolines</span><span class="o">=</span><span class="n">infofid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">hdrlinestr</span><span class="o">=</span><span class="n">infolines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">hdrlinestr</span><span class="o">=</span><span class="n">hdrlinestr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">filebase</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.csv&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hdrlinestr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39; &#39;</span>
            
    <span class="n">hdrlineslst</span><span class="o">=</span><span class="n">hdrlinestr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
 
    <span class="n">info</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">infolines</span><span class="p">)):</span>
        <span class="n">infodict</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hdrlineslst</span><span class="p">)):</span>
            <span class="n">infoline</span><span class="o">=</span><span class="n">infolines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">infoline</span><span class="o">=</span><span class="n">infoline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
            <span class="n">infostr</span><span class="o">=</span><span class="n">infoline</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">infostr</span><span class="o">=</span><span class="n">infostr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">infodict</span><span class="p">[</span><span class="n">hdrlineslst</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span><span class="o">=</span><span class="n">infostr</span>
        <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infodict</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">info</span>
</div>
<div class="viewcode-block" id="getStationInfo"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.getStationInfo">[docs]</a><span class="k">def</span> <span class="nf">getStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">,</span><span class="n">station</span><span class="p">,</span><span class="n">mapversion</span><span class="o">=</span><span class="mi">23</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStationInfo(stationinfofile,station) returns info for the nominated</span>
<span class="sd">    station from the stationinfofile as a dictionary with key words in the </span>
<span class="sd">    hdrinfo.&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">MTpy.utils.LatLongUTMconversion</span> <span class="kn">as</span> <span class="nn">utm2ll</span>

    <span class="n">info</span><span class="o">=</span><span class="n">readStationInfo</span><span class="p">(</span><span class="n">stationinfofile</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">station</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="c">#convert UTM to decimal latitude and longitude using </span>
            <span class="c">#LatLongUTMconversion.py</span>
            <span class="c">#note: the system is wgs84, if you use a different system change the</span>
            <span class="c">#number as per LatLongUTMconversion.py</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;easting&#39;</span><span class="p">]</span>
                <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;northing&#39;</span><span class="p">]</span>
                <span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="n">utm2ll</span><span class="o">.</span><span class="n">UTMtoLL</span><span class="p">(</span><span class="n">mapversion</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;northing&#39;</span><span class="p">]),</span>
                           <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;easting&#39;</span><span class="p">]),</span><span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;zone&#39;</span><span class="p">])</span>
                <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;long&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sigfigs</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lon</span><span class="p">),</span><span class="mi">12</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c">#if there is no decimal place in lat or long probably northing</span>
                <span class="c">#and easting so convert to lats and longs</span>
                <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">or</span> \
                    <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;long&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;long&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c">#if in HH:MM:SS.SS format convert to decimal</span>
                    <span class="c">#convert lat</span>
                    <span class="n">latlst</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                    <span class="n">latstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                            <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;lat&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">latstr</span>
                    <span class="c">#convert long</span>
                    <span class="n">lonlst</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;long&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                    <span class="n">lonstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                            <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
                    <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;long&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">lonstr</span>
                        
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="c">#if there is no bz correction for long period add one for consistancy</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;lpbzcor&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;lpbzcor&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;0&#39;</span>
            <span class="k">return</span> <span class="n">info</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        </div>
<div class="viewcode-block" id="convertfiles"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.convertfiles">[docs]</a><span class="k">def</span> <span class="nf">convertfiles</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">infodict</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.6g</span><span class="s">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convertfiles will convert data of counts from data logger to units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aconvstr</span><span class="o">=</span><span class="s">&#39; has already been converted check data file&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">delemptyfile</span><span class="o">=</span><span class="s">&#39; has been deleted because the file was empty&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">clines</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;======&#39;</span><span class="o">+</span><span class="n">folder</span><span class="o">+</span><span class="s">&#39;======&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dayfolder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">dayfolder</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;---&#39;</span><span class="o">+</span><span class="n">dayfolder</span><span class="o">+</span><span class="s">&#39;---&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.EX&#39;</span><span class="p">):</span>
                        <span class="n">exfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">,</span>
                                                <span class="n">filename</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                        <span class="n">exlines</span><span class="o">=</span><span class="n">exfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">exlines</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="c">#os.remove(os.path.join(dirpath,folder,dayfolder,filename))</span>
                            <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">delemptyfile</span><span class="p">)</span>                        
                        
                        <span class="k">elif</span> <span class="n">exlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">exfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">aconvstr</span><span class="p">)</span>
                        
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">exconv</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">exlines</span><span class="p">,</span><span class="n">infodict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">],</span>
                                                    <span class="n">infodict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">],</span>
                                                    <span class="n">infodict</span><span class="p">[</span><span class="s">&#39;ex&#39;</span><span class="p">])</span>
                            <span class="n">exfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="n">exconvlst</span><span class="o">=</span><span class="p">[</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">exconv</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exconv</span><span class="p">))]</span>
                            <span class="n">exfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">,</span>
                                                     <span class="n">filename</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                            <span class="n">exfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">exconvlst</span><span class="p">)</span>
                            <span class="n">exfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.EY&#39;</span><span class="p">):</span>
                        <span class="n">eyfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">,</span>
                                                <span class="n">filename</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                        <span class="n">eylines</span><span class="o">=</span><span class="n">eyfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eylines</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
<span class="c">#                            os.remove(os.path.join(dirpath,folder,dayfolder,</span>
<span class="c">#                                                   filename))</span>
                            <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">delemptyfile</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">eylines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">eyfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="c">#clines.append(filename+aconvstr)</span>
                        
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">eyconv</span><span class="o">=</span><span class="n">convertE</span><span class="p">(</span><span class="n">eylines</span><span class="p">,</span><span class="n">infodict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">],</span>
                                                    <span class="n">infodict</span><span class="p">[</span><span class="s">&#39;egain&#39;</span><span class="p">],</span>
                                                    <span class="n">infodict</span><span class="p">[</span><span class="s">&#39;ey&#39;</span><span class="p">])</span>
                            <span class="n">eyfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="n">eyconvlst</span><span class="o">=</span><span class="p">[</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">eyconv</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eyconv</span><span class="p">))]</span>
                            <span class="n">eyfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">,</span>
                                                     <span class="n">filename</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                            <span class="n">eyfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">eyconvlst</span><span class="p">)</span>
                            <span class="n">eyfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Found Folder: &#39;</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">infodict</span><span class="p">[</span><span class="s">&#39;magtype&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;lp&#39;</span><span class="p">:</span>
                <span class="n">magoristr</span><span class="o">=</span><span class="n">infodict</span><span class="p">[</span><span class="s">&#39;magori&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="n">magorilst</span><span class="o">=</span><span class="n">magoristr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">magorilst</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                            <span class="n">bxfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">,</span>
                                                    <span class="n">filename</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                            <span class="n">bxlines</span><span class="o">=</span><span class="n">bxfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bxlines</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
<span class="c">#                                os.remove(os.path.join(dirpath,folder,dayfolder,</span>
<span class="c">#                                                       filename))</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">delemptyfile</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">bxlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">bxfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">aconvstr</span><span class="p">)</span>                                
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">bxconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bxlines</span><span class="p">,</span><span class="n">infodict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">])</span>
                                <span class="n">bxfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">bxconvlst</span><span class="o">=</span><span class="p">[</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">bxconv</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bxconv</span><span class="p">))]</span>
                                <span class="n">bxfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span>
                                                         <span class="n">dayfolder</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                                <span class="n">bxfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">bxconvlst</span><span class="p">)</span>
                                <span class="n">bxfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39; as BX&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">magorilst</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="n">byfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">,</span>
                                                    <span class="n">filename</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                            <span class="n">bylines</span><span class="o">=</span><span class="n">byfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                            
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bylines</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
<span class="c">#                                os.remove(os.path.join(dirpath,folder,dayfolder,</span>
<span class="c">#                                                       filename))</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">delemptyfile</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">bylines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">byfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">aconvstr</span><span class="p">)</span>
                            
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">byconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bylines</span><span class="p">,</span>
                                                          <span class="n">infodict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">])</span>
                                <span class="n">byfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">byconvlst</span><span class="o">=</span><span class="p">[</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">byconv</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">byconv</span><span class="p">))]</span>
                                <span class="n">byfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span>
                                                         <span class="n">dayfolder</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                                <span class="n">byfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">byconvlst</span><span class="p">)</span>
                                <span class="n">byfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39; as BY&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatch</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;*.&#39;</span><span class="o">+</span><span class="n">magorilst</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                            <span class="n">bzfid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span><span class="n">dayfolder</span><span class="p">,</span>
                                                    <span class="n">filename</span><span class="p">),</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                            <span class="n">bzlines</span><span class="o">=</span><span class="n">bzfid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                            
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bzlines</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
<span class="c">#                                os.remove(os.path.join(dirpath,folder,dayfolder,</span>
<span class="c">#                                                       filename))</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">delemptyfile</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">bzlines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">bzfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="n">aconvstr</span><span class="p">)</span>
                            
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">bzconv</span><span class="o">=</span><span class="n">convertlpB</span><span class="p">(</span><span class="n">bzlines</span><span class="p">,</span>
                                                          <span class="n">infodict</span><span class="p">[</span><span class="s">&#39;dlgain&#39;</span><span class="p">],</span>
                                                          <span class="n">zadj</span><span class="o">=</span><span class="n">infodict</span><span class="p">[</span><span class="s">&#39;lpbzcor&#39;</span><span class="p">])</span>
                                <span class="n">bzfid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">bzconvlst</span><span class="o">=</span><span class="p">[</span><span class="n">fmt</span> <span class="o">%</span> <span class="n">bzconv</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bzconv</span><span class="p">))]</span>
                                <span class="n">bzfidn</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span>
                                                         <span class="n">dayfolder</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                                <span class="n">bzfidn</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">bzconvlst</span><span class="p">)</span>
                                <span class="n">bzfidn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39; as BZ&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">clines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Found Folder: &#39;</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clines</span>
</div>
<div class="viewcode-block" id="removeStaticShift"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.removeStaticShift">[docs]</a><span class="k">def</span> <span class="nf">removeStaticShift</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="n">stol</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">dm</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    removeStaticShift(edifile,stol=.2,dm=1000) will remove static shift by </span>
<span class="sd">    calculating the median of respones of near by stations, within dm.  If the </span>
<span class="sd">    ratio of the station response to the median on either side of 1+-stol then </span>
<span class="sd">    the impedance tensor for that electric component will be corrected for </span>
<span class="sd">    static shift.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">        edifile = full path to edi file. Note nearby stations will be looked </span>
<span class="sd">                  for in the dirname of edifile.  So have all edis in one folder</span>
<span class="sd">        stol = ratio tolerance.  If there is no static shift the ratio between</span>
<span class="sd">               the response and the median response should be 1, but noise and </span>
<span class="sd">               other factors can be present so a tolerance arount 1 is assumed.</span>
<span class="sd">        dm = nearby station radius in meters.  If there is no station within </span>
<span class="sd">             that radius then no static shift will be corrected for.</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        newedifile = full path to new edifile</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">MTpy.utils.LatLongUTMconversion</span> <span class="kn">as</span> <span class="nn">utm2ll</span>

    <span class="c">#get directory name where all edi files should be</span>
    <span class="n">edipath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
    
    <span class="c">#make a list of filename from edipath</span>
    <span class="n">edifilelst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">dedifile</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">dedifile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">dedifile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">!=-</span><span class="mi">1</span><span class="p">]</span>    
                
    <span class="c">#read in the edifile into a dictionary</span>
    <span class="n">edidict</span><span class="o">=</span><span class="n">readedi</span><span class="p">(</span><span class="n">edifile</span><span class="p">)</span>
    
    <span class="c">#compute resistivity of edifile</span>
    <span class="n">res</span><span class="p">,</span><span class="n">phase</span><span class="o">=</span><span class="n">imp2resphase</span><span class="p">(</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">])</span>
    
    <span class="c">#loop over files to find nearby stations</span>
    <span class="n">reslst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">statlst</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">zone</span><span class="p">,</span><span class="n">northing</span><span class="p">,</span><span class="n">easting</span><span class="o">=</span><span class="n">utm2ll</span><span class="o">.</span><span class="n">LLtoUTM</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">],</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;lon&#39;</span><span class="p">])</span>   
    <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">kedi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edifilelst</span><span class="p">):</span>
        <span class="n">kedidict</span><span class="o">=</span><span class="n">readedi</span><span class="p">(</span><span class="n">kedi</span><span class="p">)</span>
        <span class="n">zone</span><span class="p">,</span><span class="n">dn</span><span class="p">,</span><span class="n">de</span><span class="o">=</span><span class="n">utm2ll</span><span class="o">.</span><span class="n">LLtoUTM</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="n">kedidict</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">],</span><span class="n">kedidict</span><span class="p">[</span><span class="s">&#39;lon&#39;</span><span class="p">])</span>        
        <span class="n">deltad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dn</span><span class="o">-</span><span class="n">northing</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">de</span><span class="o">-</span><span class="n">easting</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deltad</span><span class="o">&lt;=</span><span class="n">dm</span><span class="p">:</span>
            <span class="n">kres</span><span class="p">,</span><span class="n">kphase</span><span class="o">=</span><span class="n">imp2resphase</span><span class="p">(</span><span class="n">kedidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span><span class="n">kedidict</span><span class="p">[</span><span class="s">&#39;frequency&#39;</span><span class="p">])</span>
            <span class="n">reslst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kres</span><span class="p">)</span>
            <span class="n">statlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
            
    <span class="c">#make resistivity list an array for easy manipulating</span>
    <span class="n">reslst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reslst</span><span class="p">)</span>
    
    <span class="c">#calculate static shift of x-components</span>
    <span class="n">staticx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">reslst</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="c">#see if it is within the tolerance level    </span>
    <span class="k">if</span> <span class="n">staticx</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">-</span><span class="n">stol</span> <span class="ow">or</span> <span class="n">staticx</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">+</span><span class="n">stol</span><span class="p">:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticx</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;X-Shifted &#39;</span><span class="o">+</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; by &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticx</span><span class="p">))</span>
        <span class="n">xyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
    
    <span class="c">#calculate static shift of y-components</span>
    <span class="n">staticy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">reslst</span><span class="p">[:,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="c">#see if it is within the tolerance level</span>
    <span class="k">if</span> <span class="n">staticy</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">-</span><span class="n">stol</span> <span class="ow">or</span> <span class="n">staticy</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">+</span><span class="n">stol</span><span class="p">:</span>
        <span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticy</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Y-Shifted &#39;</span><span class="o">+</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; by &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticy</span><span class="p">))</span> 
        <span class="n">yyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
    <span class="k">else</span><span class="p">:</span><span class="n">yyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
    
    <span class="c">#if there was a correction write a new edi file</span>
    <span class="k">if</span> <span class="n">xyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span> <span class="ow">or</span> <span class="n">yyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
        <span class="n">nedi</span><span class="o">=</span><span class="n">rewriteedi</span><span class="p">(</span><span class="n">edifile</span><span class="p">,</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;zvar&#39;</span><span class="p">])</span>
        <span class="n">savepath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="s">&#39;SS&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
        <span class="n">newedifile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">nedi</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;s.edi&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">nedi</span><span class="p">,</span><span class="n">newedifile</span><span class="p">)</span>
        
        <span class="k">print</span> <span class="s">&#39;Wrote: &#39;</span><span class="p">,</span><span class="n">newedifile</span>
        <span class="k">return</span> <span class="n">newedifile</span>
        
    <span class="c">#if no correction was made return the same edifile</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;No Static Shift Correction for &#39;</span><span class="p">,</span><span class="n">edidict</span><span class="p">[</span><span class="s">&#39;station&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">edifile</span>
        </div>
<div class="viewcode-block" id="makeDayFoldersFromObservatoryData"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.makeDayFoldersFromObservatoryData">[docs]</a><span class="k">def</span> <span class="nf">makeDayFoldersFromObservatoryData</span><span class="p">(</span><span class="n">obsdirpath</span><span class="p">,</span><span class="n">savepath</span><span class="p">,</span><span class="n">startday</span><span class="o">=</span><span class="s">&#39;000&#39;</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                      <span class="n">ndays</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">complst</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;BX&#39;</span><span class="p">,</span><span class="s">&#39;BY&#39;</span><span class="p">],</span>
                                      <span class="n">station</span><span class="o">=</span><span class="s">&#39;CNB&#39;</span><span class="p">,</span><span class="n">rowskip</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makeDayFoldersFromObservatoryData will take observatory data and put it</span>
<span class="sd">    into day folders for processing.</span>
<span class="sd">    </span>
<span class="sd">    Input:</span>
<span class="sd">        obsdirpath = path to observatory data.  If the observatory data comes</span>
<span class="sd">                     in one long file input the file, program know&#39;s its a file</span>
<span class="sd">                     by searching for the dot.</span>
<span class="sd">        savepath = path to save the day files, should be in the same directory</span>
<span class="sd">                   as collected data. ie datapath/observatory_station_name</span>
<span class="sd">        startday = UTC start day as a string of length 3</span>
<span class="sd">        d = decimation factor of collected data sampling frequency to get to </span>
<span class="sd">            observatory sampling frequency.  So if you sampled at 1000 Hz and </span>
<span class="sd">            the observatory data is at 1 sec, d=1000</span>
<span class="sd">        ndays = number of days, only used if observatory data is in one big file</span>
<span class="sd">        df = sampling frequency of observatory data in Hz</span>
<span class="sd">        complst = components to make into files, can add &#39;BZ&#39; if you like</span>
<span class="sd">        station = station name of observatory data</span>
<span class="sd">        rowskip = number of rows to skip from observatory file, usually the </span>
<span class="sd">                  header ends at row 6.</span>
<span class="sd">    </span>
<span class="sd">    Outputs:</span>
<span class="sd">        files will be saved to savepath/day/Comb00to24ddf/station00to24ddf.cnb</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#make save directory if it doesn&#39;t exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
    
    <span class="c">#start day</span>
    <span class="n">sday</span><span class="o">=</span><span class="n">startday</span>
    
    <span class="c">#number of points per day</span>
    <span class="n">dl</span><span class="o">=</span><span class="mi">86400</span><span class="o">*</span><span class="n">df</span>
    
    <span class="c">#folder to save each day to</span>
    <span class="n">folder</span><span class="o">=</span><span class="s">&#39;Comb00to24d&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">obsdirpath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">complst</span><span class="p">:</span>
            <span class="n">bx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obsdirpath</span><span class="p">,</span><span class="n">station</span><span class="o">+</span><span class="n">comp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;.txt&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndays</span><span class="p">):</span>
                <span class="n">lbx</span><span class="o">=</span><span class="n">bx</span><span class="p">[</span><span class="n">dd</span><span class="o">*</span><span class="n">dl</span><span class="p">:(</span><span class="n">dd</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dl</span><span class="p">]</span>
                <span class="n">day</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">sday</span><span class="o">+</span><span class="n">dd</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">)):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">folder</span><span class="p">)):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">folder</span><span class="p">))</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span>
                                        <span class="n">station</span><span class="o">+</span><span class="s">&#39;00to24d10.&#39;</span><span class="o">+</span><span class="n">comp</span><span class="p">),</span>
                                        <span class="n">lbx</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">filename</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">obsdirpath</span><span class="p">)):</span>
            <span class="c">#get day string            </span>
            <span class="n">dayi</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sday</span><span class="p">)</span><span class="o">+</span><span class="n">ii</span>
            <span class="k">if</span> <span class="n">dayi</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">day</span><span class="o">=</span><span class="s">&#39;00&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dayi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dayi</span><span class="o">&lt;</span><span class="mi">100</span> <span class="ow">and</span> <span class="n">dayi</span><span class="o">&gt;=</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">day</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dayi</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">day</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">dayi</span><span class="p">)</span>            
            
            <span class="c">#make folder</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">))</span>

            <span class="c">#make comb folder</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">folder</span><span class="p">)):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">folder</span><span class="p">))</span>
            <span class="c">#load file </span>
            <span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">,</span><span class="n">bz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obsdirpath</span><span class="p">,</span><span class="n">filename</span><span class="p">),</span>
                                <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="n">rowskip</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bx</span><span class="p">)</span><span class="o">!=</span><span class="n">dl</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;File length is not a full day, check time column in&#39;</span><span class="o">+</span>\
                                <span class="s">&#39;original file &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">pathjoin</span><span class="p">(</span><span class="n">obsdirpath</span><span class="p">,</span><span class="n">filename</span><span class="p">))</span>
            <span class="c">#savefiles</span>
            <span class="n">savefnpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">folder</span><span class="p">,</span>
                                    <span class="n">station</span><span class="o">+</span><span class="s">&#39;00to24d&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">bn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">,</span><span class="n">bz</span><span class="p">]):</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">savefnpath</span><span class="o">+</span><span class="n">complst</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">bn</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.7g</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Saved file: &#39;</span><span class="p">,</span><span class="n">savefnpath</span><span class="o">+</span><span class="n">complst</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                                </div>
<div class="viewcode-block" id="makeKML"><a class="viewcode-back" href="../../../core.MTtools.html#MTpy.core.MTtools.makeKML">[docs]</a><span class="k">def</span> <span class="nf">makeKML</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">stationid</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fs</span><span class="o">=.</span><span class="mi">9</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    makeKML will make a kml file for Google Earth to plot station locations </span>
<span class="sd">    relatively quickly</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="c">#create a list of edifiles to pull station info from</span>
    <span class="n">edilst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">edi</span><span class="p">)</span> <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">edi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.edi&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c">#make a data type kml        </span>
    <span class="n">kmlfid</span><span class="o">=</span><span class="n">skml</span><span class="o">.</span><span class="n">Kml</span><span class="p">()</span>
    
    <span class="c">#create the style marker</span>
    <span class="k">if</span> <span class="n">style</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">style</span><span class="o">=</span><span class="n">skml</span><span class="o">.</span><span class="n">Style</span><span class="p">()</span>
        <span class="n">style</span><span class="o">.</span><span class="n">labelstyle</span><span class="o">.</span><span class="n">scale</span><span class="o">=</span><span class="n">fs</span>
        <span class="c">#plots a small cicle with a dot in the middle</span>
        <span class="n">style</span><span class="o">.</span><span class="n">iconstyle</span><span class="o">.</span><span class="n">icon</span><span class="o">.</span><span class="n">href</span><span class="o">=</span><span class="s">r&#39;http://maps.google.com/mapfiles/kml/pal4/icon57.png&#39;</span>
    
    <span class="c">#pull information from edi files</span>
    <span class="k">for</span> <span class="n">edi</span> <span class="ow">in</span> <span class="n">edilst</span><span class="p">:</span>
        <span class="n">z1</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">edi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stationid</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">pnt</span><span class="o">=</span><span class="n">kmlfid</span><span class="o">.</span><span class="n">newpoint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">station</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="p">[(</span><span class="n">z1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">lat</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pnt</span><span class="o">=</span><span class="n">kmlfid</span><span class="o">.</span><span class="n">newpoint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">station</span><span class="p">[</span><span class="n">stationid</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">stationid</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="n">coords</span><span class="o">=</span><span class="p">[(</span><span class="n">z1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span><span class="n">z1</span><span class="o">.</span><span class="n">lat</span><span class="p">)])</span>
        <span class="n">pnt</span><span class="o">.</span><span class="n">style</span><span class="o">=</span><span class="n">style</span>
    
    <span class="c">#make a path to save the kml file to    </span>
    <span class="k">if</span> <span class="n">savepath</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
        <span class="n">svpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="s">&#39;StationLocations.kml&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">svpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="s">&#39;StationLocations.kml&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">svpath</span><span class="o">=</span><span class="n">savepath</span>
        
    <span class="c">#save the kml file</span>
    <span class="n">kmlfid</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">svpath</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Saved .kml file to: &#39;</span><span class="o">+</span><span class="n">svpath</span>
    
    <span class="k">return</span> <span class="n">svpath</span>
        
        </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jared Peacock, Lars Krieger, Stephan Thiel, Kent Inverarity.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>