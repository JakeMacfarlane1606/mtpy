

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MTpy.core.Z &mdash; MTpy 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MTpy 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for MTpy.core.Z</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Mon May 03 13:44:51 2010</span>

<span class="sd">@author: a1185872</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">pylab</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span><span class="n">FormatStrFormatter</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span><span class="p">,</span><span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">matplotlib.colorbar</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">MTpy.utils.LatLongUTMconversion</span> <span class="kn">as</span> <span class="nn">utm2ll</span>

<span class="c">#make a custom colormap to use for plotting</span>
<span class="n">ptcmapdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;red&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)),</span>
            <span class="s">&#39;green&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)),</span>
            <span class="s">&#39;blue&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">))}</span>
<span class="n">ptcmap</span><span class="o">=</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s">&#39;ptcmap&#39;</span><span class="p">,</span><span class="n">ptcmapdict</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>

<span class="c">#resistivity tensor map for calcluating apparent resistivity</span>
<span class="n">rtcmapdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;red&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;green&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)),</span>
            <span class="s">&#39;blue&#39;</span><span class="p">:((</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))}</span>
<span class="n">rtcmap</span><span class="o">=</span><span class="n">LinearSegmentedColormap</span><span class="p">(</span><span class="s">&#39;rtcmap&#39;</span><span class="p">,</span><span class="n">rtcmapdict</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>

<span class="c">#spacing for text files</span>
<span class="n">tsp</span><span class="o">=</span><span class="s">&#39;   &#39;</span>

<div class="viewcode-block" id="Edi"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Edi">[docs]</a><span class="k">class</span> <span class="nc">Edi</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a data type for edi files.  Included are </span>
<span class="sd">    self.edifn=edifilename</span>
<span class="sd">        Edi.header = header information about the survey area (dictionary)</span>
<span class="sd">        Edi.info = information about data processing (dictionary)</span>
<span class="sd">        Edi.measurement = information about measurement setup (dictionary)</span>
<span class="sd">        Edi.lat = latitude in decimal degrees</span>
<span class="sd">        Edi.lon = longitude in decimal degrees</span>
<span class="sd">        Edi.elevation = elevation in meters</span>
<span class="sd">        Edi.frequency = array of frequencies for estimated transfer functions</span>
<span class="sd">        Edi.z = array (nf,2,2) of impedance components (nf=# of frequencies)</span>
<span class="sd">        Edi.zvar = array (nf,2,2) of variance estimation of Z</span>
<span class="sd">        Edi.zrot = array (nf) of rotation angles used</span>
<span class="sd">        Edi.tipper = array (nf,2) of tipper components</span>
<span class="sd">        Edi.tippervar = array (nf,2) of variance estimation of tipper</span>
<span class="sd">        Edi.trot = array (nf) of rotation angles used</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Edi.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Edi.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edifilename</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="o">=</span><span class="n">edifilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zrot</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span>
</div>
<div class="viewcode-block" id="Edi.getInfo"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Edi.getInfo">[docs]</a>    <span class="k">def</span> <span class="nf">getInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ncol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ncol</span>
        <span class="c">#open up file</span>
        <span class="n">edifid</span><span class="o">=</span><span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="c">#read all the lines from that file</span>
        <span class="n">edilines</span><span class="o">=</span><span class="n">edifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        
        <span class="c">#---Read in the information about the measurement---------</span>
        <span class="n">gdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;head&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">,</span>
               <span class="s">&#39;info&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
               <span class="s">&#39;definemeas&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="p">,</span>
               <span class="s">&#39;mtsect&#39;</span><span class="p">:{</span><span class="s">&#39;text&#39;</span><span class="p">:[]},</span>
               <span class="s">&#39;emapsect&#39;</span><span class="p">:{</span><span class="s">&#39;text&#39;</span><span class="p">:[]},</span>
               <span class="s">&#39;comp&#39;</span><span class="p">:{}}</span>
        
        <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>               
        <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;SPECTRA&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>        
                <span class="n">ii</span><span class="o">=</span><span class="bp">None</span>
                <span class="n">specimp</span><span class="o">=</span><span class="s">&#39;spectra&#39;</span>
            <span class="k">elif</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;IMPEDANCE&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>        
                <span class="n">ii</span><span class="o">=</span><span class="bp">None</span>
                <span class="n">specimp</span><span class="o">=</span><span class="s">&#39;impedance&#39;</span>
            <span class="k">elif</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;FREQUENCIES&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>        
                <span class="n">ii</span><span class="o">=</span><span class="bp">None</span>
                <span class="n">specimp</span><span class="o">=</span><span class="s">&#39;frequency&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#get the block header</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c">#For definemeas</span>
                    <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;ACQCHAN&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;INFO&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">gkey</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">gkey</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="c">#for a comment block</span>
                    <span class="k">elif</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="c">#for the measurement channels</span>
                    <span class="k">elif</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;ACQCHAN&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">gkey</span><span class="o">=</span><span class="s">&#39;comp&#39;</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">mid</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">mtype</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">gdict</span><span class="p">[</span><span class="s">&#39;comp&#39;</span><span class="p">][</span><span class="n">mid</span><span class="p">]</span><span class="o">=</span><span class="n">mtype</span>
                    <span class="c">#for the normal block header</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gkey</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="c">#for each block header put the information into a dictionary</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c">#for a line with that can be separated by an =</span>
                    <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;CHTYPE&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">and</span> \
                        <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;mV&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">gdict</span><span class="p">[</span><span class="n">gkey</span><span class="p">][</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="c">#all other lines</span>
                    <span class="k">elif</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">gdict</span><span class="p">[</span><span class="n">gkey</span><span class="p">][</span><span class="s">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#get latitude from the header</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">latstr</span><span class="o">=</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;head&#39;</span><span class="p">][</span><span class="s">&#39;LAT&#39;</span><span class="p">]</span>
            
        <span class="c">#if it isn&#39;t in the header it should be in the definemeas</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">latstr</span><span class="o">=</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;definemeas&#39;</span><span class="p">][</span><span class="s">&#39;REFLAT&#39;</span><span class="p">]</span>
            <span class="c">#if it isn&#39;t there then need to find it else where</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Did not find Latitude&#39;</span>
                
        <span class="c">#change from hh:mm:ss to decimal deg</span>
        <span class="k">if</span> <span class="n">latstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">latlst</span><span class="o">=</span><span class="n">latstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">latstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">latlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">latstr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">latstr</span><span class="p">)</span>
        
        <span class="c">#get longitude from header</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lonstr</span><span class="o">=</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;head&#39;</span><span class="p">][</span><span class="s">&#39;LONG&#39;</span><span class="p">]</span>
            
        <span class="c">#if it isn&#39;t in the header it should be in the definemeas</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lonstr</span><span class="o">=</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;definemeas&#39;</span><span class="p">][</span><span class="s">&#39;REFLONG&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Did not find Longitude&#39;</span>
                
        <span class="c">#change from hh:mm:ss to decimal deg</span>
        <span class="k">if</span> <span class="n">lonstr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">lonlst</span><span class="o">=</span><span class="n">lonstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">lonstr</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">60</span>
                <span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">lonlst</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">3600</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lonstr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lonstr</span><span class="p">)</span>
        
        
        <span class="c">#++++++++++++Get impedences and frequencies+++++++++++++++++++</span>
        
        <span class="c">#=========Get impedance from spectra=============================</span>
        <span class="k">if</span> <span class="n">specimp</span><span class="o">==</span><span class="s">&#39;spectra&#39;</span><span class="p">:</span>
            <span class="c">#make a dictionary with a list to put the component order into</span>
            <span class="n">gdict</span><span class="p">[</span><span class="s">&#39;spectraset&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;comporder&#39;</span><span class="p">:{}}</span>
            <span class="c">#counter</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">cc</span><span class="o">=</span><span class="mi">0</span>
            <span class="c">#get header information about how the spectra is stored</span>
            <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="c">#stop at the first spectra block</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;SPECTRA&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>
                    <span class="n">ii</span><span class="o">=</span><span class="bp">None</span>
                <span class="c">#get the spectraset information</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gkey</span><span class="o">=</span><span class="s">&#39;spectraset&#39;</span>
                    <span class="c">#general information</span>
                    <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">gdict</span><span class="p">[</span><span class="n">gkey</span><span class="p">][</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="c">#get component order</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">estr</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">gdict</span><span class="p">[</span><span class="n">gkey</span><span class="p">][</span><span class="s">&#39;comporder&#39;</span><span class="p">][</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;comp&#39;</span><span class="p">][</span><span class="n">estr</span><span class="p">]]</span>
                                <span class="n">gdict</span><span class="p">[</span><span class="n">gkey</span><span class="p">][</span><span class="s">&#39;comporder&#39;</span><span class="p">][</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;comp&#39;</span><span class="p">][</span><span class="n">estr</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;R&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cc</span>
                            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                                <span class="n">gdict</span><span class="p">[</span><span class="n">gkey</span><span class="p">][</span><span class="s">&#39;comporder&#39;</span><span class="p">][</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;comp&#39;</span><span class="p">][</span><span class="n">estr</span><span class="p">]]</span><span class="o">=</span><span class="n">cc</span>
                                
                            <span class="n">cc</span><span class="o">+=</span><span class="mi">1</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
            <span class="c">#defind values of number of frequencies and number of channels</span>
            <span class="n">nf</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;spectraset&#39;</span><span class="p">][</span><span class="s">&#39;NFREQ&#39;</span><span class="p">])</span>
            <span class="n">nc</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;spectraset&#39;</span><span class="p">][</span><span class="s">&#39;NCHAN&#39;</span><span class="p">])</span>
        
            <span class="c">#set some empty arrays to put stuff into    </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            <span class="n">bw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            <span class="n">avgt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zrot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
                <span class="c">#get information from the spectra line block</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;SPECTRA&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">eline</span><span class="p">:</span>
                        <span class="n">estr</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">estr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;FREQ&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">estr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;ROTSPEC&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">zrot</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">estr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;BW&#39;</span><span class="p">:</span>
                            <span class="n">bw</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="n">estr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;AVGT&#39;</span><span class="p">:</span>
                            <span class="n">avgt</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="c">#make and empty array to put spectra into for easy calculation</span>
                    <span class="n">spectra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nc</span><span class="p">,</span><span class="n">nc</span><span class="p">))</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>
                <span class="c">#stop once all the spectra have been read</span>
                <span class="k">elif</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;SPECTRA&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">kk</span><span class="o">=</span><span class="bp">None</span>
                <span class="c">#put the spectra values into the pre-defined array</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">jj</span><span class="o">+=</span><span class="mi">1</span>
                        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                            <span class="n">spectra</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span><span class="n">nn</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">eline</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span>
                    <span class="c">#get spectra in a useable order such that all values are complex </span>
                    <span class="c">#in the upper right hand triangle</span>
                    <span class="n">spect</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nc</span><span class="p">,</span><span class="n">nc</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="n">nc</span><span class="p">):</span>
                            <span class="n">spect</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span><span class="n">nn</span><span class="p">]</span><span class="o">=</span><span class="n">spectra</span><span class="p">[</span><span class="n">nn</span><span class="p">,</span><span class="n">ll</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">spectra</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span><span class="n">nn</span><span class="p">]</span>
                            
                    
                    <span class="c">#calculate the impedance from the spectra</span>
                    <span class="n">cdict</span><span class="o">=</span><span class="n">gdict</span><span class="p">[</span><span class="s">&#39;spectraset&#39;</span><span class="p">][</span><span class="s">&#39;comporder&#39;</span><span class="p">]</span>
                    <span class="n">bx</span><span class="o">=</span><span class="n">cdict</span><span class="p">[</span><span class="s">&#39;HX&#39;</span><span class="p">]</span>            
                    <span class="n">by</span><span class="o">=</span><span class="n">cdict</span><span class="p">[</span><span class="s">&#39;HY&#39;</span><span class="p">]</span>
                    <span class="n">ex</span><span class="o">=</span><span class="n">cdict</span><span class="p">[</span><span class="s">&#39;EX&#39;</span><span class="p">]</span>            
                    <span class="n">ey</span><span class="o">=</span><span class="n">cdict</span><span class="p">[</span><span class="s">&#39;EY&#39;</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">bz</span><span class="o">=</span><span class="n">cdict</span><span class="p">[</span><span class="s">&#39;HZ&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;No HZ&#39;</span>
                    <span class="k">try</span><span class="p">:</span> 
                        <span class="n">bxr</span><span class="o">=</span><span class="n">cdict</span><span class="p">[</span><span class="s">&#39;HXR&#39;</span><span class="p">]</span>            
                        <span class="n">byr</span><span class="o">=</span><span class="n">cdict</span><span class="p">[</span><span class="s">&#39;HYR&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;No remote reference&#39;</span>
                        
                    <span class="c">#get impedance from the spectra</span>
                    <span class="n">zdet</span><span class="o">=</span><span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">bxr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">byr</span><span class="p">])</span><span class="o">-</span>\
                            <span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">byr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">bxr</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">spect</span><span class="p">[</span><span class="n">ex</span><span class="p">,</span><span class="n">bxr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">byr</span><span class="p">])</span><span class="o">-</span>
                                <span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">ex</span><span class="p">,</span><span class="n">byr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">bxr</span><span class="p">]))</span><span class="o">/</span><span class="n">zdet</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">spect</span><span class="p">[</span><span class="n">ex</span><span class="p">,</span><span class="n">byr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">bxr</span><span class="p">])</span><span class="o">-</span>
                                <span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">ex</span><span class="p">,</span><span class="n">bxr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">byr</span><span class="p">]))</span><span class="o">/</span><span class="n">zdet</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">spect</span><span class="p">[</span><span class="n">ey</span><span class="p">,</span><span class="n">bxr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">byr</span><span class="p">])</span><span class="o">-</span>
                                <span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">ey</span><span class="p">,</span><span class="n">byr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">bxr</span><span class="p">]))</span><span class="o">/</span><span class="n">zdet</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">spect</span><span class="p">[</span><span class="n">ey</span><span class="p">,</span><span class="n">byr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">bxr</span><span class="p">])</span><span class="o">-</span>
                                <span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">ey</span><span class="p">,</span><span class="n">bxr</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">byr</span><span class="p">]))</span><span class="o">/</span><span class="n">zdet</span>
                                
                    <span class="c">#get tipper from the spectra</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">bz</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">by</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span>
                                    <span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">bz</span><span class="p">]</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">]))</span><span class="o">/</span><span class="n">zdet</span>
                    
                    <span class="c">#need to put in conjugate because of coordinate system</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">spect</span><span class="p">[</span><span class="n">by</span><span class="p">,</span><span class="n">bz</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">bx</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">-</span>
                                    <span class="p">(</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">bz</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">*</span><span class="n">spect</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span><span class="n">by</span><span class="p">]))</span><span class="o">/</span><span class="n">zdet</span>
        
        <span class="c">#========Get impedance ====================================                            </span>
        <span class="k">elif</span> <span class="n">specimp</span><span class="o">==</span><span class="s">&#39;frequency&#39;</span><span class="p">:</span>
            <span class="c">#get number of frequencies</span>
            <span class="n">nf</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">edilines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="c">#initialize some arrays    </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            
            <span class="c">#get frequencies</span>
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span>
            <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="c">#if past the impedance information end loop</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;FREQ&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">kk</span><span class="o">=</span><span class="bp">None</span>
                    <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>
                    <span class="n">specimp</span><span class="o">=</span><span class="s">&#39;impedance&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                    
            <span class="c">#------Get Impedance information-----------------</span>
            <span class="n">zdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;ZXX&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),(</span><span class="s">&#39;ZXY&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),(</span><span class="s">&#39;ZYX&#39;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),(</span><span class="s">&#39;ZYY&#39;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))])</span>
            
            <span class="c">#initialize some arrays</span>
            <span class="n">nf</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">edilines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zrot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        
            
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;IMP&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">kk</span><span class="o">=</span><span class="bp">None</span>
                            <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">zkey</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">zcomp</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
                        <span class="k">if</span> <span class="n">zkey</span><span class="o">!=</span><span class="s">&#39;ZRO&#39;</span> <span class="ow">and</span> <span class="n">zkey</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">z0</span><span class="o">=</span><span class="n">zdict</span><span class="p">[</span><span class="n">zkey</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">z1</span><span class="o">=</span><span class="n">zdict</span><span class="p">[</span><span class="n">zkey</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                            
                        <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
                        <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">zkey</span><span class="o">==</span><span class="s">&#39;ZRO&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">zrot</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">zcomp</span><span class="o">==</span><span class="s">&#39;R&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">zcomp</span><span class="o">==</span><span class="s">&#39;I&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">+</span>\
                                                            <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">zcomp</span><span class="o">==</span><span class="s">&#39;.VAR&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                    
            <span class="c">#-----Get Tipper Information-----------</span>
            <span class="n">tdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;TX&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">&#39;TY&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
            
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">kk</span><span class="o">=</span><span class="bp">None</span>
                            <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">tkey</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">tcomp</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
                        <span class="k">if</span> <span class="n">tkey</span><span class="o">!=</span><span class="s">&#39;TR&#39;</span> <span class="ow">and</span> <span class="n">tkey</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">z0</span><span class="o">=</span><span class="n">tdict</span><span class="p">[</span><span class="n">tkey</span><span class="p">]</span>
                            
                        <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
                        <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">tkey</span><span class="o">==</span><span class="s">&#39;TR&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">trot</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;R&#39;</span> <span class="ow">or</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;R.EXP&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="n">ncol</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;I.EXP&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="n">ncol</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">+</span>\
                                                              <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;VAR.EXP&#39;</span> <span class="ow">or</span> <span class="s">&#39;.VAR&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="c">#=========get impedance components=================================</span>
        <span class="k">elif</span> <span class="n">specimp</span><span class="o">==</span><span class="s">&#39;impedance&#39;</span><span class="p">:</span>
            <span class="c">#defind a dictionary to place components</span>
            <span class="n">zdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;ZXX&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)),(</span><span class="s">&#39;ZXY&#39;</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)),(</span><span class="s">&#39;ZYX&#39;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)),(</span><span class="s">&#39;ZYY&#39;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))])</span>
            
            <span class="c">#if nf is already defined    </span>
            <span class="k">if</span> <span class="n">nf</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nf</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">edilines</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;complex&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
                
            <span class="c">#------Get Impedance information-----------------</span>
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;IMP&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">kk</span><span class="o">=</span><span class="bp">None</span>
                            <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">zkey</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                        <span class="n">zcomp</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
                        <span class="k">if</span> <span class="n">zkey</span><span class="o">!=</span><span class="s">&#39;ZRO&#39;</span> <span class="ow">and</span> <span class="n">zkey</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">z0</span><span class="o">=</span><span class="n">zdict</span><span class="p">[</span><span class="n">zkey</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">z1</span><span class="o">=</span><span class="n">zdict</span><span class="p">[</span><span class="n">zkey</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                            
                        <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
                        <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">zkey</span><span class="o">==</span><span class="s">&#39;ZRO&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">zrot</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">zcomp</span><span class="o">==</span><span class="s">&#39;R&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">zcomp</span><span class="o">==</span><span class="s">&#39;I&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">zcomp</span><span class="o">==</span><span class="s">&#39;.VAR&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
                    
            <span class="c">#-----Get Tipper Information-----------</span>
            <span class="n">tdict</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="s">&#39;TX&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s">&#39;TY&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
            
            <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">ii</span><span class="o">=</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">eline</span><span class="o">=</span><span class="n">edilines</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">eline</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">kk</span><span class="o">=</span><span class="bp">None</span>
                            <span class="n">jj</span><span class="o">=</span><span class="n">ii</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">tkey</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">tcomp</span><span class="o">=</span><span class="n">eline</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
                        <span class="k">if</span> <span class="n">zkey</span><span class="o">!=</span><span class="s">&#39;TR&#39;</span> <span class="ow">and</span> <span class="n">zkey</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">z0</span><span class="o">=</span><span class="n">zdict</span><span class="p">[</span><span class="n">zkey</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            
                        <span class="n">kk</span><span class="o">=</span><span class="mi">0</span>
                        <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eline</span><span class="o">=</span><span class="n">eline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">tkey</span><span class="o">==</span><span class="s">&#39;TR&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">trot</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;R&#39;</span> <span class="ow">or</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;R.EXP&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;I.EXP&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">+</span>\
                                                                <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="k">elif</span> <span class="n">tcomp</span><span class="o">==</span><span class="s">&#39;VAR.EXP&#39;</span> <span class="ow">or</span> <span class="s">&#39;.VAR&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">nn</span><span class="p">,</span><span class="n">estr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eline</span><span class="p">):</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="p">[</span><span class="n">kk</span><span class="o">*</span><span class="p">(</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="n">kk</span><span class="p">,</span><span class="n">z0</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">estr</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                                <span class="k">pass</span>
                    <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">kk</span><span class="o">+=</span><span class="mi">1</span>
    </div>
<div class="viewcode-block" id="Edi.rewriteedi"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Edi.rewriteedi">[docs]</a>    <span class="k">def</span> <span class="nf">rewriteedi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">znew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">zvarnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">freqnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">newfile</span><span class="o">=</span><span class="s">&#39;y&#39;</span><span class="p">,</span>
               <span class="n">tipnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">tipvarnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="s">&#39;dr&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rewriteedi(edifile) will rewrite an edifile say if it needs to be rotated </span>
<span class="sd">        or distortion removed.</span>
<span class="sd">    </span>
<span class="sd">        Inputs:</span>
<span class="sd">            edifile = full path to edifile to be rewritten</span>
<span class="sd">            znew = impedance tensor if a new one has been created</span>
<span class="sd">            zvarnew = errors in impedance tensor if a new one has been created</span>
<span class="sd">            freqnew = new frequency list if one has been created</span>
<span class="sd">            newfile = &#39;y&#39; for yes or &#39;n&#39; for no if you want a new file to be</span>
<span class="sd">                     created.</span>
<span class="sd">            tipnew = new tipper array</span>
<span class="sd">            tipvarnew = new tipper error array</span>
<span class="sd">            thetar = rotation angle counter clockwise (N=0, E=-90)</span>
<span class="sd">            ext = extension on the end of the file name before .edi</span>
<span class="sd">        </span>
<span class="sd">        Outputs:</span>
<span class="sd">            nedi = dirpath(edifile)+basename(edifile)+rw or dr if dr=&#39;y&#39;</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="c">#get direcotry path make one if not there    </span>
        <span class="n">dirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newfile</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">drdirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Made directory: &#39;</span><span class="p">,</span><span class="n">drdirpath</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="c">#copy files into a common directory</span>
            <span class="n">drpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">while</span> <span class="n">count</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">drpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">drpath</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">drpath</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">folder</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;EDIfiles&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">edifolderyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
                        <span class="n">drcopypath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drpath</span><span class="p">,</span><span class="s">&#39;EDIfiles&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span>
                                                               <span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">())):</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
                                <span class="k">print</span> <span class="s">&#39;Made directory &#39;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span>
                                                                     <span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">edifolderyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
                        <span class="n">drcopypath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">)</span>
                <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            
            <span class="c">#get new file name</span>
            <span class="n">nedibn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;.edi&#39;</span>
            <span class="c">#open a new edifile</span>
            <span class="n">newedifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">,</span><span class="n">nedibn</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nedibn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;c.edi&#39;</span>
            <span class="n">newedifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">nedibn</span><span class="p">),</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">edifolderyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
        
        <span class="c">#if there is no znew then rotate the data</span>
        <span class="k">if</span> <span class="n">znew</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="c">#read in the data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
            <span class="c">#rotate data if desired</span>
            <span class="k">if</span> <span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">znew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
                <span class="n">zvarnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
                <span class="c">#convert thetar into radians</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span>
                <span class="c">#make rotation matrix</span>
                <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)],</span>
                             <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)]])</span>
                <span class="n">trotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">selt</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)])</span>
                <span class="c">#rotate the data</span>
                <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">znew</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zvarnew</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                            <span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tippernew</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">trotmatrix</span><span class="p">,</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                                   <span class="n">trotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tippervarnew</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">trotmatrix</span><span class="p">,</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                                       <span class="n">trotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="c">#otherwise read in the new Z</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">znew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zvarnew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tippernew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tippervarnew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">znew</span><span class="o">=</span><span class="n">znew</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zvarnew</span><span class="o">=</span><span class="n">zvarnew</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tippernew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tippervarnew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span>
        
        <span class="c">#open existing edi file</span>
        <span class="n">edifid</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="c">#read existing edi file and find where impedances start and number of freq</span>
        <span class="n">edilines</span><span class="o">=</span><span class="n">edifid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">spot</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;&gt;FREQ&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">spot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;IMPEDANCES&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">spot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;SPECTRA&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">spot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
        
        <span class="c">#write lines until the frequency list or spectra</span>
        <span class="k">for</span> <span class="n">ll</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilines</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">spot</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****FREQUENCIES****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="c">#write in frequencies</span>
        <span class="c">#if there is a new frequency list</span>
        <span class="k">if</span> <span class="n">freqnew</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="c">#get number of frequencies    </span>
            <span class="n">nfreq</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">freqnew</span><span class="p">)</span>
            
            <span class="c">#get order of frequencies        </span>
            <span class="k">if</span> <span class="n">freqnew</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">freqnew</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">order</span><span class="o">=</span><span class="s">&#39;INC&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">order</span><span class="o">=</span><span class="s">&#39;DEC&#39;</span>
            
            <span class="c">#write frequency header</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;FREQ&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ORDER=&#39;</span><span class="o">+</span><span class="n">order</span><span class="o">+</span>
                            <span class="n">tsp</span><span class="o">+</span><span class="s">&#39;// &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:.6g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freqnew</span><span class="p">[</span><span class="n">kk</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="c">#            newedifid.write(&#39;&gt;!****IMPEDANCES****!&#39;+&#39; Rotated {0:.0f} counterclockwise\n&#39;.format(thetar*180/np.pi))</span>
        <span class="c">#from the start of file to where impedances start write from existing edifile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#get order of frequencies        </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">order</span><span class="o">=</span><span class="s">&#39;INC&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">order</span><span class="o">=</span><span class="s">&#39;DEC&#39;</span>
                
            <span class="n">nfreq</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
            <span class="c">#write frequency header</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;FREQ&#39;</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;NFREQ=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;ORDER=&#39;</span><span class="o">+</span><span class="n">order</span><span class="o">+</span>
                            <span class="n">tsp</span><span class="o">+</span><span class="s">&#39;// &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:.6f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">kk</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****IMPEDANCES****!&#39;</span><span class="o">+</span><span class="s">&#39; Rotated {0:.0f} counterclockwise</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thetar</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        
        <span class="c">#create an implst to make code simpler</span>
        <span class="n">implst</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;ZXXR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXXI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXX.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZXYR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZXYI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>\
            <span class="p">[</span><span class="s">&#39;ZXY.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYXR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;ZYXI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="s">&#39;ZYX.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>\
            <span class="p">[</span><span class="s">&#39;ZYYR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYYI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;ZYY.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
        <span class="c">#write new impedances and variances</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">imp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">implst</span><span class="p">):</span>
            <span class="n">mm</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">nn</span><span class="o">=</span><span class="n">imp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:+.6E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">znew</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">imp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:+.6E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">znew</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:+.6E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvarnew</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">,</span><span class="n">nn</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
<span class="c">#            newedifid.write(&#39;\n&#39;)</span>
        
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;!****TIPPER****!&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">tiplst</span><span class="o">=</span><span class="p">[[</span><span class="s">&#39;TXR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TXI&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TX.VAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="s">&#39;TYR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s">&#39;TYI&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="s">&#39;TY.VAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">tip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tiplst</span><span class="p">):</span>
            <span class="n">mm</span><span class="o">=</span><span class="n">tip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; // &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:+.6E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tippernew</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:+.6E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tippernew</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nfreq</span><span class="p">)):</span>
                    <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tsp</span><span class="o">+</span><span class="s">&#39;{0:+.6E}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tippervarnew</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span><span class="n">mm</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">kk</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">5.</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;END&#39;</span><span class="p">)</span>
        
        <span class="n">edifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">newedifid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#copy file to a common folder</span>
        <span class="k">if</span> <span class="n">edifolderyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">newfile</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="n">ext</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="n">newedifile</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drcopypath</span><span class="p">,</span><span class="n">newedifile</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">newfile</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nedifn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">drdirpath</span><span class="p">,</span><span class="n">nedibn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nedifn</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">nedibn</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Z"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z">[docs]</a><span class="k">class</span> <span class="nc">Z</span><span class="p">(</span><span class="n">Edi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Z is a data type to deal with edifiles and manipulate them to do </span>
<span class="sd">    informative characterization.</span>
<span class="sd">    </span>
<span class="sd">    The methods are:</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Z.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">edifn</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Edi</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        
        <span class="c">#define some parameters to be filled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="o">=</span><span class="n">edifn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurement</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:[]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elevation</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zrot</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tippervar</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span>
        
        <span class="c">#get information from edifile as a datatype Edi</span>
        <span class="n">Edi</span><span class="o">.</span><span class="n">getInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="c">#define some parameters needed from older version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;DATAID&#39;</span><span class="p">]</span>
        
                    </div>
<div class="viewcode-block" id="Z.getInvariants"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.getInvariants">[docs]</a>    <span class="k">def</span> <span class="nf">getInvariants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the invariants according to Weaver et al. (2003) output is:</span>
<span class="sd">        a class with attributes:</span>
<span class="sd">            inv1,</span>
<span class="sd">            inv2,</span>
<span class="sd">            inv3,</span>
<span class="sd">            inv4,</span>
<span class="sd">            inv5,</span>
<span class="sd">            inv6,</span>
<span class="sd">            inv7,</span>
<span class="sd">            q,</span>
<span class="sd">            strike,</span>
<span class="sd">            strikeerr&quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="n">Zinvariants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Z.getPhaseTensor"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.getPhaseTensor">[docs]</a>    <span class="k">def</span> <span class="nf">getPhaseTensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate phase tensor elements following Caldwell et al. 2004.</span>
<span class="sd">        Inputs:</span>
<span class="sd">            rotate = coordinate axis is assumed to be Y north and X east, if the</span>
<span class="sd">                     data is in X north and Y east than a rotation of 180 is</span>
<span class="sd">                     necessary</span>
<span class="sd">            thetar = will rotate the data assuming that Y is 0 and X is 90 so </span>
<span class="sd">                     clockwise is positive.</span>
<span class="sd">            </span>
<span class="sd">        Returns a phase tensor class with attributes of:</span>
<span class="sd">            phi = phase tensor</span>
<span class="sd">            phivar = phase tensor errors</span>
<span class="sd">            phimin = minimum of the phase tensor in radians (invariant)</span>
<span class="sd">            phiminvar = errors of phimin</span>
<span class="sd">            phimax = maximum of phase tensor in radians (invariant)</span>
<span class="sd">            phimaxvar = erros of phimax</span>
<span class="sd">            alpha = angle between reference axis and coordinate axis</span>
<span class="sd">            alphavar = errors of alpha</span>
<span class="sd">            beta = anble between reference axis and principal axis of ellipse</span>
<span class="sd">            betavar = erros in beta</span>
<span class="sd">            azimuth = difference between alpha and beta orienting ellipse in </span>
<span class="sd">                      degrees, is measured counter-clockwise with x=0, y=90</span>
<span class="sd">            azimuthvar = erros in azimuth</span>
<span class="sd">            phiminang = phimin in degrees</span>
<span class="sd">            phiminangvar = errors in phimin in degrees</span>
<span class="sd">            ellipticity = measure of 3D effects</span>
<span class="sd">            ellipticityvar = errors in ellipticity</span>
<span class="sd">            phidet = determinant of phi as phimin*phimax from Bibby et al.[2005]</span>
<span class="sd">            phidetvar = errors in phidet            </span>
<span class="sd">            &quot;&quot;&quot;</span>
        
        <span class="n">pt</span><span class="o">=</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="n">rotate</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pt</span>
</div>
<div class="viewcode-block" id="Z.getTipper"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.getTipper">[docs]</a>    <span class="k">def</span> <span class="nf">getTipper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get tipper information and return a type with attributes:</span>
<span class="sd">        magreal</span>
<span class="sd">        magimag</span>
<span class="sd">        anglereal</span>
<span class="sd">        angleimag</span>
<span class="sd">        </span>
<span class="sd">        need to add error bars</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
           
        <span class="k">return</span> <span class="n">Tipper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">,</span><span class="n">rott</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
   </div>
<div class="viewcode-block" id="Z.removeDistortion"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.removeDistortion">[docs]</a>    <span class="k">def</span> <span class="nf">removeDistortion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        removeDistortion(self) will remove the distortion from the impedance</span>
<span class="sd">        tensor as prescribed by Bibby et al. [2005].  </span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            thetar = will rotate the data assuming that Y is 0 and X is 90 so </span>
<span class="sd">                     clockwise is positive. </span>
<span class="sd">        Outputs:</span>
<span class="sd">            D = distortion tensor</span>
<span class="sd">            newedifn = full path to new edifile the edifile as station+dr.edi.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">MTpy.core.MTtools</span> <span class="kn">as</span> <span class="nn">mt</span>

        <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">)</span>
        <span class="c">#calculate ellipticity to figure out the distortion from 1d structure</span>
        <span class="n">pt</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">getPhaseTensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
        <span class="n">zd</span><span class="o">=</span><span class="p">[]</span>
        <span class="c">#rotated identity matrix for static shift removal</span>
        <span class="n">im</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">ellip</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">ellipticity</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ellip</span><span class="o">&lt;.</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">X</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                <span class="n">Y</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
                <span class="c">#calculate static shift factor</span>
                <span class="n">gx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>
                <span class="n">gy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">Y</span><span class="p">)))</span>
                <span class="c">#remove static shift from real and imaginary parts</span>
                <span class="c">#need to use the dot for matric multiplication</span>
                <span class="n">Xs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">im</span><span class="p">)</span><span class="o">/</span><span class="n">gx</span>
                <span class="n">Ys</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">im</span><span class="p">)</span><span class="o">/</span><span class="n">gy</span>
                <span class="c">#append real and imaginary parts sequentially</span>
                <span class="n">zd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Xs</span><span class="p">)</span>
                <span class="n">zd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ys</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zd</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;There is no 1D structure for this station&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nedifn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edifn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#estimate distortion matrix </span>
            <span class="n">zd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zd</span><span class="p">)</span>
            <span class="n">D</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()],</span>
                         <span class="p">[</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()]])</span>
            <span class="n">Dvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
                            <span class="p">[</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="n">zd</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()]])</span>
            <span class="n">Dinv</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
            <span class="c">#remove distortion as (D^-1)Z[ii]</span>
            <span class="n">zdr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">D</span><span class="p">),</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))])</span>
            
            <span class="c">#estimate errors</span>
            <span class="n">zvardr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
                <span class="n">X</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                <span class="n">Xvar</span><span class="o">=</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                <span class="n">zvardr</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                            <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">zvardr</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                            <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">zvardr</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                            <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">zvardr</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                            <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Dvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Dinv</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">Xvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="c">#make new edi file. need to flip zdr and zvardr back to normal order </span>
            <span class="c">#for edi file.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rewriteedi</span><span class="p">(</span><span class="n">znew</span><span class="o">=</span><span class="n">zdr</span><span class="p">,</span><span class="n">zvarnew</span><span class="o">=</span><span class="n">zvardr</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">=</span><span class="n">D</span>
</div>
<div class="viewcode-block" id="Z.removeStaticShift"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.removeStaticShift">[docs]</a>    <span class="k">def</span> <span class="nf">removeStaticShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stol</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">dm</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">fspot</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        removeStaticShift(edifile,stol=.2,dm=1000) will remove static shift by </span>
<span class="sd">        calculating the median of respones of near by stations, within dm.  If the </span>
<span class="sd">        ratio of the station response to the median on either side of 1+-stol then </span>
<span class="sd">        the impedance tensor for that electric component will be corrected for </span>
<span class="sd">        static shift.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            edifile = full path to edi file. Note nearby stations will be </span>
<span class="sd">                    looked for in the dirname of edifile.  So have all edis in </span>
<span class="sd">                    one folder</span>
<span class="sd">                      </span>
<span class="sd">            stol = ratio tolerance.  If there is no static shift the ratio </span>
<span class="sd">                    between the response and the median response should be 1,</span>
<span class="sd">                    but noise and other factors can be present so a tolerance </span>
<span class="sd">                    around 1 is assumed.</span>
<span class="sd">                   </span>
<span class="sd">            dm = nearby station radius in meters.  If there is no station</span>
<span class="sd">                within that radius then no static shift will be corrected for.</span>
<span class="sd">                 </span>
<span class="sd">            fspot = the last index of frequencies to look at.  So if you want</span>
<span class="sd">                    to look for static shift in the first 20 frequencies</span>
<span class="sd">                    fspot=20</span>
<span class="sd">        </span>
<span class="sd">        Outputs:</span>
<span class="sd">            newedifile = full path to new edifile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">znewss</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        
        <span class="c">#get directory name where all edi files should be</span>
        <span class="n">edipath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edifn</span><span class="p">)</span>
        
        <span class="c">#make a list of filename from edipath</span>
        <span class="n">edilst</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edipath</span><span class="p">,</span><span class="n">dedifile</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">dedifile</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">edipath</span><span class="p">)</span> <span class="k">if</span> <span class="n">dedifile</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.edi&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>    
        
        <span class="n">rp</span><span class="o">=</span><span class="n">ResPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
        <span class="c">#loop over files to find nearby stations</span>
        <span class="n">resxlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">resylst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">statlst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">zone</span><span class="p">,</span><span class="n">northing</span><span class="p">,</span><span class="n">easting</span><span class="o">=</span><span class="n">utm2ll</span><span class="o">.</span><span class="n">LLtoUTM</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>   
        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">kedi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edilst</span><span class="p">):</span>
            <span class="n">zk</span><span class="o">=</span><span class="n">Edi</span><span class="p">(</span><span class="n">kedi</span><span class="p">)</span>
            <span class="n">zk</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
            <span class="n">zone</span><span class="p">,</span><span class="n">dn</span><span class="p">,</span><span class="n">de</span><span class="o">=</span><span class="n">utm2ll</span><span class="o">.</span><span class="n">LLtoUTM</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="n">zk</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span><span class="n">zk</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>        
            <span class="n">deltad</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dn</span><span class="o">-</span><span class="n">northing</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">de</span><span class="o">-</span><span class="n">easting</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deltad</span><span class="o">&lt;=</span><span class="n">dm</span><span class="p">:</span>
                <span class="n">zkrp</span><span class="o">=</span><span class="n">ResPhase</span><span class="p">(</span><span class="n">zk</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">zk</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
                <span class="n">resxlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zkrp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fspot</span><span class="p">])</span>
                <span class="n">resylst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zkrp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fspot</span><span class="p">])</span>
                <span class="n">statlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
        
        <span class="c">#make arrays for easy manipulation</span>
        <span class="n">resxlst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resxlst</span><span class="p">)</span>
        <span class="n">resylst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">resylst</span><span class="p">)</span>
        
        <span class="c">#calculate static shift of x-components</span>
        <span class="n">staticx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fspot</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">resxlst</span><span class="p">))</span>
        
        <span class="c">#see if it is within the tolerance level    </span>
        <span class="k">if</span> <span class="n">staticx</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">-</span><span class="n">stol</span> <span class="ow">or</span> <span class="n">staticx</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">+</span><span class="n">stol</span><span class="p">:</span>
            <span class="n">znewss</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticx</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;X-Shifted &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="o">+</span><span class="s">&#39; by &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticx</span><span class="p">))</span>
            <span class="n">xyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
        
        <span class="c">#calculate static shift of y-components</span>
        <span class="n">staticy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">fspot</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">resylst</span><span class="p">))</span>
        
        <span class="c">#see if it is within the tolerance level</span>
        <span class="k">if</span> <span class="n">staticy</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">-</span><span class="n">stol</span> <span class="ow">or</span> <span class="n">staticy</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">+</span><span class="n">stol</span><span class="p">:</span>
            <span class="n">znewss</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticy</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Y-Shifted &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="o">+</span><span class="s">&#39; by &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">staticy</span><span class="p">))</span> 
            <span class="n">yyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>
        <span class="k">else</span><span class="p">:</span><span class="n">yyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
        
        <span class="c">#if there was a correction write a new edi file</span>
        <span class="k">if</span> <span class="n">xyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span> <span class="ow">or</span> <span class="n">yyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rewriteedi</span><span class="p">(</span><span class="n">znew</span><span class="o">=</span><span class="n">znewss</span><span class="p">,</span><span class="n">zvarnew</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="s">&#39;SS&#39;</span><span class="p">)</span>
            
        <span class="c">#if no correction was made return the same edifile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;No Static Shift Correction for &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span>
 </div>
<div class="viewcode-block" id="Z.getResPhase"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.getResPhase">[docs]</a>    <span class="k">def</span> <span class="nf">getResPhase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        getResPhase will return a ResPhase class that has attributes of all 4</span>
<span class="sd">        components of resistivity and phase as well as the errors and </span>
<span class="sd">        determinants.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            ffactor = a fudge factor if the calibration or gains aren&#39;t quite </span>
<span class="sd">                      correct</span>
<span class="sd">            thetar = will rotate the data assumint that Y is 0 and X is 90 so </span>
<span class="sd">                     clockwise is positive.</span>
<span class="sd">        Returns a type with attributes of all components of the resistivity</span>
<span class="sd">        and phase</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">return</span> <span class="n">ResPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">,</span>
                        <span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Z.getResTensor"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.getResTensor">[docs]</a>    <span class="k">def</span> <span class="nf">getResTensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="mi">180</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        getResTensor will return a data type that describes the reistivity </span>
<span class="sd">        tensor defined by Weckmann et al. [2003]</span>
<span class="sd">        </span>
<span class="sd">        Input: </span>
<span class="sd">            thetar = rotation of impedance tensor</span>
<span class="sd">            rotate = rotation of coordinate system, default is Y to north and </span>
<span class="sd">                     X to the east</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="n">ResistivityTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">,</span>
                                 <span class="n">rotate</span><span class="o">=</span><span class="n">rotate</span><span class="p">)</span>
    
                </div>
<div class="viewcode-block" id="Z.plotResPhase"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.plotResPhase">[docs]</a>    <span class="k">def</span> <span class="nf">plotResPhase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">plottype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">savefigfilename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">phaselimits</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plotResPhase(filename,fignum) will plot the apparent resistivity and </span>
<span class="sd">        phase for TE and TM modes or all modes.  If there is tipper data it will</span>
<span class="sd">        be plotted at the bottom as real and imaginary parts.</span>
<span class="sd">    </span>
<span class="sd">        Inputs:</span>
<span class="sd">            filename = filename containing impedance (.edi) or resistivity and phase</span>
<span class="sd">                       information (.dat)</span>
<span class="sd">            fignum = figure number</span>
<span class="sd">            ffactor = fudge factor for computing resistivity from impedances</span>
<span class="sd">            thetar = rotation angle of impedance tensor (deg or radians)</span>
<span class="sd">            plottype = 1 for just Ex/By and Ey/Bx</span>
<span class="sd">                      2 for all 4 components</span>
<span class="sd">                      3 for off diagonal plus the determinant</span>
<span class="sd">            title = title of plot</span>
<span class="sd">            savefigfilename = supply filename to save figure to if desired</span>
<span class="sd">            dpi = figure resolution</span>
<span class="sd">            format = file type of saved figure pdf,svg,eps...</span>
<span class="sd">            orientation = orientation of figure on A4 paper</span>
<span class="sd">            </span>
<span class="sd">        Outputs:</span>
<span class="sd">            none</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">dpi</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span>
                
        <span class="n">rp</span><span class="o">=</span><span class="n">ResPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">,</span>
                       <span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span><span class="p">)</span>
        <span class="n">tp</span><span class="o">=</span><span class="n">Tipper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">,</span><span class="n">rott</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tp</span><span class="o">.</span><span class="n">magreal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span> <span class="ow">and</span> <span class="n">tp</span><span class="o">.</span><span class="n">magimag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">tpyn</span><span class="o">=</span><span class="s">&#39;n&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tpyn</span><span class="o">=</span><span class="s">&#39;y&#39;</span>               
        
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">13</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">95</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">25</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">05</span>
        <span class="c">#plt.rcParams[&#39;font.family&#39;]=&#39;helvetica&#39;</span>
        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">}</span>
        
        <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">hspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
            <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span><span class="n">hspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">)</span>
        
            
        <span class="c">#make figure for xy,yx components</span>
        <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mo">07</span><span class="p">)</span>
        
        
        <span class="c">#---------plot the apparent resistivity-----------------------------------</span>
        <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">1</span>  <span class="ow">or</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
                <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
                <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax5</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax5</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax5</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,:],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax5</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c">#--------Plot Resistivity-----------------------------------------------</span>
        <span class="n">erxy</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">mec</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">eryx</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">mec</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resyxerr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="c">#ax.set_xlabel(&#39;Period (s)&#39;,fontdict=fontdict)</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;app. res. ($\mathbf{\Omega \cdot m}$)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;$E_x/B_y$&#39;</span><span class="p">,</span><span class="s">&#39;$E_y/B_x$&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
        
        <span class="c">#-----Plot the phase----------------------------------------------------</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span>
                     <span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">)</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                     <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">,</span>
                     <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;phase (deg)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>

        <span class="c">#check the phase to see if any point are outside of [0:90]    </span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">phaselimits</span><span class="p">)</span>        
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c">#Add xx and yy components to the plot</span>
        <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="c">#---------plot the apparent resistivity-----------------------------------</span>
            <span class="n">ax3</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">erxx</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">resxx</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                              <span class="n">mec</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resxxerr</span><span class="p">,</span>
                              <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
            <span class="n">eryy</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">resyy</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                              <span class="n">mec</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resyyerr</span><span class="p">,</span>
                              <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax3</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            
            
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
                     <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryy</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;$E_x/B_x$&#39;</span><span class="p">,</span><span class="s">&#39;$E_y/B_y$&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
            
            <span class="c">#-----Plot the phase----------------------------------------------------</span>
            <span class="n">ax4</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
            
            <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexx</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">mec</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexxerr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                         <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyyerr</span><span class="p">,</span>
                         <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax4</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>        
            <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c">#Add determinant to the plot</span>
        <span class="k">if</span> <span class="n">plottype</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                
            <span class="c">#-------Plot resistivity--------------------------------------------</span>
            <span class="n">erdet</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">resdet</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                              <span class="n">mec</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resdeterr</span><span class="p">,</span>
                              <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
        
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">erdet</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;$E_x/B_y$&#39;</span><span class="p">,</span><span class="s">&#39;$E_y/B_x$&#39;</span><span class="p">,</span>
                      <span class="s">&#39;$\det(\mathbf{\hat{Z}})$&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span><span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
            
            <span class="c">#-----Plot the phase------------------------------------------------</span>
            
            <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">phasedet</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">mec</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasedeterr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">tpyn</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">txr</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="n">magreal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">anglereal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">tyr</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="n">magreal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">anglereal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
    
            <span class="n">txi</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="n">magimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">angleimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">tyi</span><span class="o">=</span><span class="n">tp</span><span class="o">.</span><span class="n">magimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">angleimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            
            <span class="n">nt</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">txr</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                     <span class="n">hwidth</span><span class="o">=.</span><span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
                     <span class="n">hheight</span><span class="o">=.</span><span class="mo">01</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hwidth</span><span class="o">=.</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
                    <span class="n">hheight</span><span class="o">=.</span><span class="mo">01</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
                <span class="n">overhang</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">ax5</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">txr</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">tyr</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                          <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="n">hwidth</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="n">hheight</span><span class="p">,</span>
                          <span class="n">length_includes_head</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span><span class="p">)</span>
                <span class="n">ax5</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">txi</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">tyi</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span>
                          <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">length_includes_head</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                          
            <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nt</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax5</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>              
            <span class="n">line1</span><span class="o">=</span><span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">line2</span><span class="o">=</span><span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="c">#            ax5.set_xlim(xmin=10**np.floor(np.log10(period[0])),</span>
<span class="c">#                         xmax=10**np.ceil(np.log10(period[-1])))</span>
            <span class="n">ax5</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">))</span>
                         
            <span class="n">ax5</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="s">&#39;real&#39;</span><span class="p">,</span><span class="s">&#39;imag&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper left&#39;</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span><span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
            <span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
            <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;tipper&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>    
            
            <span class="n">ax5</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax5</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c">#make title and show</span>
        <span class="k">if</span> <span class="n">title</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">savefigfilename</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dpi</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span>
                <span class="k">if</span> <span class="n">format</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">format</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span>
                <span class="k">if</span> <span class="n">orientation</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;landscape&#39;</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefigfilename</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">,</span>
                            <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
                </div>
<div class="viewcode-block" id="Z.plotPTAll"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.plotPTAll">[docs]</a>    <span class="k">def</span> <span class="nf">plotPTAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xspacing</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">esize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s">&#39;n&#39;</span><span class="p">,</span>
                  <span class="n">savepath</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span><span class="n">coordrot</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">ptmm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rpmm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plotAll will plot phase tensor, strike angle, min and max phase angle, </span>
<span class="sd">        azimuth, skew, and ellipticity as subplots on one plot.  It also plots</span>
<span class="sd">        the resistivity tensor along side the phase tensor for comparison.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            xspacing = spacing of tensors along x direction</span>
<span class="sd">            esize = size of tensor ellipses</span>
<span class="sd">            fignum = number of figure</span>
<span class="sd">            thetar = will rotate the data assuming that Y is 0 and X is 90 so </span>
<span class="sd">                     clockwise is positive.</span>
<span class="sd">            save = save the figure &#39;y&#39; or &#39;n&#39;</span>
<span class="sd">            savepath = path to save to, saves as savepath\statioAll.fmt</span>
<span class="sd">            fmt = format of save figure pdf,svg,eps,ps,png</span>
<span class="sd">            coordrot = rotation of coordinate directions by multiples of 90</span>
<span class="sd">            rpmm = min and max of resistivity tensor on log10 scale</span>
<span class="sd">            ptmm = min an max of phase tensor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c">#Set plot parameters</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">8</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">95</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">21</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">5</span>
        
        <span class="n">fs</span><span class="o">=</span><span class="mi">8</span>
        <span class="n">tfs</span><span class="o">=</span><span class="mi">10</span>
        
        <span class="c">#begin plotting</span>
        <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        
        <span class="n">pt</span><span class="o">=</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="n">coordrot</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
        <span class="n">rp</span><span class="o">=</span><span class="n">ResistivityTensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="n">coordrot</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
        <span class="n">zinv</span><span class="o">=</span><span class="n">Zinvariants</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
        <span class="c">#tipper=Tipper(rott=thetar)</span>
        <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span>
        <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
        
        <span class="n">pperiod</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="mi">10</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rpmm</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">rpmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">rhodet</span><span class="p">))</span>
            <span class="n">rpmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">rhodet</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rpmin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">rpmm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">rpmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">rpmm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">ptmm</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">ptmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">)</span>
            <span class="n">ptmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ptmin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ptmm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
            <span class="n">ptmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ptmm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
            
        <span class="c">#plotPhaseTensor</span>
        <span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="c">#make sure the ellipses will be visable</span>
            <span class="n">scaling</span><span class="o">=</span><span class="n">esize</span><span class="o">/</span><span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">eheight</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">scaling</span>
            <span class="n">ewidth</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">scaling</span>
            
            <span class="n">rheight</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="nb">max</span><span class="p">([</span><span class="n">rp</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">ii</span><span class="p">]])</span><span class="o">*</span><span class="n">esize</span>
            <span class="n">rwidth</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">/</span><span class="nb">max</span><span class="p">([</span><span class="n">rp</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">rp</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">ii</span><span class="p">]])</span><span class="o">*</span><span class="n">esize</span>
                
            <span class="c">#create an ellipse scaled by phimin and phimax and oriented along</span>
            <span class="c">#the azimuth    </span>
            <span class="n">ellip</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">xspacing</span><span class="o">*</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="n">ewidth</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="n">eheight</span><span class="p">,</span>
                          <span class="n">angle</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                          
            <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;nan&#39;</span><span class="p">:</span>
                <span class="n">cvars</span><span class="o">=</span><span class="mi">0</span>
<span class="c">#                    print &#39;less than 0 or nan&#39;,cvars</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cvars</span><span class="o">=</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ptmax</span><span class="o">-</span><span class="n">ptmin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cvars</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">:</span>
                    <span class="n">cvars</span><span class="o">=</span><span class="mi">1</span>
                
            <span class="n">ellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">cvars</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>                          
                          
            <span class="n">ax1</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ellip</span><span class="p">)</span>
            
            <span class="c">#resistivity tensor</span>
            <span class="n">rellip</span><span class="o">=</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">xspacing</span><span class="o">*</span><span class="n">ii</span><span class="p">,</span><span class="mi">3</span><span class="o">+</span><span class="n">esize</span><span class="p">),</span><span class="n">width</span><span class="o">=</span><span class="n">rwidth</span><span class="p">,</span>
                          <span class="n">height</span><span class="o">=</span><span class="n">rheight</span><span class="p">,</span>
                          <span class="n">angle</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">rhoazimuth</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                         
            <span class="n">cvar</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">-</span><span class="n">rpmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rpmax</span><span class="o">-</span><span class="n">rpmin</span><span class="p">)</span>
<span class="c">#            print &#39;rpcvar={0:.3g}&#39;.format(cvar)</span>
            <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;.</span><span class="mi">5</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cvar</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cvar</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rellip</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvar</span><span class="p">)))</span>
            
            <span class="n">ax1</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">rellip</span><span class="p">)</span>
        
<span class="c">#        xticklabels=[&#39;%.0g&#39; % period[ii] for ii in np.arange(start=0,stop=n,</span>
<span class="c">#                     step=3)]</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">:</span>
                <span class="n">xticklabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{0:.2g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">100</span> <span class="ow">and</span> <span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1000</span><span class="p">:</span>
                <span class="n">xticklabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{0:.3g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1000</span> <span class="ow">and</span> <span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">10000</span><span class="p">:</span>
                <span class="n">xticklabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;{0:.4g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">xx</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="c">#plt.title(&#39;Phase Tensor Ellipses for &#39;+stationstr,fontsize=14)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="n">xspacing</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="n">xspacing</span><span class="p">),</span>
                   <span class="n">xticklabels</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">esize</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">esize</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">xspacing</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="n">xspacing</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="n">cbpt</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cbpt</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="c">#        ax1cbpt=make_axes(cbpt,shrink=.9,orientation=&#39;horizontal&#39;,pad=.10)</span>
<span class="c">##        ax1cb=make_axes(ax1,shrink=.3,orientation=&#39;horizontal&#39;,pad=.30)</span>
<span class="c">#        cb1=ColorbarBase(ax1cbpt[0],cmap=ptcmap,</span>
<span class="c">#                        norm=Normalize(vmin=ptmin*180/np.pi,</span>
<span class="c">#                                       vmax=ptmax*180/np.pi),</span>
<span class="c">#                        orientation=&#39;horizontal&#39;)</span>
        <span class="n">ax1cbpt</span><span class="o">=</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">005</span><span class="p">)</span>
<span class="c">#        ax1cb=make_axes(ax1,shrink=.3,orientation=&#39;horizontal&#39;,pad=.30)</span>
        <span class="n">cb1</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">ax1cbpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">ptcmap</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">ptmin</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                                       <span class="n">vmax</span><span class="o">=</span><span class="n">ptmax</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                        <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="n">ptmin</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">ptmax</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
        <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s">&#39;{0:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ptmin</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                            <span class="s">&#39;{0:.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ptmax</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)])</span>
        
<span class="c">#        cb.set_label(&#39;Min Phase&#39;)</span>


        <span class="n">cbrt</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cbrt</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="c">#        ax1cbrt=make_axes(cbrt,shrink=.9,orientation=&#39;horizontal&#39;,pad=.10)</span>
<span class="c">##        ax1cb=make_axes(ax1,shrink=.3,orientation=&#39;horizontal&#39;,pad=.30)</span>
<span class="c">#        cb2=ColorbarBase(ax1cbrt[0],cmap=rtcmap,</span>
<span class="c">#                        norm=Normalize(vmin=10**rpmin,</span>
<span class="c">#                                       vmax=10**rpmax),</span>
<span class="c">#                        orientation=&#39;horizontal&#39;)</span>
        <span class="n">ax1cbrt</span><span class="o">=</span><span class="n">make_axes</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">shrink</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">,</span><span class="n">pad</span><span class="o">=.</span><span class="mo">01</span><span class="p">)</span>
<span class="c">#        ax1cb=make_axes(ax1,shrink=.3,orientation=&#39;horizontal&#39;,pad=.30)</span>
        <span class="n">cb2</span><span class="o">=</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">ax1cbrt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">rtcmap</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">rpmin</span><span class="p">,</span>
                                       <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">rpmax</span><span class="p">),</span>
                        <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cb2</span><span class="o">.</span><span class="n">draw_all</span><span class="p">()</span>
        <span class="n">cb2</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mi">10</span><span class="o">**</span><span class="n">rpmin</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="n">rpmax</span><span class="p">])</span>
        <span class="n">cb2</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s">&#39;{0:.2g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">rpmin</span><span class="p">),</span>
                            <span class="s">&#39;{0:.5g}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">rpmax</span><span class="p">)])</span>
<span class="c">#        cb.set_label(&#39;Min Phase&#39;)</span>
    
<span class="c">#        if len(stationlst)&gt;1:</span>
<span class="c">#            plt.legend(stationlst,loc=0,markerscale=.4,borderaxespad=.05,</span>
<span class="c">#                   labelspacing=.1,handletextpad=.2)</span>
<span class="c">#            leg=plt.gca().get_legend()</span>
<span class="c">#            ltext=leg.get_texts()  # all the text.Text instance in the legend</span>
<span class="c">#            plt.setp(ltext, fontsize=10)    # the legend text fontsize</span>
    
        
        <span class="c">#plotStrikeAngle</span>
        
        <span class="n">az</span><span class="o">=</span><span class="mi">90</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span>
        <span class="n">azvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">azimuthvar</span><span class="p">)</span>
<span class="c">#        realarrow=tipper.magreal</span>
<span class="c">#        realarrowvar=np.zeros(len(realarrow))+.00000001</span>
        <span class="n">az</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">az</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">)]</span><span class="o">=</span><span class="n">az</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">az</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">)]</span><span class="o">-</span><span class="mi">180</span>
        <span class="n">az</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">az</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">)]</span><span class="o">=</span><span class="n">az</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">az</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">)]</span><span class="o">+</span><span class="mi">180</span>
        
        <span class="n">strike</span><span class="o">=</span><span class="n">zinv</span><span class="o">.</span><span class="n">strike</span>
        <span class="n">strike</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">strike</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">)]</span><span class="o">=</span><span class="n">strike</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">strike</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">)]</span><span class="o">-</span><span class="mi">180</span>
        <span class="n">strike</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">strike</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">)]</span><span class="o">=</span><span class="n">strike</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">strike</span><span class="o">&lt;-</span><span class="mi">90</span><span class="p">)]</span><span class="o">+</span><span class="mi">180</span>
        
        <span class="n">ax2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">erxy</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">strike</span><span class="p">,</span>
                          <span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                          <span class="n">mec</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                          <span class="n">yerr</span><span class="o">=</span><span class="n">zinv</span><span class="o">.</span><span class="n">strikeerr</span><span class="p">,</span>
                          <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="n">eraz</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                          <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;purple&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">azvar</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;purple&#39;</span><span class="p">)</span>
        <span class="c">#ertip=plt.errorbar(period,realarrow,marker=&#39;&gt;&#39;,ms=4,mfc=&#39;None&#39;,mec=&#39;k&#39;,</span>
        <span class="c">#                   mew=1,ls=&#39;None&#39;,yerr=realarrowvar,ecolor=&#39;k&#39;)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eraz</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;Strike&#39;</span><span class="p">,</span><span class="s">&#39;Azimuth&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;lower left&#39;</span><span class="p">,</span>
                   <span class="n">markerscale</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">columnspacing</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">leg</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
        <span class="n">ltext</span>  <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()</span>  <span class="c"># all the text.Text instance in the legend</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ltext</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>    <span class="c"># the legend text fontsize</span>

        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span>
                 <span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">95</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
        <span class="c">#plt.xlabel(&#39;Period (s)&#39;,fontsize=fs,fontweight=&#39;bold&#39;)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Angle (deg)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Strike Angle, Azimuth&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tfs</span><span class="p">,</span>
                      <span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        
        <span class="c">#plotMinMaxPhase</span>
        
        <span class="n">minphi</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phiminang</span>
        <span class="n">minphivar</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phiminangvar</span>
        <span class="n">maxphi</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimaxang</span>
        <span class="n">maxphivar</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">phimaxangvar</span>

        <span class="n">ax3</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">ermin</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">minphi</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                           <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span>
                           <span class="n">yerr</span><span class="o">=</span><span class="n">minphivar</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ermax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">maxphi</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                           <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">maxphivar</span><span class="p">,</span>
                           <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">ermin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ermax</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;$\phi_{min}$&#39;</span><span class="p">,</span><span class="s">&#39;$\phi_{max}$&#39;</span><span class="p">),</span>
                   <span class="n">loc</span><span class="o">=</span><span class="s">&#39;lower left&#39;</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span>
                   <span class="n">labelspacing</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span><span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span>
                   <span class="n">columnspacing</span><span class="o">=.</span><span class="mo">01</span><span class="p">)</span>
        <span class="n">leg</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span>
        <span class="n">ltext</span>  <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">get_texts</span><span class="p">()</span>  <span class="c"># all the text.Text instance in the legend</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ltext</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mf">6.5</span><span class="p">)</span>    <span class="c"># the legend text fontsize</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span>
                 <span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
        <span class="c">#plt.xlabel(&#39;Period (s)&#39;,fontsize=fs,fontweight=&#39;bold&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;$\mathbf{\phi_{min}}$ and $\mathbf{\phi_{max}}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tfs</span><span class="p">,</span>
                  <span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>

        
        <span class="c">#plotSkew</span>
        
        <span class="n">skew</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">beta</span>
        <span class="n">skewvar</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">betavar</span>

        <span class="n">ax5</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">erskew</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">skew</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                            <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">skewvar</span><span class="p">,</span>
                            <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pperiod</span><span class="p">,[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span><span class="s">&#39;--k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pperiod</span><span class="p">,[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span><span class="s">&#39;--k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">ax5</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">skew</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">skew</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Skew Angle (deg)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Skew Angle&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tfs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        
        <span class="c">#plotEllipticity</span>
        
        <span class="n">ellipticity</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">ellipticity</span>
        <span class="n">ellipticityvar</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">ellipticityvar</span>

        <span class="n">ax6</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">erskew</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">ellipticity</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span>
                            <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;orange&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">ellipticityvar</span><span class="p">,</span>
                            <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;orange&#39;</span><span class="p">)</span>
        <span class="n">ax6</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax6</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pperiod</span><span class="p">,[</span><span class="o">.</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span><span class="s">&#39;--k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax6</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span>
                 <span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c">#plt.yticks(range(10),np.arange(start=0,stop=1,step=.1))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=.</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;$\mathbf{\phi_{max}-\phi_{min}/\phi_{max}+\phi_{min}}$&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Ellipticity&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">tfs</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
        <span class="c">#plt.suptitle(self.z.station,fontsize=tfs,fontweight=&#39;bold&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&#39;Phase Tensor Elements for: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="s">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">savepath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">savepath</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savepath</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Made Directory: &#39;</span><span class="o">+</span> <span class="n">savepath</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;All.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Saved figure to: &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savepath</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">station</span><span class="o">+</span><span class="s">&#39;All.&#39;</span><span class="o">+</span><span class="n">fmt</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">save</span><span class="o">==</span><span class="s">&#39;n&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        </div>
<div class="viewcode-block" id="Z.plotTipper"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Z.plotTipper">[docs]</a>    <span class="k">def</span> <span class="nf">plotTipper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thetar</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">plotnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plotTipper will plot the resistivity, phase and tipper</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rp</span><span class="o">=</span><span class="n">ResPhase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">thetar</span><span class="p">,</span>
                       <span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tip</span><span class="o">=</span><span class="n">Tipper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">,</span><span class="n">rott</span><span class="o">=</span><span class="n">thetar</span><span class="p">)</span>
        
        <span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span>
        <span class="n">nt</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tip</span><span class="o">.</span><span class="n">tipper</span><span class="p">)</span>

        <span class="n">txr</span><span class="o">=</span><span class="n">tip</span><span class="o">.</span><span class="n">magreal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tip</span><span class="o">.</span><span class="n">anglereal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">tyr</span><span class="o">=</span><span class="n">tip</span><span class="o">.</span><span class="n">magreal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tip</span><span class="o">.</span><span class="n">anglereal</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>

        <span class="n">txi</span><span class="o">=</span><span class="n">tip</span><span class="o">.</span><span class="n">magimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tip</span><span class="o">.</span><span class="n">angleimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">tyi</span><span class="o">=</span><span class="n">tip</span><span class="o">.</span><span class="n">magimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tip</span><span class="o">.</span><span class="n">angleimag</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.left&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">13</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.right&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">98</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.bottom&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.top&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">95</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.wspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mi">25</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.subplot.hspace&#39;</span><span class="p">]</span><span class="o">=.</span><span class="mo">05</span>
        <span class="c">#plt.rcParams[&#39;font.family&#39;]=&#39;helvetica&#39;</span>
        <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">}</span>
        
        <span class="n">gs</span><span class="o">=</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">hspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">)</span>
        
            
        <span class="c">#make figure for xy,yx components</span>
        <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fignum</span><span class="p">,[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">15</span><span class="p">,</span><span class="n">left</span><span class="o">=.</span><span class="mo">07</span><span class="p">)</span>
        
        <span class="c">#---------plot the apparent resistivity-----------------------------------</span>
        <span class="k">if</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">1</span>  <span class="ow">or</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
            <span class="n">ax3</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,:])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">055</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plotnum</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-.</span><span class="mo">075</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        
        
        <span class="n">erxy</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">resxy</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span>
                          <span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">eryx</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">resyx</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span>
                          <span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">resyxerr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="c">#ax.set_xlabel(&#39;Period (s)&#39;,fontdict=fontdict)</span>
        <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;App. Res. ($\mathbf{\Omega \cdot m}$)&#39;</span><span class="p">,</span>
                   <span class="n">fontdict</span><span class="o">=</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
                 <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">erxy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eryx</span><span class="p">[</span><span class="mi">0</span><span class="p">]),(</span><span class="s">&#39;$E_x/B_y$&#39;</span><span class="p">,</span><span class="s">&#39;$E_y/B_x$&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
        
        <span class="c">#-----Plot the phase----------------------------------------------------</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span>
                     <span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">period</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">)</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                     <span class="n">mfc</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">,</span>
                     <span class="n">ecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Phase (deg)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="c">#ax2.set_xlim(xmin=10**(np.floor(np.log10(period[0]))),</span>
        <span class="c">#         xmax=10**(np.ceil(np.log10(period[-1]))))</span>
        <span class="c">#check the phase to see if any point are outside of [0:90]    </span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">pymin</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">),</span><span class="nb">min</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">pymin</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">pymin</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pymin</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">90</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">:</span>
            <span class="n">pymax</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phasexy</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">+</span><span class="mi">180</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">pymax</span><span class="o">&lt;</span><span class="mi">91</span><span class="p">:</span>
                <span class="n">pymax</span><span class="o">=</span><span class="mi">90</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pymax</span><span class="o">=</span><span class="mi">90</span>
        
        <span class="n">pylab</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">pymin</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">pymax</span><span class="p">)</span>        
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c">#------Plot Tipper-----------------------------------------------------</span>
        
        
        <span class="n">ml</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span><span class="o">/</span><span class="n">nt</span>
        
        <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                 <span class="n">hwidth</span><span class="o">=.</span><span class="mi">1</span><span class="o">*</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
                 <span class="n">hheight</span><span class="o">=.</span><span class="mo">01</span><span class="o">*</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hwidth</span><span class="o">=.</span><span class="mi">2</span><span class="o">/</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
                <span class="n">hheight</span><span class="o">=.</span><span class="mo">01</span><span class="o">/</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span>
            <span class="n">overhang</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">txr</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">tyr</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                      <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="n">hwidth</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="n">hheight</span><span class="p">,</span>
                      <span class="n">length_includes_head</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">overhang</span><span class="o">=</span><span class="n">overhang</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">txi</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">tyi</span><span class="p">[</span><span class="n">aa</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span>
                      <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">length_includes_head</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">period</span><span class="p">,[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nt</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>              
        <span class="n">line1</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">line2</span><span class="o">=</span><span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span>
                     <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">))</span>
                     
        <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="s">&#39;Real&#39;</span><span class="p">,</span><span class="s">&#39;Imag&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper left&#39;</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">borderaxespad</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=.</span><span class="mo">07</span><span class="p">,</span><span class="n">handletextpad</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=.</span><span class="mo">02</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Period (s)&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Tipper&#39;</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s">&#39;weight&#39;</span><span class="p">:</span><span class="s">&#39;bold&#39;</span><span class="p">})</span>    
        
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">tyi</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-.</span><span class="mi">1</span><span class="p">,</span><span class="n">tyr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+.</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>        
            

                    </div></div>
<div class="viewcode-block" id="PhaseTensor"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.PhaseTensor">[docs]</a><span class="k">class</span> <span class="nc">PhaseTensor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PhaseTensor calculates the components of the phase tensor following </span>
<span class="sd">    Caldwell et al. [2004].</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PhaseTensor.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.PhaseTensor.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="c">#make z an array</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                
        <span class="c">#make a copy of z    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">zvar</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">zvar</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zvar</span><span class="p">])</span>                
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">zvar</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="o">=</span><span class="n">rotate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">rotz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nz</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phivar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phiminvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimaxvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphavar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">betavar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuthvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phiminang</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phiminangvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimaxang</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimaxangvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ellipticity</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ellipticityvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phidet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phidetvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        
        <span class="c">#rotate data if desired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#convert thetar into radians</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="c">#make rotation matrix</span>
            <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)]])</span>
            <span class="c">#rotate the data</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                        <span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        
            
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
            <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="n">Y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
            <span class="c">#calculate phase tensor and rotate  to align x pointing </span>
            <span class="c">#east and y pointing north following convention of Caldwell (2004)</span>
            <span class="k">if</span> <span class="n">rotate</span><span class="o">==</span><span class="mi">90</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">Y</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">rotate</span><span class="o">==</span><span class="mi">180</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">Y</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">rotate</span><span class="o">==</span><span class="mi">270</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">Y</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                    <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">Y</span><span class="p">)</span>
            <span class="c">#put variance into standard deviation</span>
            <span class="n">zvar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="c">#create a matrix for errors to be calculated</span>
            <span class="n">dphi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
            <span class="c">#compute determinate of X</span>
            <span class="n">detX</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="c">#calculate the deteriminate of the error matrix </span>
            <span class="n">ddet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="c">#calculate errors for each component of the matrix ala Caldwell </span>
            <span class="c">#2004</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span>
                <span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">zvar</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="c">#rotate the error matrix</span>
            <span class="n">dphi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">dphi</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="c">#finish calculating the errors</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                            <span class="p">(</span><span class="n">ddet</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                            <span class="p">(</span><span class="n">ddet</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                            <span class="p">(</span><span class="n">ddet</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                                            <span class="p">(</span><span class="n">ddet</span><span class="o">/</span><span class="n">detX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c">#Calculate Trace of Phi and error of trace of phi</span>
            <span class="n">tr</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">trvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c">#Calculate skew of phi and the cooresponding error</span>
            <span class="n">skew</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">skewvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c">#calculate the determinate and determinate error of phi</span>
            <span class="n">phidet</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
            <span class="n">phidetvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span>
                <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span>
                <span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c">#calculate reverse trace and error</span>
            <span class="n">revtr</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">revtrvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c">#calculate reverse skew and error</span>
            <span class="n">revskew</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">revskewvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dphi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c">#calculate skew angle beta and error</span>
            <span class="n">beta</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">skew</span><span class="p">,</span><span class="n">tr</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">betavar</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">skew</span><span class="o">*</span><span class="n">tr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">skewvar</span><span class="o">/</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span>
                                                <span class="n">trvar</span><span class="o">/</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            
            <span class="c">#calculate angle alpha corresponding to phase tensor&#39;s </span>
            <span class="c">#dependence on coordinate system</span>
            <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">revskew</span><span class="p">,</span><span class="n">revtr</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">alphavar</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">revskew</span><span class="o">*</span><span class="n">revtr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">revskewvar</span><span class="o">/</span><span class="n">revskew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">revtrvar</span><span class="o">/</span><span class="n">revtr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            
            <span class="c">#calculate azimuth as angle between major axis and x-axis</span>
            <span class="n">azimuth</span><span class="o">=</span><span class="n">alpha</span><span class="o">-</span><span class="n">beta</span>
            <span class="n">azimuthvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">alphavar</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">betavar</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="c">#calulate maximum value for phi</span>
            <span class="n">phimax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span>\
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phidet</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">phimaxvar</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">trvar</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">skewvar</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                                        <span class="mi">2</span><span class="o">*</span><span class="n">trvar</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">skewvar</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">phidetvar</span><span class="p">)</span>
            
            <span class="c">#calculate minimum value for phi</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">phimin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span>\
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phidet</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">phimin</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                            <span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span>
                            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">phidet</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">phiminvar</span><span class="o">=</span><span class="n">phimaxvar</span>
            
            <span class="c">#calculate ellipticity</span>
            <span class="n">phiminang</span><span class="o">=</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phimin</span><span class="p">))</span>
            <span class="n">phiminangvar</span><span class="o">=</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phiminvar</span><span class="p">))</span>
            <span class="n">phimaxang</span><span class="o">=</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phimax</span><span class="p">))</span>
            <span class="n">phimaxangvar</span><span class="o">=</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phimaxvar</span><span class="p">))</span>
            
            <span class="n">ellipticity</span><span class="o">=</span><span class="p">(</span><span class="n">phimaxang</span><span class="o">-</span><span class="n">phiminang</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">phimaxang</span><span class="o">+</span><span class="n">phiminang</span><span class="p">)</span>
            <span class="n">ellipticityvar</span><span class="o">=</span><span class="n">ellipticity</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phimaxangvar</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                    <span class="n">phiminangvar</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">phimaxang</span><span class="o">-</span><span class="n">phiminang</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">phimaxang</span><span class="o">+</span><span class="n">phiminang</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="n">phidet</span><span class="o">=</span><span class="n">phimin</span><span class="o">*</span><span class="n">phimax</span>
            <span class="n">phidetvar</span><span class="o">=</span><span class="n">phiminvar</span><span class="o">*</span><span class="n">phimaxvar</span>
            <span class="c">#append things to a dictionary of lists</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">phi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phivar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dphi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phimin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phiminvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phiminvar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phimax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimaxvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phimaxvar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alphavar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">alphavar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">betavar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">betavar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">azimuth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">azimuthvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">azimuthvar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phiminang</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phiminang</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phiminangvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phiminangvar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimaxang</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phimaxang</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimaxangvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phimaxangvar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipticity</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ellipticity</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ellipticityvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ellipticityvar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phidet</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phidet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phidetvar</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">phidetvar</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ResPhase"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.ResPhase">[docs]</a><span class="k">class</span> <span class="nc">ResPhase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ResPhase is a resistivity and phase class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ResPhase.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.ResPhase.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">period</span><span class="p">,</span><span class="n">zvar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ffactor</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="n">period</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">period</span><span class="p">])</span>
        
        <span class="c">#make a copy of z    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">zvar</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">zvar</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">zvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">zvar</span><span class="p">])</span>                
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="o">=</span><span class="n">zvar</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">rotz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ffactor</span><span class="o">=</span><span class="n">ffactor</span>
        
        <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">resxy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resxyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resxx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resxxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resyy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resyyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">phasexy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasexyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phaseyx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasexx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasexxerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phaseyy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phaseyyerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">resdet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resdeterr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasedet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasedeterr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        
        <span class="c">#rotate the data if desired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#convert thetar into radians</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="c">#make rotation matrix</span>
            <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)]])</span>
            <span class="c">#rotate the data</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        
        <span class="c">#calculate resistivity and phase components</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
            <span class="n">wt</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">*</span><span class="n">ffactor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">resxxerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">resxx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resxyerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">resxy</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resyxerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">resyx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resyyerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span>\
                        <span class="bp">self</span><span class="o">.</span><span class="n">resyy</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phasexx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phasexy</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phaseyx</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phaseyy</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phasexxerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span>
                                            <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phasexyerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span>
                                            <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phaseyxerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span>
                                            <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phaseyyerr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span>
                                            <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            
            <span class="c">#calculate determinant values</span>
            <span class="c">#apparent resistivity</span>
            <span class="n">zdet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">**.</span><span class="mi">5</span>
            <span class="n">zdetvar</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zvar</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">**.</span><span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resdet</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">zdet</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resdeterr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">wt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">zdet</span><span class="o">+</span><span class="n">zdetvar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">resdet</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
            
            <span class="c">#phase</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phasedet</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">zdet</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">zdet</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phasedeterr</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">zdetvar</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">zdet</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Tipper"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Tipper">[docs]</a><span class="k">class</span> <span class="nc">Tipper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tipper is a type with attributes:</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Tipper.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Tipper.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tipper</span><span class="p">,</span><span class="n">rott</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nt</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tipper</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">tipper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tipper</span><span class="p">])</span>
            <span class="n">nt</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tipper</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="o">=</span><span class="n">tipper</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">rott</span>
        
         <span class="c">#rotate the data if desired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#convert thetar into radians</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="c">#make rotation matrix</span>
            <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)]])</span>
            <span class="c">#rotate the data</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span>
                                        <span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="c">#get the magnitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magreal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magimag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c">#get the angle, need to make both parts negative to get it into the</span>
        <span class="c">#parkinson convention where the arrows point towards the conductor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anglereal</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                                        <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angleimag</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                                            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">tipper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</div></div>
<div class="viewcode-block" id="Zinvariants"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Zinvariants">[docs]</a><span class="k">class</span> <span class="nc">Zinvariants</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculates invariants from Weaver [2003]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="Zinvariants.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.Zinvariants.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">rotz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv5</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv6</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inv7</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strikeerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span>
        
        <span class="c">#rotate the data if desired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#convert thetar into radians</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="c">#make rotation matrix</span>
            <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)]])</span>
            <span class="c">#rotate the data</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
            <span class="c">#compute invariant parameters</span>
            <span class="n">x1</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
            <span class="n">x2</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
            <span class="n">x3</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
            <span class="n">x4</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
            <span class="n">e1</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">e2</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">e3</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">e4</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">ex</span><span class="o">=</span><span class="n">x1</span><span class="o">*</span><span class="n">e1</span><span class="o">-</span><span class="n">x2</span><span class="o">*</span><span class="n">e2</span><span class="o">-</span><span class="n">x3</span><span class="o">*</span><span class="n">e3</span><span class="o">+</span><span class="n">x4</span><span class="o">*</span><span class="n">e4</span>
            <span class="n">d12</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">e2</span><span class="o">-</span><span class="n">x2</span><span class="o">*</span><span class="n">e1</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">d34</span><span class="o">=</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="n">e4</span><span class="o">-</span><span class="n">x4</span><span class="o">*</span><span class="n">e3</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">d13</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">e3</span><span class="o">-</span><span class="n">x3</span><span class="o">*</span><span class="n">e1</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">d24</span><span class="o">=</span><span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">e4</span><span class="o">-</span><span class="n">x4</span><span class="o">*</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">d41</span><span class="o">=</span><span class="p">(</span><span class="n">x4</span><span class="o">*</span><span class="n">e1</span><span class="o">-</span><span class="n">x1</span><span class="o">*</span><span class="n">e4</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">d23</span><span class="o">=</span><span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">e3</span><span class="o">-</span><span class="n">x3</span><span class="o">*</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">inv1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x4</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">inv2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">e4</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">inv3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">x3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">inv1</span>
            <span class="n">inv4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">e2</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">e3</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">inv2</span>
            <span class="n">s12</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">e2</span><span class="o">+</span><span class="n">x2</span><span class="o">*</span><span class="n">e1</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">s34</span><span class="o">=</span><span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="n">e4</span><span class="o">+</span><span class="n">x4</span><span class="o">*</span><span class="n">e3</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">s13</span><span class="o">=</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">e3</span><span class="o">+</span><span class="n">x3</span><span class="o">*</span><span class="n">e1</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">s24</span><span class="o">=</span><span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">e4</span><span class="o">+</span><span class="n">x4</span><span class="o">*</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">s41</span><span class="o">=</span><span class="p">(</span><span class="n">x4</span><span class="o">*</span><span class="n">e1</span><span class="o">+</span><span class="n">x1</span><span class="o">*</span><span class="n">e4</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">s23</span><span class="o">=</span><span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">e3</span><span class="o">+</span><span class="n">x3</span><span class="o">*</span><span class="n">e2</span><span class="p">)</span><span class="o">/</span><span class="n">ex</span>
            <span class="n">inv5</span><span class="o">=</span><span class="n">s41</span><span class="o">*</span><span class="n">ex</span><span class="o">/</span><span class="p">(</span><span class="n">inv1</span><span class="o">*</span><span class="n">inv2</span><span class="p">)</span>
            <span class="n">inv6</span><span class="o">=</span><span class="n">d41</span><span class="o">*</span><span class="n">ex</span><span class="o">/</span><span class="p">(</span><span class="n">inv1</span><span class="o">*</span><span class="n">inv2</span><span class="p">)</span>
            <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">d12</span><span class="o">-</span><span class="n">d34</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">d13</span><span class="o">+</span><span class="n">d24</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">inv7</span><span class="o">=</span><span class="p">(</span><span class="n">d41</span><span class="o">-</span><span class="n">d23</span><span class="p">)</span><span class="o">/</span><span class="n">q</span>
            <span class="n">strikeang</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">d12</span><span class="o">-</span><span class="n">d34</span><span class="p">,</span><span class="n">d13</span><span class="o">+</span><span class="n">d24</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">strikeangerr</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">inv7</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv1</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">inv1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv2</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">inv2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv3</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">inv3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv4</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">inv4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv5</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">inv5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv6</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">inv6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv7</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">inv7</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">q</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strike</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">strikeang</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strikeerr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">strikeangerr</span>
            </div></div>
<div class="viewcode-block" id="ResistivityTensor"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.ResistivityTensor">[docs]</a><span class="k">class</span> <span class="nc">ResistivityTensor</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gets components of the resistivity tensor defined by Weckmann et al. [2003]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ResistivityTensor.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.ResistivityTensor.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">frequency</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z</span><span class="p">])</span>
            <span class="n">frequency</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">frequency</span><span class="p">])</span>
            <span class="n">nz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">rotz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c">#rotate impedance tensor to align x pointing </span>
        <span class="c">#east and y pointing north following convention of Weckmann [2003]</span>
        <span class="k">if</span> <span class="n">rotate</span><span class="o">==</span><span class="mi">90</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">z</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">rotate</span><span class="o">==</span><span class="mi">180</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">z</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">rotate</span><span class="o">==</span><span class="mi">270</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">zz</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">zz</span> <span class="ow">in</span> <span class="n">z</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    
        
        <span class="c">#rotate the data if desired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="c">#convert thetar into radians</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="c">#make rotation matrix</span>
            <span class="n">rotmatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)],</span>
                         <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="p">)]])</span>
            <span class="c">#rotate the data</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nz</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">rotmatrix</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">zz</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>            
                <span class="n">Y</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                <span class="k">pass</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=-</span><span class="n">frequency</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="n">frequency</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=-</span><span class="n">frequency</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="n">frequency</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">gg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>                
                <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=.</span><span class="mi">2</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">gg</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span> 
            <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                <span class="k">pass</span>
                                        
        <span class="bp">self</span><span class="o">.</span><span class="n">rhodet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">])))</span>
        
        <span class="n">pi1</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>\
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pi2</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>\
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">rhomax</span><span class="o">=</span><span class="n">pi1</span><span class="o">+</span><span class="n">pi2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhomin</span><span class="o">=</span><span class="n">pi2</span><span class="o">-</span><span class="n">pi1</span>
		
        <span class="bp">self</span><span class="o">.</span><span class="n">rhoalpha</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhobeta</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhoazimuth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoalpha</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rhobeta</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">gg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>                
                <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=.</span><span class="mi">2</span><span class="o">*</span><span class="n">frequency</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">gg</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> 
            <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                <span class="k">pass</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">epsdet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> 
                            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">])))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">epsmax</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsmin</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsalpha</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsbeta</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsazimuth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsalpha</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">epsbeta</span>
        </div></div>
<div class="viewcode-block" id="PhaseTensorResidual"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.PhaseTensorResidual">[docs]</a><span class="k">class</span> <span class="nc">PhaseTensorResidual</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    calculates the tensor residual</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="PhaseTensorResidual.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.PhaseTensorResidual.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="mi">180</span><span class="p">):</span>
        <span class="n">z1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>        
        <span class="n">z2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span>        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>        
            <span class="bp">self</span><span class="o">.</span><span class="n">z1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z1</span><span class="o">=</span><span class="n">z1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z2</span><span class="o">=</span><span class="n">z2</span>
            
        <span class="n">nf</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">shape</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">rotz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotatecoord</span><span class="o">=</span><span class="n">rotate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecolor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        
        <span class="n">pt1</span><span class="o">=</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">rotz</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="n">rotate</span><span class="p">)</span>
        <span class="n">pt2</span><span class="o">=</span><span class="n">PhaseTensor</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">rotz</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="n">rotate</span><span class="p">)</span>
        
        <span class="c">#calculate the difference between the two phase tensor ellipses</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
<span class="c">#            phi=np.eye(2)-\</span>
<span class="c">#                (np.dot(np.linalg.inv(pt2.phi[ii]),pt1.phi[ii])+</span>
<span class="c">#                np.dot(pt1.phi[ii],np.linalg.inv(pt2.phi[ii])))/2             </span>
            <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">pt1</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span><span class="n">pt2</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>             
            
            <span class="c">#compute the trace        </span>
            <span class="n">tr</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="c">#Calculate skew of phi and the cooresponding error</span>
            <span class="n">skew</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#calculate the determinate and determinate error of phi</span>
            <span class="n">phidet</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
            
            <span class="c">#calculate reverse trace and error</span>
            <span class="n">revtr</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c">#calculate reverse skew and error</span>
            <span class="n">revskew</span><span class="o">=</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="n">beta</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">skew</span><span class="p">,</span><span class="n">tr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">revskew</span><span class="p">,</span><span class="n">revtr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            
            <span class="c">#need to figure out why azimuth is off by 90 deg</span>
            <span class="n">azimuth</span><span class="o">=</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span>                   
           
            <span class="c">#calculate phimax</span>
            <span class="n">phimax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span>\
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phidet</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                
            <span class="c">#calculate minimum value for phi</span>
            <span class="k">if</span> <span class="n">phidet</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">phimin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">-</span>\
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phidet</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">phidet</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">phimin</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span>
                            <span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">tr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">phidet</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
                            
            <span class="n">ecolor</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">phi</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">phi</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span><span class="o">/</span><span class="mi">2</span>
            
            <span class="c">#put things into arrays</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">phimax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">phimin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">azimuth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">beta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ecolor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">ecolor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">phi</span>
        </div></div>
<div class="viewcode-block" id="ResistivityTensorResidual"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.ResistivityTensorResidual">[docs]</a><span class="k">class</span> <span class="nc">ResistivityTensorResidual</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    will calculate the resistivity residual between two tensors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="ResistivityTensorResidual.__init__"><a class="viewcode-back" href="../../../core.Z.html#MTpy.core.Z.ResistivityTensorResidual.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">frequency</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">rotatecoord</span><span class="o">=</span><span class="mi">180</span><span class="p">):</span>
        <span class="n">z1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>        
        <span class="n">z2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span>        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>        
            <span class="bp">self</span><span class="o">.</span><span class="n">z1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">z2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z1</span><span class="o">=</span><span class="n">z1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z2</span><span class="o">=</span><span class="n">z2</span>
            
        <span class="n">nf</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="o">=</span><span class="n">z1</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetar</span><span class="o">=</span><span class="n">rotz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotatecoord</span><span class="o">=</span><span class="n">rotatecoord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhomin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhomax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhodet</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecolor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        
        <span class="n">rt1</span><span class="o">=</span><span class="n">ResistivityTensor</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span><span class="n">frequency</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">rotz</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="n">rotatecoord</span><span class="p">)</span>
        <span class="n">rt2</span><span class="o">=</span><span class="n">ResistivityTensor</span><span class="p">(</span><span class="n">z2</span><span class="p">,</span><span class="n">frequency</span><span class="p">,</span><span class="n">rotz</span><span class="o">=</span><span class="n">rotz</span><span class="p">,</span><span class="n">rotate</span><span class="o">=</span><span class="n">rotatecoord</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="n">rho</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span>\
                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">rt2</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">ii</span><span class="p">]),</span><span class="n">rt1</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">+</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rt1</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">rt2</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">ii</span><span class="p">])))</span><span class="o">/</span><span class="mi">2</span>
                    
            <span class="n">pi1</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">pi2</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="n">rhomax</span><span class="o">=</span><span class="n">pi1</span><span class="o">+</span><span class="n">pi2</span>
            <span class="n">rhomin</span><span class="o">=</span><span class="n">pi2</span><span class="o">-</span><span class="n">pi1</span>
            
            <span class="n">alpha</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">beta</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
            
            <span class="n">azimuth</span><span class="o">=</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            
            <span class="n">ecolor</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rt1</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">rt2</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">*</span>\
                    <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">rho</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span><span class="o">/</span><span class="mi">2</span>
                    
            <span class="n">rhodet</span><span class="o">=</span><span class="n">rt1</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">rt2</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    
            <span class="c">#put things into arrays</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rhomax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">rhomax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rhomin</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">rhomin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">azimuth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ecolor</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">ecolor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">rho</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rhodet</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">rhodet</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">MTpy 0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jared Peacock, Lars Krieger, Stephan Thiel, Kent Inverarity.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>